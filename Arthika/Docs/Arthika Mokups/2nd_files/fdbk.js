(function(a,b,c){function d(a){var b=document.documentElement.style,c;if(typeof b[a]=="string")return a;a=e(a);for(var d=0,g=f.length;d<g;d++){c=f[d]+a;if(typeof b[c]=="string")return c}}function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}var f="Moz Webkit Khtml O Ms".split(" "),g=d("transform"),h={csstransforms:function(){return!!g},csstransforms3d:function(){var a=!!d("perspective");if(a){var c=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),e="@media ("+c.join("transform-3d),(")+"modernizr)",f=b("<style>"+e+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),g=b('<div id="modernizr" />').appendTo("html");a=g.height()===3,g.remove(),f.remove()}return a},csstransitions:function(){return!!d("transitionProperty")}};if(a.Modernizr)for(var i in h)Modernizr.hasOwnProperty(i)||Modernizr.addTest(i,h[i]);else a.Modernizr=function(){var a={_version:"1.6ish: miniModernizr for Isotope"},c=" ",d,e;for(e in h)d=h[e](),a[e]=d,c+=" "+(d?"":"no-")+e;return b("html").addClass(c),a}();if(Modernizr.csstransforms){var j=Modernizr.csstransforms3d?{translate:function(a){return"translate3d("+a[0]+"px, "+a[1]+"px, 0) "},scale:function(a){return"scale3d("+a+", "+a+", 1) "}}:{translate:function(a){return"translate("+a[0]+"px, "+a[1]+"px) "},scale:function(a){return"scale("+a+") "}},k=function(a,c,d){var e=b.data(a,"isoTransform")||{},f={},h,i={},k;f[c]=d,b.extend(e,f);for(h in e)k=e[h],i[h]=j[h](k);var l=i.translate||"",m=i.scale||"",n=l+m;b.data(a,"isoTransform",e),a.style[g]=n};b.cssNumber.scale=!0,b.cssHooks.scale={set:function(a,b){k(a,"scale",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.scale?d.scale:1}},b.fx.step.scale=function(a){b.cssHooks.scale.set(a.elem,a.now+a.unit)},b.cssNumber.translate=!0,b.cssHooks.translate={set:function(a,b){k(a,"translate",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.translate?d.translate:[0,0]}}}var l=b.event,m;l.special.smartresize={setup:function(){b(this).bind("resize",l.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",l.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize",m&&clearTimeout(m),m=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Isotope=function(a,c){this.element=b(c),this._create(a),this._init()};var n=["overflow","position","width","height"];b.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:Modernizr.csstransforms&&!b.browser.opera?{opacity:0,scale:.001}:{opacity:0},visibleStyle:Modernizr.csstransforms&&!b.browser.opera?{opacity:1,scale:1}:{opacity:1},animationEngine:b.browser.opera?"jquery":"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!0,itemPositionDataEnabled:!1},b.Isotope.prototype={_create:function(c){this.options=b.extend({},b.Isotope.settings,c),this.styleQueue=[],this.elemCount=0;var d=this.element[0].style;this.originalStyle={};for(var e=0,f=n.length;e<f;e++){var g=n[e];this.originalStyle[g]=d[g]||""}this.element.css({overflow:"hidden",position:"relative"}),this._updateAnimationEngine(),this._updateUsingTransforms();var h={"original-order":function(a,b){return b.elemCount},random:function(){return Math.random()}};this.options.getSortData=b.extend(this.options.getSortData,h),this.reloadItems();var i=b(document.createElement("div")).prependTo(this.element);this.offset=i.position(),i.remove();var j=this;setTimeout(function(){j.element.addClass(j.options.containerClass)},0),this.options.resizable&&b(a).bind("smartresize.isotope",function(){j.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(a){var b=this.options.itemSelector,c=b?a.filter(b).add(a.find(b)):a,d={position:"absolute"};return this.usingTransforms&&(d.left=0,d.top=0),c.css(d).addClass(this.options.itemClass),this.updateSortData(c,!0),c},_init:function(a){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(a)},option:function(a){if(b.isPlainObject(a)){this.options=b.extend(!0,this.options,a);var c;for(var d in a)c="_update"+e(d),this[c]&&this[c]()}},_updateAnimationEngine:function(){var a=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,"");switch(a){case"css":case"none":this.isUsingJQueryAnimation=!1;break;case"jquery":this.isUsingJQueryAnimation=!0;break;default:this.isUsingJQueryAnimation=!Modernizr.csstransitions}this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){this.usingTransforms=this.options.transformsEnabled&&Modernizr.csstransforms&&Modernizr.csstransitions&&!this.isUsingJQueryAnimation,this.getPositionStyles=this.usingTransforms?this._translate:this._positionAbs},_filter:function(a){var b=this.options.filter===""?"*":this.options.filter;if(!b)return a;var c=this.options.hiddenClass,d="."+c,e=a.filter(d),f=e;if(b!=="*"){f=e.filter(b);var g=a.not(d).not(b).addClass(c);this.styleQueue.push({$el:g,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:f,style:this.options.visibleStyle}),f.removeClass(c),a.filter(b)},updateSortData:function(a,c){var d=this,e=this.options.getSortData,f,g;a.each(function(){f=b(this),g={};for(var a in e)g[a]=e[a](f,d);b.data(this,"isotope-sort-data",g),c&&d.elemCount++})},_sort:function(){var a=this.options.sortBy,b=this._getSorter,c=this.options.sortAscending?1:-1,d=function(d,e){var f=b(d,a),g=b(e,a);return f===g&&a!=="original-order"&&(f=b(d,"original-order"),g=b(e,"original-order")),(f>g?1:f<g?-1:0)*c};this.$filteredAtoms.sort(d)},_getSorter:function(a,c){return b.data(a,"isotope-sort-data")[c]},_translate:function(a,b){return{translate:[a,b]}},_positionAbs:function(a,b){return{left:a,top:b}},_pushPosition:function(a,b,c){b+=this.offset.left,c+=this.offset.top;var d=this.getPositionStyles(b,c);this.styleQueue.push({$el:a,style:d}),this.options.itemPositionDataEnabled&&a.data("isotope-item-position",{x:b,y:c})},layout:function(a,b){var c=this.options.layoutMode;this["_"+c+"Layout"](a);if(this.options.resizesContainer){var d=this["_"+c+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:d})}this._processStyleQueue(),b&&b.call(a),this.isLaidOut=!0},_processStyleQueue:function(){var a=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",c=this.options.animationOptions,d=this._isInserting&&this.isUsingJQueryAnimation,e;b.each(this.styleQueue,function(b,f){e=d&&f.$el.hasClass("no-transition")?"css":a,f.$el[e](f.style,c)}),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(a){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,a)},addItems:function(a,b){var c=this._getAtoms(a);this.$allAtoms=this.$allAtoms.add(c),b&&b(c)},insert:function(a,b){this.element.append(a);var c=this;this.addItems(a,function(a){var d=c._filter(a,!0);c._addHideAppended(d),c._sort(),c.reLayout(),c._revealAppended(d,b)})},appended:function(a,b){var c=this;this.addItems(a,function(a){c._addHideAppended(a),c.layout(a),c._revealAppended(a,b)})},_addHideAppended:function(a){this.$filteredAtoms=this.$filteredAtoms.add(a),a.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:a,style:this.options.hiddenStyle})},_revealAppended:function(a,b){var c=this;setTimeout(function(){a.removeClass("no-transition"),c.styleQueue.push({$el:a,style:c.options.visibleStyle}),c._processStyleQueue(),delete c._isInserting,b&&b(a)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(a){this.$allAtoms=this.$allAtoms.not(a),this.$filteredAtoms=this.$filteredAtoms.not(a),a.remove()},shuffle:function(){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout()},destroy:function(){var c=this.usingTransforms;this.$allAtoms.removeClass(this.options.hiddenClass+" "+this.options.itemClass).each(function(){this.style.position="",this.style.top="",this.style.left="",this.style.opacity="",c&&(this.style[g]="")});var d=this.element[0].style;for(var e=0,f=n.length;e<f;e++){var h=n[e];d[h]=this.originalStyle[h]}this.element.unbind(".isotope").undelegate("."+this.options.hiddenClass,"click").removeClass(this.options.containerClass).removeData("isotope"),b(a).unbind(".isotope")},_getSegments:function(a){var b=this.options.layoutMode,c=a?"rowHeight":"columnWidth",d=a?"height":"width",f=a?"rows":"cols",g=this.element[d](),h,i=this.options[b]&&this.options[b][c]||this.$filteredAtoms["outer"+e(d)](!0)||g;h=Math.floor(g/i),h=Math.max(h,1),this[b][f]=h,this[b][c]=i},_checkIfSegmentsChanged:function(a){var b=this.options.layoutMode,c=a?"rows":"cols",d=this[b][c];return this._getSegments(a),this[b][c]!==d},_masonryReset:function(){this.masonry={},this._getSegments();var a=this.masonry.cols;this.masonry.colYs=[];while(a--)this.masonry.colYs.push(0)},_masonryLayout:function(a){var c=this,d=c.masonry;a.each(function(){var a=b(this),e=Math.ceil(a.outerWidth(!0)/d.columnWidth);e=Math.min(e,d.cols);if(e===1)c._masonryPlaceBrick(a,d.colYs);else{var f=d.cols+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.colYs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryPlaceBrick(a,g)}})},_masonryPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=this.masonry.columnWidth*d,h=c;this._pushPosition(a,g,h);var i=c+a.outerHeight(!0),j=this.masonry.cols+1-f;for(e=0;e<j;e++)this.masonry.colYs[d+e]=i},_masonryGetContainerSize:function(){var a=Math.max.apply(Math,this.masonry.colYs);return{height:a}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(a){var c=this,d=this.element.width(),e=this.fitRows;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.x!==0&&f+e.x>d&&(e.x=0,e.y=e.height),c._pushPosition(a,e.x,e.y),e.height=Math.max(e.y+g,e.height),e.x+=f})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(a){var c=this,d=this.cellsByRow;a.each(function(){var a=b(this),e=d.index%d.cols,f=~~(d.index/d.cols),g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,0,c.straightDown.y),c.straightDown.y+=d.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var a=this.masonryHorizontal.rows;this.masonryHorizontal.rowXs=[];while(a--)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(a){var c=this,d=c.masonryHorizontal;a.each(function(){var a=b(this),e=Math.ceil(a.outerHeight(!0)/d.rowHeight);e=Math.min(e,d.rows);if(e===1)c._masonryHorizontalPlaceBrick(a,d.rowXs);else{var f=d.rows+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.rowXs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryHorizontalPlaceBrick(a,g)}})},_masonryHorizontalPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=c,h=this.masonryHorizontal.rowHeight*d;this._pushPosition(a,g,h);var i=c+a.outerWidth(!0),j=this.masonryHorizontal.rows+1-f;for(e=0;e<j;e++)this.masonryHorizontal.rowXs[d+e]=i},_masonryHorizontalGetContainerSize:function(){var a=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:a}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(a){var c=this,d=this.element.height(),e=this.fitColumns;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.y!==0&&g+e.y>d&&(e.x=e.width,e.y=0),c._pushPosition(a,e.x,e.y),e.width=Math.max(e.x+f,e.width),e.y+=g})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(a){var c=this,d=this.cellsByColumn;a.each(function(){var a=b(this),e=~~(d.index/d.rows),f=d.index%d.rows,g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,c.straightAcross.x,0),c.straightAcross.x+=d.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},b.fn.imagesLoaded=function(a){function b(){--f<=0&&this.src!==h&&(setTimeout(d),e.unbind("load error",b))}function d(){a.call(g,e)}var e=this.find("img"),f=e.length,g=this,h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return f||d(),e.bind("load error",b).each(function(){if(this.complete||this.complete===c){var a=this.src;this.src=h,this.src=a}}),this};var o=function(a){this.console&&console.error(a)};b.fn.isotope=function(a){if(typeof a=="string"){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=b.data(this,"isotope");if(!d)o("cannot call methods on isotope prior to initialization; attempted to call method '"+a+"'");else{if(!b.isFunction(d[a])||a.charAt(0)==="_"){o("no such method '"+a+"' for isotope instance");return}d[a].apply(d,c)}})}else this.each(function(){var c=b.data(this,"isotope");c?(c.option(a),c._init()):b.data(this,"isotope",new b.Isotope(a,this))});return this}})(window,jQuery),function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery),function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires=="number"){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g=d.raw?function(a){return a}:decodeURIComponent,h=document.cookie.split("; ");for(var i=0,j;j=h[i]&&h[i].split("=");i++)if(g(j[0])===b)return g(j[1]||"");return null}}(jQuery),function(a,b){function c(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,a._a=null,this._lang=c||!1}function d(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,f=a.weeks||a.w||0,g=a.days||a.d||0,h=a.hours||a.h||0,i=a.minutes||a.m||0,j=a.seconds||a.s||0,k=a.milliseconds||a.ms||0;this._milliseconds=k+j*1e3+i*6e4+h*36e5,this._days=g+f*7,this._months=d+c*12,b.milliseconds=k%1e3,j+=e(k/1e3),b.seconds=j%60,i+=e(j/60),b.minutes=i%60,h+=e(i/60),b.hours=h%24,g+=e(h/24),g+=f*7,b.days=g%30,d+=e(g/30),b.months=d%12,c+=e(d/12),b.years=c,this._lang=!1}function e(a){return a<0?Math.ceil(a):Math.floor(a)}function f(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function g(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function h(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function j(b,c){var d,e;for(d=1;d<7;d++)b[d]=b[d]==null?d===2?1:0:b[d];return b[7]=c,e=new a(0),c?(e.setUTCFullYear(b[0],b[1],b[2]),e.setUTCHours(b[3],b[4],b[5],b[6])):(e.setFullYear(b[0],b[1],b[2]),e.setHours(b[3],b[4],b[5],b[6])),e._a=b,e}function k(a,b){var c,d,e=[];!b&&H&&(b=require("./lang/"+a));for(c=0;c<I.length;c++)b[I[c]]=b[I[c]]||F.en[I[c]];for(c=0;c<12;c++)d=B([2e3,c]),e[c]=new RegExp("^"+(b.months[c]||b.months(d,""))+"|^"+(b.monthsShort[c]||b.monthsShort(d,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||e,F[a]=b,b}function l(a){var b=typeof a=="string"&&a||a&&a._lang||null;return b?F[b]||k(b):B}function m(a){return ba[a]?"'+("+ba[a]+")+'":a.replace(M,"").replace(/\\?'/g,"\\'")}function n(a){return l().longDateFormat[a]||a}function o(a){var b="var a,b;return '"+a.replace(K,m)+"';",c=Function;return new c("t","v","o","p","m",b)}function p(a){return _[a]||(_[a]=o(a)),_[a]}function q(a,b){function c(c,e){return d[c].call?d[c](a,b):d[c][e]}var d=l(a);while(L.test(b))b=b.replace(L,n);return _[b]||(_[b]=o(b)),_[b](a,c,d.ordinal,f,d.meridiem)}function r(a){switch(a){case"DDDD":return Q;case"YYYY":return R;case"S":case"SS":case"SSS":case"DDD":return P;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return S;case"Z":case"ZZ":return T;case"T":return U;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return O;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c,d){var e;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(l().monthsParse[e].test(b)){c[1]=e;break}break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":b=~~b,c[0]=b+(b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(Y),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}}function t(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(K),f,g;for(f=0;f<e.length;f++)g=(r(e[f]).exec(a)||[])[0],a=a.replace(r(e[f]),""),s(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),c[3]+=d.tzh,c[4]+=d.tzm,j(c,d.isUTC)}function u(a,b){var d,e=a.match(N)||[],f,g=99,h,j,k;for(h=0;h<b.length;h++)j=t(a,b[h]),f=q(new c(j),b[h]).match(N)||[],k=i(e,f),k<g&&(g=k,d=j);return d}function v(b){var c="YYYY-MM-DDT",d;if(V.exec(b)){for(d=0;d<4;d++)if(X[d][1].exec(b)){c+=X[d][0];break}return T.exec(b)?t(b,c+" Z"):t(b,c)}return new a(b)}function w(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function x(a,b,c){var d=D(Math.abs(a)/1e3),e=D(d/60),f=D(e/60),g=D(f/24),h=D(g/365),i=d<45&&["s",d]||e===1&&["m"]||e<45&&["mm",e]||f===1&&["h"]||f<22&&["hh",f]||g===1&&["d"]||g<=25&&["dd",g]||g<=45&&["M"]||g<345&&["MM",D(g/30)]||h===1&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,w.apply({},i)}function y(a,b){B.fn[a]=function(a){var c=this._isUTC?"UTC":"";return a!=null?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function z(a){B.duration.fn[a]=function(){return this._data[a]}}function A(a,b){B.duration.fn["as"+a]=function(){return+this/b}}var B,C="1.7.0",D=Math.round,E,F={},G="en",H=typeof module!="undefined"&&module.exports,I="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),J=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?)/g,L=/(LT|LL?L?L?)/g,M=/(^\[)|(\\)|\]$/g,N=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,O=/\d\d?/,P=/\d{1,3}/,Q=/\d{3}/,R=/\d{1,4}/,S=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,T=/Z|[\+\-]\d\d:?\d\d/i,U=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,W="YYYY-MM-DDTHH:mm:ssZ",X=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],Y=/([\+\-]|\d\d)/gi,Z="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),$={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},_={},ba={M:"(a=t.month()+1)",MMM:'v("monthsShort",t.month())',MMMM:'v("months",t.month())',D:"(a=t.date())",DDD:"(a=new Date(t.year(),t.month(),t.date()),b=new Date(t.year(),0,1),a=~~(((a-b)/864e5)+1.5))",d:"(a=t.day())",dd:'v("weekdaysMin",t.day())',ddd:'v("weekdaysShort",t.day())',dddd:'v("weekdays",t.day())',w:"(a=new Date(t.year(),t.month(),t.date()-t.day()+5),b=new Date(a.getFullYear(),0,4),a=~~((a-b)/864e5/7+1.5))",YY:"p(t.year()%100,2)",YYYY:"p(t.year(),4)",a:"m(t.hours(),t.minutes(),!0)",A:"m(t.hours(),t.minutes(),!1)",H:"t.hours()",h:"t.hours()%12||12",m:"t.minutes()",s:"t.seconds()",S:"~~(t.milliseconds()/100)",SS:"p(~~(t.milliseconds()/10),2)",SSS:"p(t.milliseconds(),3)",Z:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(a/60),2)+":"+p(~~a%60,2)',ZZ:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(10*a/6),4)'},bb="DDD w M D d".split(" "),bc="M D H h m s w".split(" ");while(bb.length)E=bb.pop(),ba[E+"o"]=ba[E]+"+o(a)";while(bc.length)E=bc.pop(),ba[E+E]="p("+ba[E]+",2)";ba.DDDD="p("+ba.DDD+",3)",B=function(d,e){if(d===null||d==="")return null;var f,g;return B.isMoment(d)?new c(new a(+d._d),d._isUTC,d._lang):(e?h(e)?f=u(d,e):f=t(d,e):(g=J.exec(d),f=d===b?new a:g?new a(+g[1]):d instanceof a?d:h(d)?j(d):typeof d=="string"?v(d):new a(d)),new c(f))},B.utc=function(a,b){return h(a)?new c(j(a,!0),!0):(typeof a=="string"&&!T.exec(a)&&(a+=" +0000",b&&(b+=" Z")),B(a,b).utc())},B.unix=function(a){return B(a*1e3)},B.duration=function(a,b){var c=B.isDuration(a),e=typeof a=="number",f=c?a._data:e?{}:a,g;return e&&(b?f[b]=a:f.milliseconds=a),g=new d(f),c&&(g._lang=a._lang),g},B.humanizeDuration=function(a,b,c){return B.duration(a,b===!0?null:b).humanize(b===!0?!0:c)},B.version=C,B.defaultFormat=W,B.lang=function(a,b){var c;if(!a)return G;(b||!F[a])&&k(a,b);if(F[a]){for(c=0;c<I.length;c++)B[I[c]]=F[a][I[c]];B.monthsParse=F[a].monthsParse,G=a}},B.langData=l,B.isMoment=function(a){return a instanceof c},B.isDuration=function(a){return a instanceof d},B.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),B.fn=c.prototype={clone:function(){return B(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d+""},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?!i(this._a,(this._a[7]?B.utc(this):this).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return q(this,a?a:B.defaultFormat)},add:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,1),this},subtract:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,-1),this},diff:function(a,b,c){var d=this._isUTC?B(a).utc():B(a).local(),e=(this.zone()-d.zone())*6e4,f=this._d-d._d-e,g=this.year()-d.year(),h=this.month()-d.month(),i=this.date()-d.date(),j;return b==="months"?j=g*12+h+i/30:b==="years"?j=g+(h+i/30)/12:j=b==="seconds"?f/1e3:b==="minutes"?f/6e4:b==="hours"?f/36e5:b==="days"?f/864e5:b==="weeks"?f/6048e5:f,c?j:D(j)},from:function(a,b){return B.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(B(),a)},calendar:function(){var a=this.diff(B().sod(),"days",!0),b=this.lang().calendar,c=b.sameElse,d=a<-6?c:a<-1?b.lastWeek:a<0?b.lastDay:a<1?b.sameDay:a<2?b.nextDay:a<7?b.nextWeek:c;return this.format(typeof d=="function"?d.apply(this):d)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<B([this.year()]).zone()||this.zone()<B([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return B.utc([this.year(),this.month()+1,0]).date()},lang:function(a){return a===b?l(this):(this._lang=a,this)}};for(E=0;E<Z.length;E++)y(Z[E].toLowerCase(),Z[E]);y("year","FullYear"),B.duration.fn=d.prototype={weeks:function(){return e(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=x(b,!a,this.lang());return a&&(d=(b<=0?c.past:c.future).replace(/%s/i,d)),d},lang:B.fn.lang};for(E in $)$.hasOwnProperty(E)&&(A(E,$[E]),z(E.toLowerCase()));A("Weeks",6048e5),H&&(module.exports=B),typeof ender=="undefined"&&(this.moment=B),typeof define=="function"&&define.amd&&define("moment",[],function(){return B})}.call(this,Date),function(){var a=function(b,c){if(!(this instanceof a))return new a(b,c);this.tokenizers=b.splice?b:[b],c&&(this.doBuild=c)};a.prototype={parse:function(a){this.src=a,this.ended=!1,this.tokens=[];do this.next();while(!this.ended);return this.tokens},build:function(a,b){a&&this.tokens.push(this.doBuild?this.doBuild(a,b,this.tkn):a)},next:function(){var a=this,b;a.findMin(),b=a.src.slice(0,a.min),a.build(b,!1),a.src=a.src.slice(a.min).replace(a.tkn,function(b){return a.build(b,!0),""}),a.src||(a.ended=!0)},findMin:function(){var a=this,b=0,c,d;a.min=-1,a.tkn="";while((c=a.tokenizers[b++])!==undefined)d=a.src[c.test?"search":"indexOf"](c),d!=-1&&(a.min==-1||d<a.min)&&(a.tkn=c,a.min=d);a.min==-1&&(a.min=a.src.length)}},window.jQuery?(jQuery.tokenizer=a,a.fn=a.prototype):window.Tokenizer=a}(),function(a){function e(a,b){if(a.originalEvent.touches.length>1)return;a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}a.support.touch="ontouchend"in document;if(!a.support.touch)return;var b=a.ui.mouse.prototype,c=b._mouseInit,d;b._touchStart=function(a){var b=this;if(d||!b._mouseCapture(a.originalEvent.changedTouches[0]))return;d=!0,b._touchMoved=!1,e(a,"mouseover"),e(a,"mousemove"),e(a,"mousedown")},b._touchMove=function(a){if(!d)return;this._touchMoved=!0,e(a,"mousemove")},b._touchEnd=function(a){if(!d)return;e(a,"mouseup"),e(a,"mouseout"),this._touchMoved||e(a,"click"),d=!1},b._mouseInit=function(){var b=this;b.element.bind("touchstart",a.proxy(b,"_touchStart")).bind("touchmove",a.proxy(b,"_touchMove")).bind("touchend",a.proxy(b,"_touchEnd")),c.call(b)}}(jQuery),function(a){a.fn.autoGrowInput=function(b){return b=a.extend({maxWidth:500,minWidth:70,comfortZone:20},b),this.filter("input:text").each(function(){a(this).parent().find("tester").remove();var c=b.minWidth||a(this).width(),d="",e=a(this),f=a("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),fontWeight:e.css("fontWeight"),letterSpacing:e.css("letterSpacing"),whiteSpace:"nowrap"}),g=function(){if(d===(d=e.val()))return;var a=d.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");f.html(a);var g=f.width(),h=g+b.comfortZone>=c?g+b.comfortZone:c,i=e.width(),j=h<i&&h>=c||h>c&&h<b.maxWidth;j&&e.width(h)};f.insertAfter(e),a(this).bind("keyup keydown blur update",function(){g()})}),this}}(jQuery),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=[].slice,u=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},v=this;a=jQuery,a.payment={},a.payment.fn={},a.fn.payment=function(){var b,c;return c=arguments[0],b=2<=arguments.length?t.call(arguments,1):[],a.payment.fn[c].apply(this,b)},e=/(\d{1,4})/g,d=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:e,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:e,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:e,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:e,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:e,length:[13,14,15,16],cvcLength:[3],luhn:!0}],b=function(a){var b,c,e;a=(a+"").replace(/\D/g,"");for(c=0,e=d.length;c<e;c++){b=d[c];if(b.pattern.test(a))return b}},c=function(a){var b,c,e;for(c=0,e=d.length;c<e;c++){b=d[c];if(b.type===a)return b}},m=function(a){var b,c,d,e,f,g;d=!0,e=0,c=(a+"").split("").reverse();for(f=0,g=c.length;f<g;f++){b=c[f],b=parseInt(b,10);if(d=!d)b*=2;b>9&&(b-=9),e+=b}return e%10===0},l=function(a){var b;return a.prop("selectionStart")!=null&&a.prop("selectionStart")!==a.prop("selectionEnd")?!0:(typeof document!="undefined"&&document!==null?(b=document.selection)!=null?typeof b.createRange=="function"?b.createRange().text:void 0:void 0:void 0)?!0:!1},n=function(b){var c=this;return setTimeout(function(){var c,d;return c=a(b.currentTarget),d=c.val(),d=a.payment.formatCardNumber(d),c.val(d)})},h=function(c){var d,e,f,g,h,i,j;f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;d=a(c.currentTarget),j=d.val(),e=b(j+f),g=(j.replace(/\D/g,"")+f).length,i=16,e&&(i=e.length[e.length.length-1]);if(g>=i)return;if(d.prop("selectionStart")!=null&&d.prop("selectionStart")!==j.length)return;e&&e.type==="amex"?h=/^(\d{4}|\d{4}\s\d{6})$/:h=/(?:^|\s)(\d{4})$/;if(h.test(j))return c.preventDefault(),d.val(j+" "+f);if(h.test(j+f))return c.preventDefault(),d.val(j+f+" ")},f=function(b){var c,d;c=a(b.currentTarget),d=c.val();if(b.meta)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(b.which===8&&/\s\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\d?$/,""))},i=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val()+d;if(/^\d$/.test(e)&&e!=="0"&&e!=="1")return b.preventDefault(),c.val("0"+e+" / ");if(/^\d\d$/.test(e))return b.preventDefault(),c.val(""+e+" / ")},j=function(b){var c,d,e;d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;c=a(b.currentTarget),e=c.val();if(/^\d\d$/.test(e))return c.val(""+e+" / ")},k=function(b){var c,d,e;d=String.fromCharCode(b.which);if(d!=="/")return;c=a(b.currentTarget),e=c.val();if(/^\d$/.test(e)&&e!=="0")return c.val("0"+e+" / ")},g=function(b){var c,d;if(b.meta)return;c=a(b.currentTarget),d=c.val();if(b.which!==8)return;if(c.prop("selectionStart")!=null&&c.prop("selectionStart")!==d.length)return;if(/\s\/\s?\d?$/.test(d))return b.preventDefault(),c.val(d.replace(/\s\/\s?\d?$/,""))},r=function(a){var b;return a.metaKey||a.ctrlKey?!0:a.which===32?!1:a.which===0?!0:a.which<33?!0:(b=String.fromCharCode(a.which),!!/[\d\s]/.test(b))},p=function(c){var d,e,f,g;d=a(c.currentTarget),f=String.fromCharCode(c.which);if(!/^\d+$/.test(f))return;if(l(d))return;return g=(d.val()+f).replace(/\D/g,""),e=b(g),e?g.length<=e.length[e.length.length-1]:g.length<=16},q=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;if(l(c))return;e=c.val()+d,e=e.replace(/\D/g,"");if(e.length>6)return!1},o=function(b){var c,d,e;c=a(b.currentTarget),d=String.fromCharCode(b.which);if(!/^\d+$/.test(d))return;return e=c.val()+d,e.length<=4},s=function(b){var c,e,f,g,h;c=a(b.currentTarget),h=c.val(),g=a.payment.cardType(h)||"unknown";if(!c.hasClass(g))return e=function(){var a,b,c;c=[];for(a=0,b=d.length;a<b;a++)f=d[a],c.push(f.type);return c}(),c.removeClass("unknown"),c.removeClass(e.join(" ")),c.addClass(g),c.toggleClass("identified",g!=="unknown"),c.trigger("payment.cardType",g)},a.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",o),this},a.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",q),this.on("keypress",i),this.on("keypress",k),this.on("keypress",j),this.on("keydown",g),this},a.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",p),this.on("keypress",h),this.on("keydown",f),this.on("keyup",s),this.on("paste",n),this},a.payment.fn.restrictNumeric=function(){return this.on("keypress",r),this},a.payment.fn.cardExpiryVal=function(){return a.payment.cardExpiryVal(a(this).val())},a.payment.cardExpiryVal=function(a){var b,c,d,e;return a=a.replace(/\s/g,""),e=a.split("/",2),b=e[0],d=e[1],(d!=null?d.length:void 0)===2&&/^\d+$/.test(d)&&(c=(new Date).getFullYear(),c=(c+"").slice(0,2),d=c+d),b=parseInt(b,10),d=parseInt(d,10),{month:b,year:d}},a.payment.validateCardNumber=function(a){var c,d;return a=(a+"").replace(/\s+|-/g,""),/^\d+$/.test(a)?(c=b(a),c?(d=a.length,u.call(c.length,d)>=0)&&(c.luhn===!1||m(a)):!1):!1},a.payment.validateCardExpiry=function(b,c){var d,e,f,g;return typeof b=="object"&&"month"in b&&(g=b,b=g.month,c=g.year),!b||!c?!1:(b=a.trim(b),c=a.trim(c),/^\d+$/.test(b)?/^\d+$/.test(c)?parseInt(b,10)<=12?(c.length===2&&(f=(new Date).getFullYear(),f=(f+"").slice(0,2),c=f+c),e=new Date(c,b),d=new Date,e.setMonth(e.getMonth()-1),e.setMonth(e.getMonth()+1,1),e>d):!1:!1:!1)},a.payment.validateCardCVC=function(b,d){var e,f;return b=a.trim(b),/^\d+$/.test(b)?d?(e=b.length,u.call((f=c(d))!=null?f.cvcLength:void 0,e)>=0):b.length>=3&&b.length<=4:!1},a.payment.cardType=function(a){var c;return a?((c=b(a))!=null?c.type:void 0)||null:null},a.payment.formatCardNumber=function(a){var c,d,e,f;return c=b(a),c?(e=c.length[c.length.length-1],a=a.replace(/\D/g,""),a=a.slice(0,+e+1||9e9),c.format.global?(f=a.match(c.format))!=null?f.join(" "):void 0:(d=c.format.exec(a),d!=null&&d.shift(),d!=null?d.join(" "):void 0)):a}}.call(this);var MODULE=function(a,b){function g(a,c,d,e){if(!c)return;var f;e=="V"?(f=a.options.customSnap.snappedV&&a.options.customSnap.snappedV.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.elem.item,snapMode:c.snapMode})),c.snappedV=!0):(f=a.options.customSnap.snappedH&&a.options.customSnap.snappedH.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.elem.item,snapMode:c.snapMode})),c.snappedH=!0)}function h(a,c,d,e){if(!c)return;var f;e=="V"?(f=a.options.customSnap.releasedV&&a.options.customSnap.releasedV.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.item})),c.snappedV=!1):(f=a.options.customSnap.releasedH&&a.options.customSnap.releasedH.call(a.element,d,b.extend(a._uiHash(),{snapItem:c.item})),c.snappedH=!1)}var c={start:function(c,e){var f=b(this).data("draggable"),g=f.options,h=a.$htmlStage.offset();f.customSnapElements=[{item:a.$htmlStage,width:a.$htmlStage,height:a.$htmlStage,top:h.top,left:h.left}];if(a.snapoptions.gridsystem!==!1){var i=a.snapoptions.getGridSystemElements("drag");i.map(function(a){a.left+=h.left,a.top+=h.top}),f.customSnapElements=f.customSnapElements.concat(i)}b(g.customSnap.constructor!=String?g.customSnap.items||":data(draggable)":g.customSnap).each(function(){if(this.tagName=="svg"){var a=b(f.element[0]).data("svgElem")||[];for(var c=0;c<a.length;c++)if(b(this)[0]==b(a[c])[0])return;d={left:e.position.left,top:e.position.top};var g=svg(this),i=g.position();f.customSnapElements.push({item:this,width:g.measuredWidth(),height:g.measuredHeight(),top:i.y+h.top,left:i.x+h.left})}else{var j=b(this),k=j.offset();this!=f.element[0]&&f.customSnapElements.push({item:this,width:j.outerWidth(),height:j.outerHeight(),top:k.top,left:k.left})}})},drag:function(c,i){var j=b(this).data("draggable"),k=j.options,l=k.snapTolerance,m=i.offset.left,n=m+j.helperProportions.width,o=i.offset.top,p=o+j.helperProportions.height,q=0,r=0,s=k.customSnapPoint||!1;s&&(q=Math.round(j.helperProportions.width/2),r=Math.round(j.helperProportions.height/2),m+=q,o+=r,n=m,p=o);var t=a.snapoptions.gridEnabled(),u=a.currentMockup.stageHeight/2+(i.offset.top-i.position.top),v=a.currentMockup.stageWidth/2+(i.offset.left-i.position.left),w=t?a.snapoptions.gridValues[0]:0,x=t?a.snapoptions.gridValues[1]:0,y=t?w:l,z=t?x:l;a.snapoptions.snap.snapToObjects===!1&&(y=z=0);var A=y,B=z,C={val:5e3,elem:null,top:0},D={val:5e3,elem:null,left:0};for(var E=j.customSnapElements.length-1;E>=0;E--){var F=j.customSnapElements[E].left,G=F+j.customSnapElements[E].width,H=j.customSnapElements[E].top,I=H+j.customSnapElements[E].height;j.customSnapElements[E].snapTolerance?y=z=j.customSnapElements[E].snapTolerance:(y=A,z=B);var J,K,L,M,N,O;if(k.snapMode!="inner"){var P={ts:Math.abs(H-p),bs:Math.abs(I-o),ls:Math.abs(F-n),rs:Math.abs(G-m)};K=P.ts<=z,J=P.bs<=z,M=P.ls<=y,L=P.rs<=y,K&&P.ts<C.val&&(C.val=P.ts,C.elem=j.customSnapElements[E],C.snapMode=a.snapoptions.SNAP_BOTTOM,i.position.top=C.top=j._convertPositionTo("relative",{top:H-j.helperProportions.height,left:0}).top-j.margins.top+r),J&&P.bs<C.val&&(C.val=P.bs,C.snapMode=a.snapoptions.SNAP_TOP,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:I,left:0}).top-j.margins.top-r),M&&P.ls<D.val&&(D.val=P.ls,D.snapMode=a.snapoptions.SNAP_RIGHT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:F-j.helperProportions.width}).left+j.margins.left+q),L&&P.rs<D.val&&(D.val=P.rs,D.snapMode=a.snapoptions.SNAP_LEFT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:G}).left-j.margins.left-q)}if(k.snapMode!="outer"){var Q={ts:Math.abs(H-o),bs:Math.abs(I-p),ls:Math.abs(F-m),rs:Math.abs(G-n)};K=Q.ts<=z,J=Q.bs<=z,M=Q.ls<=y,L=Q.rs<=y,K&&Q.ts<C.val&&(C.val=Q.ts,C.snapMode=a.snapoptions.SNAP_TOP,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:H,left:0}).top-j.margins.top-r),J&&Q.bs<C.val&&(C.val=Q.bs,C.snapMode=a.snapoptions.SNAP_BOTTOM,C.elem=j.customSnapElements[E],i.position.top=C.top=j._convertPositionTo("relative",{top:I-j.helperProportions.height,left:0}).top-j.margins.top+r),M&&Q.ls<D.val&&(D.val=Q.ls,D.snapMode=a.snapoptions.SNAP_LEFT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:F}).left-j.margins.left-q),L&&Q.rs<D.val&&(D.val=Q.rs,D.snapMode=a.snapoptions.SNAP_RIGHT,D.elem=j.customSnapElements[E],i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:G-j.helperProportions.width}).left-j.margins.left+q)}if(j.customSnapElements[E].center!==!1){var R={hm:Math.abs(H+(I-H)/2-(o+(p-o)/2)),vm:Math.abs(F+(G-F)/2-(m+(n-m)/2))};O=R.hm<=z,N=R.vm<=y;if(O&&R.hm<=C.val){C.val=R.hm,C.snapMode=a.snapoptions.SNAP_MIDDLE,C.elem=j.customSnapElements[E];var S=H+Math.round((I-H-(p-o))/2);i.position.top=C.top=j._convertPositionTo("relative",{top:S,left:0}).top-j.margins.top-r}if(N&&R.vm<=D.val){D.val=R.vm,D.snapMode=a.snapoptions.SNAP_MIDDLE,D.elem=j.customSnapElements[E];var T=F+Math.round((G-F-(n-m))/2);i.position.left=D.left=j._convertPositionTo("relative",{top:0,left:T}).left-j.margins.left-q}}}i.position.top<d.top?e="n":i.position.top>d.top&&(e="s"),i.position.left<d.left?f="w":i.position.left>d.left&&(f="e"),c.axes=[f,e],d={left:i.position.left,top:i.position.top};for(E=j.customSnapElements.length-1;E>=0;E--){var U=j.customSnapElements[E];(!D.elem||b(U.item).get(0)!=b(D.elem.item).get(0))&&h(j,U,c,"V"),(!C.elem||b(U.item).get(0)!=b(C.elem.item).get(0))&&h(j,U,c,"H")}D.elem!==null?g(j,D,c,"V"):t&&(i.position.left=w*Math.round(i.position.left/w)-q),C.elem!==null?g(j,C,c,"H"):t&&(i.position.top=x*Math.round(i.position.top/x)-r),a.snapoptions.snap.snapToObjects&&(i.offset.top=i.position.top+i.helper.parent().offset().top,i.offset.left=i.position.left+i.helper.parent().offset().left)}},d={},e="",f="";return b.ui.plugin.add("draggable","snap",c),a}(MODULE||{},jQuery),MODULE=function(a,b){return function(b){function c(a,b,c){return Math.abs(a)<c?-a-.1:Math.abs(b)<c?-b-.1:0}function d(a){return a.length===0?0:a.sort(function(a,b){return a?b?Math.abs(a)-Math.abs(b):-1:1})[0]}function e(a){return parseInt(a.css("margin-left"),10)||0}function f(a){return parseInt(a.css("margin-top"),10)||0}function g(a,c,d){var e=b.ui.resizable.prototype[a];b.ui.resizable.prototype[a]=function(){d&&d.apply(this,arguments),e.apply(this,arguments),c&&c.apply(this,arguments)}}function h(a,b){var c=b.originalSize.width/b.originalSize.height;return a*c}function i(a,b){var c=b.originalSize.width/b.originalSize.height;return a/c}function j(a){return{helper:a.helper,position:a.position,originalPosition:a.originalPosition,offset:a.positionAbs}}b.extend(b.ui.resizable.prototype.options,{snapTolerance:5,snapMode:"both"}),b.ui.plugin.add("resizable","snap",{start:function(c,d){var g=b(this),h=g.data("resizable"),i=h.options.snap;h.ow=h.helper.outerWidth()-h.size.width,h.oh=h.helper.outerHeight()-h.size.height,h.lm=e(g),h.tm=f(g),h.coords=[],h.snappedPos={},h.snapped={h:!1,v:!1},h.coords=[{el:a.$htmlStage,l:0,r:a.$htmlStage.width(),t:0,b:a.$htmlStage.height(),snapping:!1}];if(a.snapoptions.gridsystem!==!1){var j=a.snapoptions.getGridSystemElements("resize");h.coords=h.coords.concat(j)}d.helper[0]!=d.originalElement[0]&&(h.lm=d.originalElement.position().left-d.helper.position().left,h.tm=d.originalElement.position().top-d.helper.position().top),b(typeof i=="string"?i:i.items||":data(resizable)").each(function(){if(this.tagName=="svg"){var a=h.originalElement.data("svgElem")||[];for(var c=0;c<a.length;c++)if(b(this)[0]==b(a[c])[0])return;var d=b(this),g=svg(this).position(),i=g.x,j=g.y;h.coords.push({l:i,t:j,r:i+svg(this).measuredWidth(),b:j+svg(this).measuredHeight(),el:d,snapping:!1})}else{if(this==h.element[0]||this==h.helper[0])return;var d=b(this),g=d.position(),i=g.left+e(d),j=g.top+f(d);h.coords.push({l:i,t:j,r:i+d.outerWidth(),b:j+d.outerHeight(),el:d,snapping:!1})}})},resize:function(e,f){var g=b(this).data("resizable");if(!g||!g.position)return;var k=g._aspectRatio,l=a.snapoptions.gridEnabled(),m=l?a.snapoptions.gridValues[0]:0,n=l?a.snapoptions.gridValues[1]:0,o=l?m:g.options.snapTolerance,p=l?n:g.options.snapTolerance;a.snapoptions.snap.snapToObjects===!1&&(o=p=.1);var q=o,r=p,s=[],t=[],u=[],v=[],w=g.axis.split(""),x=g.options.snapMode,y=g.position.left+g.lm,z=y-o,A=g.position.top+g.tm,B=A-p,C=y+g.size.width+g.ow,D=C+o,E=A+g.size.height+g.oh,F=E+p,G=!1,H=!1,I=[];b.each(g.coords,function(){var d=this,f=Math.min(D,d.r)-Math.max(z,d.l),h=Math.min(F,d.b)-Math.max(B,d.t),i=0;d.snapTolerance?o=p=d.snapTolerance:(o=q,p=r),b.each(w,function(b,e){var g;if(x=="outer")switch(e){case"w":case"e":if(f>o*2)return;break;case"n":case"s":if(h>p*2)return}else if(x=="inner")switch(e){case"w":case"e":if(f<o*2)return;break;case"n":case"s":if(h<p*2)return}switch(e){case"w":g=c(y-d.l,y-d.r,o),G=g!==0&&s.push(g)&&(d.snapModeV=a.snapoptions.SNAP_LEFT);break;case"n":g=c(A-d.t,A-d.b,p),H=g!==0&&t.push(g)&&(d.snapModeH=a.snapoptions.SNAP_TOP);break;case"e":g=c(C-d.l,C-d.r,o),G=g!==0&&u.push(g)&&(d.snapModeV=a.snapoptions.SNAP_RIGHT);break;case"s":g=c(E-d.t,E-d.b,p),H=g!==0&&v.push(g)&&(d.snapModeH=a.snapoptions.SNAP_BOTTOM)}i+=g}),i!==0?(G?I.push(function(){g.options.snap.snappedV&&g.options.snap.snappedV.call(g.element,e,b.extend(j(g),{snapItem:d.el,snapMode:d.snapModeV}))}):I.push(function(){g.options.snap.releasedV&&g.options.snap.releasedV.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}),H?I.push(function(){g.options.snap.snappedH&&g.options.snap.snappedH.call(g.element,e,b.extend(j(g),{snapItem:d.el,snapMode:d.snapModeH}))}):I.push(function(){g.options.snap.releasedH&&g.options.snap.releasedH.call(g.element,e,b.extend(j(g),{snapItem:d.el}))})):(I.push(function(){g.options.snap.releasedV&&g.options.snap.releasedV.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}),I.push(function(){g.options.snap.releasedH&&g.options.snap.releasedH.call(g.element,e,b.extend(j(g),{snapItem:d.el}))}))});var J,K,L,M={top:g.position.top,left:g.position.left,width:g.size.width,height:g.size.height};!v.length&&!t.length&&!u.length&&!s.length&&l?(w.indexOf("s")!=-1?(K=n*Math.round((g.position.top+g.size.height)/n)-(g.position.top+g.size.height),g.size.height+=K):w.indexOf("n")!=-1&&(K=n*Math.round(f.position.top/n)-g.position.top,g.position.top+=K,g.size.height-=K),k&&(L=h(g.size.height,g)-g.size.width,g.size.width+=L,w.indexOf("w")!=-1&&(g.position.left-=L))):(g.snapped.v=v.length>0||t.length>0,v.length&&(g.size.height+=Math.round(d(v))),t.length&&(J=Math.round(d(t)),g.position.top+=J,g.size.height-=J),k&&!s.length&&!u.length&&(L=h(g.size.height,g)-g.size.width,g.size.width+=L,w.indexOf("w")!=-1&&(g.position.left-=L))),!u.length&&!s.length&&l?(w.indexOf("e")!=-1?(K=m*Math.round((g.position.left+g.size.width)/m)-(g.position.left+g.size.width),g.size.width+=K):w.indexOf("w")!=-1&&(K=m*Math.round(f.position.left/m)-g.position.left,g.position.left+=K,g.size.width-=K),k&&(L=i(g.size.width,g)-g.size.height,g.size.height+=L,w.indexOf("n")!=-1&&(g.position.top-=L))):(g.snapped.h=u.length>0||s.length>0,u.length&&(g.size.width+=Math.round(d(u))),s.length&&(J=Math.round(d(s)),g.position.left+=J,g.size.width-=J),k&&(L=i(g.size.width,g)-g.size.height,g.size.height+=L,w.indexOf("n")!=-1&&(g.position.top-=L))),g.options.minWidth&&g.options.minHeight&&(g.size.width<g.options.minWidth&&(g.size.width=M.width,g.position.left=M.left),g.size.height<g.options.minHeight&&(g.size.height=M.height,g.position.top=M.top)),g.snappedPos={top:g.position.top,left:g.position.left,width:g.size.width,height:g.size.height};for(var N=0;N<I.length;N++)I[N]()},stop:function(c,d){var e=b(this).data("resizable"),f=a.snapoptions.gridEnabled();if(!e||!e.position)return;if(this._helper&&f){var g=e._aspectRatio,j=a.snapoptions.gridValues[0],k=a.snapoptions.gridValues[1],l=e.axis.split(""),m=0;e.snapped.v||(l.indexOf("s")!=-1?(m=k*Math.round((e.position.top+e.size.height)/k)-(e.position.top+e.size.height),e.size.height+=m):l.indexOf("n")!=-1&&(m=k*Math.round(d.position.top/k)-e.position.top,e.position.top+=m,e.size.height-=m),g&&(e.size.width=h(e.size.height,e))),e.snapped.h||(l.indexOf("e")!=-1?(m=j*Math.round((e.position.left+e.size.width)/j)-(e.position.left+e.size.width),e.size.width+=m):l.indexOf("w")!=-1&&(m=j*Math.round(d.position.left/j)-e.position.left,e.position.left+=m,e.size.width-=m),g&&(e.size.height=i(e.size.width,e)))}else this._helper||(e.position.top=e.snappedPos.top,e.position.left=e.snappedPos.left,e.size.width=e.snappedPos.width,e.size.height=e.snappedPos.height)}}),g("_mouseStop",null,function(){this._helper&&(this.position={left:(parseInt(this.helper.css("left"),10)||0)+this.lm,top:(parseInt(this.helper.css("top"),10)||0)+this.tm},this.size={width:this.helper.outerWidth(),height:this.helper.outerHeight()})}),g("_mouseStart",function(){this._helper&&(this.size={width:this.size.width-(this.helper.outerWidth()-this.helper.width()),height:this.size.height-(this.helper.outerHeight()-this.helper.height())},this.originalSize={width:this.size.width,height:this.size.height})}),g("_renderProxy",function(){this._helper&&this.helper.css({left:this.elementOffset.left,top:this.elementOffset.top,width:this.element.outerWidth(),height:this.element.outerHeight()})});var k=b.ui.resizable.prototype.plugins.resize;b.each(k,function(a,b){if(b[0]=="ghost")return k.splice(a,1),!1}),b.each(b.ui.resizable.prototype.plugins.start,function(a,c){if(c[0]=="ghost"){var d=c[1];return c[1]=function(){d.apply(this,arguments),b(this).data("resizable").ghost.css({width:"100%",height:"100%"})},!1}})}(b),a}(MODULE||{},jQuery),Markdown;typeof exports=="object"&&typeof require=="function"?Markdown=exports:Markdown={},function(){function a(a){return a}function b(a){return!1}function c(){}function d(){}c.prototype={chain:function(b,c){var d=this[b];if(!d)throw new Error("unknown hook "+b);d===a?this[b]=c:this[b]=function(a){return c(d(a))}},set:function(a,b){if(!this[a])throw new Error("unknown hook "+a);this[a]=b},addNoop:function(b){this[b]=a},addFalse:function(a){this[a]=b}},Markdown.HookCollection=c,d.prototype={set:function(a,b){this["s_"+a]=b},get:function(a){return this["s_"+a]}},Markdown.Converter=function(){function h(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,c,d,f,g,h){return c=c.toLowerCase(),b.set(c,D(d)),g?f:(h&&e.set(c,h.replace(/"/g,"&quot;")),"")}),a}function i(a){var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,j),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,j),a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,j),a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,j),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,j),a}function j(a,b){var c=b;return c=c.replace(/^\n+/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(f.push(c)-1)+"K\n\n",c}function k(a,b){a=s(a);var c="<hr />\n";return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,c),a=t(a),a=w(a),a=B(a),a=i(a),a=C(a,b),a}function l(a){return a=y(a),a=m(a),a=E(a),a=p(a),a=n(a),a=F(a),a=a.replace(/~P/g,"://"),a=D(a),a=A(a),a=a.replace(/  +\n/g," <br>\n"),a}function m(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=L(b,a.charAt(1)=="!"?"\\`*_/":"\\`*_"),b}),a}function n(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,o),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,o),a}function o(a,c,d,f,g,h,i,j){j==undefined&&(j="");var k=c,l=d.replace(/:\/\//g,"~P"),m=f.toLowerCase(),n=g,o=j;if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)!=undefined)n=b.get(m),e.get(m)!=undefined&&(o=e.get(m));else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}n=K(n),n=L(n,"*_");var p='<a target="_blank" href="'+n+'"';return o!=""&&(o=q(o),o=L(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>",p}function p(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,r),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,r),a}function q(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function r(a,c,d,f,g,h,i,j){var k=c,l=d,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)==undefined)return k;n=b.get(m),e.get(m)!=undefined&&(o=e.get(m))}l=L(q(l),"*_[]()"),n=L(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=q(o),o=L(o,"*_"),p+=' title="'+o+'"',p+=" />",p}function s(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+l(b)+"</h1>\n\n"}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+l(b)+"</h2>\n\n"}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return"<h"+d+">"+l(c)+"</h"+d+">\n\n"}),a}function t(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return g?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol",f=v(d,e);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",h=v(f,g);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a}function v(a,b){g++,a=a.replace(/\n{2,}$/,"\n"),a+="~0";var c=u[b],d=new RegExp("(^[ \\t]*)("+c+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+c+")[ \\t]+))","gm"),e=!1;return a=a.replace(d,function(a,b,c,d){var f=d,g=b,h=/\n\n$/.test(f),i=h||f.search(/\n{2,}/)>-1;return i||e?f=k(H(f),!0):(f=t(H(f)),f=f.replace(/\n$/,""),f=l(f)),e=h,"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),g--,a}function w(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=z(H(d)),d=I(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>","\n\n"+d+"\n\n"+e}),a=a.replace(/~0/,""),a}function x(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(f.push(a)-1)+"K\n\n"}function y(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=z(f),f=f.replace(/:\/\//g,"~P"),b+"<code>"+f+"</code>"}),a}function z(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=L(a,"*_{}[]\\",!1),a}function A(a){return a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4"),a}function B(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=k(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /mg,"~0"),c=c.replace(/~0/g,""),c}),x("<blockquote>\n"+c+"\n</blockquote>")}),a}function C(a,b){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,g=c.length;for(var h=0;h<g;h++){var i=c[h];e.test(i)?d.push(i):/\S/.test(i)&&(i=l(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",d.push(i))}if(!b){g=d.length;for(var h=0;h<g;h++){var j=!0;while(j)j=!1,d[h]=d[h].replace(/~K(\d+)K/g,function(a,b){return j=!0,f[b]})}}return d.join("\n\n")}function D(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a}function E(a){return a=a.replace(/\\(\\)/g,M),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,M),a}function F(b){b=b.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4"),b=b.replace(/&nbsp>;/gi,">");var c=function(b,c){return'<a target="_blank" href="'+c+'">'+a.plainLinkText(c)+"</a>"};return b=b.replace(/<((https?|ftp):[^'">\s]+)>/gi,c),b}function G(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)}),a}function H(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a}function I(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){return a==="\n"?(c=e+1,a):(d=(e-c)%4,c=e+1,b[d])})}function K(a){if(!a)return"";var b=a.length;return a.replace(J,function(c,d){if(c=="~D")return"%24";if(c==":")if(d==b-1||/[0-9\/]/.test(a.charAt(d+1)))return":";return"%"+c.charCodeAt(0).toString(16)})}function L(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,M),a}function M(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}var a=this.hooks=new c;a.addNoop("plainLinkText"),a.addNoop("preConversion"),a.addNoop("postConversion");var b,e,f,g;this.makeHtml=function(c){if(b)throw new Error("Recursive call to converter.makeHtml");return b=new d,e=new d,f=[],g=0,c=a.preConversion(c),c=c.replace(/~/g,"~T"),c=c.replace(/\$/g,"~D"),c=c.replace(/\r\n/g,"\n"),c=c.replace(/\r/g,"\n"),c="\n\n"+c+"\n\n",c=I(c),c=c.replace(/^[ \t]+$/mg,""),c=i(c),c=h(c),c=k(c),c=G(c),c=c.replace(/~D/g,"$$"),c=c.replace(/~T/g,"~"),c=a.postConversion(c),f=e=b=null,c};var u={ol:"\\d+[.]",ul:"[*+-]"},J=/(?:["'*()[\]:]|~D)/g}}(),function(){function c(a){return a.replace(/<[^>]*>?/gi,g)}function g(a){return a.match(d)||a.match(e)||a.match(f)?a:""}function h(a){if(a=="")return"";var b=/<\/?\w+[^>]*(\s|$|>)/g,c=a.toLowerCase().match(b),d=(c||[]).length;if(d==0)return a;var e,f,g="<p><img><br><li><hr>",h,i=[],j=[],k=!1;for(var l=0;l<d;l++){e=c[l].replace(/<\/?(\w+).*/,"$1");if(i[l]||g.search("<"+e+">")>-1)continue;f=c[l],h=-1;if(!/^<\//.test(f))for(var m=l+1;m<d;m++)if(!i[m]&&c[m]=="</"+e+">"){h=m;break}h==-1?k=j[l]=!0:i[h]=!0}if(!k)return a;var l=0;return a=a.replace(b,function(a){var b=j[l]?"":a;return l++,b}),a}var a,b;typeof exports=="object"&&typeof require=="function"?(a=exports,b=require("./Markdown.Converter").Converter):(a=window.Markdown,b=a.Converter),a.getSanitizingConverter=function(){var a=new b;return a.hooks.chain("postConversion",c),a.hooks.chain("postConversion",h),a};var d=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,e=/^(<a\starget="_blank"\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,f=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}(),function(){function f(a){throw a}function q(){return function(){}}function s(a){return function(b){this[a]=b}}function aa(a){return function(){return this[a]}}function ba(a){return function(){return a}}function da(a){for(var a=a.split("."),b=u,c;c=a.shift();){if(b[c]==k)return k;b=b[c]}return b}function ea(){}function fa(a){var b=typeof a;if("object"==b){if(!a)return"null";if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function v(a){return"array"==fa(a)}function ga(a){var b=fa(a);return"array"==b||"object"==b&&"number"==typeof a.length}function x(a){return"string"==typeof a}function ha(a){return"function"==fa(a)}function y(a){return a[ia]||(a[ia]=++ja)}function ka(a,b,c){return a.call.apply(a.bind,arguments)}function la(a,b,c){a||f(Error());if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,d),a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function z(a,b,c){return z=Function.prototype.bind&&-1!=(Function.prototype.bind+"").indexOf("native code")?ka:la,z.apply(k,arguments)}function B(a,b){function c(){}c.prototype=b.prototype,a.oa=b.prototype,a.prototype=new c}function ma(a,b){for(var c=1;c<arguments.length;c++)var d=String(arguments[c]).replace(/\$/g,"$$$$"),a=a.replace(/\%s/,d);return a}function na(a){return oa.test(a)?(-1!=a.indexOf("&")&&(a=a.replace(pa,"&amp;")),-1!=a.indexOf("<")&&(a=a.replace(qa,"&lt;")),-1!=a.indexOf(">")&&(a=a.replace(ra,"&gt;")),-1!=a.indexOf('"')&&(a=a.replace(sa,"&quot;")),a):a}function xa(){return u.navigator?u.navigator.userAgent:k}function Fa(){var a=u.document;return a?a.documentMode:h}function E(a){var b;if(!(b=Ma[a])){b=0;for(var c=String(Ga).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",h=d[f]||"",i=RegExp("(\\d*)(\\D*)","g"),j=RegExp("(\\d*)(\\D*)","g");do{var k=i.exec(g)||["","",""],l=j.exec(h)||["","",""];if(0==k[0].length&&0==l[0].length)break;b=((0==k[1].length?0:parseInt(k[1],10))<(0==l[1].length?0:parseInt(l[1],10))?-1:(0==k[1].length?0:parseInt(k[1],10))>(0==l[1].length?0:parseInt(l[1],10))?1:0)||((0==k[2].length)<(0==l[2].length)?-1:(0==k[2].length)>(0==l[2].length)?1:0)||(k[2]<l[2]?-1:k[2]>l[2]?1:0)}while(0==b)}b=Ma[a]=0<=b}return b}function Pa(a){Error.captureStackTrace?Error.captureStackTrace(this,Pa):this.stack=Error().stack||"",a&&(this.message=String(a))}function Qa(a,b){b.unshift(a),Pa.call(this,ma.apply(k,b)),b.shift(),this.Ic=a}function Ra(a,b){f(new Qa("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1)))}function Ta(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Ua(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Wa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Va.length;f++)c=Va[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Za(a){return F.concat.apply(F,arguments)}function $a(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}function ab(a){if("function"==typeof a.L)return a.L();if(x(a))return a.split("");if(ga(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Ta(a)}function bb(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(ga(a)||x(a))Ya(a,b,c);else{var d;if("function"==typeof a.ga)d=a.ga();else if("function"!=typeof a.L)if(ga(a)||x(a)){d=[];for(var e=a.length,f=0;f<e;f++)d.push(f)}else d=Ua(a);else d=h;for(var e=ab(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)}}function cb(a,b){this.N={},this.j=[];var c=arguments.length;if(1<c){c%2&&f(Error("Uneven number of arguments"));for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof cb?(c=a.ga(),d=a.L()):(c=Ua(a),d=Ta(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}function db(a){if(a.f!=a.j.length){for(var b=0,c=0;b<a.j.length;){var d=a.j[b];eb(a.N,d)&&(a.j[c++]=d),b++}a.j.length=c}if(a.f!=a.j.length){for(var e={},c=b=0;b<a.j.length;)d=a.j[b],eb(e,d)||(a.j[c++]=d,e[d]=1),b++;a.j.length=c}}function eb(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function H(a,b){var c;if(a instanceof H)this.A=b!==h?b:a.A,fb(this,a.na),c=a.Xa,I(this),this.Xa=c,gb(this,a.fa),hb(this,a.za),ib(this,a.G),jb(this,a.Q.n()),c=a.Ja,I(this),this.Ja=c;else if(a&&(c=String(a).match(Sa))){this.A=!!b,fb(this,c[1]||"",j);var d=c[2]||"";I(this),this.Xa=d?decodeURIComponent(d):"",gb(this,c[3]||"",j),hb(this,c[4]),ib(this,c[5]||"",j),jb(this,c[6]||"",j),c=c[7]||"",I(this),this.Ja=c?decodeURIComponent(c):""}else this.A=!!b,this.Q=new kb(k,0,this.A)}function fb(a,b,c){I(a),a.na=c?b?decodeURIComponent(b):"":b,a.na&&(a.na=a.na.replace(/:$/,""))}function gb(a,b,c){I(a),a.fa=c?b?decodeURIComponent(b):"":b}function hb(a,b){I(a),b?(b=Number(b),(isNaN(b)||0>b)&&f(Error("Bad port number "+b)),a.za=b):a.za=k}function ib(a,b,c){I(a),a.G=c?b?decodeURIComponent(b):"":b}function jb(a,b,c){I(a),b instanceof kb?(a.Q=b,a.Q.nb(a.A)):(c||(b=lb(b,qb)),a.Q=new kb(b,0,a.A))}function J(a,b,c){I(a),a.Q.set(b,c)}function rb(a,b,c){I(a),v(c)||(c=[String(c)]),sb(a.Q,b,c)}function K(a){return I(a),J(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^A()).toString(36)),a}function I(a){a.lc&&f(Error("Tried to modify a read-only Uri"))}function lb(a,b){return x(a)?encodeURI(a).replace(b,tb):k}function tb(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}function kb(a,b,c){this.z=a||k,this.A=!!c}function L(a){if(!a.i&&(a.i=new cb,a.f=0,a.z))for(var b=a.z.split("&"),c=0;c<b.length;c++){var d=b[c].indexOf("="),e=k,f=k;0<=d?(e=b[c].substring(0,d),f=b[c].substring(d+1)):e=b[c],e=decodeURIComponent(e.replace(/\+/g," ")),e=M(a,e),a.add(e,f?decodeURIComponent(f.replace(/\+/g," ")):"")}}function sb(a,b,c){a.remove(b),0<c.length&&(a.z=k,a.i.set(M(a,b),$a(c)),a.f+=c.length)}function M(a,b){var c=String(b);return a.A&&(c=c.toLowerCase()),c}function ub(){}function wb(){}function xb(a){return(a=yb(a))?new ActiveXObject(a):new XMLHttpRequest}function zb(a){var b={};return yb(a)&&(b[0]=j,b[1]=j),b}function yb(a){if(!a.Eb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.Eb=d}catch(e){}}f(Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed"))}return a.Eb}function Ab(){}function N(){0!=Eb&&(this.Fc=Error().stack,Fb[y(this)]=this)}function Hb(a){a&&"function"==typeof a.Fa&&a.Fa()}function Gb(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];ga(d)?Gb.apply(k,d):Hb(d)}}function O(a,b){this.type=a,this.currentTarget=this.target=b}function Ib(a){return Ib[" "](a),a}function Jb(a,b){a&&this.La(a,b)}function Mb(a,b,c,d,e){if(b){if(v(b)){for(var g=0;g<b.length;g++)Mb(a,b[g],c,d,e);return k}var d=!!d,h=P;b in h||(h[b]={f:0,B:0}),h=h[b],d in h||(h[d]={f:0,B:0},h.f++);var h=h[d],i=y(a),j;h.B++;if(h[i]){j=h[i];for(g=0;g<j.length;g++)if(h=j[g],h.xa==c&&h.ib==e){if(h.la)break;return j[g].key}}else j=h[i]=[],h.f++;var l=Nb,m=Cb?function(a){return l.call(m.src,m.key,a)}:function(a){a=l.call(m.src,m.key,a);if(!a)return a},g=m;return g.src=a,h=new Ab,h.La(c,g,a,b,d,e),c=h.key,g.key=c,j.push(h),Kb[c]=h,Q[i]||(Q[i]=[]),Q[i].push(h),a.addEventListener?(a==u||!a.vb)&&a.addEventListener(b,g,d):a.attachEvent(b in Lb?Lb[b]:Lb[b]="on"+b,g),c}f(Error("Invalid event type"))}function Ob(a,b,c,d,e){if(v(b))for(var f=0;f<b.length;f++)Ob(a,b[f],c,d,e);else{d=!!d;a:{f=P;if(b in f&&(f=f[b],d in f&&(f=f[d],a=y(a),f[a]))){a=f[a];break a}a=k}if(a)for(f=0;f<a.length;f++)if(a[f].xa==c&&a[f].capture==d&&a[f].ib==e){Pb(a[f].key);break}}}function Pb(a){if(!Kb[a])return p;var b=Kb[a];if(b.la)return p;var c=b.src,d=b.type,e=b.Sb,f=b.capture;c.removeEventListener?(c==u||!c.vb)&&c.removeEventListener(d,e,f):c.detachEvent&&c.detachEvent(d in Lb?Lb[d]:Lb[d]="on"+d,e),c=y(c);if(Q[c]){var e=Q[c],g=Xa(e,b);0<=g&&F.splice.call(e,g,1),0==e.length&&delete Q[c]}b.la=j;if(b=P[d][f][c])b.Kb=j,Qb(d,f,c,b);return delete Kb[a],j}function Qb(a,b,c,d){if(!d.Na&&d.Kb){for(var e=0,f=0;e<d.length;e++)d[e].la?d[e].Sb.src=k:(e!=f&&(d[f]=d[e]),f++);d.length=f,d.Kb=p,0==f&&(delete P[a][b][c],P[a][b].f--,0==P[a][b].f&&(delete P[a][b],P[a].f--),0==P[a].f&&delete P[a])}}function Rb(a,b,c,d,e){var f=1,b=y(b);if(a[b]){a.B--,a=a[b],a.Na?a.Na++:a.Na=1;try{for(var g=a.length,h=0;h<g;h++){var i=a[h];i&&!i.la&&(f&=Sb(i,e)!==p)}}finally{a.Na--,Qb(c,d,b,a)}}return Boolean(f)}function Sb(a,b){return a.tb&&Pb(a.key),a.handleEvent(b)}function Nb(a,b){if(!Kb[a])return j;var c=Kb[a],d=c.type,e=P;if(d in e){var e=e[d],f,g;if(!Cb){f=b||da("window.event");var i=j in e,k=p in e;if(i){if(0>f.keyCode||f.returnValue!=h)return j;a:{var l=p;if(0==f.keyCode)try{f.keyCode=-1;break a}catch(m){l=j}if(l||f.returnValue==h)f.returnValue=j}}l=new Jb,l.La(f,this),f=j;try{if(i){for(var n=[],o=l.currentTarget;o;o=o.parentNode)n.push(o);g=e[j],g.B=g.f;for(var q=n.length-1;!l.ja&&0<=q&&g.B;q--)l.currentTarget=n[q],f&=Rb(g,n[q],d,j,l);if(k){g=e[p],g.B=g.f;for(q=0;!l.ja&&q<n.length&&g.B;q++)l.currentTarget=n[q],f&=Rb(g,n[q],d,p,l)}}else f=Sb(c,l)}finally{n&&(n.length=0)}return f}return d=new Jb(b,this),f=Sb(c,d)}return j}function Tb(){N.call(this)}function Ub(a,b){N.call(this),this.aa=a||1,this.Ca=b||R,this.ab=z(this.Dc,this),this.lb=A()}function Wb(a){N.call(this),this.e=a,this.j=[]}function Yb(a,b,c,d){v(c)||(Xb[0]=c,c=Xb);for(var e=0;e<c.length;e++){var f=Mb(b,c[e],d||a,p,a.e||a);a.j.push(f)}}function Zb(a,b,c){N.call(this),this.mc=a,this.aa=b,this.e=c,this.fc=z(this.sc,this)}function $b(a){var b;b=a.fc;var c=a.aa;ha(b)||(b&&"function"==typeof b.handleEvent?b=z(b.handleEvent,b):f(Error("Invalid listener argument"))),b=2147483647<c?-1:R.setTimeout(b,c||0),a.r=b,a.mc.call(a.e)}function S(a,b,c,d,e){this.b=a,this.a=b,this.X=c,this.C=d,this.Aa=e||1,this.Ba=ac,this.gb=new Wb(this),this.Pa=new Ub,this.Pa.setInterval(bc)}function cc(a,b){switch(a){case 0:return"Non-200 return code ("+b+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}function fc(){return!C||C&&10<=Oa}function gc(a,b,c){a.pa=1,a.S=K(b.n()),a.V=c,a.wb=j,hc(a,k)}function ic(a,b,c,d,e){a.pa=1,a.S=K(b.n()),a.V=k,a.wb=c,e&&(a.Vb=p),hc(a,d)}function hc(a,b){a.ma=A(),jc(a),a.v=a.S.n(),rb(a.v,"t",a.Aa),a.Da=0,a.l=a.b.eb(a.b.Va()?b:k),0<a.ka&&(a.Qa=new Zb(z(a.bc,a,a.l),a.ka)),Yb(a.gb,a.l,"readystatechange",a.zc);var c;if(a.u){c=a.u;var d={},e;for(e in c)d[e]=c[e];c=d}else c={};a.V?(a.qa="POST",c["Content-Type"]="application/x-www-form-urlencoded",a.l.send(a.v,a.qa,a.V,c)):(a.qa="GET",a.Vb&&!D&&(c.Connection="close"),a.l.send(a.v,a.qa,k,c)),a.b.F(kc);if(d=a.V){c="",d=d.split("&");for(e=0;e<d.length;e++){var f=d[e].split("=");if(1<f.length){var g=f[0],f=f[1],h=g.split("_");c=2<=h.length&&"type"==h[1]?c+(g+"="+f+"&"):c+(g+"=redacted&")}}}else c=k;a.a.info("XMLHTTP REQ ("+a.C+") [attempt "+a.Aa+"]: "+a.qa+"\n"+a.v+"\n"+c)}function sc(a,b,c){for(var d=j;!a.Y&&a.Da<c.length;){var e=zc(a,c);if(e==ec){4==b&&(a.p=4,V(Ac),d=p),tc(a.a,a.C,k,"[Incomplete Response]");break}if(e==dc){a.p=4,V(Bc),tc(a.a,a.C,c,"[Invalid Chunk]"),d=p;break}tc(a.a,a.C,e,k),uc(a,e)}4==b&&0==c.length&&(a.p=1,V(Cc),d=p),a.I=a.I&&d,d||(tc(a.a,a.C,c,"[Invalid Chunked Response]"),U(a),xc(a))}function zc(a,b){var c=a.Da,d=b.indexOf("\n",c);if(-1==d)return ec;c=Number(b.substring(c,d));if(isNaN(c))return dc;d+=1;if(d+c>b.length)return ec;var e=b.substr(d,c);return a.Da=d+c,e}function Dc(a,b){a.ma=A(),jc(a);var c=b?window.location.hostname:"";a.v=a.S.n(),J(a.v,"DOMAIN",c),J(a.v,"t",a.Aa);try{a.J=new ActiveXObject("htmlfile")}catch(d){a.a.H("ActiveX blocked"),U(a),a.p=7,V(Ec),xc(a);return}var e="<html><body>";b&&(e+='<script>document.domain="'+c+'"</script>'),e+="</body></html>",a.J.open(),a.J.write(e),a.J.close(),a.J.parentWindow.m=z(a.vc,a),a.J.parentWindow.d=z(a.Qb,a,j),a.J.parentWindow.rpcClose=z(a.Qb,a,p),c=a.J.createElement("div"),a.J.parentWindow.document.body.appendChild(c),c.innerHTML='<iframe src="'+a.v+'"></iframe>',a.a.info("TRIDENT REQ ("+a.C+") [ attempt "+a.Aa+"]: GET\n"+a.v),a.b.F(kc)}function jc(a){a.qb=A()+a.Ba,Hc(a,a.Ba)}function Hc(a,b){a.sa!=k&&f(Error("WatchDog timer not null")),a.sa=W(z(a.wc,a),b)}function rc(a){a.sa&&(u.clearTimeout(a.sa),a.sa=k)}function xc(a){!a.b.Fb()&&!a.Y&&a.b.ia(a)}function U(a){rc(a),Hb(a.Qa),a.Qa=k,a.Pa.stop();var b=a.gb;Ya(b.j,Pb),b.j.length=0,a.l&&(b=a.l,a.l=k,b.abort(),b.Fa()),a.J&&(a.J=k)}function uc(a,b){try{a.b.Nb(a,b),a.b.F(Gc)}catch(c){yc(a.a,c,"Error in httprequest callback")}}function Jc(a){a=String(a);if(/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}f(Error("Invalid JSON string: "+a))}function Kc(a){return eval("("+a+")")}function Lc(a){var b=[];return Mc(new Nc(h),a,b),b.join("")}function Nc(a){this.Sa=a}function Mc(a,b,c){switch(typeof b){case"string":Oc(b,c);break;case"number":c.push(isFinite(b)&&!isNaN(b)?b:"null");break;case"boolean":c.push(b);break;case"undefined":c.push("null");break;case"object":if(b==k){c.push("null");break}if(v(b)){var d=b.length;c.push("[");for(var e="",g=0;g<d;g++)c.push(e),e=b[g],Mc(a,a.Sa?a.Sa.call(b,String(g),e):e,c),e=",";c.push("]");break}c.push("{"),d="";for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(e=b[g],"function"!=typeof e&&(c.push(d),Oc(g,c),c.push(":"),Mc(a,a.Sa?a.Sa.call(b,g,e):e,c),d=","));c.push("}");break;case"function":break;default:f(Error("Unknown type: "+typeof b))}}function Oc(a,b){b.push('"',a.replace(Qc,function(a){if(a in Pc)return Pc[a];var b=a.charCodeAt(0),c="\\u";return 16>b?c+="000":256>b?c+="00":4096>b&&(c+="0"),Pc[a]=c+b.toString(16)}),'"')}function Rc(a){return Sc(a||arguments.callee.caller,[])}function Sc(a,b){var c=[];if(0<=Xa(b,a))c.push("[...circular reference...]");else if(a&&50>b.length){c.push(Tc(a)+"(");for(var d=a.arguments,e=0;e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case"object":f=f?"object":"null";break;case"string":break;case"number":f=String(f);break;case"boolean":f=f?"true":"false";break;case"function":f=(f=Tc(f))?f:"[fn]";break;default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"..."),c.push(f)}b.push(a),c.push(")\n");try{c.push(Sc(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?c.push("[...long stack...]"):c.push("[end]");return c.join("")}function Tc(a){if(Uc[a])return Uc[a];a=String(a);if(!Uc[a]){var b=/function ([^\(]+)/.exec(a);Uc[a]=b?b[1]:"[Anonymous]"}return Uc[a]}function Vc(a,b,c,d,e){this.reset(a,b,c,d,e)}function Xc(a){this.oc=a}function Yc(a,b){this.name=a,this.value=b}function dd(a){return a.wa?a.wa:a.Oa?dd(a.Oa):(Ra("Root logger has no level set."),k)}function X(a,b){a.log(cd,b,h)}function gd(a){fd||(fd=new Xc(""),ed[""]=fd,fd.Wb(bd));var b;if(!(b=ed[a])){b=new Xc(a);var c=a.lastIndexOf("."),d=a.substr(c+1),c=gd(a.substr(0,c));c.bb||(c.bb={}),c.bb[d]=b,b.Oa=c,ed[a]=b}return b}function hd(){this.q=gd("goog.net.BrowserChannel")}function tc(a,b,c,d){a.info("XMLHTTP TEXT ("+b+"): "+Fc(a,c)+(d?" "+d:""))}function yc(a,b,c){a.H((c||"Exception")+b)}function Fc(a,b){if(!b||b==id)return b;try{var c=Kc(b);if(c)for(var d=0;d<c.length;d++)if(v(c[d])){var e=c[d];if(!(2>e.length)){var f=e[1];if(v(f)&&!(1>f.length)){var g=f[0];if("noop"!=g&&"stop"!=g)for(var h=1;h<f.length;h++)f[h]=""}}}return Lc(c)}catch(i){return a.debug("Exception parsing expected JS array - probably was not JS"),b}}function jd(a,b){this.Nc=new Nc(a),this.O=b?Kc:Jc}function kd(a){N.call(this),this.headers=new cb,this.ta=a||k}function md(a,b){a.R=p,a.g&&(a.$=j,a.g.abort(),a.$=p),a.p=b,a.ha=5,nd(a),od(a)}function nd(a){a.fb||(a.fb=j,a.dispatchEvent("complete"),a.dispatchEvent("error"))}function pd(a){if(a.R&&"undefined"!=typeof ca)if(a.Ya[1]&&4==T(a)&&2==lc(a))X(a.q,Y(a,"Local request error detected and ignored"));else if(a.Ka&&4==T(a))R.setTimeout(z(a.Mb,a),0);else if(a.dispatchEvent("readystatechange"),4==T(a)){X(a.q,Y(a,"Request complete")),a.R=p;try{var b=lc(a),c,d;a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:d=j;break a;default:d=p}if(!(c=d)){var e;if(e=0===b){var f=String(a.Ma).match(Sa)[1]||k;if(!f&&self.location)var g=self.location.protocol,f=g.substr(0,g.length-1);e=!ld.test(f?f.toLowerCase():"")}c=e}if(c)a.dispatchEvent("complete"),a.dispatchEvent("success");else{a.ha=6;var h;try{h=2<T(a)?a.g.statusText:""}catch(i){X(a.q,"Can not get status: "+i.message),h=""}a.p=h+" ["+lc(a)+"]",nd(a)}}finally{od(a)}}}function od(a,b){if(a.g){var c=a.g,d=a.Ya[0]?ea:k;a.g=k,a.Ya=k,a.ba&&(R.clearTimeout(a.ba),a.ba=k),b||a.dispatchEvent("ready");try{c.onreadystatechange=d}catch(e){a.q.H("Problem encountered resetting onreadystatechange: "+e.message)}}}function T(a){return a.g?a.g.readyState:0}function lc(a){try{return 2<T(a)?a.g.status:-1}catch(b){return a.q.ra("Can not get status: "+b.message),-1}}function mc(a){try{return a.g?a.g.responseText:""}catch(b){return X(a.q,"Can not get responseText: "+b.message),""}}function Y(a,b){return b+" ["+a.Hb+" "+a.Ma+" "+lc(a)+"]"}function qd(){this.Tb=A()}function rd(a,b,c,d,e){(new hd).debug("TestLoadImageWithRetries: "+e);if(0==d)c(p);else{var f=e||0;d--,sd(a,b,function(e){e?c(j):u.setTimeout(function(){rd(a,b,c,d,f)},f)})}}function sd(a,b,c){var d=new hd;d.debug("TestLoadImage: loading "+a);var e=new Image,f=k;createHandler=function(a,b){return function(){try{d.debug("TestLoadImage: "+b),e.onload=k,e.onerror=k,e.onabort=k,e.ontimeout=k,u.clearTimeout(f),c(a)}catch(h){yc(d,h)}}},e.onload=createHandler(j,"loaded"),e.onerror=createHandler(p,"error"),e.onabort=createHandler(p,"abort"),e.ontimeout=createHandler(p,"timeout"),f=u.setTimeout(function(){e.ontimeout&&e.ontimeout()},b),e.src=a}function td(a,b){this.b=a,this.a=b,this.O=new jd(k,j)}function wd(a){a.a.debug("TestConnection: starting stage 2"),a.w=new S(a,a.a,h,h,h),a.w.W(a.u);var b=yd(a.b,a.M,a.G);V(zd);if(fc())rb(b,"TYPE","xmlhttp"),ic(a.w,b,p,a.M,p);else{rb(b,"TYPE","html");var c=a.w,a=Boolean(a.M);c.pa=3,c.S=K(b.n()),Dc(c,a)}}function Kd(a){this.ub=a||k,this.c=Ld,this.s=[],this.P=[],this.a=new hd,this.O=new jd(k,j)}function Md(a,b){this.Jb=a,this.map=b,this.Ec=k}function Od(a,b){O.call(this,"statevent",a),this.Oc=b}function Pd(a,b,c,d){O.call(this,"timingevent",a),this.size=b,this.Mc=c,this.Lc=d}function Qd(a,b){O.call(this,"serverreachability",a),this.Kc=b}function Sd(a){a.T&&(a.T.abort(),a.T=k),a.k&&(a.k.cancel(),a.k=k),a.K&&(u.clearTimeout(a.K),a.K=k),Td(a),a.o&&(a.o.cancel(),a.o=k),a.D&&(u.clearTimeout(a.D),a.D=k)}function Ud(a){!a.o&&!a.D&&(a.D=W(z(a.Pb,a),0),a.U=0)}function Xd(a,b){var c,d;b?6<a.da?(a.s=a.P.concat(a.s),a.P.length=0,c=a.ya-1,d=Vd(a)):(c=b.C,d=b.V):(c=a.ya++,d=Vd(a));var e=a.Ia.n();J(e,"SID",a.X),J(e,"RID",c),J(e,"AID",a.va),Wd(a,e),c=new S(a,a.a,a.X,c,a.U+1),c.W(a.u),c.setTimeout(Math.round(.5*a.Bb)+Math.round(.5*a.Bb*Math.random())),a.o=c,gc(c,e,d)}function Wd(a,b){if(a.e){var c=a.e.getAdditionalParams(a);c&&bb(c,function(a,c){J(b,c,a)})}}function Vd(a){var b=Math.min(a.s.length,1e3),c=["count="+b],d;6<a.da&&0<b?(d=a.s[0].Jb,c.push("ofs="+d)):d=0;for(var e=0;e<b;e++){var f=a.s[e].Jb,g=a.s[e].map,f=6>=a.da?e:f-d;try{bb(g,function(a,b){c.push("req"+f+"_"+b+"="+encodeURIComponent(a))})}catch(h){c.push("req"+f+"_type="+encodeURIComponent("_badmap")),a.e&&a.e.badMapError(a,g)}}return a.P=a.P.concat(a.s.splice(0,b)),c.join("&")}function Yd(a){!a.k&&!a.K&&(a.rb=1,a.K=W(z(a.Ob,a),0),a.ca=0)}function Zd(a){return a.k||a.K?(a.a.H("Request already in progress"),p):3<=a.ca?p:(a.a.debug("Going to retry GET"),a.rb++,a.K=W(z(a.Ob,a),$d(a,a.ca)),a.ca++,j)}function Rd(a){if(a.e){var b=a.e.okToMakeRequest(a);if(0!=b)return a.a.debug("Handler returned error code from okToMakeRequest"),Z(a,b),p}return j}function Ed(a,b,c){a.a.debug("Test Connection Finished"),a.pb=a.cc&&c,a.h=b.h,a.a.debug("connectChannel_()"),a.ic(Ld,0),a.Ia=ud(a,a.G),Ud(a)}function Ad(a,b){a.a.debug("Test Connection Failed"),a.h=b.h,Z(a,2)}function Td(a){a.Z!=k&&(u.clearTimeout(a.Z),a.Z=k)}function $d(a,b){var c=a.ec+Math.floor(Math.random()*a.Ac);return a.isActive()||(a.a.debug("Inactive channel"),c*=2),c*b}function Z(a,b){a.a.info("Error code "+b);if(2==b||9==b){var c=k;a.e&&(c=a.e.getNetworkTestImageUri(a));var d=z(a.Cc,a);c||(c=new H("//www.google.com/images/cleardot.gif"),K(c)),sd(c+"",1e4,d)}else V(2);ae(a,b)}function ae(a,b){a.a.debug("HttpChannel: error - "+b),a.c=0,a.e&&a.e.channelError(a,b),be(a),Sd(a)}function be(a){a.c=0,a.h=-1;if(a.e)if(0==a.P.length&&0==a.s.length)a.e.channelClosed(a);else{a.a.debug("Number of undelivered maps, pending: "+a.P.length+", outgoing: "+a.s.length);var b=$a(a.P),c=$a(a.s);a.P.length=0,a.s.length=0,a.e.channelClosed(a,b,c)}}function ud(a,b){var c=Gd(a,k,b);return a.a.debug("GetForwardChannelUri: "+c),c}function yd(a,b,c){return b=Gd(a,a.Va()?b:k,c),a.a.debug("GetBackChannelUri: "+b),b}function Gd(a,b,c){var d;d=c instanceof H?c.n():new H(c,h);if(""!=d.fa)b&&gb(d,b+"."+d.fa),hb(d,d.za);else{var e=window.location,f=e.protocol,b=b?b+"."+e.hostname:e.hostname,e=e.port,g=new H(k,h);f&&fb(g,f),b&&gb(g,b),e&&hb(g,e),c&&ib(g,c),d=g}return a.ua&&bb(a.ua,function(a,b){J(d,b,a)}),J(d,"VER",a.da),Wd(a,d),d}function W(a,b){return ha(a)||f(Error("Fn must not be null and must be a function")),u.setTimeout(function(){a()},b)}function V(a){Nd.dispatchEvent(new Od(Nd,a))}function ce(){}var h=void 0,j=!0,k=null,p=!1,t,ca=ca||{},u=this,ia="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36),ja=0,A=Date.now||function(){return+(new Date)},pa=/&/g,qa=/</g,ra=/>/g,sa=/\"/g,oa=/[&<>\"]/,ta,ua,va,wa;wa=va=ua=ta=p;var za;if(za=xa()){var Aa=u.navigator;ta=0==za.indexOf("Opera"),ua=!ta&&-1!=za.indexOf("MSIE"),va=!ta&&-1!=za.indexOf("WebKit"),wa=!ta&&!va&&"Gecko"==Aa.product}var Ba=ta,C=ua,Ca=wa,D=va,Da=u.navigator,Ea=-1!=(Da&&Da.platform||"").indexOf("Mac"),Ga;a:{var Ha="",Ia;if(Ba&&u.opera)var Ja=u.opera.version,Ha="function"==typeof Ja?Ja():Ja;else if(Ca?Ia=/rv\:([^\);]+)(\)|;)/:C?Ia=/MSIE\s+([^\);]+)(\)|;)/:D&&(Ia=/WebKit\/(\S+)/),Ia)var Ka=Ia.exec(xa()),Ha=Ka?Ka[1]:"";if(C){var La=Fa();if(La>parseFloat(Ha)){Ga=String(La);break a}}Ga=Ha}var Ma={},Na=u.document,Oa=!Na||!C?h:Fa()||("CSS1Compat"==Na.compatMode?parseInt(Ga,10):5);B(Pa,Error),Pa.prototype.name="CustomError",B(Qa,Pa),Qa.prototype.name="AssertionError";var Sa=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),F=Array.prototype,Xa=F.indexOf?function(a,b,c){return F.indexOf.call(a,b,c)}:function(a,b,c){c=c==k?0:0>c?Math.max(0,a.length+c):c;if(x(a))return!x(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ya=F.forEach?function(a,b,c){F.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=x(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};t=cb.prototype,t.f=0,t.$b=0,t.L=function(){db(this);for(var a=[],b=0;b<this.j.length;b++)a.push(this.N[this.j[b]]);return a},t.ga=function(){return db(this),this.j.concat()},t.ea=function(a){return eb(this.N,a)},t.remove=function(a){return eb(this.N,a)?(delete this.N[a],this.f--,this.$b++,this.j.length>2*this.f&&db(this),j):p},t.get=function(a,b){return eb(this.N,a)?this.N[a]:b},t.set=function(a,b){eb(this.N,a)||(this.f++,this.j.push(a),this.$b++),this.N[a]=b},t.n=function(){return new cb(this)},t=H.prototype,t.na="",t.Xa="",t.fa="",t.za=k,t.G="",t.Ja="",t.lc=p,t.A=p,t.toString=function(){var a=[],b=this.na;b&&a.push(lb(b,mb),":");if(b=this.fa){a.push("//");var c=this.Xa;c&&a.push(lb(c,mb),"@"),a.push(encodeURIComponent(String(b))),b=this.za,b!=k&&a.push(":",String(b))}if(b=this.G)this.fa&&"/"!=b.charAt(0)&&a.push("/"),a.push(lb(b,"/"==b.charAt(0)?nb:ob));return(b=this.Q+"")&&a.push("?",b),(b=this.Ja)&&a.push("#",lb(b,pb)),a.join("")},t.n=function(){return new H(this)},t.nb=function(a){return this.A=a,this.Q&&this.Q.nb(a),this};var mb=/[#\/\?@]/g,ob=/[\#\?:]/g,nb=/[\#\?]/g,qb=/[\#\?@]/g,pb=/#/g;t=kb.prototype,t.i=k,t.f=k,t.add=function(a,b){L(this),this.z=k;var a=M(this,a),c=this.i.get(a);return c||this.i.set(a,c=[]),c.push(b),this.f++,this},t.remove=function(a){return L(this),a=M(this,a),this.i.ea(a)?(this.z=k,this.f-=this.i.get(a).length,this.i.remove(a)):p},t.ea=function(a){return L(this),a=M(this,a),this.i.ea(a)},t.ga=function(){L(this);for(var a=this.i.L(),b=this.i.ga(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c},t.L=function(a){L(this);var b=[];if(a)this.ea(a)&&(b=Za(b,this.i.get(M(this,a))));else for(var a=this.i.L(),c=0;c<a.length;c++)b=Za(b,a[c]);return b},t.set=function(a,b){return L(this),this.z=k,a=M(this,a),this.ea(a)&&(this.f-=this.i.get(a).length),this.i.set(a,[b]),this.f++,this},t.get=function(a,b){var c=a?this.L(a):[];return 0<c.length?String(c[0]):b},t.toString=function(){if(this.z)return this.z;if(!this.i)return"";for(var a=[],b=this.i.ga(),c=0;c<b.length;c++)for(var d=b[c],e=encodeURIComponent(String(d)),d=this.L(d),f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f]))),a.push(g)}return this.z=a.join("&")},t.n=function(){var a=new kb;return a.z=this.z,this.i&&(a.i=this.i.n(),a.f=this.f),a},t.nb=function(a){a&&!this.A&&(L(this),this.z=k,bb(this.i,function(a,b){var c=b.toLowerCase();b!=c&&(this.remove(b),sb(this,c,a))},this)),this.A=a},ub.prototype.Ea=k;var vb;B(wb,ub),vb=new wb;var Bb=0;t=Ab.prototype,t.key=0,t.la=p,t.tb=p,t.La=function(a,b,c,d,e,g){ha(a)?this.Gb=j:a&&a.handleEvent&&ha(a.handleEvent)?this.Gb=p:f(Error("Invalid listener argument")),this.xa=a,this.Sb=b,this.src=c,this.type=d,this.capture=!!e,this.ib=g,this.tb=p,this.key=++Bb,this.la=p},t.handleEvent=function(a){return this.Gb?this.xa.call(this.ib||this.src,a):this.xa.handleEvent.call(this.xa,a)};var Cb=!C||C&&9<=Oa,Db=C&&!E("9");!D||E("528"),Ca&&E("1.9b")||C&&E("8")||Ba&&E("9.5")||D&&E("528"),Ca&&!E("8")||C&&E("9");var Eb=0,Fb={};N.prototype.xb=p,N.prototype.Fa=function(){if(!this.xb&&(this.xb=j,this.t(),0!=Eb)){var a=y(this);delete Fb[a]}},N.prototype.t=function(){this.hc&&Gb.apply(k,this.hc);if(this.Lb)for(;this.Lb.length;)this.Lb.shift()()},t=O.prototype,t.t=q(),t.Fa=q(),t.ja=p,t.defaultPrevented=p,t.Ta=j,t.preventDefault=function(){this.defaultPrevented=j,this.Ta=p},Ib[" "]=ea,B(Jb,O),t=Jb.prototype,t.target=k,t.relatedTarget=k,t.offsetX=0,t.offsetY=0,t.clientX=0,t.clientY=0,t.screenX=0,t.screenY=0,t.button=0,t.keyCode=0,t.charCode=0,t.ctrlKey=p,t.altKey=p,t.shiftKey=p,t.metaKey=p,t.xc=p,t.yb=k,t.La=function(a,b){var c=this.type=a.type;O.call(this,c),this.target=a.target||a.srcElement,this.currentTarget=b;var d=a.relatedTarget;if(d){if(Ca){var e;a:{try{Ib(d.nodeName),e=j;break a}catch(f){}e=p}e||(d=k)}}else"mouseover"==c?d=a.fromElement:"mouseout"==c&&(d=a.toElement);this.relatedTarget=d,this.offsetX=D||a.offsetX!==h?a.offsetX:a.layerX,this.offsetY=D||a.offsetY!==h?a.offsetY:a.layerY,this.clientX=a.clientX!==h?a.clientX:a.pageX,this.clientY=a.clientY!==h?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0,this.button=a.button,this.keyCode=a.keyCode||0,this.charCode=a.charCode||("keypress"==c?a.keyCode:0),this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.xc=Ea?a.metaKey:a.ctrlKey,this.state=a.state,this.yb=a,a.defaultPrevented&&this.preventDefault(),delete this.ja},t.preventDefault=function(){Jb.oa.preventDefault.call(this);var a=this.yb;if(a.preventDefault)a.preventDefault();else if(a.returnValue=p,Db)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}},t.t=q();var Kb={},P={},Q={},Lb={};B(Tb,N),t=Tb.prototype,t.vb=j,t.mb=k,t.addEventListener=function(a,b,c,d){Mb(this,a,b,c,d)},t.removeEventListener=function(a,b,c,d){Ob(this,a,b,c,d)},t.dispatchEvent=function(a){var b=a.type||a,c=P;if(b in c){if(x(a))a=new O(a,this);else if(a instanceof O)a.target=a.target||this;else{var d=a,a=new O(b,this);Wa(a,d)}var d=1,e,c=c[b],b=j in c,f;if(b){e=[];for(f=this;f;f=f.mb)e.push(f);f=c[j],f.B=f.f;for(var g=e.length-1;!a.ja&&0<=g&&f.B;g--)a.currentTarget=e[g],d&=Rb(f,e[g],a.type,j,a)&&a.Ta!=p}if(p in c)if(f=c[p],f.B=f.f,b)for(g=0;!a.ja&&g<e.length&&f.B;g++)a.currentTarget=e[g],d&=Rb(f,e[g],a.type,p,a)&&a.Ta!=p;else for(e=this;!a.ja&&e&&f.B;e=e.mb)a.currentTarget=e,d&=Rb(f,e,a.type,p,a)&&a.Ta!=p;a=Boolean(d)}else a=j;return a},t.t=function(){Tb.oa.t.call(this);var a,b=0,c=a==k;a=!!a;if(this==k){var d=function(d){for(var e=d.length-1;0<=e;e--){var f=d[e];if(c||a==f.capture)Pb(f.key),b++}},e;for(e in Q)d.call(h,Q[e])}else if(d=y(this),Q[d]){d=Q[d];for(e=d.length-1;0<=e;e--){var f=d[e];if(c||a==f.capture)Pb(f.key),b++}}this.mb=k},B(Ub,Tb),Ub.prototype.enabled=p;var R=u.window;t=Ub.prototype,t.r=k,t.setInterval=function(a){this.aa=a,this.r&&this.enabled?(this.stop(),this.start()):this.r&&this.stop()},t.Dc=function(){if(this.enabled){var a=A()-this.lb;0<a&&a<.8*this.aa?this.r=this.Ca.setTimeout(this.ab,this.aa-a):(this.dispatchEvent(Vb),this.enabled&&(this.r=this.Ca.setTimeout(this.ab,this.aa),this.lb=A()))}},t.start=function(){this.enabled=j,this.r||(this.r=this.Ca.setTimeout(this.ab,this.aa),this.lb=A())},t.stop=function(){this.enabled=p,this.r&&(this.Ca.clearTimeout(this.r),this.r=k)},t.t=function(){Ub.oa.t.call(this),this.stop(),delete this.Ca};var Vb="tick";B(Wb,N);var Xb=[];Wb.prototype.t=function(){Wb.oa.t.call(this),Ya(this.j,Pb),this.j.length=0},Wb.prototype.handleEvent=function(){f(Error("EventHandler.handleEvent not implemented"))},B(Zb,N),t=Zb.prototype,t.Ua=p,t.Rb=0,t.r=k,t.stop=function(){this.r&&(R.clearTimeout(this.r),this.r=k,this.Ua=p)},t.t=function(){Zb.oa.t.call(this),this.stop()},t.sc=function(){this.r=k,this.Ua&&!this.Rb&&(this.Ua=p,$b(this))},t=S.prototype,t.u=k,t.I=p,t.sa=k,t.qb=k,t.ma=k,t.pa=k,t.S=k,t.v=k,t.V=k,t.l=k,t.Da=0,t.J=k,t.qa=k,t.p=k,t.h=-1,t.Vb=j,t.Y=p,t.ka=0,t.Qa=k;var ac=45e3,bc=250,dc={},ec={};t=S.prototype,t.W=s("u"),t.setTimeout=s("Ba"),t.Yb=s("ka"),t.zc=function(a){var a=a.target,b=this.Qa;b&&3==T(a)?(this.a.debug("Throttling readystatechange."),!b.r&&!b.Rb?$b(b):b.Ua=j):this.bc(a)},t.bc=function(a){try{if(a==this.l)a:{var b=T(this.l),c=this.l.ha,d=lc(this.l);if(!fc()||D&&!E("420+")){if(4>b)break a}else if(3>b||3==b&&!Ba&&!mc(this.l))break a;!this.Y&&4==b&&c!=nc&&(c==oc||0>=d?this.b.F(pc):this.b.F(qc)),rc(this);var e=lc(this.l);this.h=e;var f=mc(this.l);f||this.a.debug("No response text for uri "+this.v+" status "+e),this.I=200==e,this.a.info("XMLHTTP RESP ("+this.C+") [ attempt "+this.Aa+"]: "+this.qa+"\n"+this.v+"\n"+b+" "+e),this.I?(4==b&&U(this),this.wb?(sc(this,b,f),Ba&&3==b&&(Yb(this.gb,this.Pa,Vb,this.yc),this.Pa.start())):(tc(this.a,this.C,f,k),uc(this,f)),this.I&&!this.Y&&(4==b?this.b.ia(this):(this.I=p,jc(this)))):(400==e&&0<f.indexOf("Unknown SID")?(this.p=3,V(vc)):(this.p=0,V(wc)),tc(this.a,this.C,f),U(this),xc(this))}else this.a.ra("Called back with an unexpected xmlhttp")}catch(g){this.a.debug("Failed call to OnXmlHttpReadyStateChanged_"),this.l&&mc(this.l)?yc(this.a,g,"ResponseText: "+mc(this.l)):yc(this.a,g,"No response text")}finally{}},t.yc=function(){var a=T(this.l),b=mc(this.l);this.Da<b.length&&(rc(this),sc(this,a,b),this.I&&4!=a&&jc(this))},t.vc=function(a){W(z(this.uc,this,a),0)},t.uc=function(a){if(!this.Y){var b=this.a;b.info("TRIDENT TEXT ("+this.C+"): "+Fc(b,a)),rc(this),uc(this,a),jc(this)}},t.Qb=function(a){W(z(this.tc,this,a),0)},t.tc=function(a){this.Y||(this.a.info("TRIDENT TEXT ("+this.C+"): "+a?"success":"failure"),U(this),this.I=a,this.b.ia(this),this.b.F(Gc))},t.kc=function(){rc(this),this.b.ia(this)},t.cancel=function(){this.Y=j,U(this)},t.wc=function(){this.sa=k;var a=A();0<=a-this.qb?(this.I&&this.a.H("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.v),2!=this.pa&&this.b.F(pc),U(this),this.p=2,V(Ic),xc(this)):(this.a.ra("WatchDog timer called too early"),Hc(this,this.qb-a))},t.Cb=aa("p");var Pc={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","":"\\u000b"},Qc=/\uffff/.test("")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,Uc={};Vc.prototype.Bc=0,Vc.prototype.Ab=k,Vc.prototype.zb=k;var Wc=0;Vc.prototype.reset=function(a,b,c,d,e){this.Bc="number"==typeof e?e:Wc++,this.Pc=d||A(),this.wa=a,this.nc=b,this.Hc=c,delete this.Ab,delete this.zb},Vc.prototype.Wb=s("wa"),Xc.prototype.Oa=k,Xc.prototype.wa=k,Xc.prototype.bb=k,Xc.prototype.Db=k,Yc.prototype.toString=aa("name");var Zc=new Yc("SEVERE",1e3),$c=new Yc("WARNING",900),ad=new Yc("INFO",800),bd=new Yc("CONFIG",700),cd=new Yc("FINE",500);t=Xc.prototype,t.getParent=aa("Oa"),t.Wb=s("wa"),t.log=function(a,b,c){return},t.jc=function(a,b,c){var d=new Vc(a,String(b),this.oc);if(c){d.Ab=c;var e,f=arguments.callee.caller;try{var g,h=da("window.location.href");if(x(c))g={message:c,name:"Unknown error",lineNumber:"Not available",fileName:h,stack:"Not available"};else{var i,k,l=p;try{i=c.lineNumber||c.Gc||"Not available"}catch(m){i="Not available",l=j}try{k=c.fileName||c.filename||c.sourceURL||h}catch(n){k="Not available",l=j}g=l||!c.lineNumber||!c.fileName||!c.stack?{message:c.message,name:c.name,lineNumber:i,fileName:k,stack:c.stack||"Not available"}:c}e="Message: "+na(g.message)+'\nUrl: <a href="view-source:'+g.fileName+'" target="_new">'+g.fileName+"</a>\nLine: "+g.lineNumber+"\n\nBrowser stack:\n"+na(g.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+na(Rc(f)+"-> ")}catch(o){e="Exception trying to expose exception! You win, we lose. "+o}d.zb=e}return d},t.H=function(a,b){this.log(Zc,a,b)},t.ra=function(a,b){this.log($c,a,b)},t.info=function(a,b){this.log(ad,a,b)};var ed={},fd=k;hd.prototype.debug=function(a){},hd.prototype.info=function(a){this.q.info(a)},hd.prototype.ra=function(a){this.q.ra(a)},hd.prototype.H=function(a){this.q.H(a)},jd.prototype.parse=function(a){return this.O(a)};var nc=7,oc=8;B(kd,Tb),kd.prototype.q=gd("goog.net.XhrIo");var ld=/^https?$/i;t=kd.prototype,t.R=p,t.g=k,t.Ya=k,t.Ma="",t.Hb="",t.ha=0,t.p="",t.fb=p,t.Ka=p,t.jb=p,t.$=p,t.Wa=0,t.ba=k,t.Ub="",t.ac=p,t.send=function(a,b,c,d){this.g&&f(Error("[goog.net.XhrIo] Object is active with another request="+this.Ma+"; newUri="+a)),b=b?b.toUpperCase():"GET",this.Ma=a,this.p="",this.ha=0,this.Hb=b,this.fb=p,this.R=j,this.g=this.ta?xb(this.ta):xb(vb),this.Ya=this.ta?this.ta.Ea||(this.ta.Ea=zb(this.ta)):vb.Ea||(vb.Ea=zb(vb)),this.g.onreadystatechange=z(this.Mb,this);try{X(this.q,Y(this,"Opening Xhr")),this.jb=j,this.g.open(b,a,j),this.jb=p}catch(e){X(this.q,Y(this,"Error opening Xhr: "+e.message)),md(this,e);return}var a=c||"",g=this.headers.n();d&&bb(d,function(a,b){g.set(b,a)}),d=u.FormData&&a instanceof u.FormData,"POST"==b&&!g.ea("Content-Type")&&!d&&g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),bb(g,function(a,b){this.g.setRequestHeader(b,a)},this),this.Ub&&(this.g.responseType=this.Ub),"withCredentials"in this.g&&(this.g.withCredentials=this.ac);try{this.ba&&(R.clearTimeout(this.ba),this.ba=k),0<this.Wa&&(X(this.q,Y(this,"Will abort after "+this.Wa+"ms if incomplete")),this.ba=R.setTimeout(z(this.Ba,this),this.Wa)),X(this.q,Y(this,"Sending request")),this.Ka=j,this.g.send(a),this.Ka=p}catch(h){X(this.q,Y(this,"Send error: "+h.message)),md(this,h)}},t.Ba=function(){"undefined"!=typeof ca&&this.g&&(this.p="Timed out after "+this.Wa+"ms, aborting",this.ha=oc,X(this.q,Y(this,this.p)),this.dispatchEvent("timeout"),this.abort(oc))},t.abort=function(a){this.g&&this.R&&(X(this.q,Y(this,"Aborting")),this.R=p,this.$=j,this.g.abort(),this.$=p,this.ha=a||nc,this.dispatchEvent("complete"),this.dispatchEvent("abort"),od(this))},t.t=function(){this.g&&(this.R&&(this.R=p,this.$=j,this.g.abort(),this.$=p),od(this,j)),kd.oa.t.call(this)},t.Mb=function(){!this.jb&&!this.Ka&&!this.$?this.rc():pd(this)},t.rc=function(){pd(this)},t.isActive=function(){return!!this.g},t.Cb=function(){return x(this.p)?this.p:String(this.p)},new qd,qd.prototype.set=s("Tb"),qd.prototype.reset=function(){this.set(A())},qd.prototype.get=aa("Tb"),t=td.prototype,t.u=k,t.w=k,t.Ra=p,t.Zb=k,t.Ha=k,t.kb=k,t.G=k,t.c=k,t.h=-1,t.M=k,t.$a=k,t.W=s("u"),t.Xb=s("O"),t.cb=function(a){this.G=a,a=ud(this.b,this.G),V(vd),rb(a,"MODE","init"),this.w=new S(this,this.a,h,h,h),this.w.W(this.u),ic(this.w,a,p,k,j),this.c=0,this.Zb=A()},t.gc=function(a){if(a)this.c=2,wd(this);else{V(xd);var b=this.b;b.a.debug("Test Connection Blocked"),b.h=b.T.h,Z(b,9)}a&&this.F(qc)},t.eb=function(a){return this.b.eb(a)},t.abort=function(){this.w&&(this.w.cancel(),this.w=k),this.h=-1},t.Fb=ba(p),t.Nb=function(a,b){this.h=a.h;if(0==this.c)if(this.a.debug("TestConnection: Got data for stage 1"),b){try{var c=this.O.parse(b)}catch(d){yc(this.a,d),Ad(this.b,this);return}this.M=this.b.correctHostPrefix(c[0]),this.$a=c[1]}else this.a.debug("TestConnection: Null responseText"),Ad(this.b,this);else if(2==this.c)if(this.Ra)V(Bd),this.kb=A();else if("11111"==b){if(V(Cd),this.Ra=j,this.Ha=A(),c=this.Ha-this.Zb,fc()||500>c)this.h=200,this.w.cancel(),this.a.debug("Test connection succeeded; using streaming connection"),V(Dd),Ed(this.b,this,j)}else V(Fd),this.Ha=this.kb=A(),this.Ra=p},t.ia=function(){this.h=this.w.h;if(this.w.I)if(0==this.c)if(this.a.debug("TestConnection: request complete for initial check"),this.$a){this.c=1;var a=Gd(this.b,this.$a,"/mail/images/cleardot.gif");K(a),rd(a+"",5e3,z(this.gc,this),3,2e3),this.F(kc)}else this.c=2,wd(this);else 2==this.c&&(this.a.debug("TestConnection: request complete for stage 2"),a=p,(a=fc()?this.Ra:200>this.kb-this.Ha?p:j)?(this.a.debug("Test connection succeeded; using streaming connection"),V(Dd),Ed(this.b,this,j)):(this.a.debug("Test connection failed; not using streaming"),V(Hd),Ed(this.b,this,p)));else this.a.debug("TestConnection: request failed, in state "+this.c),0==this.c?V(Id):2==this.c&&V(Jd),Ad(this.b,this)},t.Va=function(){return this.b.Va()},t.isActive=function(){return this.b.isActive()},t.F=function(a){this.b.F(a)},t=Kd.prototype,t.u=k,t.ua=k,t.o=k,t.k=k,t.G=k,t.Ia=k,t.sb=k,t.M=k,t.dc=j,t.ya=0,t.pc=0,t.Ga=p,t.e=k,t.D=k,t.K=k,t.Z=k,t.T=k,t.pb=k,t.cc=j,t.va=-1,t.Ib=-1,t.h=-1,t.U=0,t.ca=0,t.ec=5e3,t.Ac=1e4,t.hb=2,t.Bb=2e4,t.ka=0,t.ob=p,t.da=8;var Ld=1,Nd=new Tb;B(Od,O),B(Pd,O);var kc=1,qc=2,pc=3,Gc=4;B(Qd,O);var vd=3,xd=4,zd=5,Cd=6,Bd=7,Fd=8,Id=9,Jd=10,Hd=11,Dd=12,vc=13,wc=14,Ac=15,Bc=16,Cc=17,Ic=18,Ec=22,id="y2f%";t=Kd.prototype,t.cb=function(a,b,c,d,e){this.a.debug("connect()"),V(0),this.G=b,this.ua=c||{},d&&e!==h&&(this.ua.OSID=d,this.ua.OAID=e),this.a.debug("connectTest_()"),Rd(this)&&(this.T=new td(this,this.a),this.T.W(this.u),this.T.Xb(this.O),this.T.cb(a))},t.W=s("u"),t.Yb=s("ka"),t.Fb=function(){return 0==this.c},t.Xb=s("O"),t.Pb=function(a){this.D=k,this.a.debug("startForwardChannel_");if(Rd(this))if(this.c==Ld)if(a)this.a.H("Not supposed to retry the open");else{this.a.debug("open_()"),this.ya=Math.floor(1e5*Math.random());var a=this.ya++,b=new S(this,this.a,"",a,h);b.W(this.u);var c=Vd(this),d=this.Ia.n();J(d,"RID",a),this.ub&&J(d,"CVER",this.ub),Wd(this,d),gc(b,d,c),this.o=b,this.c=2}else 3==this.c&&(a?Xd(this,a):0==this.s.length?this.a.debug("startForwardChannel_ returned: nothing to send"):this.o?this.a.H("startForwardChannel_ returned: connection already in progress"):(Xd(this),this.a.debug("startForwardChannel_ finished, sent request")))},t.Ob=function(){this.K=k;if(Rd(this)){this.a.debug("Creating new HttpRequest"),this.k=new S(this,this.a,this.X,"rpc",this.rb),this.k.W(this.u),this.k.Yb(this.ka);var a=this.sb.n();J(a,"RID","rpc"),J(a,"SID",this.X),J(a,"CI",this.pb?"0":"1"),J(a,"AID",this.va),Wd(this,a);if(fc())J(a,"TYPE","xmlhttp"),ic(this.k,a,j,this.M,p);else{J(a,"TYPE","html");var b=this.k,c=Boolean(this.M);b.pa=3,b.S=K(a.n()),Dc(b,c)}this.a.debug("New Request created")}},t.Nb=function(a,b){if(0!=this.c&&(this.k==a||this.o==a))if(this.h=a.h,this.o==a&&3==this.c)if(7<this.da){var c;try{c=this.O.parse(b)}catch(d){c=k}if(v(c)&&3==c.length){var e=c;if(0==e[0])a:if(this.a.debug("Server claims our backchannel is missing."),this.K)this.a.debug("But we are currently starting the request.");else{if(this.k){if(!(this.k.ma+3e3<this.o.ma))break a;Td(this),this.k.cancel(),this.k=k}else this.a.ra("We do not have a BackChannel established");Zd(this),V(19)}else this.Ib=e[1],c=this.Ib-this.va,0<c&&(e=e[2],this.a.debug(e+" bytes (in "+c+" arrays) are outstanding on the BackChannel"),37500>e&&this.pb&&0==this.ca&&!this.Z&&(this.Z=W(z(this.qc,this),6e3)))}else this.a.debug("Bad POST response data returned"),Z(this,11)}else b!=id&&(this.a.debug("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.k==a&&Td(this),!/^[\s\xa0]*$/.test(b)){c=this.O.parse(b);for(var e=this.e&&this.e.channelHandleMultipleArrays?[]:k,f=0;f<c.length;f++){var g=c[f];this.va=g[0],g=g[1],2==this.c?"c"==g[0]?(this.X=g[1],this.M=this.correctHostPrefix(g[2]),g=g[3],this.da=g!=k?g:6,this.c=3,this.e&&this.e.channelOpened(this),this.sb=yd(this,this.M,this.G),Yd(this)):"stop"==g[0]&&Z(this,7):3==this.c&&("stop"==g[0]?(e&&e.length&&(this.e.channelHandleMultipleArrays(this,e),e.length=0),Z(this,7)):"noop"!=g[0]&&(e?e.push(g):this.e&&this.e.channelHandleArray(this,g)),this.ca=0)}e&&e.length&&this.e.channelHandleMultipleArrays(this,e)}},t.correctHostPrefix=function(a){return this.dc?this.e?this.e.correctHostPrefix(a):a:k},t.qc=function(){this.Z!=k&&(this.Z=k,this.k.cancel(),this.k=k,Zd(this),V(20))},t.ia=function(a){this.a.debug("Request complete");var b;if(this.k==a)Td(this),this.k=k,b=2;else{if(this.o!=a)return;this.o=k,b=1}this.h=a.h;if(0!=this.c)if(a.I)1==b?(b=A()-a.ma,Nd.dispatchEvent(new Pd(Nd,a.V?a.V.length:0,b,this.U)),Ud(this),this.P.length=0):Yd(this);else{var c=a.Cb();if(3==c||7==c||0==c&&0<this.h)this.a.debug("Not retrying due to error type");else{this.a.debug("Maybe retrying, last error: "+cc(c,this.h));var d;if(d=1==b)this.o||this.D?(this.a.H("Request already in progress"),d=p):this.c==Ld||this.U>=(this.Ga?0:this.hb)?d=p:(this.a.debug("Going to retry POST"),this.D=W(z(this.Pb,this,a),$d(this,this.U)),this.U++,d=j);if(d||2==b&&Zd(this))return;this.a.debug("Exceeded max number of retries")}this.a.debug("Error: HTTP request failed");switch(c){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;case 7:Z(this,12);break;default:Z(this,2)}}},t.ic=function(a){0<=Xa(arguments,this.c)||f(Error("Unexpected channel state: "+this.c))},t.Cc=function(a){a?(this.a.info("Successfully pinged google.com"),V(2)):(this.a.info("Failed to ping google.com"),V(1),ae(this,8))},t.eb=function(a){return a&&!this.ob&&f(Error("Can't create secondary domain capable XhrIo object.")),a=new kd,a.ac=this.ob,a},t.isActive=function(){return!!this.e&&this.e.isActive(this)},t.F=function(a){Nd.dispatchEvent(new Qd(Nd,a))},t.Va=function(){return this.ob||!fc()},t=ce.prototype,t.channelHandleMultipleArrays=k,t.okToMakeRequest=ba(0),t.channelOpened=q(),t.channelHandleArray=q(),t.channelError=q(),t.channelClosed=q(),t.getAdditionalParams=function(){return{}},t.getNetworkTestImageUri=ba(k),t.isActive=ba(j),t.badMapError=q(),t.correctHostPrefix=function(a){return a};var $,de;de={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(a,b){var c,d,e,g,i,l,m,n,o;return m=this,a||(a="channel"),a.match(/:\/\//)&&a.replace(/^ws/,"http"),b||(b={}),v(b||"string"==typeof b)&&(b={}),i=b.reconnectTime||3e3,o=function(a){m.readyState=m.readyState=a},o(this.CLOSED),n=k,e=b.Jc,c=new ce,c.channelOpened=function(){return e=n,o($.OPEN),"function"==typeof m.onopen?m.onopen():h},d=k,c.channelError=function(a,b){var c;return c=de[b],d=b,o($.Za),"function"==typeof m.onerror?m.onerror(c,b):h},l=k,c.channelClosed=function(a,c,e){if(m.readyState!==$.CLOSED){n=k,a=d?de[d]:"Closed",o($.CLOSED);try{"function"==typeof m.onclose&&m.onclose(a,c,e)}catch(f){"undefined"!=typeof console&&console!==k&&console.error(f.stack)}return b.reconnect&&7!==d&&0!==d&&(c=6===d?0:i,clearTimeout(l),l=setTimeout(g,c)),d=k}},c.channelHandleArray=function(a,b){try{return"function"==typeof m.onmessage?m.onmessage(b):h}catch(c){"undefined"!=typeof console&&console!==k&&console.error(c.stack),f(c)}},g=function(){n&&f(Error("Reconnect() called from invalid state")),o($.CONNECTING),"function"==typeof m.onconnecting&&m.onconnecting(),clearTimeout(l),n=new Kd(b.appVersion),n.e=c,d=k;if(b.failFast){var g=n;g.Ga=j,g.a.info("setFailFast: true"),(g.o||g.D)&&g.U>(g.Ga?0:g.hb)&&(g.a.info("Retry count "+g.U+" > new maxRetries "+(g.Ga?0:g.hb)+". Fail immediately!"),g.o?(g.o.cancel(),g.ia(g.o)):(u.clearTimeout(g.D),g.D=k,Z(g,2)))}return n.cb(""+a+"/test",""+a+"/bind",k,e!=k?e.X:h,e!=k?e.va:h)},this.open=function(){return m.readyState!==m.CLOSED&&f(Error("Already open")),g()},this.close=function(){clearTimeout(l),d=0;if(m.readyState!==$.CLOSED){o($.Za);var a=n;a.a.debug("disconnect()"),Sd(a);if(3==a.c){var b=a.ya++,c=a.Ia.n();J(c,"SID",a.X),J(c,"RID",b),J(c,"TYPE","terminate"),Wd(a,c),b=new S(a,a.a,a.X,b,h),b.pa=2,b.S=K(c.n()),c=new Image,c.src=b.S,c.onload=c.onerror=z(b.kc,b),b.ma=A(),jc(b)}be(a)}},this.sendMap=function(a){var b;((b=m.readyState)===$.Za||b===$.CLOSED)&&f(Error("Cannot send to a closed connection")),b=n,0==b.c&&f(Error("Invalid operation: sending map when state is closed")),1e3==b.s.length&&b.a.H("Already have 1000 queued maps upon queueing "+Lc(a)),b.s.push(new Md(b.pc++,a)),(2==b.c||3==b.c)&&Ud(b)},this.send=function(a){return this.sendMap({JSON:Lc(a)})},g(),this},$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.Za=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,("undefined"!=typeof exports&&exports!==k?exports:window).BCSocket=$}(),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=[].slice,x=function(a,b){return function(){return a.apply(b,arguments)}},y=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.sharejs=l={version:"0.6.2"},typeof WEB=="undefined"&&(window.WEB=!0),p=typeof WEB!="undefined"&&WEB!==null?function(a){return setTimeout(a,0)}:process.nextTick,d=function(){function a(){}return a.prototype.on=function(a,b){var c;return this._events||(this._events={}),(c=this._events)[a]||(c[a]=[]),this._events[a].push(b),this},a.prototype.removeListener=function(a,b){var c,d,e,f=this;this._events||(this._events={}),d=(e=this._events)[a]||(e[a]=[]),c=0;while(c<d.length)d[c]===b&&(d[c]=void 0),c++;return p(function(){var b;return f._events[a]=function(){var c,d,e,f;e=this._events[a],f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b&&f.push(b);return f}.call(f)}),this},a.prototype.emit=function(){var a,b,c,d,e,f,g;b=arguments[0],a=2<=arguments.length?w.call(arguments,1):[];if((f=this._events)!=null?!f[b]:!void 0)return this;g=this._events[b];for(d=0,e=g.length;d<e;d++)c=g[d],c&&c.apply(this,a);return this},a.prototype.once=function(a,b){var c,d=this;return this.on(a,c=function(){var e;return e=1<=arguments.length?w.call(arguments,0):[],d.removeListener(a,c),b.apply(d,e)})},a}(),d.mixin=function(a){var b;return b=a.prototype||a,b.on=d.prototype.on,b.removeListener=d.prototype.removeListener,b.emit=d.prototype.emit,b.once=d.prototype.once,a};if(typeof WEB=="undefined"||WEB===null)module.exports=d;l._bt=i=function(a,b,c,d){var e,f;return e=function(a,c,d,e){return b(d,a,c,"left"),b(e,c,a,"right")},a.transformX=a.transformX=f=function(a,b){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;c(a),c(b),k=[];for(p=0,t=b.length;p<t;p++){o=b[p],j=[],g=0;while(g<a.length){l=[],e(a[g],o,j,l),g++;if(l.length!==1){if(l.length===0){x=a.slice(g);for(q=0,u=x.length;q<u;q++)h=x[q],d(j,h);o=null;break}y=f(a.slice(g),l),i=y[0],n=y[1];for(r=0,v=i.length;r<v;r++)h=i[r],d(j,h);for(s=0,w=n.length;s<w;s++)m=n[s],d(k,m);o=null;break}o=l[0]}o!=null&&d(k,o),a=j}return[a,k]},a.transform=a.transform=function(a,c,d){var e,g,h,i,j;if(d!=="left"&&d!=="right")throw new Error("type must be 'left' or 'right'");return c.length===0?a:a.length===1&&c.length===1?b([],a[0],c[0],d):d==="left"?(i=f(a,c),e=i[0],h=i[1],e):(j=f(c,a),h=j[0],g=j[1],g)}},typeof WEB=="undefined"&&(l.bootstrapTransform=i),s={},s.name="text",s.create=function(){return""},r=function(a,b,c){return a.slice(0,b)+c+a.slice(b)},j=function(a){var b,c;if(typeof a.p!="number")throw new Error("component missing position field");c=typeof a.i,b=typeof a.d;if(!(c==="string"^b==="string"))throw new Error("component needs an i or d field");if(!(a.p>=0))throw new Error("position cannot be negative")},k=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],j(b);return!0},s.apply=function(a,b){var c,d,e,f;k(b);for(e=0,f=b.length;e<f;e++){c=b[e];if(c.i!=null)a=r(a,c.p,c.i);else{d=a.slice(c.p,c.p+c.d.length);if(c.d!==d)throw new Error("Delete component '"+c.d+"' does not match deleted text '"+d+"'");a=a.slice(0,c.p)+a.slice(c.p+c.d.length)}}return a},s._append=h=function(a,b){var c,d,e;if(b.i===""||b.d==="")return;return a.length===0?a.push(b):(c=a[a.length-1],c.i!=null&&b.i!=null&&c.p<=(d=b.p)&&d<=c.p+c.i.length?a[a.length-1]={i:r(c.i,b.p-c.p,b.i),p:c.p}:c.d!=null&&b.d!=null&&b.p<=(e=c.p)&&e<=b.p+b.d.length?a[a.length-1]={d:r(b.d,c.p-b.p,c.d),p:b.p}:a.push(b))},s.compose=function(a,b){var c,d,e,f;k(a),k(b),d=a.slice();for(e=0,f=b.length;e<f;e++)c=b[e],h(d,c);return d},s.compress=function(a){return s.compose([],a)},s.normalize=function(a){var b,c,d,e;c=[];if(a.i!=null||a.p!=null)a=[a];for(d=0,e=a.length;d<e;d++)b=a[d],b.p==null&&(b.p=0),h(c,b);return c},u=function(a,b,c){return b.i!=null?b.p<a||b.p===a&&c?a+b.i.length:a:a<=b.p?a:a<=b.p+b.d.length?b.p:a-b.d.length},s.transformCursor=function(a,b,c){var d,e,f,g;e=c==="right";for(f=0,g=b.length;f<g;f++)d=b[f],a=u(a,d,e);return a},s._tc=t=function(a,b,c,d){var e,f,g,i,j,l;k([b]),k([c]);if(b.i!=null)h(a,{i:b.i,p:u(b.p,c,d==="right")});else if(c.i!=null)l=b.d,b.p<c.p&&(h(a,{d:l.slice(0,c.p-b.p),p:b.p}),l=l.slice(c.p-b.p)),l!==""&&h(a,{d:l,p:b.p+c.i.length});else if(b.p>=c.p+c.d.length)h(a,{d:b.d,p:b.p-c.d.length});else if(b.p+b.d.length<=c.p)h(a,b);else{i={d:"",p:b.p},b.p<c.p&&(i.d=b.d.slice(0,c.p-b.p)),b.p+b.d.length>c.p+c.d.length&&(i.d+=b.d.slice(c.p+c.d.length-b.p)),g=Math.max(b.p,c.p),f=Math.min(b.p+b.d.length,c.p+c.d.length),e=b.d.slice(g-b.p,f-b.p),j=c.d.slice(g-c.p,f-c.p);if(e!==j)throw new Error("Delete ops delete different text in the same region of the document");i.d!==""&&(i.p=u(i.p,c),h(a,i))}return a},o=function(a){return a.i!=null?{d:a.i,p:a.p}:{i:a.d,p:a.p}},s.invert=function(a){var b,c,d,e,f;e=a.slice().reverse(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(o(b));return f},typeof WEB!="undefined"&&WEB!==null?(l.types||(l.types={}),i(s,t,k,h),l.types.text=s):(module.exports=s,require("./helpers").bootstrapTransform(s,t,k,h)),typeof WEB=="undefined"&&(s=require("./text")),s.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(a,b,c){var d;return d=[{p:a,i:b}],this.submitOp(d,c),d},del:function(a,b,c){var d;return d=[{p:a,d:this.snapshot.slice(a,a+b)}],this.submitOp(d,c),d},_register:function(){return this.on("remoteop",function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],b.i!==void 0?e.push(this.emit("insert",b.p,b.i)):e.push(this.emit("delete",b.p,b.d));return e})}};if(typeof WEB=="undefined"||WEB===null)v=require("../types");typeof WEB!="undefined"&&WEB!==null&&(l.extendDoc=function(a,b){return c.prototype[a]=b}),c=function(){function a(a,b,c){this.connection=a,this.name=b,this.shout=x(this.shout,this),this.flush=x(this.flush,this),c||(c={}),this.version=c.v,this.snapshot=c.snapshot,c.type&&this._setType(c.type),this.state="closed",this.autoOpen=!1,this._create=c.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[],this.serverOps={}}return a.prototype._xf=function(a,b){var c,d;return this.type.transformX?this.type.transformX(a,b):(c=this.type.transform(a,b,"left"),d=this.type.transform(b,a,"right"),[c,d])},a.prototype._otApply=function(a,b){var c;c=this.snapshot,this.snapshot=this.type.apply(this.snapshot,a),this.emit("change",a,c);if(b)return this.emit("remoteop",a,c)},a.prototype._connectionStateChanged=function(a,b){switch(a){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.prevId),this.emit("closed");break;case"ok":this.connection.prevId=this.connection.id,this.autoOpen&&this.open();break;case"stopped":typeof this._openCallback=="function"&&this._openCallback(b)}return this.emit(a,b)},a.prototype._setType=function(a){var b,c,d;if(this.type)return;typeof a=="string"&&(a=v[a]);if(!a||!a.compose)throw new Error("Support for types without compose() is not implemented");this.type=a;if(a.api){d=a.api;for(b in d)c=d[b],this[b]=c;return typeof this._register=="function"?this._register():void 0}return this.provides={}},a.prototype._onMessage=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;switch(!1){case a.open!==!0:return this.state="open",this._create=!1,this.created==null&&(this.created=!!a.create),a.type&&this._setType(a.type),a.create?(this.created=!0,this.snapshot=this.type.create()):(this.created!==!0&&(this.created=!1),a.snapshot!==void 0&&(this.snapshot=a.snapshot)),a.meta&&(this.meta=a.meta),a.v!=null&&(this.version=a.v),this.inflightOp?(h={doc:this.name,op:this.inflightOp,v:this.version},this.inflightSubmittedIds.length&&(h.dupIfSource=this.inflightSubmittedIds),this.connection.send(h)):this.flush(),this.emit("open"),typeof this._openCallback=="function"?this._openCallback(null):void 0;case a.open!==!1:return a.error&&(typeof console!="undefined"&&console!==null&&console.error("Could not open document: "+a.error),this.emit("error",a.error),typeof this._openCallback=="function"&&this._openCallback(a.error)),this.state="closed",this.emit("closed"),typeof this._closeCallback=="function"&&this._closeCallback(),this._closeCallback=null;case a.op!==null||a.error!=="Op already submitted":break;case!(a.op===void 0&&a.v!==void 0||a.op&&(o=a.meta.source,y.call(this.inflightSubmittedIds,o)>=0)):e=this.inflightOp,this.inflightOp=null,this.inflightSubmittedIds.length=0,d=a.error;if(d){this.type.invert?(i=this.type.invert(e),this.pendingOp&&(p=this._xf(this.pendingOp,i),this.pendingOp=p[0],i=p[1]),this._otApply(i,!0)):this.emit("error","Op apply failed ("+d+") and the op could not be reverted"),q=this.inflightCallbacks;for(k=0,m=q.length;k<m;k++)b=q[k],b(d)}else{if(a.v!==this.version)throw new Error("Invalid version from server");this.serverOps[this.version]=e,this.version++,this.emit("acknowledge",e),r=this.inflightCallbacks;for(l=0,n=r.length;l<n;l++)b=r[l],b(null,e)}return this.flush();case!a.op:if(a.v<this.version)return;if(a.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+a.doc);if(a.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+a.v);return f=a.op,this.serverOps[this.version]=f,c=f,this.inflightOp!==null&&(s=this._xf(this.inflightOp,c),this.inflightOp=s[0],c=s[1]),this.pendingOp!==null&&(t=this._xf(this.pendingOp,c),this.pendingOp=t[0],c=t[1]),this.version++,this._otApply(c,!0);case!a.meta:u=a.meta,g=u.path,j=u.value;switch(g!=null?g[0]:void 0){case"shout":return this.emit("shout",j);default:return typeof console!="undefined"&&console!==null?console.warn("Unhandled meta op:",a):void 0}break;default:return typeof console!="undefined"&&console!==null?console.warn("Unhandled document message:",a):void 0}},a.prototype.flush=function(){if(this.connection.state!=="ok"||this.inflightOp!==null||this.pendingOp===null)return;return this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.connection.send({doc:this.name,op:this.inflightOp,v:this.version})},a.prototype.submitOp=function(a,b){return this.type.normalize!=null&&(a=this.type.normalize(a)),this.snapshot=this.type.apply(this.snapshot,a),this.pendingOp!==null?this.pendingOp=this.type.compose(this.pendingOp,a):this.pendingOp=a,b&&this.pendingCallbacks.push(b),this.emit("change",a),setTimeout(this.flush,0)},a.prototype.shout=function(a){return this.connection.send({doc:this.name,meta:{path:["shout"],value:a}})},a.prototype.open=function(a){var b,c=this;this.autoOpen=!0;if(this.state!=="closed")return;return b={doc:this.name,open:!0},this.snapshot===void 0&&(b.snapshot=null),this.type&&(b.type=this.type.name),this.version!=null&&(b.v=this.version),this._create&&(b.create=!0),this.connection.send(b),this.state="opening",this._openCallback=function(b){return c._openCallback=null,typeof a=="function"?a(b):void 0}},a.prototype.close=function(a){return this.autoOpen=!1,this.state==="closed"?typeof a=="function"?a():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=a)},a}();if(typeof WEB=="undefined"||WEB===null)d=require("./microevent");d.mixin(c),l.Doc=c,e=function(){function a(a,b,c){var d,e,f=this;b!=null&&typeof b=="function"?(c=b,b=void 0):typeof c!="function"&&(c=g),this.debug=this.debugAll,this.reconnectInterval=1e3,this.timeoutInterval=2e3,this.forcedClose=!1,this.url=a,this.protocols=b,this.readyState=c.CONNECTING,this.URL=a,e=!1,d=function(a){var b;return f.ws=new c(f.url,null,{debug:!0,protocols_whitelist:["xhr-polling","jsonp-polling"],rtt:3e4}),f.debug&&console.debug("ReconnectingWebSocket","attempt-connect",f.url),b=setTimeout(function(){return f.debug&&console.debug("ReconnectingWebSocket","connection-timeout",f.url),e=!0,f.ws.close(),e=!1},f.timeoutInterval),f.ws.onopen=function(d){return clearTimeout(b),f.debug&&console.debug("ReconnectingWebSocket","onopen",f.url),f.readyState=c.OPEN,a=!1,f.onopen(d)},f.ws.onclose=function(g){return clearTimeout(b),f.ws=null,f.forcedClose?(f.readyState=c.CLOSED,f.onclose(g)):(f.readyState=c.CONNECTING,f.onconnecting(g),!a&&!e&&(f.debug&&console.debug("ReconnectingWebSocket","onclose",f.url),f.onclose(g)),setTimeout(function(){return d(!0)},f.reconnectInterval))},f.ws.onmessage=function(a){return f.debug&&console.debug("ReconnectingWebSocket","onmessage",f.url,a.data),f.onmessage(a)},f.ws.onerror=function(a){return f.debug&&console.debug("ReconnectingWebSocket","onerror",f.url,a),f.onerror(a)}},d(this.url)}return a.prototype.onopen=function(a){},a.prototype.onclose=function(a){},a.prototype.onconnecting=function(a){},a.prototype.onmessage=function(a){},a.prototype.onerror=function(a){},a.prototype.send=function(a){if(this.ws)return this.debug&&console.debug("ReconnectingWebSocket","send",this.url,a),this.ws.send(a);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},a.prototype.close=function(){if(this.ws)return this.forcedClose=!0,this.ws.close()},a.prototype.debugAll=!1,a.prototype.refresh=function(){if(this.ws)return this.ws.close()},a}(),typeof WEB!="undefined"&&WEB!==null?(v=l.types,a=window.BCSocket,f=window.SockJS,g=window.WebSocket,a?q="channel":f?q="sockjs":q="websocket"):(v=require("../types"),a=require("browserchannel").BCSocket,c=require("./doc").Doc,g=require("ws"),q=null),b=function(){function b(b,c){var d=this;this.docs={},this.state="connecting",q==null&&b.match(/^ws:/)&&(q="websocket"),this.socket=function(){switch(q){case"channel":return new a(b,{reconnect:!0});case"sockjs":return new e(b,f);case"websocket":return new e(b);default:return new a(b,{reconnect:!0})}}(),this.socket.onmessage=function(a){var b;if(q==="sockjs"||q==="websocket")a=JSON.parse(a.data);if(a.auth===null)return d.lastError=a.error,d.disconnect(),d.emit("connect failed",a.error);if(a.auth){d.id=a.auth,d.setState("ok");return}return b=a.doc,b!==void 0?d.lastReceivedDoc=b:a.doc=b=d.lastReceivedDoc,d.docs[b]?d.docs[b]._onMessage(a):typeof console!="undefined"&&console!==null?console.error("Unhandled message",a):void 0},this.connected=!1,this.socket.onclose=function(a){d.setState("disconnected",a);if(a==="Closed"||a==="Stopped by server")return d.setState("stopped",d.lastError||a)},this.socket.onerror=function(a){return d.emit("error",a)},this.socket.onopen=function(){return d.send({auth:c?c:null}),d.lastError=d.lastReceivedDoc=null,d.setState("handshaking")},this.socket.onconnecting=function(){return d.setState("connecting")}}return b.prototype.setState=function(a,b){var c,d,e,f;if(this.state===a)return;this.state=a,a==="disconnected"&&delete this.id,this.emit(a,b),e=this.docs,f=[];for(d in e)c=e[d],f.push(c._connectionStateChanged(a,b));return f},b.prototype.send=function(a){if(q==="sockjs"||q==="websocket")a=JSON.stringify(a);return this.socket.send(a)},b.prototype.disconnect=function(){return this.socket.close()},b.prototype.makeDoc=function(a,b,d){var e,f=this;if(this.docs[a])throw new Error("Doc "+a+" already open");return e=new c(this,a,b),this.docs[a]=e,e.open(function(b){return b&&delete f.docs[a],b||e.on("closed",function(){if(!e.autoOpen)return delete f.docs[a]}),d(b,b?void 0:e)})},b.prototype.openExisting=function(a,b){var c;return this.state==="stopped"?b("connection closed"):this.docs[a]?this._ensureOpenState(this.docs[a],b):c=this.makeDoc(a,{},b)},b.prototype.open=function(a,b,c){var d;if(this.state==="stopped")return c("connection closed");if(this.state==="connecting"){this.on("handshaking",function(){return this.open(a,b,c),c=null});return}typeof b=="function"&&(c=b,b="text"),c||(c=function(){}),typeof b=="string"&&(b=v[b]);if(!b)throw new Error("OT code for document type missing");if(a==null)throw new Error("Server-generated random doc names are not currently supported");if(this.docs[a]){d=this.docs[a],d.type===b?this._ensureOpenState(d,c):c("Type mismatch",d);return}return this.makeDoc(a,{create:!0,type:b.name},c)},b.prototype._ensureOpenState=function(a,b){switch(a.state){case"open":b(null,a);break;case"opening":this.on("open",function(){return b(null,a)});break;case"closed":a.open(function(c){return b(c,c?void 0:a)})}},b}();if(typeof WEB=="undefined"||WEB===null)d=require("./microevent");d.mixin(b),l.Connection=b,typeof WEB!="undefined"&&WEB!==null?(m=window.BCSocket!==void 0,n=window.SockJS!==void 0,m?q="channel":n?q="sockjs":q="websocket"):b=require("./connection").Connection,l.open=function(){var a,c,d;return a={},c=function(c,d){var e,f,g,h;return typeof WEB!="undefined"&&WEB!==null&&c==null&&(g=window.location,h=q==="websocket"?"ws:":g.protocol,c=""+h+"//"+g.host+"/"+q),a[c]||(e=new b(c,d),f=function(){return delete a[c]},e.on("disconnected",f),e.on("connect failed",f),a[c]=e),a[c]},d=function(a){var b,c,d,e;d=0,e=a.docs;for(c in e)b=e[c],(b.state!=="closed"||b.autoOpen)&&d++;if(d===0)return a.disconnect()},function(a,b,e,f){var g,h,i;return typeof e=="function"&&(f=e,e={}),typeof e=="string"&&(e={origin:e}),i=e.origin,g=e.authentication,h=c(i,g),h.open(a,b,function(a,b){return a?(f(a),d(h)):(b.on("closed",function(){return d(h)}),f(null,b))}),h.on("connect failed"),h}}();if(typeof WEB=="undefined"||WEB===null)l.Doc=require("./doc").Doc,l.Connection=require("./connection").Connection}.call(this),function(){var a=!0,b,c,d,e,f,g,h,i,j,k,l,m=[].slice;e=window.sharejs,typeof a!="undefined"&&a!==null?k=e.types.text:k=require("./text"),h={},h.name="json",h.create=function(){return null},h.invertComponent=function(a){var b;return b={p:a.p},a.si!==void 0&&(b.sd=a.si),a.sd!==void 0&&(b.si=a.sd),a.oi!==void 0&&(b.od=a.oi),a.od!==void 0&&(b.oi=a.od),a.li!==void 0&&(b.ld=a.li),a.ld!==void 0&&(b.li=a.ld),a.na!==void 0&&(b.na=-a.na),a.lm!==void 0&&(b.lm=a.p[a.p.length-1],b.p=a.p.slice(0,a.p.length-1).concat([a.lm])),b},h.invert=function(a){var b,c,d,e,f;e=a.slice().reverse(),f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(h.invertComponent(b));return f},h.checkValidOp=function(a){},g=function(a){return Object.prototype.toString.call(a)==="[object Array]"},h.checkList=function(a){if(!g(a))throw new Error("Referenced element not a list")},h.checkObj=function(a){if(a.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(a)+")")},h.apply=function(a,b){var d,e,f,g,i,j,k,l,m,n,o,p,q,r;h.checkValidOp(b),b=c(b),e={data:a};try{for(i=n=0,p=b.length;n<p;i=++n){d=b[i],l=null,m=null,g=e,j="data",r=d.p;for(o=0,q=r.length;o<q;o++){k=r[o],l=g,m=j,g=g[j],j=k;if(l==null)throw new Error("Path invalid")}if(d.na!==void 0){if(typeof g[j]!="number")throw new Error("Referenced element not a number");g[j]+=d.na}else if(d.si!==void 0){if(typeof g!="string")throw new Error("Referenced element not a string (it was "+JSON.stringify(g)+")");l[m]=g.slice(0,j)+d.si+g.slice(j)}else if(d.sd!==void 0){if(typeof g!="string")throw new Error("Referenced element not a string");if(g.slice(j,j+d.sd.length)!==d.sd)throw new Error("Deleted string does not match");l[m]=g.slice(0,j)+g.slice(j+d.sd.length)}else if(d.li!==void 0&&d.ld!==void 0)h.checkList(g),g[j]=d.li;else if(d.li!==void 0)h.checkList(g),g.splice(j,0,d.li);else if(d.ld!==void 0)h.checkList(g),g.splice(j,1);else if(d.lm!==void 0)h.checkList(g),d.lm!==j&&(f=g[j],g.splice(j,1),g.splice(d.lm,0,f));else if(d.oi!==void 0)h.checkObj(g),g[j]=d.oi;else{if(d.od===void 0)throw new Error("invalid / missing instruction in op");h.checkObj(g),delete g[j]}}}catch(s){throw s}return e.data},h.pathMatches=function(a,b,c){var d,e,f,g;if(a.length!==b.length)return!1;for(d=f=0,g=a.length;f<g;d=++f){e=a[d];if(e!==b[d]&&(!c||d!==a.length-1))return!1}return!0},h.append=function(a,b){var d;return b=c(b),a.length!==0&&h.pathMatches(b.p,(d=a[a.length-1]).p)?d.na!==void 0&&b.na!==void 0?a[a.length-1]={p:d.p,na:d.na+b.na}:d.li!==void 0&&b.li===void 0&&b.ld===d.li?d.ld!==void 0?delete d.li:a.pop():d.od!==void 0&&d.oi===void 0&&b.oi!==void 0&&b.od===void 0?d.oi=b.oi:b.lm!==void 0&&b.p[b.p.length-1]===b.lm?null:a.push(b):a.push(b)},h.compose=function(a,b){var d,e,f,g;h.checkValidOp(a),h.checkValidOp(b),e=c(a);for(f=0,g=b.length;f<g;f++)d=b[f],h.append(e,d);return e},h.normalize=function(a){var b,c,d,e,f;c=[],g(a)||(a=[a]);for(d=0,e=a.length;d<e;d++)b=a[d],(f=b.p)==null&&(b.p=[]),h.append(c,b);return c},c=function(b){return typeof a!="undefined"&&a!==null?JSON.parse(JSON.stringify(b)):j(b)},j=function(a){var b,c,d;if(typeof a!="object"||a===null)return a;b=a instanceof Array?[]:{};for(c in a)d=a[c],a.hasOwnProperty(c)&&(b[c]=j(a[c]));return b},h.canOpAffectOp=function(a,b){var c,d,e,f;if(a.length===0)return!0;if(b.length===0)return!1;b=b.slice(0,b.length-1),a=a.slice(0,a.length-1);for(c=e=0,f=a.length;e<f;c=++e){d=a[c];if(c>=b.length)return!1;if(d!==b[c])return!1}return!0},h.transformComponent=function(a,b,d,e){var f,g,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;b=c(b),b.na!==void 0&&b.p.push(0),d.na!==void 0&&d.p.push(0),h.canOpAffectOp(d.p,b.p)&&(f=d.p.length-1),h.canOpAffectOp(b.p,d.p)&&(g=b.p.length-1),l=b.p.length,p=d.p.length,b.na!==void 0&&b.p.pop(),d.na!==void 0&&d.p.pop();if(d.na)return g!=null&&p>=l&&d.p[g]===b.p[g]&&(b.ld!==void 0?(o=c(d),o.p=o.p.slice(l),b.ld=h.apply(c(b.ld),[o])):b.od!==void 0&&(o=c(d),o.p=o.p.slice(l),b.od=h.apply(c(b.od),[o]))),h.append(a,b),a;g!=null&&p>l&&b.p[g]===d.p[g]&&(b.ld!==void 0?(o=c(d),o.p=o.p.slice(l),b.ld=h.apply(c(b.ld),[o])):b.od!==void 0&&(o=c(d),o.p=o.p.slice(l),b.od=h.apply(c(b.od),[o])));if(f!=null){i=l===p;if(d.na===void 0)if(d.si!==void 0||d.sd!==void 0){if(b.si!==void 0||b.sd!==void 0){if(!i)throw new Error("must be a string?");j=function(a){var b;return b={p:a.p[a.p.length-1]},a.si!=null?b.i=a.si:b.d=a.sd,b},v=j(b),w=j(d),t=[],k._tc(t,v,w,e);for(y=0,z=t.length;y<z;y++)u=t[y],n={p:b.p.slice(0,f)},n.p.push(u.p),u.i!=null&&(n.si=u.i),u.d!=null&&(n.sd=u.d),h.append(a,n);return a}}else if(d.li!==void 0&&d.ld!==void 0){if(d.p[f]===b.p[f]){if(!i)return a;if(b.ld!==void 0){if(b.li===void 0||e!=="left")return a;b.ld=c(d.li)}}}else if(d.li!==void 0)b.li!==void 0&&b.ld===void 0&&i&&b.p[f]===d.p[f]?e==="right"&&b.p[f]++:d.p[f]<=b.p[f]&&b.p[f]++,b.lm!==void 0&&i&&d.p[f]<=b.lm&&b.lm++;else if(d.ld!==void 0){if(b.lm!==void 0&&i){if(d.p[f]===b.p[f])return a;s=d.p[f],m=b.p[f],x=b.lm,(s<x||s===x&&m<x)&&b.lm--}if(d.p[f]<b.p[f])b.p[f]--;else if(d.p[f]===b.p[f]){if(p<l)return a;if(b.ld!==void 0){if(b.li===void 0)return a;delete b.ld}}}else if(d.lm!==void 0)if(b.lm!==void 0&&l===p){m=b.p[f],x=b.lm,q=d.p[f],r=d.lm;if(q!==r)if(m===q){if(e!=="left")return a;b.p[f]=r,m===x&&(b.lm=r)}else m>q&&b.p[f]--,m>r?b.p[f]++:m===r&&q>r&&(b.p[f]++,m===x&&b.lm++),x>q?b.lm--:x===q&&x>m&&b.lm--,x>r?b.lm++:x===r&&(r>q&&x>m||r<q&&x<m?e==="right"&&b.lm++:x>m?b.lm++:x===q&&b.lm--)}else b.li!==void 0&&b.ld===void 0&&i?(m=d.p[f],x=d.lm,s=b.p[f],s>m&&b.p[f]--,s>x&&b.p[f]++):(m=d.p[f],x=d.lm,s=b.p[f],s===m?b.p[f]=x:(s>m&&b.p[f]--,s>x?b.p[f]++:s===x&&m>x&&b.p[f]++));else if(d.oi!==void 0&&d.od!==void 0){if(b.p[f]===d.p[f]){if(b.oi===void 0||!i)return a;if(e==="right")return a;b.od=d.oi}}else if(d.oi!==void 0){if(b.oi!==void 0&&b.p[f]===d.p[f]){if(e!=="left")return a;h.append(a,{p:b.p,od:d.oi})}}else if(d.od!==void 0&&b.p[f]===d.p[f]){if(!i)return a;if(b.oi===void 0)return a;delete b.od}}return h.append(a,b),a},typeof a!="undefined"&&a!==null?(e.types||(e.types={}),e._bt(h,h.transformComponent,h.checkValidOp,h.append),e.types.json=h):(module.exports=h,require("./helpers").bootstrapTransform(h,h.transformComponent,h.checkValidOp,h.append)),typeof a=="undefined"&&(h=require("./json")),typeof a!="undefined"&&a!==null&&(f=e.extendDoc,e.extendDoc=function(a,c){return b.prototype[a]=c,f(a,c)}),d=function(a){return a.length===1&&a[0].constructor===Array?a[0]:a},b=function(){function a(a,b){this.doc=a,this.path=b}return a.prototype.at=function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],this.doc.at(this.path.concat(d(a)))},a.prototype.parent=function(){return this.path.length?this.doc.at(this.path.slice(0,this.path.length-1)):void 0},a.prototype.get=function(){return this.doc.getAt(this.path)},a.prototype.set=function(a,b){return this.doc.setAt(this.path,a,b)},a.prototype.insert=function(a,b,c){return this.doc.insertAt(this.path,a,b,c)},a.prototype.del=function(a,b,c){return this.doc.deleteTextAt(this.path,b,a,c)},a.prototype.remove=function(a){return this.doc.removeAt(this.path,a)},a.prototype.push=function(a,b){return this.insert(this.get().length,a,b)},a.prototype.move=function(a,b,c){return this.doc.moveAt(this.path,a,b,c)},a.prototype.add=function(a,b){return this.doc.addAt(this.path,a,b)},a.prototype.on=function(a,b){return this.doc.addListener(this.path,a,b)},a.prototype.removeListener=function(a){return this.doc.removeListener(a)},a.prototype.getLength=function(){return this.get().length},a.prototype.getText=function(){return this.get()},a}(),l=function(a,b){var c,d,e,f,g,h;c={data:a},e="data",d=c;for(g=0,h=b.length;g<h;g++){f=b[g],d=d[e],e=f;if(typeof d=="undefined")throw new Error("bad path")}return{elem:d,key:e}},i=function(a,b){var c,d,e,f;if(a.length!==b.length)return!1;for(d=e=0,f=a.length;e<f;d=++e){c=a[d];if(c!==b[d])return!1}return!0},h.api={provides:{json:!0},at:function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],new b(this,d(a))},get:function(){return this.snapshot},set:function(a,b){return this.setAt([],a,b)},getAt:function(a){var b,c,d;return d=l(this.snapshot,a),b=d.elem,c=d.key,b[c]},setAt:function(a,b,c){var d,e,f,g;g=l(this.snapshot,a),d=g.elem,e=g.key,f={p:a};if(d.constructor===Array)f.li=b,typeof d[e]!="undefined"&&(f.ld=d[e]);else{if(typeof d!="object")throw new Error("bad path");f.oi=b,typeof d[e]!="undefined"&&(f.od=d[e])}return this.submitOp([f],c)},removeAt:function(a,b){var c,d,e,f;f=l(this.snapshot,a),c=f.elem,d=f.key;if(typeof c[d]=="undefined")throw new Error("no element at that path");e={p:a};if(c.constructor===Array)e.ld=c[d];else{if(typeof c!="object")throw new Error("bad path");e.od=c[d]}return this.submitOp([e],b)},insertAt:function(a,b,c,d){var e,f,g,h;return h=l(this.snapshot,a),e=h.elem,f=h.key,g={p:a.concat(b)},e[f].constructor===Array?g.li=c:typeof e[f]=="string"&&(g.si=c),this.submitOp([g],d)},moveAt:function(a,b,c,d){var e;return e=[{p:a.concat(b),lm:c}],this.submitOp(e,d)},addAt:function(a,b,c){var d;return d=[{p:a,na:b}],this.submitOp(d,c)},deleteTextAt:function(a,b,c,d){var e,f,g,h;return h=l(this.snapshot,a),e=h.elem,f=h.key,g=[{p:a.concat(c),sd:e[f].slice(c,c+b)}],this.submitOp(g,d)},addListener:function(a,b,c){var d;return d={path:a,event:b,cb:c},this._listeners.push(d),d},removeListener:function(a){var b;return b=this._listeners.indexOf(a),b<0?!1:(this._listeners.splice(b,1),!0)},_register:function(){return this._listeners=[],this.on("change",function(a){var b,c,d,e,f,g,h,i,j,k,l,m;m=[];for(h=0,j=a.length;h<j;h++){b=a[h];if(b.na!==void 0||b.si!==void 0||b.sd!==void 0)continue;f=[],l=this._listeners;for(d=i=0,k=l.length;i<k;d=++i){e=l[d],c={p:e.path,na:0},g=this.type.transformComponent([],c,b,"left");if(g.length===0)f.push(d);else{if(g.length!==1)throw new Error("Bad assumption in json-api: xforming an 'si' op will always result in 0 or 1 components.");e.path=g[0].p}}f.sort(function(a,b){return b-a}),m.push(function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++)d=f[a],c.push(this._listeners.splice(d,1));return c}.call(this))}return m}),this.on("remoteop",function(a){var b,c,d,e,f,g,h,j,k;k=[];for(h=0,j=a.length;h<j;h++)b=a[h],f=b.na===void 0?b.p.slice(0,b.p.length-1):b.p,k.push(function(){var a,h,j,k,l;j=this._listeners,l=[];for(a=0,h=j.length;a<h;a++){k=j[a],g=k.path,e=k.event,c=k.cb;if(i(g,f))switch(e){case"insert":b.li!==void 0&&b.ld===void 0?l.push(c(b.p[b.p.length-1],b.li)):b.oi!==void 0&&b.od===void 0?l.push(c(b.p[b.p.length-1],b.oi)):b.si!==void 0?l.push(c(b.p[b.p.length-1],b.si)):l.push(void 0);break;case"delete":b.li===void 0&&b.ld!==void 0?l.push(c(b.p[b.p.length-1],b.ld)):b.oi===void 0&&b.od!==void 0?l.push(c(b.p[b.p.length-1],b.od)):b.sd!==void 0?l.push(c(b.p[b.p.length-1],b.sd)):l.push(void 0);break;case"replace":b.li!==void 0&&b.ld!==void 0?l.push(c(b.p[b.p.length-1],b.ld,b.li)):b.oi!==void 0&&b.od!==void 0?l.push(c(b.p[b.p.length-1],b.od,b.oi)):l.push(void 0);break;case"move":b.lm!==void 0?l.push(c(b.p[b.p.length-1],b.lm)):l.push(void 0);break;case"add":b.na!==void 0?l.push(c(b.na)):l.push(void 0);break;default:l.push(void 0)}else this.type.canOpAffectOp(g,f)?e==="child op"?(d=b.p.slice(g.length),l.push(c(d,b))):l.push(void 0):l.push(void 0)}return l}.call(this));return k})}}}.call(this),FDBK.Mockup=function(a,b){a=a||{},this.id=a.id||utils.guid("a"),this.name=a.name,this.isMaster=a.isMaster||!1,this.master=a.master||null,this.stageWidth=a.stageWidth,this.stageHeight=a.stageHeight,this.stencils=a.stencils||[],this.selection=[],this.stencilDict={},this.groupedStencils={},typeof FDBK.UndoManager!="undefined"&&(this.undo=new FDBK.UndoManager({undoChange:FDBK.action("updateUndoButton"),redoChange:FDBK.action("updateRedoButton"),max_undo:300})),this.hasLayout=!1,this.guidForStencil=function(){return utils.guid(this.id+"-")},this.localIdForStencil=function(a){var b=a.split("-");return b[b.length-1]},a.duplicateFrom&&function(a,b){var c=function(c){return c.replace(a,b)};((function(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.id;d.id=c(d.id),d.type==="group"&&d.stencils&&arguments.callee.call(this,d.stencils)}})).call(this,this.stencils)}.call(this,a.duplicateFrom,this.id),this.cleanUpLinks=function(a){var b=this,c=function(d){for(var e=0;e<d.length;e++){var f=d[e];f.link&&f.link.ref===a&&(f.link=null,FDBK.pub("collab-link-stencil",f.id,null,b)),f.type==="group"&&f.stencils&&c(f.stencils)}};c(this.stencils)},function(a,b){for(var c=0;c<a.length;c++)this.stencilDict[a[c].id]=a[c],b&&(this.groupedStencils[a[c].id]=b),a[c].type=="group"&&a[c].stencils&&a[c].stencils.length>0&&arguments.callee.call(this,a[c].stencils,a[c].id)}.call(this,this.stencils),this.stencil=function(a){return this.stencilDict[a]},this.stencilPath=function(a){var b=[],c;while(c=this.stencil(a))b.push(c),a=this.groupedStencils[a];return b},this.substencils=function(a){var b=[];return function(a){if(a){b.push(a);if(a.type==="group"&&a.stencils)for(var c=0;c<a.stencils.length;c++)arguments.callee.call(this,a.stencils[c])}}(this.stencil(a)),b},this.stencilList=function(){return this.stencils||[]},this.indexOfStencil=function(a){for(var b=0;b<this.stencils.length;b++)if(this.stencils[b]&&this.stencils[b].id===a)return b;return-1},this.addStencil=function(a,b){a=a||{};var c=a.id||this.guidForStencil();a.id=c;if(b){var d=this.stencil(b);d.type!="group"&&console.log("Trying to add sub stencils to non group parents"),d.stencils=d.stencils?[a].concat(d.stencils):[a]}else this.stencils=[a].concat(this.stencils);return this.stencilDict[c]=a,b&&(this.groupedStencils[c]=b),c},this.copyStencil=function(a){return this.addStencil($.extend(!0,{},this.stencil(a)))},this.removeStencil=function(a){function c(a){var c=b.stencil(a);delete b.stencilDict[a],b.groupedStencils[a]&&delete b.groupedStencils[a];if(c&&c.type=="group"&&c.stencils&&c.stencils.length>0)for(var d=0;d<c.stencils.length;d++)arguments.callee(c.stencils[d].id)}var b=this;c(a);var d=this.indexOfStencil(a);d!==-1&&this.stencils.splice(d,1)},this.updateStencil=function(a,b){var c=this.stencil(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.changeStencilIndex=function(a,b){var c=this.indexOfStencil(a);c>=0&&this.stencils.splice(b,0,this.stencils.splice(c,1)[0])},this.stackStencil=function(a,b,c){var d=this.indexOfStencil(a),e=this.indexOfStencil(c),f=this.stencils[d],g=this.stencils[e];this.stencils.splice(d,1),e=this.indexOfStencil(c);var h=this.stencils.slice(0,e),i=this.stencils.slice(e+1,this.stencils.length);b=="before"?this.stencils=h.concat([f,g],i):this.stencils=h.concat([g,f],i)},this.stencilList=function(){return this.stencils},this.toString=function(){var a="#"+this.id+":";for(var b=0;b<this.stencils.length;b++){var c=this._stencilStore[this.stencils[b]];a+=this.stencils[b]+", "}return a},this.isEmpty=function(){return this.stencils.length===0};var c=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b};return this.propertiesToExport=function(){var a=["id","name","stageWidth","stageHeight","stencils","master","isMaster"];return c.call(this,a)},this.propertiesToDuplicate=function(){var a=["stageWidth","stageHeight","stencils","master","isMaster"];return c.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.filterStencils=function(a){var b=this.stencilDict;return Object.keys(b).map(function(a){return b[a]}).filter(a)},this},FDBK.Project=function(a,b){b&&($.extend(!0,a,a.jsonData),delete a.jsonData),a=a||{},this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.tempId=a.tempId||utils.guid("unsaved-"),this.alias=a.alias||null,this.name=a.name||FDBK.loc("_Untitled Project"),this.description=a.description||FDBK.loc("_No Description"),this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName||FDBK.USER_DATA.userName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy?a.privacy==="public_":!0,this.privacy=a.privacy,this.permission=a.permission||"unknown",this.font=a.font||FDBK.config("projectManagement.font.legacy"),this.readOnly=a.readOnly||!1,this.notificationsCommentsEnabled=a.notificationsCommentsEnabled||!1,this.lastUpdateDate=a.lastupdateDate||null,this.ownerIsPremium=a.ownerIsPremium||!1,this.isClean=function(){return JSON.stringify(this)===FDBK.CACHED_PROJECT},this.links=a.links||{},this.stageWidth=Math.abs(parseInt(a.stageWidth,10))||960,this.stageHeight=Math.abs(parseInt(a.stageHeight,10))||1200,this.mockups=a.mockups||[],this.privacy=a.privacy,this.fallbackImages=a.fallbackImages||[],this.mockups=this.mockups.map(function(a){return new FDBK.Mockup(a,b)}),this.updateAttributes=function(a){this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.alias=a.alias||null,this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy==="public_",this.permission=a.permission||"unknown",this.notificationsCommentsEnabled=a.notificationsCommentsEnabled||!1},this.mockupFromStencilId=function(a){var b=a.split("-");switch(b.length){case 1:return null;case 2:return this.mockup(b[0]);case 3:return this.mockup(b[0]+"-"+b[1])}return null},this.mockup=function(a){a+="";for(var b=0;b<this.mockups.length;b++)if(this.mockups[b].id===a)return this.mockups[b];return null},this.indexOfMockup=function(a){for(var b=0;b<this.mockups.length;b++)if(this.mockups[b].id===a)return b;return-1},this.mockupList=function(){return this.mockups},this.normalPages=function(){return this.mockupList().filter(function(a){return!a.isMaster})},this.masterPages=function(){return this.mockupList().filter(function(a){return a.isMaster})},this.pagesForMaster=function(a){return this.normalPages().filter(function(b){return b.master===a})},this.addMockup=function(a){a=a||{},a.stageWidth=a.stagewidth||this.stageWidth,a.stageHeight=a.stageHeight||this.stageHeight;var b=new FDBK.Mockup(a);return this.mockups.push(b),b.id},this.removeMockup=function(a){var b=this.indexOfMockup(a);b!==-1&&(this.cleanUpLinks(a),this.mockups.splice(b,1))},this.updateMockup=function(a,b){var c=this.mockup(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.sortMockups=function(a){this.mockups.sort(function(b,c){return a.indexOf(b.id)-a.indexOf(c.id)})},this.cleanUpLinks=function(a){this.mockupList().forEach(function(b){b.cleanUpLinks(a)})},this.size=function(){return this.mockups.length},this.isNew=function(){return!this.uniqueId};var c=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b};return this.propertiesToExport=function(){var a=["id","uniqueId","name","description","stageWidth","stageHeight","mockups","font"];return c.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.toServerJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description,mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getMetadataJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description};return b},this.getContentJSON=function(){var a=this.toJSON(),b={mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getAttributes=function(){return{id:this.id,uniqueId:this.uniqueId,alias:this.alias,isArchived:this.isArchived,ownerUserName:this.ownerUserName,isDeleted:this.isDeleted,privacy:this.privacy,permission:this.permission,notificationsCommentsEnabled:this.notificationsCommentsEnabled}},this.canViewProject=function(){return this.permission!="unknown"&&this.permission!="forbidden"},this.canEditProject=function(){return this.permission=="owner"||this.permission=="collab_edit"},this.canCommentProject=function(){return this.permission=="owner"||this.permission=="collab_edit"||this.permission=="collab_view"},this.canDeleteComments=function(){return this.permission=="owner"},this.canChangeCollaborators=function(){return this.permission=="owner"},this.isPremiumProject=function(){return FDBK.VIEWER_MODE?this.ownerIsPremium:this.permission=="collab_edit"||this.permission=="owner"&&FDBK.hasPremiumPlan()},this},FDBK.UndoManager=function(a){this.action_index={},this.next_id=1,this.undo_queue=[],this.redo_queue=[],this.current_action=null,this.group=null,this.group_queue=[],this.group_id=0,this.working="",this.undo_available=0,this.undo_names=[],this.redo_available=0,this.redo_names=[];var b={max_undo:20,undoChange:function(){},redoChange:function(){}};this.settings=$.extend(b,a)},FDBK.UndoManager.prototype.groupRunner=function(a){var b;while(b=a.pop()){var c=this.action_index[b];delete this.action_index[b],c[1].apply(c[3],c[2])}},FDBK.UndoManager.prototype.undoable=function(a,b,c,d,e,f){if(this.group!==null)return e=e||this.next_id++,this.action_index[e]=[a,b,c,d],this.group[2][0].push(e),this;var g=this.undo_queue;return this.working=="UNDO"&&(g=this.redo_queue),e=e||this.next_id++,this.action_index[e]=[a,b,c,d],f||(g.push(e),g.length>this.settings.max_undo&&(g.shift(),this.working=="UNDO"?(this.redo_available--,this.redo_names.shift()):(this.undo_available--,this.undo_names.shift())),this.working=="UNDO"?(this.redo_available++,this.redo_names.push(this.current_action[0]),this.settings.redoChange()):(this.undo_available++,this.working=="REDO"?this.undo_names.push(this.current_action[0]):(this.clearRedoQueue(),this.undo_names.push(a)),this.settings.undoChange())),this},FDBK.UndoManager.prototype.undo=function(){if(this.undo_queue.length>0){var a=this.undo_queue.pop();this.undo_available--,this.undo_names.pop();var b=this.action_index[a];delete this.action_index[a],this.working="UNDO",this.current_action=b,this.startGroup(b[0]),b[1].apply(b[3],b[2]),this.endGroup(),delete this.current_action,this.working="",this.settings.undoChange()}return this},FDBK.UndoManager.prototype.undoQueueActionNames=function(a){var b=0,c,d=[];for(var e=this.undo_queue.length-1;e>=0;e--){c=this.action_index[this.undo_queue[e]][0];if(this.action_index[this.undo_queue[e]][1]!=this.groupRunner)c+=" "+this.action_index[this.undo_queue[e]][2].join(",");else{var f=this.action_index[this.undo_queue[e]][2];f.length>0&&(f=f[0]);var g=[];for(var h=0;h<f.length;h++)g.push(this.action_index[f[h]][2].join(","));c+=" "+g.join("").replace(",[object Object]","")}d.push(c),b++;if(b==a)break}return d},FDBK.UndoManager.prototype.clearUndoQueue=function(){for(var a=this.undo_queue.length-1;a>=0;a--)delete this.action_index[this.undo_queue[a]];return this.undo_queue=[],this.undo_available=0,this.redo_names=[],this.settings.undoChange(),this},FDBK.UndoManager.prototype.clearQueues=function(){return this.action_index={},this.undo_queue=[],this.undo_available=0,this.undo_names=[],this.redo_queue=[],this.redo_available=0,this.redo_names=[],this.settings.undoChange(),this.settings.redoChange(),this},FDBK.UndoManager.prototype.redo=function(){if(this.redo_queue.length>0){var a=this.redo_queue.pop();this.redo_available--,this.redo_names.pop();var b=this.action_index[a];delete this.action_index[a],this.working="REDO",this.current_action=b,this.startGroup(b[0]),b[1].apply(b[3],b[2]),this.endGroup(),delete this.current_action,this.working="",this.settings.redoChange()}return this},FDBK.UndoManager.prototype.clearRedoQueue=function(){for(var a=this.redo_queue.length-1;a>=0;a--)delete this.action_index[this.redo_queue[a]];return this.redo_queue=[],this.redo_available=0,this.redo_names=[],this.settings.redoChange(),this},FDBK.UndoManager.prototype.startGroup=function(a){return this.group!==null&&this.group_queue.push(this.group),this.group_id=this.next_id++,this.group=[a,this.groupRunner,[[]],this,this.group_id],this.group_id},FDBK.UndoManager.prototype.endGroup=function(){var a=this.group;return this.group_queue.length>0?this.group=this.group_queue.pop():this.group=null,this.undoable.apply(this,a),this},FDBK.UndoManager.prototype.exitGroup=function(a){if(a!==!1){var b=this.group;this.startGroup("rolling back"),b[1].apply(b[3],b[2]),this.exitGroup(!1)}return this.group_queue.length>0?this.group=this.group_queue.pop():this.group=null,this},FDBK.UndoManager.prototype.resumeGroup=function(a){return this.group!==null&&this.group_queue.push(this.group),this.group=this.action_index[a],this.group[5]=!0,this.group_id=a,this},FDBK.StreamingClient=function(a){this._doc=null,this._logEnabled=!1,this.connectedUsers=[],this.saveActionOnAcknowledge=!1,this.$offlineStatus=$("#project-offline-status"),this.$saveInProgress=$("#project-save-in-progress"),this._suppressCheck=!1,FDBK.sub("selection-transform",function(a,b,c){switch(b){case"timer-start":this._suppressCheck=!0;break;case"timer-stop":this._suppressCheck=!1}},this),this._log=function(){this._logEnabled&&console.log.apply(console,arguments)},this._EXCEPTION_LOG_LENGTH=20,this._exceptionLog=[],this._logException=function(a,b,c){c&&typeof c=="object"&&(c=JSON.stringify(c));var d={t:(new Date).toISOString()};a&&(d.title=a.name+" "+a.message),b&&(d.label=b),c&&(d.extra=c);if(a||b||c)this._exceptionLog.push(d),this._exceptionLog.length>this._EXCEPTION_LOG_LENGTH&&this._exceptionLog.shift()};var b={authentication:null,origin:FDBK.WEB_SOCKET_URL};this.createProject=function(a,b){var c=this,d=a.constructor==FDBK.Project?a:new FDBK.Project(a);FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT,{data:JSON.stringify(d.getMetadataJSON()),success:function(a){a.success&&a.object?(d.updateAttributes(a.object),FDBK.library.closeCurrentProject(),FDBK.library.openProject(d,!0),c.getProjectJSON(a.object.uniqueId,function(a,c){a&&(FDBK.library.closeCurrentProject(),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error creating your project. Please contact us if the problem persists."),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})),b&&b()})):FDBK.library.checkSession()},error:function(a){a.status===403&&FDBK.showActiveProjectsAlert(!0)}})},this.getProjectJSON=function(a,c){this._log("opening document ",a);var d=this;d._doc&&FDBK.library.closeCurrentProject();var e,f=function(a){d._log("Failed opening document:",a),e&&e.disconnect(),e=null,c(a)};b.authentication=FDBK._authToken(),b.origin=FDBK.WEB_SOCKET_URL+"channel",e=sharejs.open(a,"json",b,function(b,g){if(b){d._log("error opening document ",a,b),d._doc=null,c(b,null);return}d._log("document open",a),d.setOnline(!0),e.removeListener("disconnected",f),d._doc=g,d.addDocListeners(),d.addOperationListeners(),d.addMetaEventsListeners();if(!g.snapshot){var h;if(!FDBK.library.currentProject){var i=FDBK.defaultProjects.emptyProject;i.uniqueId=a,h=(new FDBK.Project(i)).toServerJSON()}h=h||FDBK.library.currentProject.toServerJSON(),g.submitOp([{p:[],oi:h}])}c(null,$.extend(!0,{},d._doc.snapshot))}),e&&e.on("disconnected",f)},this.closeProject=function(){var a=this;this._doc&&(this.removeDocListeners(),this.removeOperationListeners(),this.removeMetaEventsListeners(),this._doc.close(function(){a._log("document closed succesfully")}),a._doc=null)},this.getOpForFixingSync=function(a,b){if(!a.mockups||!b.mockups||a.mockups.length!=b.mockups.length)return{p:[],oi:a,od:b};var c=[];for(var d=0;d<a.mockups.length;d++)if(JSON.stringify(a.mockups[d])!=JSON.stringify(b.mockups[d])){c.push(d);if(c.length>1)break}return c.length==1?{p:["mockups",c[0]],ld:b.mockups[c[0]],li:a.mockups[c[0]],s:"sync_update"}:{p:[],oi:a,od:b}},this.checkProjectData=function(){var a=JSON.stringify(this._doc.snapshot),b=JSON.stringify(FDBK.library.currentProject.toServerJSON());if(a===b||this._suppressCheck)this.$saveInProgress.hide(),FDBK.pub("project-sanity-check-passed");else{var c=this.getOpForFixingSync(JSON.parse(b),JSON.parse(a));c.p.length>0?this.sendOp(c):(FDBK.API.xhr(FDBK.API.CALL_SAVE_PROJECT_SYNC_ERROR,{BASE_URL:FDBK.WEB_SOCKET_URL,data:{v:this._doc.version,collaborating:this.connectedUsers.length>1,ownerUsername:FDBK.library.currentProject.ownerUserName,exceptions:this._exceptionLog},contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"syncerror"]}),this.connectedUsers.length<=1?this.sendOp(c):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error synchronizing changes for your project. To avoid any issues please reload your project."),buttons:[{text:FDBK.loc("_Reload Project"),classes:"right primary-action",onClick:function(){var a=FDBK.library.currentProject.uniqueId;FDBK.library.closeCurrentProject(),FDBK.library.fetchProject(a)}}]}))}},this.setOnline=function(a){a?c.$offlineStatus.removeClass("shown"):c.$offlineStatus.addClass("shown"),FDBK.STREAMING_OFFLINE=!a,FDBK.pub("streaming-offline-status-changed")},this.saveAction=function(a){if(!this._doc)return!0;if(this._doc.state!="open"){a&&FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You are now working offline. Your changes will be synchronized once the connection is established."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action close-modal"}]});return}this._doc.pendingOp||this._doc.inflightOp?(a&&this.$saveInProgress.show(),this.saveActionOnAcknowledge=!0):(this.$saveInProgress.hide(),this.checkProjectData())},this.replaceProjectData=function(a,b){if(!c._doc)return;try{c._doc.submitOp({p:[],oi:a},function(){b&&b()})}catch(d){c._logException(d,"replaceProjectData"),c._log("Error replacing project data",d)}},this.pathForStencil=function(a,b){function d(a){var c=b.groupedStencils[a];return c?d(c).concat(["stencils",b.stencil(c).stencils.indexOf(b.stencil(a))]):["stencils",b.indexOfStencil(a)]}var c=this;return this.pathForMockup(b).concat(d(a))},this.pathForMockup=function(a){return["mockups",FDBK.library.currentProject.mockupList().indexOf(a)]};var c=this,d=function(){c.closeProject()},e=function(a,b){var d=FDBK.library.currentMockup.stencil(a),e=c.pathForStencil(a,FDBK.library.currentMockup),f=[];b=b||{top:d.top,left:d.left,width:d.width,height:d.height};for(var g in b){var h;try{h=c._doc.getAt(e.concat(g))}catch(i){c._logException(i,"onMoveResizeStencil",{p:e,s:a}),c._log("error getting path",i),c._suppressCheck=!1,c.checkProjectData();break}h!==undefined&&h!=b[g]&&f.push({p:e.concat(g),od:h,oi:b[g],s:a})}f.length>0&&c.sendOp(f)},f=function(a){var b=FDBK.library.currentMockup.stencil(a),d=c.pathForStencil(a,FDBK.library.currentMockup),e={p:d,ld:b};c.sendOp(e)},g=function(a,b){var d,e,f;if(b){var g=FDBK.library.currentMockup.stencil(b);for(var h=0;h<g.stencils.length;h++)if(g.stencils[h].id==a){d=g.stencils[h];break}g.stencils.length==1?(e=c.pathForStencil(b,FDBK.library.currentMockup).concat(["stencils"]),f={p:e,oi:[d]}):(e=c.pathForStencil(b,FDBK.library.currentMockup).concat(["stencils",h]),f={p:e,li:d})}else d=FDBK.library.currentMockup.stencil(a),e=c.pathForStencil(a,FDBK.library.currentMockup),f={p:e,li:d};c.sendOp(f)},h=function(a,b){var d=FDBK.library.currentMockup.stencil(a),e=c.pathForStencil(a,FDBK.library.currentMockup),f={p:e.concat("locked"),oi:b,od:!b,s:a};c.sendOp(f)},i=function(a,b,d){d=d||FDBK.library.currentMockup;var e=d.stencil(a),f=c.pathForStencil(a,d),g=c._doc.getAt(f.concat("link")),h={p:f.concat("link"),oi:b,od:g};c.sendOp(h)},j=function(a,b){var d=FDBK.library.currentMockup.stencil(a),e=c.pathForMockup(FDBK.library.currentMockup).concat(["stencils",b]),f=FDBK.library.currentMockup.indexOfStencil(a),g={p:e,lm:f,s:a};c.sendOp(g)},k=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b),e={p:d,li:b};c.sendOp(e)},l=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b),e={p:d,ld:b};c.sendOp(e)},m=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b),e={p:d.concat("name"),oi:b.name,od:c._doc.getAt(d.concat("name"))};c.sendOp(e)},n=function(a,b){var d=FDBK.library.currentProject.mockup(a),e=c.pathForMockup(d);op={p:e,lm:b},c.sendOp(op)},o=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b),e=[];e.push({p:d.concat("stageWidth"),oi:FDBK.library.currentMockup.stageWidth,od:c._doc.getAt(d.concat("stageWidth"))}),e.push({p:d.concat("stageHeight"),oi:FDBK.library.currentMockup.stageHeight,od:c._doc.getAt(d.concat("stageHeight"))}),e.push({p:["stageWidth"],oi:FDBK.library.currentProject.stageWidth,od:c._doc.getAt(["stageWidth"])}),e.push({p:["stageHeight"],oi:FDBK.library.currentProject.stageHeight,od:c._doc.getAt(["stageHeight"])}),c.sendOp(e)},p=function(){c.sendOp([{p:["name"],oi:FDBK.library.currentProject.name,od:c._doc.getAt(["name"])}])},q=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b);c.sendOp([{p:d.concat("isMaster"),oi:!1,od:!0}])},r=function(a){var b=FDBK.library.currentProject.mockup(a),d=c.pathForMockup(b);c.sendOp([{p:d.concat("isMaster"),oi:!0,od:!1}])},s=function(a,b){var d=FDBK.library.currentProject.mockup(a),e=c.pathForMockup(d);c.sendOp([{p:e.concat("master"),oi:b,od:c._doc.getAt(e.concat("master"))}])},t=function(a,b,d,e){var f=FDBK.library.currentProject.mockup(a),g=c.pathForMockup(f),h=[],i=[];stencilPath=g.concat(["stencils",e]);for(var j in b){if(!d.hasOwnProperty(j))h.push({p:stencilPath.concat(j),oi:b[j],s:b.id});else{var k=!1;typeof b[j]=="object"?k=JSON.stringify({val:b[j]})!=JSON.stringify({val:d[j]}):k=b[j]!=d[j],k&&h.push({p:stencilPath.concat(j),oi:b[j],od:d[j],s:b.id})}i.push(j)}for(j in d)i.indexOf(j)==-1&&h.push({p:stencilPath.concat(j),ld:d[j],s:b.id});c.sendOp(h)};this.sendOp=function(a){var b=[].concat(a),c;for(var d=0;d<b.length;d++){c=b[d];if(c.p.length>1&&c.p[1]==-1){this._logException(null,"validateMockupOpPath",c.p),this._suppressCheck=!1,this.checkProjectData();return}if(c.p.length>2&&c.p[2]=="stencils"&&c.p[3]==-1){this._logException(null,"validateOpStencilPath",c.p),this._suppressCheck=!1,this.checkProjectData();return}}try{this._doc.submitOp(a,function(a){if(a=="Internal error"){var b=FDBK.library.currentProject.uniqueId;FDBK.library.closeCurrentProject(),setTimeout(function(){FDBK.library.fetchProject(b)},100)}})}catch(e){this._logException(e,"sendOp"),this._log("Error sending op ",a,e.message)}},this.addOperationListeners=function(){this.removeOperationListeners(),FDBK.sub("collab-move-resize-stencil",e),FDBK.sub("collab-remove-stencil",f),FDBK.sub("collab-add-stencil",g),FDBK.sub("collab-lock-stencil",h),FDBK.sub("collab-link-stencil",i),FDBK.sub("collab-order-stencil",j),FDBK.sub("collab-add-mockup",k),FDBK.sub("collab-remove-mockup",l),FDBK.sub("collab-rename-mockup",m),FDBK.sub("collab-sort-mockup",n),FDBK.sub("collab-update-stagesize",o),FDBK.sub("collab-rename-project",p),FDBK.sub("collab-mockup-convert-normal",q),FDBK.sub("collab-mockup-convert-master",r),FDBK.sub("collab-mockup-set-master",s),FDBK.sub("collab-replace-stencil",t)},this.removeOperationListeners=function(){FDBK.unsub("collab-move-resize-stencil",e),FDBK.unsub("collab-remove-stencil",f),FDBK.unsub("collab-add-stencil",g),FDBK.unsub("collab-lock-stencil",h),FDBK.unsub("collab-link-stencil",i),FDBK.unsub("collab-order-stencil",j),FDBK.unsub("collab-add-mockup",k),FDBK.unsub("collab-remove-mockup",l),FDBK.unsub("collab-rename-mockup",m),FDBK.unsub("collab-sort-mockup",n),FDBK.unsub("collab-update-stagesize",o),FDBK.unsub("collab-rename-project",p),FDBK.unsub("collab-mockup-convert-normal",q),FDBK.unsub("collab-mockup-convert-master",r),FDBK.unsub("collab-mockup-set-master",s),FDBK.unsub("collab-replace-stencil",t)};var u=function(a){if(c.connectedUsers.length==1)return;try{c._doc.shout(JSON.stringify({action:"updateComments",args:a}))}catch(b){c._logException(b,"shoutComment"),c._log("Error on shout : ",b)}},v="",w=function(a){if(c.connectedUsers.length==1)return;var b=a.map(function(a){return a.id}),d=JSON.stringify({selection:b});if(d===v)return;v=d;try{c._doc.shout(JSON.stringify({action:"selectionChanged",args:[FDBK.library.currentMockup.id,FDBK.USER_DATA.userName,b]}))}catch(e){c._logException(e,"shoutSelection"),c._log("Error on shout : ",e)}},x=function(){try{c._doc.shout(JSON.stringify({action:"updatePermissions",args:[FDBK.library.currentProject.uniqueId]}))}catch(a){c._logException(a,"shoutPermission"),c._log("Error on shout : ",a)}},y=function(){try{c._doc.shout(JSON.stringify({action:"projectNotAvailable",args:[FDBK.library.currentProject.uniqueId]}))}catch(a){c._logException(a,"shoutProjectNotAvailable"),c._log("Error on shout : ",a)}},z=function(){try{c._doc.shout(JSON.stringify({action:"updateProjectPrivacy",args:FDBK.library.currentProject.isPublic}))}catch(a){c._logException(a,"shoutUpdateProjectPrivacy"),c._log("Error on shout : ",a)}};this.addMetaEventsListeners=function(){FDBK.sub("comment-posted",u),FDBK.sub("selection-changed",w),FDBK.sub("changed-collaborators plan-updated",x),FDBK.sub("project-not-available",y),FDBK.sub("project-privacy-changed",z)},this.removeMetaEventsListeners=function(){FDBK.unsub("comment-posted",u),FDBK.unsub("selection-changed",w),FDBK.unsub("changed-collaborators plan-updated",x),FDBK.unsub("project-not-available",y),FDBK.unsub("project-privacy-changed",z)},this.kick=function(a,b){this._doc.connection.id==a&&(FDBK.library.closeCurrentProject(),FDBK.library.getAllProjects(),b&&FDBK.showServerError({message:b}))},this.selectionChanged=function(a,b,c){FDBK.pub("presence-user-selection",a,b,c)},this.updatePresence=function(a){this.connectedUsers=a,FDBK.pub("presence-update-users",a)},this.updateComments=function(a){FDBK.pub("refresh-comments",a)},this.updateProjectPrivacy=function(a){FDBK.library.currentProject.isPublic=a,FDBK.library.updatePresencePrivacy()};var A=function(a){c._log("doc closed",c._doc.connection.state),c.setOnline(!1)},B=function(){c._log("doc open",c._doc.connection.state),c.setOnline(!0)},C=function(a){c._log("server acknowledged op",a);if(c.saveActionOnAcknowledge||c.$saveInProgress.is(":visible"))c.saveAction(),c.saveActionOnAcknowledge=!1;FDBK.pub("project-saved")},D=function(a){c._log("received shout : ",a);var b=JSON.parse(a);c.hasOwnProperty(b.action)&&c[b.action].apply(c,[].concat(b.args))},E=function(a){c._log("document error ",a),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:"The following error occured : <br/><strong>"+a+"</strong><br/>To avoid any issues please reload your project.",buttons:[{text:FDBK.loc("_Reload Project"),classes:"right primary-action",onClick:function(){var a=FDBK.library.currentProject.uniqueId;FDBK.library.closeCurrentProject(),setTimeout(function(){FDBK.library.fetchProject(a)},100)}}]})},F=function(a){c._log("received remote op",a);var b=[].concat(a);for(var d=0;d<b.length;d++)a=b[d],c.processOperation(a);FDBK.pub("project-saved")};this.addDocListeners=function(){this._doc.on("open",B),this._doc.on("closed",A),this._doc.on("error",E),this._doc.on("acknowledge",C),this._doc.on("shout",D),this._doc.on("remoteop",F),FDBK.sub("close-project",d)},this.removeDocListeners=function(){sharejs.Doc.prototype.removeListener.apply(this._doc,["open",B]),sharejs.Doc.prototype.removeListener.apply(this._doc,["closed",A]),sharejs.Doc.prototype.removeListener.apply(this._doc,["error",A]),sharejs.Doc.prototype.removeListener.apply(this._doc,["acknowledge",C]),sharejs.Doc.prototype.removeListener.apply(this._doc,["shout",D]),sharejs.Doc.prototype.removeListener.apply(this._doc,["remoteop",F]),FDBK.unsub("close-project",d)},this.processOperation=function(a){this._log("processing op ",a);if(a.length===0){this._log("invalid operation");return}var b,c,d=a.p;if(d.length===0){var e=FDBK.library.currentProject.uniqueId;FDBK.library.fetchProject(e);return}if(d[0]=="mockups")if(d.length>2){b=FDBK.library.currentProject.mockupList()[d[1]];switch(d[2]){case"stageWidth":R(b,{stageWidth:a.oi});break;case"stageHeight":R(b,{stageHeight:a.oi});break;case"master":FDBK.library.setMasterForMockup(b.id,{master:a.oi},{forward:!1,undoable:!1});break;case"isMaster":a.oi===!0?FDBK.library.convertNormalToMasterPage(b.id,{forward:!1}):FDBK.library.convertMasterToNormalPage(b.id,{forward:!1});break;case"name":P(b,a.oi);break;case"stencils":var f=(d.length-1)%2===0?d[d.length-1]:null;opStencilModel=b;for(var g=2;g<d.length;g+=2){if(d[g]!="stencils")break;opStencilModel=opStencilModel.stencils[d[g+1]]}if(f)switch(f){case"left":case"top":G(b,opStencilModel,f,a.oi);break;case"width":case"height":H(b,opStencilModel,f,a.oi);break;case"locked":K(b,opStencilModel,a.oi);break;case"link":L(b,opStencilModel,a.oi);break;default:var h=$.extend(!0,{},opStencilModel);a.oi&&a.od?h[f]=a.oi:a.od&&delete h[f],a.oi&&(h[f]=a.oi),J(b,opStencilModel),I(h,b),M(b,h,d[3])}else a.li?a.ld?J(b,opStencilModel):a.li.id&&b.stencil(a.li.id)&&JSON.stringify(a.li)==JSON.stringify(b.stencil(a.li.id))?(mixpanel.track("duplicate-stencil-reconnect-healed",FDBK.library.currentProject.uniqueId),this._doc.submitOp({p:a.p,ld:a.li})):(I(a.li,b),d[3]!==0&&M(b,a.li,d[3]),opStencilModel=b.stencilList()[d[3]]):a.ld?J(b,opStencilModel):a.lm!==undefined&&M(b,opStencilModel,a.lm);b&&FDBK.library.currentMockup.master&&FDBK.library.currentMockup.master==b.id&&FDBK.pub("master-edited",b.id),opStencilModel&&FDBK.pub("remote-stencil-update",opStencilModel.id);break;default:}}else if(a.li&&a.ld){b=FDBK.library.currentProject.mockupList()[d[1]];var i=!1;b.id==FDBK.library.currentMockup.id&&(i=!0),O(b),N(a.li,d[1]),i&&FDBK.library.changeActiveMockup(a.li.id)}else a.li?a.li.id&&FDBK.library.currentProject.mockup(a.li.id)&&JSON.stringify(a.li)==JSON.stringify(FDBK.library.currentProject.mockup(a.li.id))?(mixpanel.track("duplicate-mockup-reconnect-healed",FDBK.library.currentProject.uniqueId),this._doc.submitOp({p:a.p,ld:a.li})):N(a.li,d[1]):a.ld?(b=FDBK.library.currentProject.mockupList()[d[1]],O(b)):a.lm!==undefined&&(b=FDBK.library.currentProject.mockupList()[d[1]],Q(b,a.lm));else if(d[0]=="stageWidth"||d[0]=="stageHeight"){var j={};j[d[0]]=a.oi,S(j)}else d[0]=="name"&&T(a.oi)};var G=function(a,b,c,d){if(!b)return;if(a!=FDBK.library.currentMockup){var e={};e[c]=d,a.updateStencil(b.id,e),FDBK.library.setMockupRendered(a.id,!1);return}c=="left"?FDBK.library.moveStencil(b.id,{left:d,top:b.top},{undoable:!1,forward:!1}):c=="top"&&FDBK.library.moveStencil(b.id,{left:b.left,top:d},{undoable:!1,forward:!1})},H=function(a,b,c,d){if(!b)return;if(a!=FDBK.library.currentMockup){var e={};e[c]=d,a.updateStencil(b.id,e),FDBK.library.setMockupRendered(a.id,!1);return}c=="width"?FDBK.library.resizeStencil(b.id,{width:d,height:b.height,top:b.top,left:b.left},{forward:!1}):c=="height"&&FDBK.library.resizeStencil(b.id,{width:b.width,height:d,top:b.top,left:b.left},{forward:!1,undoable:!1})},I=function(a,b){if(!a)return;if(b!=FDBK.library.currentMockup){b.addStencil(a),FDBK.library.setMockupRendered(b.id,!1);return}FDBK.library.addStencilFinal({type:a.type,templateName:a.name,data:a,checkSize:!0},{forward:!1,undoable:!1})},J=function(a,b){if(!b)return;if(a!=FDBK.library.currentMockup){a.removeStencil(b.id),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.removeStencil(b.id,{},{forward:!1,undoable:!1})},K=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.updateStencil(b.id,{locked:c}),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.lockStencil(b.id,{lock:c},{forward:!1,undoable:!1})},L=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.updateStencil(b.id,{link:c}),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.linkStencil(b.id,{link:c},{forward:!1,undoable:!1})},M=function(a,b,c){if(!b)return;if(a!=FDBK.library.currentMockup){a.changeStencilIndex(b.id,c),FDBK.library.setMockupRendered(a.id,!1);return}FDBK.library.updateStencilIndex(b,c,{forward:!1,undoable:!1,updateModel:!1})},N=function(a,b){FDBK.library.addMockup({props:a,switchToMockup:!1,index:b},{forward:!1})},O=function(a){FDBK.library.removeMockup(a.id,{remote:!0},{forward:!1})},P=function(a,b){FDBK.library.updateMockupName(a.id,{value:b},{forward:!1})},Q=function(a,b){FDBK.library.changeMockupOrder(a.id,{index:b,updateStructure:!0},{forward:!1})},R=function(a,b){b.stageWidth?a.stageWidth=b.stageWidth:b.stageHeight&&(a.stageHeight=b.stageHeight),a.id==FDBK.library.currentMockup.id&&FDBK.library.setStageSize()},S=function(a){a.stageWidth?FDBK.library.currentProject.stageWidth=a.stageWidth:a.stageHeight&&(FDBK.library.currentProject.stageHeight=a.stageHeight)},T=function(a){FDBK.library.updateProjectName({value:a},{forward:!1})};return this};var MODULE=function(a,b){function j(c){var d=b(c).prop("tagName").toLowerCase(),e={};if(d=="div"){c=b(c);var f=a.$svgObject.offset(),g=c.offset();e.st=g.top-f.top,e.sb=e.st+c.height(),e.sl=g.left-f.left,e.sr=e.sl+c.width()}else{var h=svg(b(c)[0]),i=h.position();e.st=i.y,e.sb=e.st+h.measuredHeight(),e.sl=i.x,e.sr=e.sl+h.measuredWidth()}return e}function k(a){var b=a.data("draggable");if(!b||!b.options)return!1;var c=b.options.customSnapPoint||!1;return c}function l(a){var b=a.data("resizable");if(!b||!b.resizing)return null;var c={l:b.position.left+b.lm,t:b.position.top+b.tm,r:b.position.left+b.lm+b.size.width,b:b.position.top+b.tm+b.size.height};return c}function m(a){var b=a.data("resizable");return!b||!b.resizing?!1:!0}var c=document.getElementById("hLine"),d=document.getElementById("vLine");a.snapoptions={snap:{snapToObjects:!0,snapTolerance:5,snapGrid:!1,showGuides:!0,items:".active-mockup .stencil",snappedH:function(d,f){var g=f.helper.parents("[id^=ghost]").length>0?!0:!1,j=f.position.top-(g?0:h-b("#project-wrapper").scrollTop()),m=j+f.helper.height(),n=f.position.left-(g?0:i),o=n+f.helper.width();k(f.helper)&&(j+=Math.round(b(this).height()/2),n+=Math.round(b(this).width()/2),m=j,o=n),e=f.snapItem;var p=0,q=l(b(this));q&&(o=q.r,n=q.l,j=q.t,m=q.b);switch(f.snapMode){case a.snapoptions.SNAP_TOP:p=j;break;case a.snapoptions.SNAP_BOTTOM:p=m;break;case a.snapoptions.SNAP_MIDDLE:p=j+Math.round((m-j)/2)}a.snapoptions.snap.showGuides&&(c.style.top=Math.min(p,a.currentMockup.stageHeight-1)+"px",c.style.display="block")},snappedV:function(c,e){var g=e.helper.parents("[id^=ghost]").length>0?!0:!1,j=e.position.top-(g?0:h),m=j+e.helper.height(),n=e.position.left-(g?0:i),o=n+e.helper.width();f=e.snapItem;var p=0;k(e.helper)&&(j+=Math.round(b(this).height()/2),n+=Math.round(b(this).width()/2),m=j,o=n);var q=l(b(this));q&&(o=q.r,n=q.l,j=q.t,m=q.b);switch(e.snapMode){case a.snapoptions.SNAP_LEFT:p=n;break;case a.snapoptions.SNAP_RIGHT:p=o;break;case a.snapoptions.SNAP_MIDDLE:p=n+Math.round((o-n)/2)}a.snapoptions.snap.showGuides&&(d.style.left=Math.min(p,a.currentMockup.stageWidth-1)+"px",d.style.display="block")},releasedH:function(a,d){if(e&&typeof f!="string"&&b(d.snapItem).get(0)==b(e).get(0)||typeof e=="string"&&e===d.snapItem)c.style.display="none",e=null},releasedV:function(a,c){if(f&&typeof f!="string"&&b(c.snapItem).get(0)==b(f).get(0)||typeof f=="string"&&f===c.snapItem)d.style.display="none",f=null}},stop:function(a,b){f=null,e=null,c.style.display="none",d.style.display="none"},update:function(a,b){}};var e=null,f=null,g=[20,20],h=b("#htmlStage").offset().top,i=b("#htmlStage").offset().left;a.snapoptions.gridValues=g,a.snapoptions.gridEnabled=function(b){if(b===undefined)return a.snapoptions.snapGrid;a.snapoptions.snapGrid=b},a.snapoptions.setGrid=function(b,c){a.snapoptions.gridValues=[b,c]},a.snapoptions._gridsystem=!1,a.snapoptions.gridsystemSnapping=!1;var n={};return a.snapoptions.gridsystem=function(c){if(c===undefined)return a.snapoptions._gridsystem;a.snapoptions._gridsystem=c;var d,e,f,g;switch(a.snapoptions._gridsystem){case a.snapoptions.GS_960_12:d=10,e=60,f=20,g=12;break;case a.snapoptions.GS_960_16:d=10,e=40,f=20,g=16;break;case a.snapoptions.GS_960_24:d=5,e=30,f=10,g=24;break;case a.snapoptions.GS_960_24_BP:d=0,e=30,f=10,g=24}n={padding:d,colWidth:e,colSpacing:f,colCount:g},b("#gridsystem").remove(),c!==!1&&b("#tmplsvg-gridsystem").loc_tmpl({colCount:Array(g),colPadding:d,colWidth:e,colSpacing:f}).insertBefore("#grid")},a.snapoptions.getGridSystemElements=function(c){var d=[];if(!a.snapoptions.gridsystemSnapping)return d;c=c||"drag";for(var e=0;e<n.colCount;e++){var f=n.padding+e*(n.colWidth+n.colSpacing),g=n.colWidth,h;c=="resize"?h={el:"snap_gs"+e,l:f,r:f+g,t:0,b:b("#htmlStage").height(),snapping:!1,snapTolerance:5}:h={item:"snap_gs"+e,width:g,height:b("#htmlStage").height(),top:0,left:f,center:!1,snapTolerance:5},d.push(h)}return d},a.snapoptions.SNAP_TOP="snapTop",a.snapoptions.SNAP_BOTTOM="snapBottom",a.snapoptions.SNAP_LEFT="snapLeft",a.snapoptions.SNAP_RIGHT="snapRight",a.snapoptions.SNAP_MIDDLE="snapMiddle",a.snapoptions.GS_960_12="GS_960_12",a.snapoptions.GS_960_16="GS_960_16",a.snapoptions.GS_960_24="GS_960_24",a.snapoptions.GS_960_24_BP="GS_960_24_BP",a}(MODULE||{},jQuery),utils=window.utils={};utils.svgns="http://www.w3.org/2000/svg",utils.xlinkns="http://www.w3.org/1999/xlink",utils.xmlns="http://www.w3.org/XML/1998/namespace",utils.userAgent=navigator.userAgent,utils.isOpera=!!window.opera,utils.isWebkit=utils.userAgent.indexOf("AppleWebKit")>=0,utils.isGecko=utils.userAgent.indexOf("Gecko/")>=0,utils.isIE=utils.userAgent.indexOf("MSIE")>=0,utils._guidCount=0,utils.guid=function(a){var b=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},c=b()+b();return a?a+c:c},utils.getPercentage=function(a){return typeof a=="string"&&a.substr(-1)=="%"&&!isNaN(parseInt(a))?parseInt(a):!1},utils.nl2br=function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.uniqueName=function(a,b){a=a.replace(/\s\([0-9]+\)$/,"");var c=a,d=1;while(b.indexOf(c)!==-1)c=a+" ("+d++ +")";return c},utils.stencil=function(a){var b=a;return typeof b=="string"&&(b=$("#"+a).get(0)),b},utils.stencilId=function(a){return a instanceof jQuery?a.get(0).attr("id"):a!==undefined&&a.id!==undefined?a.id:null},utils.sameArrayContent=function(a,b){return a.length===b.length&&!a.filter(function(a){return b.indexOf(a)===-1}).length},utils.getAlphabeticIndex=function(a){var b=26,c=a%(b-1)>0?Math.floor(a/b):0,d=c>0?String.fromCharCode(64+c):"";return d+String.fromCharCode(a%b+65)},utils.sanitize=function(a){return((a||"")+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},utils.optimalPopoverPosition=function(a,b){var c=FDBK.library.$projectWrapper.height(),d=FDBK.library.$projectWrapper.width(),e=FDBK.library.$projectWrapper.scrollTop(),f=FDBK.library.$projectWrapper.scrollLeft(),g={left:$(a).offset().left-FDBK.library.$projectWrapper.offset().left,top:$(a).offset().top-FDBK.library.$projectWrapper.offset().top};targetOffset=$(a).offset();var h=$(a).outerWidth(),i=$(a).outerHeight(),j=$(b).width(),k=$(b).height(),l=$("body").height()-(targetOffset.top+i),m=targetOffset.top,n=targetOffset.left,o=$("body").width()-(targetOffset.left+h),p,q,r,s,t;return l>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top+i+5,r="bottom",s="",t=""):m>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top-k-15,r="top",s="bottom",t="popoverTailDown"):o>=j+30?(p=targetOffset.left+h+15,q=targetOffset.top+i/2-k/2,r="right",s="right",t="popoverTailLeft"):n>=j+30?(p=targetOffset.left-j-15,q=targetOffset.top+i/2-k/2,r="left",s="left",t="popoverTailRight"):(p=targetOffset.left+(h-j)/2,q=targetOffset.top+(i-k)/2,s="",t="popoverTailNone"),p+j>$("body").width()&&(p-=p+j-$("body").width()+10,t="popoverTailNone"),q+k>$("body").height()&&(q-=q+k-$("body").height()+10,t="popoverTailNone"),{left:p,top:q,pos:r,tooltipWrapperClass:s,popoverTailClass:t}},utils.md5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=a&2147483648,f=b&2147483648,c=a&1073741824,d=b&1073741824,g=(a&1073741823)+(b&1073741823),c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){var b,c=a.length,d=c+8,e=(d-d%64)/64,f=(e+1)*16,g=Array(f-1),h=0,i=0;while(i<c)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b="",c="",d,e;for(e=0;e<=3;e++)d=a>>>e*8&255,c="0"+d.toString(16),b+=c.substr(c.length-2,2);return b}function n(a){a=a.replace(/rn/g,"n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var o=[],p,q,r,s,t,u,v,w,x,y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;a=n(a),o=l(a),u=1732584193,v=4023233417,w=2562383102,x=271733878;for(p=0;p<o.length;p+=16)q=u,r=v,s=w,t=x,u=h(u,v,w,x,o[p+0],y,3614090360),x=h(x,u,v,w,o[p+1],z,3905402710),w=h(w,x,u,v,o[p+2],A,606105819),v=h(v,w,x,u,o[p+3],B,3250441966),u=h(u,v,w,x,o[p+4],y,4118548399),x=h(x,u,v,w,o[p+5],z,1200080426),w=h(w,x,u,v,o[p+6],A,2821735955),v=h(v,w,x,u,o[p+7],B,4249261313),u=h(u,v,w,x,o[p+8],y,1770035416),x=h(x,u,v,w,o[p+9],z,2336552879),w=h(w,x,u,v,o[p+10],A,4294925233),v=h(v,w,x,u,o[p+11],B,2304563134),u=h(u,v,w,x,o[p+12],y,1804603682),x=h(x,u,v,w,o[p+13],z,4254626195),w=h(w,x,u,v,o[p+14],A,2792965006),v=h(v,w,x,u,o[p+15],B,1236535329),u=i(u,v,w,x,o[p+1],C,4129170786),x=i(x,u,v,w,o[p+6],D,3225465664),w=i(w,x,u,v,o[p+11],E,643717713),v=i(v,w,x,u,o[p+0],F,3921069994),u=i(u,v,w,x,o[p+5],C,3593408605),x=i(x,u,v,w,o[p+10],D,38016083),w=i(w,x,u,v,o[p+15],E,3634488961),v=i(v,w,x,u,o[p+4],F,3889429448),u=i(u,v,w,x,o[p+9],C,568446438),x=i(x,u,v,w,o[p+14],D,3275163606),w=i(w,x,u,v,o[p+3],E,4107603335),v=i(v,w,x,u,o[p+8],F,1163531501),u=i(u,v,w,x,o[p+13],C,2850285829),x=i(x,u,v,w,o[p+2],D,4243563512),w=i(w,x,u,v,o[p+7],E,1735328473),v=i(v,w,x,u,o[p+12],F,2368359562),u=j(u,v,w,x,o[p+5],G,4294588738),x=j(x,u,v,w,o[p+8],H,2272392833),w=j(w,x,u,v,o[p+11],I,1839030562),v=j(v,w,x,u,o[p+14],J,4259657740),u=j(u,v,w,x,o[p+1],G,2763975236),x=j(x,u,v,w,o[p+4],H,1272893353),w=j(w,x,u,v,o[p+7],I,4139469664),v=j(v,w,x,u,o[p+10],J,3200236656),u=j(u,v,w,x,o[p+13],G,681279174),x=j(x,u,v,w,o[p+0],H,3936430074),w=j(w,x,u,v,o[p+3],I,3572445317),v=j(v,w,x,u,o[p+6],J,76029189),u=j(u,v,w,x,o[p+9],G,3654602809),x=j(x,u,v,w,o[p+12],H,3873151461),w=j(w,x,u,v,o[p+15],I,530742520),v=j(v,w,x,u,o[p+2],J,3299628645),u=k(u,v,w,x,o[p+0],K,4096336452),x=k(x,u,v,w,o[p+7],L,1126891415),w=k(w,x,u,v,o[p+14],M,2878612391),v=k(v,w,x,u,o[p+5],N,4237533241),u=k(u,v,w,x,o[p+12],K,1700485571),x=k(x,u,v,w,o[p+3],L,2399980690),w=k(w,x,u,v,o[p+10],M,4293915773),v=k(v,w,x,u,o[p+1],N,2240044497),u=k(u,v,w,x,o[p+8],K,1873313359),x=k(x,u,v,w,o[p+15],L,4264355552),w=k(w,x,u,v,o[p+6],M,2734768916),v=k(v,w,x,u,o[p+13],N,1309151649),u=k(u,v,w,x,o[p+4],K,4149444226),x=k(x,u,v,w,o[p+11],L,3174756917),w=k(w,x,u,v,o[p+2],M,718787259),v=k(v,w,x,u,o[p+9],N,3951481745),u=c(u,q),v=c(v,r),w=c(w,s),x=c(x,t);var O=m(u)+m(v)+m(w)+m(x);return O.toLowerCase()},utils.gravatarImageURL=function(a,b){return b=b||60,"https://secure.gravatar.com/avatar/"+utils.md5(a)+"?d=mm&s="+b},utils.markdown=function(a){return this._markdownConverter||(this._markdownConverter=new Markdown.getSanitizingConverter,this._markdownConverter.hooks.chain("preConversion",function(a){return a=a.replace(/\n/g,"&nbsp;  \n"),a})),this._markdownConverter.makeHtml(a)},utils.setDocumentTitle=function(a){document.title=a+"  Moqups"},utils.insertText=function(a,b){if(a.selectionStart||a.selectionStart=="0"){var c=a.selectionStart,d=a.selectionEnd;a.value=a.value.substring(0,c)+b+a.value.substring(d,a.value.length),a.selectionStart=c+b.length,a.selectionEnd=c+b.length}else a.value+=b},utils.tab=function(a){utils.insertText(a,"\t")},utils.untab=function(a){utils.insertText(a,"\t")},utils.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},FDBK.mixinModule("stencil-templates",{_stencilTemplates:{},_sidebarStencilTemplates:[],_SVGDefs:[],_SVGDefsProps:[],STENCIL_TEMPLATES_URL:"compiled/stencils-compiled.tmpl.",STENCIL_TEMPLATE_INDIVIDUAL_URL:"stencil-tmpl/{name}.tmpl.",STENCIL_ICON_SPRITE_URL:"stencils/compiled-stencil-icons.png",STENCIL_ICON_INDIVIDUAL_URL:"stencils/{name}.png",DEF_INDIVIDUAL_URL:"stencil-tmpl/{name}.def.",STENCIL_SIDEBAR_ITEM_TMPL:'<li class="stencil-item">   <a class="stencil-icon" data-id="{{= templateName}}">    <img src="{{= iconStyle}}" alt=""/><span>{{= title}}</span>   </a>  </li>',STENCIL_SIDEBAR_ITEM_SPRITE_TMPL:'<li class="stencil-item">   <a class="stencil-icon" data-id="{{= templateName}}">    <img class="stencil-icon-sprite" src="'+FDBK.CSS_BASE_URL+'images/pixel.gif" style="{{= iconStyle}}" />    <span>{{= title}}</span>   </a>  </li>',STENCIL_ICON_SPRITE_UNIT_SIZE_X:80,STENCIL_ICON_SPRITE_UNIT_SIZE_Y:50,_stencilsDefsReady:!1,_stencilTemplatesLoaded:!1,_stencilTemplatesToLoadCount:0,_stencilTemplatesLoadedCount:0,_SVGDefsLoaded:!1,_SVGDefsToLoadCount:0,_SVGDefsLoadedCount:0,initModule:function(){},parseCompiledStencilTemplates:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data);var b=0,c,d;while((b=a.indexOf("<<<",b))!==-1){c=b,b=a.indexOf(">>>",b);if(b===-1){console.info("stencil templates are corrupted.");break}var e=a.substring(c+3,b).split(/\n|\r\n/),f="tmplsvg-"+e[0].match(/\/([a-zA-Z0-9\-\_]+)\.tmpl\.svg/)[1],g=e.slice(1).join(" ");$.template(f,g)}},getStencilDOM:function(a,b){var c=this.stencilTemplate(a),d=c&&c.legacyInspectables?c.legacyInspectables:{},e=$.extend(!0,{},b,{tpl:typeof b.text!="undefined"?FDBK.tokenize(a,b.text,b):null,guid:utils.guid(),insp:$.extend({},d,b.inspectables),constants:{BASE_URL:FDBK.BASE_URL,IMAGE_BASE_URL:FDBK.ASSET_IMAGE_BASE_URL},stencil:b}),f=$.loc_tmpl(a,e).get(0);return f.templateName=a,b.locked&&(f.locked="true"),f},cloneStencilDOM:function(a){var b=$(a).clone()[0],c=FDBK.config("stencilTemplates.domProperties")||[];return c.forEach(function(c){b[c]=a[c]}),b},getStencilTemplateDefaultData:function(a){var b=this._stencilTemplates[a];return b?b.metadata||{}:{}},getPanelDOM:function(a,b){var c=this.stencilTemplate(b.name),d=c&&c.legacyInspectables?c.legacyInspectables:{};return $("#"+a).loc_tmpl({tpl:$.extend({},d,b.inspectables),stencil:b})},getAllStencilIconsDOM:function(){return FDBK.config("stencilTemplates.useSpriteStencilIcons")?$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_SPRITE_TMPL):$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_TMPL),this._sidebarStencilTemplates.map(function(a){var b=FDBK.stencilTemplate(a);return $.loc_tmpl("stencil-sidebar-item-tmpl",b).outerHTML()}).join("")},addSVGDef:function(a){this._SVGDefsToLoadCount+=1,this._SVGDefsProps.push(a)},loadSVGDefs:function(){var a;for(var b=0;b<this._SVGDefsProps.length;b++){a=this._SVGDefsProps[b];var c=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.DEF_INDIVIDUAL_URL.replace("{name}",a.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data),FDBK._SVGDefs.push(a),c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()},error:function(){c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()}})}},getSVGDefs:function(){return this._SVGDefs.join("")},addStencilTemplate:function(a){var b="tmplsvg-"+a.name;if(!a.excludeFromSidebar){if(FDBK.config("stencilTemplates.useSpriteStencilIcons")){var c=a.iconPosition||[0,0],d=-(c[1]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_X,e=-(c[0]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_Y;a.iconStyle="background: url('"+FDBK.IMAGE_BASE_URL+FDBK.STENCIL_ICON_SPRITE_URL+"') "+d+"px "+e+"px"}else a.iconStyle=FDBK.IMAGE_BASE_URL+FDBK.STENCIL_ICON_INDIVIDUAL_URL.replace("{name}",a.name);this._sidebarStencilTemplates.push(b)}a.templateName=b,this._stencilTemplates[b]=a,FDBK.config("stencilTemplates.useCompiledStencils")||(this._stencilTemplatesToLoadCount+=1)},loadStencilTemplates:function(){if(!FDBK.config("stencilTemplates.useCompiledStencils")){var a=this,b;for(var c in this._stencilTemplates)b=this._stencilTemplates[c],$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATE_INDIVIDUAL_URL.replace("{name}",b.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,jsonpCallback:"dataready",success:function(b){FDBK.config("stencilTemplates.useJSONPStencils")&&(b=b.data),$.template(c,b),a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()}})}else{this._stencilTemplatesToLoadCount=1;var a=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATES_URL+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,data:{},jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(b){a.parseCompiledStencilTemplates(b),a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()}})}},stencilTemplate:function(a){return this._stencilTemplates[a]},getExtension:function(){return FDBK.config("stencilTemplates.useJSONPStencils")?"json":"svg"},checkStencilsAndDefsLoaded:function(){!this._stencilTemplatesLoaded&&this._stencilTemplatesToLoadCount>0&&this._stencilTemplatesToLoadCount==this._stencilTemplatesLoadedCount&&(this._stencilTemplatesLoaded=!0,FDBK.pub("stencils-loaded"),FDBK.loadSVGDefs()),!this._SVGDefsLoaded&&this._SVGDefsToLoadCount>0&&this._SVGDefsToLoadCount==this._SVGDefsLoadedCount&&(this._SVGDefsLoaded=!0,$("#svgObject").append(FDBK.getSVGDefs()),FDBK.pub("svg-defs-loaded")),!this._stencilsDefsReady&&this._stencilTemplatesLoadedCount&&this._SVGDefsLoaded&&(this._stencilsDefsReady=!0,FDBK.pub("stencils-and-defs-loaded"))},executeLayoutHelper:function(a,b){if(!a)return;var c=this.stencilTemplate(a).layoutHelper||this.F_HELPER_NULL;c(b)},F_HELPER_NULL:function(a){},F_TOKENIZER_MARKDOWN:function(a){return this._tokenizerConverter||(this._tokenizerConverter=new Markdown.getSanitizingConverter,this._tokenizerConverter.hooks.chain("preConversion",function(a){var b;while(b=/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm.exec(a))a=a.replace(b[0],b[0].replace(/\*/g,"\0"));return a=a.replace(/\n/g,"&nbsp;  \n"),a}),this._tokenizerConverter.hooks.chain("postConversion",function(a){return a.replace(/\0/g,"*")})),this._tokenizerConverter.makeHtml(a)},F_TOKENIZER_PARAGRAPH:function(a,b){return b.inspectables&&b.inspectables.blokk==="true"?a.replace(/[^\s\t\r\n]/g,"&#9600;").replace(/\s/g,"&#8194;"):this.F_TOKENIZER_MARKDOWN(a)},F_TOKENIZER_PERCENTAGE:function(a){var b=a.match(/(\d+)%?/);return b?Math.min(parseInt(b,10),100):a},F_TOKENIZER_RATINGS:function(a){var b=a.match(/(\d+)\/(\d+)/);if(!b)return"";for(var c=0,d=[],e=Math.min(parseInt(b[2],10),100);c<e;c++)d.push(" ");return b[2]=d,b},F_TOKENIZER_NEWLINE:function(a){var b=a.split(/\n|\r\n/);return b.map(utils.sanitize)},F_TOKENIZER_NULL:function(a){return utils.sanitize(a)},F_TOKENIZER_VERTICAL_MENU:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_HORIZONTAL_MENU:function(a){var b=a.replace(/\n|\r\n/g," ").split(/,\s*/igm),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_TREE:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e={};e.title=b[d].replace(/^\s*/,""),e.indent=Math.max(0,b[d].length-e.title.length);var f=e.title.match(/^(f|F|v|>|\[\+\]|\[\-\]|\[x\]|\[\s\]|\-)?\s?(.*)?$/);e.icon=f[1],e.icon||e.indent--,e.title=utils.sanitize((f[2]||"").replace(/\s?,\s?(\s?>|)$/,"")),c.push(e)}return c},tokenize:function(a,b,c){var d=this._stencilTemplates[a];return(d&&d.tokenizer?d.tokenizer:this.F_TOKENIZER_NULL).call(this,b,c)}}),FDBK.addSVGDef({name:"webalys"}),FDBK.addStencilTemplate({name:"note",title:"Note",tags:"sticky note paper book",iconPosition:[6,6],metadata:{text:"When **you** do things **right**, people won't be sure you've done anything at all.\n\n_~~Futurama_",inspectables:{note_style:"yellow"}},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,layoutHelper:function(a){var b=$(a).find("path")[0],c=svg(a).explicitHeight(),d=svg(a).explicitWidth(),e=10,f=d/e,g="M0,0",h=0;for(var i=0;i<f;i++)h+e<=d&&(g+="l5,5 5,-5"),h+=e;g+="l0,-"+(c-e/2)+"-"+d+",0 0,"+(c-e/2),h+e>d&&(g+="l 0,5"),g+="z",b.setAttribute("d",g)},multiline:!0}),FDBK.addStencilTemplate({name:"rect",title:"Rectangle / Box",tags:"square rectangle container box",iconPosition:[5,2],metadata:{text:"",inspectables:{bg:"#ffffff",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:"true"}},multiline:!0}),FDBK.addStencilTemplate({name:"hotspot",title:"Hotspot",tags:"link hotspot target",iconPosition:[6,5],excludeFromPrint:!0,excludeFromSidebar:!0,metadata:{inspectables:{type:"rect"}}}),FDBK.addStencilTemplate({name:"heading-one",title:"Heading",tags:"heading h1 big title",iconPosition:[1,12],metadata:{text:"Heading",inspectables:{color:"#000000",font_size:"26",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"label",title:"Label",tags:"label text input",iconPosition:[2,6],metadata:{text:"Label:",inspectables:{color:"#000000",font_size:"14",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"text",title:"Paragraph",tags:"label char paragraph string",iconPosition:[5,1],metadata:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla quam velit, vulputate eu pharetra nec, mattis ac neque. Duis vulputate commodo lectus, ac blandit elit tincidunt id. Sed rhoncus, tortor sed eleifend tristique, tortor mauris molestie elit, et lacinia ipsum quam nec dui. Quisque nec mauris sit amet elit iaculis pretium sit amet quis magna. Aenean velit odio, elementum in tempus ut, vehicula eu diam. Pellentesque rhoncus aliquam mattis. Ut vulputate eros sed felis sodales nec vulputate justo hendrerit. Vivamus varius pretium ligula, a aliquam odio euismod sit amet. Quisque laoreet sem sit amet orci ullamcorper at ultricies metus viverra. Pellentesque arcu mauris, malesuada quis ornare accumsan, blandit sed diam.",inspectables:{color:"#000000",font_size:"14",text_align:"left",line_height:"1.3",blokk:"false"}},legacyInspectables:{line_height:"1"},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,multiline:!0}),FDBK.addStencilTemplate({name:"link",title:"Link",tags:"link text hyper",iconPosition:[6,1],metadata:{text:"Hyperlink",inspectables:{color:"#1464f6",font_size:"14",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"link-bar-menu",title:"Link Bar",tags:"horizontal",iconPosition:[6,2],metadata:{text:"Link 1, *Link2, Link 3",inspectables:{color:"#1464f6",font_size:"14",text_align:"center",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"checkbox",tags:"form",title:"Checkbox",iconPosition:[1,3],metadata:{text:"Check me out",inspectables:{checked:"checked",disabled:"checked",font_size:"14"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"radio",title:"Radio buttons",tags:"form",iconPosition:[1,4],metadata:{text:"Pizza",inspectables:{checked:"checked",disabled:"checked",font_size:"14",_inspector:"tmplsvg-checkbox-panel"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"button",tags:"pill button control target action",title:"Button",iconPosition:[1,2],metadata:{text:"Button",inspectables:{radius:"4",color:"#000000",fill_color:"#E6E6E6",stroke_color:"#000000",icon:"",dropdown:"",size:"16"}},layoutHelper:function(a){var b=$(a).find("rect")[0];if(parseFloat(b.getAttribute("rx"))>4){var c=parseInt(svg(a).explicitHeight())/2;b.setAttribute("rx",c)}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"combo-box",title:"Combo box",tags:"form input combobox dropdown select options menu",iconPosition:[1,5],metadata:{text:"Options"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"input-text",title:"Text input",tags:"input text field",iconPosition:[2,4],metadata:{text:""},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"textarea",title:"Text area",tags:"input text field textarea area multiline",iconPosition:[2,5],metadata:{text:"Multi\n\nline\n\ntextarea"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"stepper",title:"Stepper input",tags:"form input number",iconPosition:[3,12],metadata:{text:"12px"}}),FDBK.addStencilTemplate({name:"annotation-circle",excludeFromSidebar:!0,metadata:{options:{fill:"none",stroke:"red",strokeWidth:5}}}),FDBK.addStencilTemplate({name:"annotation-line",excludeFromSidebar:!0,metadata:{options:{stroke:"red",strokeWidth:5,startMarker:"none",endMarker:"none"}}}),FDBK.addStencilTemplate({name:"annotation-rect",excludeFromSidebar:!0,metadata:{options:{fill:"none",stroke:"red",strokeWidth:5}}}),FDBK.addStencilTemplate({name:"slider",title:"Slider",tags:"form input percentage slider",iconPosition:[3,7],metadata:{text:"50%"},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"avatar",tags:"user picture",title:"Avatar",iconPosition:[1,1],metadata:{text:"",inspectables:{type:"dude",fill_color:"#606060",size:"128",border:"true"}}}),FDBK.addStencilTemplate({name:"icon",title:"Icon",tags:"symbol",iconPosition:[5,4],metadata:{text:"Icon",inspectables:{fill_color:"#000000",icon:"icon-emoticon-happy",size:"24"}}}),FDBK.addStencilTemplate({name:"grid",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Cell 1, cell 2, cell 3\nCell 4, cell 5, cell 6\nCell 7, cell 8, cell 9\n cell 10"},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});return c.map(function(a){a.length=d}),c},multiline:!0,excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"grid-2",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Head 1, Head 2, Head 3\n Cell 1, Cell 2, Cell 3, []\nCell 4, Cell 5, Cell 6, [x]\nCell 7, Cell 8, Cell 9, ()\nCell 10, Cell 11, Cell 12, (o)",inspectables:{header:"true",zebra:"true",sortable:"true",border:"true",vertical_lines:"true",horizontal_lines:"true"}},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});for(var e in c)for(var f in c[e])c[e][f]!="(o)"&&c[e][f]!="()"&&c[e][f]!="[x]"&&c[e][f]!="[]"&&(c[e][f]=FDBK.F_TOKENIZER_MARKDOWN(c[e][f]));return[c,d]},multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-progress-bar",title:"Horizontal progress bar",tags:"percentage progress",iconPosition:[2,8],metadata:{text:"50%"},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"line",title:"Diagonal Line",tags:"ruler line horizontal diagonal connector arc orthogonal arrow",iconPosition:[6,5],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_type:"diagonal",line_mode:"major",line_marker_start:"true",line_marker_end:"true",resize_mode:"nwse"}}}),FDBK.addStencilTemplate({name:"horizontal-line",title:"Horizontal Line",tags:"ruler line horizontal",iconPosition:[3,9],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_marker_start:"false",line_marker_end:"false"}}}),FDBK.addStencilTemplate({name:"vertical-line",title:"Vertical Line",tags:"ruler line vertical",iconPosition:[3,10],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_marker_start:"false",line_marker_end:"false"}}}),FDBK.addStencilTemplate({name:"iphone",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"5",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait"}},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"iphone-2",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"4",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait",_inspector:"tmplsvg-iphone-panel"}}}),FDBK.addStencilTemplate({name:"ipad",title:"iPad",tags:"ios device mobile tablet",iconPosition:[6,4],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"4",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait"}}}),FDBK.addStencilTemplate({name:"ios-alert",title:"iOS Alert",tags:"alert confirm dialog",iconPosition:[5,10],metadata:{text:"Are you sure?\nSome helpful info here\nNo, Yes"},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];return c.push(b[0]),c.push(b[1]),b[2]&&c.push(b[2].split(/\s*\,\s*/)),c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-picker",title:"iOS Picker",tags:"picker",iconPosition:[5,8],metadata:{text:"April, 20, 2011\nMay, 21, 2012\nJune, 22, 2013"},tokenizer:function(a){var b;b=a.split(/\n|\r\n/);var c=0,d=[],e=[];for(var f=0;f<b.length;f++){var g=b[f].split(/,\s*/igm);d.push(g),c=Math.max(c,g.length)}for(var h=0;h<c;h++)for(var i=0;i<b.length;i++){e[h]||(e[h]=[]);var g=d[i][h];g==undefined&&(g=""),e[h].push(g)}return e},multiline:!0}),FDBK.addStencilTemplate({name:"ios-menu",title:"iOS Menu",tags:"menu settings",iconPosition:[5,6],metadata:{text:"+ Add\n- Delete\nv Check\nAnother check, (v)\nCurrent value, value\nSub menu, >\nReorder, =\n* Bullet\n_ Icon\n__ Big Icon, Summary description\nx Thumbnail\nX Big Thumbnail, Summary description\nToggle, ON",inspectables:{background:"true"}},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\+|v|__|_|X|x|-|\*)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(OFF|ON|=|>|\(>\)|\(v\))$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?(OFF)|(ON)|=|>|\(>\)|\(v\))$/,"").split(/,([^,]+)$/);f.title=h[0],f.subtitle=h[1],c.push(f)}return c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-button",title:"iOS Button",tags:"mobile ios back",iconPosition:[3,5],metadata:{text:"Back",inspectables:{color:"#000000",fill_color:"#E6E6E6",stroke_color:"#000000",icon:"",orientation:"back"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"ios-segmented-control",title:"iOS Segments",tags:"tab menu segment horizontal",iconPosition:[5,7],metadata:{text:"Item 1, *Item 2, Item 3"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"ios-keyboard",title:"iOS Keyboard",tags:"input",iconPosition:[5,9],metadata:{text:"dasd",inspectables:{mode:"normal"}}}),FDBK.addStencilTemplate({name:"ios-switch",title:"iOS Switch",tags:"form on off",iconPosition:[2,1],metadata:{text:"",inspectables:{checked:"checked"}}}),FDBK.addStencilTemplate({name:"map",title:"Map",tags:"google maps location position",iconPosition:[3,2],metadata:{}}),FDBK.addStencilTemplate({name:"image-placeholder",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],excludeFromSidebar:!0,metadata:{}}),FDBK.addStencilTemplate({name:"image-placeholder-2",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],metadata:{}}),FDBK.addStencilTemplate({name:"image",title:"Image",tags:"picture photo",iconPosition:[0,0],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"group-stencil",title:"Group",tags:"",iconPosition:[0,0],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"pie-chart",title:"Pie chart",tags:"charts data",iconPosition:[4,11],metadata:{}}),FDBK.addStencilTemplate({name:"bar-chart",title:"Bar chart",tags:"charts data",iconPosition:[4,10],metadata:{}}),FDBK.addStencilTemplate({name:"column-chart",title:"Column Chart",tags:"charts data",iconPosition:[4,9],metadata:{}}),FDBK.addStencilTemplate({name:"line-chart",title:"Line Chart",tags:"charts data",iconPosition:[4,8],metadata:{}}),FDBK.addStencilTemplate({name:"banner",title:"Banner",tags:"banner advertisement",iconPosition:[3,3],metadata:{text:"468*60",inspectables:{color:"#000000",fill_color:"#ffffff",stroke_color:"#000000"}},layoutHelper:function(a){$(a).find("div").html(utils.sanitize(svg(a).explicitWidth())+" &times; "+utils.sanitize(svg(a).explicitHeight()))}}),FDBK.addStencilTemplate({name:"search-input",title:"Search input",tags:"form search filter",iconPosition:[3,1],metadata:{text:"Search"}}),FDBK.addStencilTemplate({name:"stars",title:"Star ratings",tags:"ratings feedback vote",iconPosition:[1,10],metadata:{text:"3/5"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"hearts",title:"Heart ratings",tags:"ratings feedback",iconPosition:[1,9],metadata:{text:"3/5"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"tab-bar",title:"Tabs",tags:"navigation",iconPosition:[4,1],metadata:{text:"Home, *Products, About, Contact",inspectables:{mode:"up"}},tokenizer:function(a){return a.split(/,\s*/igm)}}),FDBK.addStencilTemplate({name:"throbber",title:"Throbber",tags:"spinner loading",iconPosition:[3,4],metadata:{}}),FDBK.addStencilTemplate({name:"thumbnails",title:"Thumbnails",tags:"grid placeholder image",iconPosition:[4,3],metadata:{text:"2*2"},tokenizer:function(a){var b=a.match(/\s*(\d+)\s*\*?\s*(\d+)?\s*/);if(!b)return"";var c,d,e,f;for(c=0,d=[],f=Math.min(parseInt(b[1]||1),100);c<f;c++)d.push(" ");for(c=0,e=[],f=Math.min(parseInt(b[2]||1),100);c<f;c++)e.push(" ");return[d,e]}}),FDBK.addStencilTemplate({name:"tooltip",title:"Tooltip",tags:"note annotation tooltip speech popover arrow",iconPosition:[3,6],metadata:{text:"I'm a tooltip! \n\nOr am I a *speech bubble?*",inspectables:{color:"#000000",bg:"#ffffff",stroke:"#000000",direction:"bottom-left"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"window",title:"Window",tags:"window chrome mac windows",iconPosition:[2,12],metadata:{text:"Untitled Window",inspectables:{type:"mac"}}}),FDBK.addStencilTemplate({name:"browser",title:"Browser",tags:"browser window popup firefox chrome windows mac",iconPosition:[2,11],metadata:{text:"Moqzilla \n http://moqups.com"},tokenizer:FDBK.F_TOKENIZER_NEWLINE,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-scrollbar",title:"Vertical scrollbar",tags:"scrollbar vertical",iconPosition:[1,6]}),FDBK.addStencilTemplate({name:"horizontal-scrollbar",title:"Horizontal scrollbar",tags:"scrollbar horizontal",iconPosition:[1,7]}),FDBK.addStencilTemplate({name:"context-menu",title:"Context menu",tags:"menu right click context vertical",iconPosition:[1,8],metadata:{text:"File\nOpen...\n*Open Recent,>\nExport as, >\n\nPrint\nPage Setup\n\nExit"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-menu",title:"Vertical List menu",tags:"menu right click context vertical list",iconPosition:[5,5],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-arrow-menu",title:"Vertical arrow menu",tags:"menu",iconPosition:[4,6],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-menu",title:"Horizontal menu",tags:"menu right click context vertical list",iconPosition:[4,4],metadata:{text:"Apps, Games, * Movies, Books, Newspapers"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"horizontal-arrow-menu",title:"Horizontal Arrow Menu",tags:"menu right click context vertical list",iconPosition:[4,5],metadata:{text:"Apps, Games, * Movies, Books, Newspapers",inspectables:{hide_arrow:"false"}},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"steps",title:"Steps",tags:"steps",iconPosition:[2,7],metadata:{text:"*Sign up, Pricing plan, Payment, Complete!"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"bread-crumb-menu",title:"Breadcrumb menu",tags:"bread crumb menu",iconPosition:[4,7],metadata:{text:"Home, Level 1, Level 2, Level 3, *Last"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"tree-menu",title:"Tree menu",tags:"tree",iconPosition:[6,3],metadata:{text:"F Pictures\n - Purple Lotus 1.jpg\n - Blue Orchid.png\n f Other Flowers\n\n[-] Tree\n [+] Branch\n [+] Another Branch\n A Leaf\n\nv Level 1 \n > Level 2\n v Level 3\n  > Level 3.1\n\n[ ] Check all the things!\n [x] Check me once\n [x] Check me twice"},tokenizer:FDBK.F_TOKENIZER_TREE,multiline:!0}),FDBK.addStencilTemplate({name:"ribbon",title:"Ribbon",tags:"header ribbon section",iconPosition:[1,11],metadata:{text:"Page Section",inspectables:{type:"both"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"calendar",title:"Calendar",tags:"date calendar picker",iconPosition:[2,2],metadata:{}}),FDBK.addStencilTemplate({name:"date-picker",title:"Date picker",tags:"input date picker",iconPosition:[2,3],metadata:{text:"4/22/2012"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"video-player",tags:"video player",title:"Video player",iconPosition:[2,9]}),FDBK.addStencilTemplate({name:"audio-player",tags:"audio player",title:"Audio player",iconPosition:[2,10]}),FDBK.addStencilTemplate({name:"basic-shapes",tags:"circle rectangle hexagon pentagon rombus parallelogram star",title:"Simple Shapes",iconPosition:[5,3],metadata:{text:"",inspectables:{color:"#000000",bg:"#E1E1E1",stroke:"#000000",stroke_width:"2",stroke_style:"solid",type:"star",border:"true"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.loadStencilTemplates();var svg=window.svg=function(a){return a==svg.element?svg:(typeof a=="string"&&(a=$(a)[0]),svg.init(a))};svg.TEXT_ALIGN_LEFT="left",svg.TEXT_ALIGN_RIGHT="right",svg.TEXT_ALIGN_MIDDLE="middle",svg.TEXT_ALIGN_JUSTIFY="justify",svg.RESIZE_VERTICAL="vertical",svg.RESIZE_HORIZONTAL="horizontal",svg.RESIZE_ASPECT="aspect",svg.RESIZE_ALL="all",svg.RESIZE_NWSE="nwse",svg.RESIZE_NESW="nesw",svg.RESIZE_NONE="none",svg.RESIZE_LINE="line",svg.init=function(a){return svg.element=a,svg.$element=$(a),svg.root=a.ownerSVGElement,svg},svg.width=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),svg.getBoundingRect().width;if(svg.isGroup())return svg.getBoundingRect().width;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().width;b!=1&&svg.transform(b,1)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().width)+svg.strokeWidth():0},svg.height=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("height",a),svg.measuredHeight(a),svg.element.boundingRect=null),svg.getBoundingRect().height;if(svg.isGroup())return svg.getBoundingRect().height;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().height;b!=1&&svg.transform(1,b)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().height)+svg.strokeWidth():0},svg.explicitWidth=function(){var a=svg.element.getAttributeNode("explicit-width")||svg.element.getAttributeNode("width");if(a)return a.value},svg.explicitHeight=function(){var a=svg.element.getAttributeNode("explicit-height")||svg.element.getAttributeNode("height");if(a)return a.value},svg.totalWidth=function(a){if(a==undefined)return svg.element.getAttribute("total-width");svg.element.setAttribute("total-width",a)},svg.totalHeight=function(a){if(a==undefined)return svg.element.getAttribute("total-height");svg.element.setAttribute("total-height",a)},svg.measuredWidth=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-width")):(svg.element.setAttribute("measured-width",a),a)},svg.measuredHeight=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-height")):(svg.element.setAttribute("measured-height",a),a)},svg.strokeWidthCompensation=function(){return svg.strokeWidth()/2},svg.strokeWidth=function(){return parseInt(svg.element.getAttribute("stroke-width"))||0},svg.size=function(a,b){if(a==undefined&&b==undefined){if(svg.isContainer())return svg.getBoundingRect();return}var c,d;if(svg.isContainer()||svg.isRect()||svg.isImage())a!=undefined&&(a=Math.max(0,a-svg.strokeWidth()),svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),b!=undefined&&(b=Math.max(0,b-svg.strokeWidth()),svg.element.setAttribute("height",b),svg.measuredHeight(b),svg.element.boundingRect=null);else if(svg.isGroup()){var e=svg.getRealBBox();a!=undefined?c=parseInt(a)/(e.width||1):c=1,b!=undefined?d=parseInt(b)/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}else{var e=svg.element.getBBox();a!=undefined?c=(parseInt(a)-svg.strokeWidth())/(e.width||1):c=1,b!=undefined?d=(parseInt(b)-svg.strokeWidth())/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}},svg.position=function(a,b){if(a!=undefined&&b!=undefined){svg.transform(null,null,a,b);return}if(svg.isRect()||svg.isImage()||svg.isContainer()){var c=svg.element.x.baseVal.value-svg.strokeWidthCompensation(),d=svg.element.y.baseVal.value-svg.strokeWidthCompensation();return{x:c,y:d}}if(svg.isGroup()){var e=svg.root.createSVGPoint();return e.x=parseInt(svg.element.getAttribute("x"))||0,e.y=parseInt(svg.element.getAttribute("y"))||0,e}if(svg.isForeign())return{x:svg.element.x.baseVal.value||0,y:svg.element.y.baseVal.value||0};var f=svg.element.getBBox();return realX=f.x-svg.strokeWidthCompensation(),realY=f.y-svg.strokeWidthCompensation(),{x:realX,y:realY}},svg.transform=function(a,b,c,d){var e=svg.ROOT_EL||(svg.ROOT_EL=document.getElementById("svgObject"));switch(svg.element.nodeName){case"g":var f=svg.element.transform.baseVal,g,h,i,j,k,l;c!=undefined&&d!=undefined&&(l=svg.getRealBBox(),f.numberOfItems==0?(i=e.createSVGTransform(),i.setMatrix(e.createSVGMatrix()),f.appendItem(i)):i=f.getItem(0),g=svg.element.getScreenCTM(),g&&(j=svg.root.createSVGMatrix(),j.a=g.a,j.d=g.d,k=svg.root.createSVGMatrix(),k.e=l.x*j.a-c,k.f=l.y*j.d-d,j=j.inverse().multiply(k).inverse(),i.setMatrix(j)),svg.element.setAttribute("x",c),svg.element.setAttribute("y",d),svg.element.boundingRect=null);if(a!=undefined&&b!=undefined){var m;f.numberOfItems==0?m=svg.position(0,0):m=svg.position(),i=f.getItem(0),g=svg.element.getCTM(),l=svg.getRealBBox(),j=svg.root.createSVGMatrix(),j.e=l.x,j.f=l.y,g&&(j=g.multiply(j),h=svg.element.ownerSVGElement.getCTM(),k=svg.root.createSVGMatrix(),k.e=(g.e-j.e)/g.a*a+j.e-h.e,k.f=(g.f-j.f)/g.d*b+j.f-h.f,k.a=a,k.d=b,i.setMatrix(k)),svg.element.boundingRect=null}break;case"svg":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"ellipse":var n=parseInt(c),o=parseInt(d),p=parseFloat(svg.element.getAttribute("rx")),q=parseFloat(svg.element.getAttribute("ry"));isNaN(n)||svg.element.setAttribute("cx",n+p+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+q+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("rx",p)),isNaN(parseFloat(b))||(q=Math.abs(Math.max(0,svg.height()*b/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("ry",q));break;case"circle":var n=parseInt(c),o=parseInt(d),r=parseFloat(svg.element.getAttribute("r"));isNaN(n)||svg.element.setAttribute("cx",n+r+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+r+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("r",r));break;case"rect":var n=parseInt(c)+svg.strokeWidthCompensation(),o=parseInt(d)+svg.strokeWidthCompensation();isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"text":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"foreignObject":var n=parseInt(c),o=parseInt(d),s=svg.element.firstElementChild;isNaN(n)||(svg.element.setAttribute("x",n),s&&(s.style.width=svg.measuredWidth()+"px")),isNaN(o)||(svg.element.setAttribute("y",o),s&&(s.style.height=svg.measuredHeight()+"px"));break;case"path":var l=svg.element.getBBox(),t=svg.scaleGrid(l);if(t&&svg.isRelativePath()){var u=svg.convertPath();svg.pathData(u)}var v=svg.element.pathSegList,w=v.numberOfItems,x=[];a=Math.max(0,a),b=Math.max(0,b),x.right=a*l.width-l.width,x.bottom=b*l.height-l.height,c=c||0,d=d||0;var y=[];y.x=(c||0)+svg.strokeWidthCompensation()-l.x,y.y=(d||0)+svg.strokeWidthCompensation()-l.y;if(!isNaN(a)||!isNaN(b)||!isNaN(c)||!isNaN(d))while(w--){var z=v.getItem(w);a&&b&&(t?(z.x>t.right&&(z.x+=x.right,z.x1+=x.right,z.x2+=x.right),isNaN(t.right)&&(z.x*=a,z.x1*=a,z.x2*=a),z.y>t.bottom&&(z.y+=x.bottom,z.y1+=x.bottom,z.y2+=x.bottom),isNaN(t.bottom)&&(z.y*=b,z.y1*=b,z.y2*=b)):(z.x*=a,z.y*=b,z.x1*=a,z.y1*=b,z.x2*=a,z.y2*=b)),z.pathSegType%2||(c!=undefined&&(z.x+=y.x,z.x2+=y.x,z.x1+=y.x),d!=undefined&&(z.y+=y.y,z.y2+=y.y,z.y1+=y.y))}}e=null},svg.linePosition=function(a,b,c,d){if(svg.isLine()){a!=undefined&&b!=undefined&&(svg.$element[0].setAttribute("x1",a),svg.$element[0].setAttribute("y1",b)),c!=undefined&&d!=undefined&&(svg.$element[0].setAttribute("x2",c),svg.$element[0].setAttribute("y2",d));var e={x1:parseInt(svg.$element[0].getAttribute("x1")),y1:parseInt(svg.$element[0].getAttribute("y1")),x2:parseInt(svg.$element[0].getAttribute("x2")),y2:parseInt(svg.$element[0].getAttribute("y2"))};return e}},svg.gap=function(){return parseInt(svg.element.getAttribute("gap"))||0},svg.padding=function(){return parseInt(svg.element.getAttribute("padding"))||0},svg.isContainer=function(){return svg.element.nodeName=="svg"},svg.isRect=function(){return svg.element.nodeName=="rect"},svg.isImage=function(){return svg.element.nodeName=="image"},svg.isGroup=function(){return svg.element.nodeName=="g"},svg.isText=function(){return svg.element.nodeName=="text"},svg.isForeign=function(){return svg.element.nodeName=="foreignObject"},svg.isLine=function(){return svg.element.nodeName=="line"},svg.isStencil=function(){return svg.hasClass("stencil")||svg.hasClass("stencil-grouped")},svg.hasClass=function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(svg.element.nodeType===1&&(" "+svg.element.className.baseVal+" ").replace($.rclass," ").indexOf(b)>-1)return!0;return!1},svg.isDirty=function(a){return a!=undefined&&(a?svg.element.setAttribute("dirty","true"):svg.element.setAttribute("dirty","false")),svg.element.getAttribute("dirty")=="true"?!0:!1},svg.scaleGrid=function(a){a||(a=svg.element.getBBox());var b=[];b.right=parseInt(svg.element.getAttribute("scale-grid-right"))+a.x,b.bottom=parseInt(svg.element.getAttribute("scale-grid-bottom"))+a.y;if(b.right||b.bottom)return b},svg.minWidth=function(a){var b;if(!svg.element.getAttribute("min-width")){if(a!=undefined)b=a,svg.element.setAttribute("min-width",b);else if(!svg.isContainer()){var c=svg.explicitWidth();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild,e=d.style.width,f=svg.explicitWidth(),g=svg.explicitHeight();f==undefined&&(svg.element.setAttribute("width","100%"),g==undefined&&svg.element.setAttribute("height","100%")),d.style.width="1px",d.style.overflow="hidden",b=d.scrollWidth+(parseInt(d.style.paddingLeft)||0)+(parseInt(d.style.paddingRight)||0)+(parseInt(d.style.marginLeft)||0)+(parseInt(d.style.marginRight)||0),d.style.width=e,f==undefined&&(svg.element.setAttribute("width",b),g==undefined&&svg.element.removeAttribute("height"))}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.width()/2:svg.width();svg.element.setAttribute("min-width",b)}return b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-width",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-width"))||0},svg.minHeight=function(a){var b;if(!svg.element.getAttribute("min-height")){if(a!=undefined)b=a,svg.element.setAttribute("min-height",b);else if(!svg.isContainer()){var c=svg.explicitHeight();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild;b=Math.round(parseInt(document.defaultView.getComputedStyle(d,null).getPropertyValue("line-height"))*1.3)||0,svg.explicitHeight()==undefined&&svg.element.setAttribute("height",b)}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.height()/2:svg.height()}return svg.element.setAttribute("min-height",b),b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-height",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-height"))||0},svg.convertPath=function(){var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],b=svg.element.pathSegList,c=b.numberOfItems,d=0,e=0,f="",g=null;for(var h=0;h<c;++h){var i=b.getItem(h),j=i.x||0,k=i.y||0,l=i.x1||0,m=i.y1||0,n=i.x2||0,o=i.y2||0,p=i.pathSegType,q=a[p].toUpperCase(),r=function(a,b,c){var d="",b=b?" "+b.join(" "):"",c=c?" "+c:"";$.each(a,function(b,c){a[b]=c}),f+=q+a.join(" ")+b+c};switch(p){case 1:f+="z";break;case 12:j-=d;case 13:j+=d,d=j,q="L",r([[j,e]]);break;case 14:k-=e;case 15:k+=e,e=k,q="L",r([[d,k]]);break;case 2:case 4:case 18:j-=d,k-=e;case 5:case 3:g&&b.getItem(h-1).pathSegType===1&&!toRel&&(d=g[0],e=g[1]);case 19:j+=d,k+=e,d=j,e=k,p===3&&(g=[d,e]),r([[j,k]]);break;case 6:j-=d,l-=d,n-=d,k-=e,m-=e,o-=e;case 7:j+=d,l+=d,n+=d,k+=e,m+=e,o+=e,d=j,e=k,r([[l,m],[n,o],[j,k]]);break;case 8:j-=d,l-=d,k-=e,m-=e;case 9:j+=d,l+=d,k+=e,m+=e,d=j,e=k,r([[l,m],[j,k]]);break;case 10:j-=d,k-=e;case 11:console.error("Error: Resizing paths with relative elliptical arcs is not implemented!"),j+=d,k+=e,d=j,e=k,r([[i.r1,i.r2]],[i.angle,i.largeArcFlag?1:0,i.sweepFlag?1:0],[j,k]);break;case 16:j-=d,n-=d,k-=e,o-=e;case 17:j+=d,n+=d,k+=e,o+=e,d=j,e=k,r([[n,o],[j,k]])}}return f},svg.pathData=function(a){return a&&svg.element.setAttribute("d",a),a||svg.element.getAttribute("d")},svg.isRelativePath=function(){var a=/[achlmqstv]/,b=svg.pathData().search(a);return b!=-1},svg.shouldWrap=function(){return svg.element.getAttribute("wrap")==="true"},svg.textData=function(a){return a&&svg.element.setAttribute("data-text",a),a||svg.element.getAttribute("data-text")},svg.textAlign=function(a){return a&&svg.element.setAttribute("data-text-align",a),a||svg.element.getAttribute("data-text-align")},svg.isEditable=function(){return svg.element.getAttribute("editable")==="true"},svg.resetSizeOnEdit=function(){return svg.element.getAttribute("reset-size")==="true"},svg.resetSizeOnInspect=function(){return svg.element.getAttribute("reset-size-inspect")==="true"},svg.isMultilineEditable=function(){return svg.element.getAttribute("multiline")==="true"},svg.resizeMode=function(){return svg.element.getAttribute("resize-mode")||svg.RESIZE_ALL},svg.isUIElement=function(){var a=/svg|text|foreignObject|path|circle|rect|ellipse|g|image/,b=svg.element.nodeName.search(a);return b!=-1},svg.data=function(a){console.info("deprecated: svg.data()")},svg.getRealBBox=function(){if(!svg.element.realBBox){var a=svg.$element.find("*").get(),b=svg.element.getBBox(),c,d,e,f,g,h;c=b.x,e=b.y,d=b.x+b.width,f=b.y+b.height,g=b.width,h=b.height;if(a.length)for(var i=0;i<a.length;i++){if(!a[i].getBBox||a[i].nodeName=="clipPath")break;var j=a[i].getBBox(),k=parseFloat(a[i].getAttribute("stroke-width"))||0,l=k/2;c=Math.min(c,j.x-l),e=Math.min(e,j.y-l),d=Math.max(d,j.x+j.width+l),f=Math.max(f,j.y+j.height+l),g=d-c,h=f-e}var m=svg.root.createSVGRect();m.x=c,m.y=e,m.width=g,m.height=h,svg.element.realBBox=m}return svg.element.realBBox},svg.getBoundingRect=function(){if(!svg.element.boundingRect){var a=svg.element.getCTM(),b=svg.element.ownerSVGElement.getCTM(),c=svg.getRealBBox(),d,e,f,g,h,i;h=a.a*c.width,i=a.d*c.height,d=(c.x+a.e/a.a)*a.a-b.e,f=(c.y+a.f/a.d)*a.d-b.f,e=d+h,g=e+i,svg.element.boundingRect={left:d,right:e,top:f,bottom:g,width:h,height:i}}return svg.element.boundingRect};var layout=window.layout=function(a){return typeof a=="string"&&(a=$(a)[0]),layout.init(a)};layout.LAYOUT_VERTICAL="vertical",layout.LAYOUT_HORIZONTAL="horizontal",layout.LAYOUT_NONE="none",layout.ALIGN_VERTICAL_TOP="top",layout.ALIGN_VERTICAL_MIDDLE="middle",layout.ALIGN_VERTICAL_BOTTOM="bottom",layout.ALIGN_HORIZONTAL_LEFT="left",layout.ALIGN_HORIZONTAL_RIGHT="right",layout.ALIGN_HORIZONTAL_CENTER="center",layout.init=function(a){return layout.element=a,layout},layout.measure=function(a){var b=a.getAttribute("layout"),c=svg(a).measuredWidth(),d=svg(a).measuredHeight(),e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=svg(a).padding(),p=o*2,q=0,r=0,s=0,t=0,u=$(a).children();u.length>1&&(m=svg(a).gap(),n=(u.length-1)*m);var v=n+p,w=n+p;isNaN(c)&&(c=svg(a).measuredWidth(a.getAttribute("width"))),isNaN(d)&&(d=svg(a).measuredHeight(a.getAttribute("height")));var x=[];for(var y=0;y<u.length;y++){var z=u[y],A=svg(z).explicitWidth(),B=svg(z).explicitHeight();if(!utils.getPercentage(A)){var C=parseInt(A);isNaN(C)?C=svg(z).width():C=parseInt(A),g+=C}else $.inArray(z,x)==-1&&x.push(z),e+=utils.getPercentage(A);if(!utils.getPercentage(B)){var D=parseInt(B);isNaN(D)?D=svg(z).height():D=parseInt(B),h+=D}else $.inArray(z,x)==-1&&x.push(z),f+=utils.getPercentage(B);svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0);var E=svg(z).minWidth(),F=svg(z).minHeight();C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).measuredWidth(C),svg(z).measuredHeight(D),!svg(z).isContainer()&&(!isNaN(parseInt(A))||!isNaN(parseInt(B)))&&svg(z).size(C,D),!isNaN(C)&&!utils.getPercentage(A)&&(v+=C),!isNaN(D)&&!utils.getPercentage(A)&&(w+=D),C=0,D=0}var G=x.length;b==layout.LAYOUT_HORIZONTAL?x.sort(function(a,b){return svg(b).minWidth()-svg(a).minWidth()}):b==layout.LAYOUT_VERTICAL&&x.sort(function(a,b){return svg(b).minHeight()-svg(a).minHeight()}),i=c-(g+n)-p,j=d-(h+n)-p,e<100&&(i*=e/100),f<100&&(j*=f/100),k=i,l=j;for(var y=0;y<x.length;y++){var z=x[y],H=utils.getPercentage(svg(z).explicitWidth()),I=utils.getPercentage(svg(z).explicitHeight()),E=svg(z).minWidth(),F=svg(z).minHeight(),C=0,D=0;if(b==layout.LAYOUT_HORIZONTAL)H&&(C=Math.round(H/e*k),C=Math.max(C,E),k-=C,e-=H,q+=C),I&&(j=d-p,D=j*I/100);else if(b==layout.LAYOUT_VERTICAL)I&&(D=Math.round(I/f*l),D=Math.max(D,F),l-=D,f-=I,r+=D),H&&(i=c-p,C=i*H/100);else{var J;H&&(C=c*H/100-p),I&&(D=d*I/100-p);if(H&&I&&svg(z).resizeMode()==svg.RESIZE_ASPECT)if(c>d){if(E>F){J=E/F;var K=C/J;K>d?(J=F/E,C=D/J,svg(z).measuredWidth(C)):(J=E/F,D=C/J,svg(z).measuredHeight(D))}E<F&&(J=F/E,C=D/J,svg(z).measuredWidth(C)),E==F&&(J=E/F,D=C/J,svg(z).measuredHeight(D))}else if(c<d){if(F>E){J=F/E;var L=D/J;L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C))}F<E&&(J=E/F,D=C/J,svg(z).measuredHeight(D)),E==F&&(J=F/E,C=D/J,svg(z).measuredWidth(C))}else c==d&&(J=F/E,L=D/J,L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C)))}G>1&&G===y+1&&(s=q-i,t=r-j),b==layout.LAYOUT_HORIZONTAL&&H?C-=s:b==layout.LAYOUT_VERTICAL&&I&&(D-=t),C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0),svg(z).isContainer()||svg(z).size(C,D),H&&(svg(z).measuredWidth(C),v+=C),I&&(svg(z).measuredHeight(D),w+=D),!!isNaN(C),!!isNaN(D)}svg(a).totalWidth(v),svg(a).totalHeight(w),x=null,u=null,z=null},layout.layout=function(a,b){var c=a;FDBK.executeLayoutHelper(a.templateName,a),b&&layout.measureMinSizes(c),layout.measure(c);var d=c.getAttribute("layout");switch(d){case layout.LAYOUT_HORIZONTAL:layout.horizontalLayout(c);break;case layout.LAYOUT_VERTICAL:layout.verticalLayout(c);break;default:layout.defaultLayout(c)}},layout.horizontalLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children(),i=svg(a).totalWidth(),j=svg(a).totalHeight();for(var k=0;k<h.length;k++){var l=h[k];if(!svg(l).isUIElement())continue;if(k==0)f=layout.verticalAlign(l,a,b),g=layout.horizontalAlign(l,a,c),svg(l).position(g,f);else{var m=h[k-1],n=svg(m).position().x,o=svg(m).measuredWidth(),p=n+o+d;f=layout.verticalAlign(l,a,b),svg(l).position(p,f)}svg(l).isContainer()&&svg(l).isDirty()&&layout.layout(l)}},layout.verticalLayout=function(a){var b=a.getAttribute("horizontal-align"),c=a.getAttribute("vertical-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children();for(var i=0;i<h.length;i++){var j=h[i];if(!svg(j).isUIElement())continue;if(i==0)f=layout.horizontalAlign(j,a,b),g=c?layout.verticalAlign(j,a,c):e,svg(j).position(f,g);else{var k=h[i-1],l=svg(k).position().y,m=svg(k).measuredHeight(),n=l+m+d;f=layout.horizontalAlign(j,a,b),svg(j).position(f,n)}svg(j).isContainer()&&svg(j).isDirty()&&layout.layout(j)}},layout.defaultLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d,e,f=$(a).children();for(var g=0;g<f.length;g++){var h=f[g];if(!svg(h).isUIElement())continue;d=layout.horizontalAlign(h,a,c),e=layout.verticalAlign(h,a,b),svg(h).position(d,e),svg(h).isContainer()&&svg(h).isDirty()&&layout.layout(h)}},layout.verticalAlign=function(a,b,c){var d=svg(b).measuredHeight(),e,f=svg(b).padding();switch(c){case layout.ALIGN_VERTICAL_MIDDLE:e=Math.floor((d-svg(a).measuredHeight())/2);break;case layout.ALIGN_VERTICAL_BOTTOM:e=d-svg(a).measuredHeight()-f;break;default:e=f}return e},layout.horizontalAlign=function(a,b,c){var d=svg(b).measuredWidth(),e=0,f=svg(b).padding();switch(c){case layout.ALIGN_HORIZONTAL_CENTER:var g=b.getAttribute("layout");g==layout.LAYOUT_HORIZONTAL?e=(d-svg(b).totalWidth())/2+f:e=Math.floor((d-svg(a).measuredWidth())/2);break;case layout.ALIGN_HORIZONTAL_RIGHT:e=d-svg(b).totalWidth()+f;break;default:e=f}return e},layout.measureMinSizes=function(a){var b=$(a).find("*").get().reverse();$(b).each(function(){if(svg(this).isText()&&!svg.shouldWrap()){var b=parseInt($(this).css("line-height"));this.setAttribute("dy",b)}this.nodeName!="foreignText";var c=$(this).parent()[0];if(!svg(c).isContainer())return;var d=$(c).children().length,e=svg(c).padding()*2,f,g=0,h=0,i=svg(c).minWidth(),j=svg(c).minHeight(),k=svg(c).explicitWidth(),l=svg(c).explicitHeight();d>1&&(g=svg(c).gap(),h=(d-1)*g),f=c.getAttribute("layout"),svg(c).minWidth()==0&&(i=e,f==layout.LAYOUT_HORIZONTAL&&(i+=h),svg(c).minWidth(i)),svg(c).minHeight()==0&&(j=e,f==layout.LAYOUT_VERTICAL&&(j+=h),svg(c).minHeight(j));switch(f){case layout.LAYOUT_HORIZONTAL:i=svg(c).minWidth()+svg(this).minWidth(),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight());break;case layout.LAYOUT_VERTICAL:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=svg(this).minHeight()+svg(c).minHeight();break;default:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight())}c!=a&&(!utils.getPercentage(k)&&!isNaN(parseInt(k))&&(i=parseInt(k)),!utils.getPercentage(l)&&!isNaN(parseInt(l))&&(j=parseInt(l))),svg(c).isContainer()&&(svg(c).minWidth(i),svg(c).minHeight(j),svg(c).isStencil()&&(!svg(c).explicitWidth()&&!svg(c).explicitHeight()&&(c.setAttribute("width",i),c.setAttribute("height",j)),parseInt(svg(c).explicitWidth())<i&&(c.setAttribute("width",i),c.setAttribute("measured-width",i)),parseInt(svg(c).explicitHeight())<j&&(c.setAttribute("height",j),c.setAttribute("measured-height",j))))}),b=null},layout.add=function(a,b,c){var d=$(a).appendTo(b)[0];return c||layout.layout(d,!0),d};var MODULE=function(a,b,c,d){var e,f,g=function(){return g};return g.editingStencil=null,g.enterEditMode=function(){if(a.hasSelection()&&c(a.currentMockup.selection[0]).isStencil()&&!b(a.currentMockup.selection[0]).prop("locked")){var d=a.currentMockup.selection[0];a.editor.startEditing(d)}},g.startEditing=function(d){e=null,f=null;if(c(d).isEditable()){var h=a.currentMockup.stencil(d.id),i=FDBK.stencilTemplate(h.name)&&FDBK.stencilTemplate(h.name).multiline;b("#htmlStage").append(i?'<textarea id="editArea">Some data here</textarea>':'<input id="editArea" type="text" value="Some data here"/>'),FDBK.pub("stencil-edit","start",d),g.editingStencil=d;var j=g.getSelectedRect(d);b(d).prev(".stencil").length>0?e=b(d).prev(".stencil")[0]:b(d).next(".stencil").length>0&&(f=b(d).next(".stencil")[0]),b("#editArea").show().css({left:j.x+"px",top:j.y+"px"}).width(Math.max(j.width,FDBK.config("stencilEditor.minTextareaWidth"))).height(Math.max(j.height,FDBK.config("stencilEditor.minTextareaHeight"))).focus().val(h.text).select(),b("#editArea").on("keydown",null,"esc",function(){g.stopEditing(!1)}).on("keydown",null,i?"meta+return ctrl+return":"return meta+return ctrl+return",function(){g.stopEditing(!0)}).on("keydown",null,"tab",function(a){return a.shiftKey?utils.untab(b(this)[0]):utils.tab(b(this)[0]),!1})}},g.stopEditing=function(h){var i=b("#editArea");if(i.is(":visible")){i.remove();var j=g.editingStencil;if(h){var k=b(j).attr("name"),l=a.currentMockup.stencil(j.id),m=b.extend(!0,{},l),n=i.val();if(n!==l.text){a.currentMockup.undo.startGroup("Edit Stencil"),a.removeStencil(j,{},{forward:!1}),l.text=n;var o={x:c(j).position().x,y:c(j).position().y,width:c(j).measuredWidth(),height:c(j).measuredHeight()},p=o;j=a.addStencilFinal({type:"stencil",templateName:k,data:l},{forward:!1}),a.orderStencil(j,{before:e,after:f},{forward:!1}),b(j).focus();var q=c(j).minWidth(),r=c(j).minHeight();if(o.width<q||c.resetSizeOnEdit())p.width=q;if(o.height<r||c.resetSizeOnEdit())p.height=r;a.resizeStencil(j,{width:p.width,height:p.height,top:p.y,left:p.x},{forward:!1}),l=a.currentMockup.stencil(l.id);var s=a.currentMockup.indexOfStencil(l.id);a.replaceStencilCollab(a.currentMockup.id,l,m,s),a.currentMockup.undo.endGroup(),d.layout(j,!1)}}a.hasSelection()||FDBK.pub("stencil-edit","end",j)}g.editingStencil=null},FDBK.sub("stencil-edit",function(a,b){a==="start"?this.clearSelection():a==="end"&&this.selectElement(b)},a),g.getSelectedRect=function(a){var b={x:c(a).position().x,y:c(a).position().y,width:c(a).width(),height:c(a).height()};return isNaN(c(a).measuredWidth())||(b.width=c(a).measuredWidth(),b.height=c(a).measuredHeight()),b},g.iconLookup=function(){function c(a,b){return a.substring(0,b.selectionStart).match(/.+[\w]+$/)}function d(a,b){if(a.setSelectionRange)a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}}var a=["icon-glass","icon-music","icon-search","icon-envelope","icon-heart","icon-star","icon-star-empty","icon-user","icon-film","icon-th-large","icon-th","icon-th-list","icon-ok","icon-remove","icon-zoom-in","icon-zoom-out","icon-off","icon-signal","icon-cog","icon-trash","icon-home","icon-file","icon-time","icon-road","icon-download-alt","icon-download","icon-upload","icon-inbox","icon-play-circle","icon-repeat","icon-refresh","icon-list-alt","icon-lock","icon-flag","icon-headphones","icon-volume-off","icon-volume-down","icon-volume-up","icon-qrcode","icon-barcode","icon-tag","icon-tags","icon-book","icon-bookmark","icon-print","icon-camera","icon-font","icon-bold","icon-italic","icon-text-height","icon-text-width","icon-align-left","icon-align-center","icon-align-right","icon-align-justify","icon-list","icon-indent-left","icon-indent-right","icon-facetime-video","icon-picture","icon-pencil","icon-map-marker","icon-adjust","icon-tint","icon-edit","icon-share","icon-check","icon-move","icon-step-backward","icon-fast-backward","icon-backward","icon-play","icon-pause","icon-stop","icon-forward","icon-fast-forward","icon-step-forward","icon-eject","icon-chevron-left","icon-chevron-right","icon-plus-sign","icon-minus-sign","icon-remove-sign","icon-ok-sign","icon-question-sign","icon-info-sign","icon-screenshot","icon-remove-circle","icon-ok-circle","icon-ban-circle","icon-arrow-left","icon-arrow-right","icon-arrow-up","icon-arrow-down","icon-share-alt","icon-resize-full","icon-resize-small","icon-plus","icon-minus","icon-asterisk","icon-exclamation-sign","icon-gift","icon-leaf","icon-fire","icon-eye-open","icon-eye-close","icon-warning-sign","icon-plane","icon-calendar","icon-random","icon-comment","icon-magnet","icon-chevron-up","icon-chevron-down","icon-retweet","icon-shopping-cart","icon-folder-close","icon-folder-open","icon-resize-vertical","icon-resize-horizontal"];b("#editArea").autocomplete({position:{my:"right top",at:"right bottom"},source:function(d,e){var f=c(d.term,b("#editArea")[0]);f=f!==null?f[0]:"",e(b.ui.autocomplete.filter(a,f))},focus:function(){return!1},select:function(a,b){var e=c(this.value,this)[0],f=this.value.substring(0,this.selectionStart-e.length);this.value=f+b.item.value+this.value.substring(this.selectionStart,this.value.length);var g=f.length+b.item.value.length;return d(this,g),!1},search:function(a,b){var d=c(this.value,this);return d!==null}})},a.editor=g,a}(MODULE||{},jQuery,svg,layout),BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init(),BrowserDetect.browser=="Chrome"&&BrowserDetect.version>15||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>9||BrowserDetect.browser=="Safari"&&BrowserDetect.version>5||(BrowserDetect.unsupportedBrowser=!0);if(BrowserDetect.OS=="iPhone/iPod"||BrowserDetect.OS=="Mac")BrowserDetect.isMac=!0;var MODULE=function(a,b){b("body").on("click","#group-button",function(){if(b(this).hasClass("disabled")||FDBK.library.$ghost.hasClass("locked"))return;var d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()};a.isSingleSelection()&&a.isGroup(a.currentMockup.selection[0])?c(a.ungroupStencils(a.currentMockup.selection[0].id)):c(a.groupStencils(a.currentMockup.selection,{rect:d}))}),b(document).on("keydown",null,"meta+g ctrl+g",function(){var d;return b("#group-button").hasClass("disabled")||a.$ghost.hasClass("locked")?!1:(b("#group-button").hasClass("active")?(d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()},c(a.ungroupStencils(a.currentMockup.selection[0].id))):(d={x:a.$ghost.position().left,y:a.$ghost.position().top,width:a.$ghost.width(),height:a.$ghost.height()},c(a.groupStencils(a.currentMockup.selection,{rect:d}))),!1)});var c=function(b){a.currentMockup.selection=[].concat(b),a.showSelection()},d=function(a,c){var d=b(a).attr("class").split(" "),g=c?f:e,h=[];for(var i=0;i<d.length;i++)d[i]==e||d[i]==f?h.push(g):h.push(d[i]);b(a).attr("class",h.join(" "))},e="stencil",f="stencil-grouped",g="group";return a.setClassGrouped=d,a.isGroup=function(a){var c=b(a).attr("class").split(" ");return c.indexOf(g)!==-1},a.isGrouped=function(a){var c=b(a).attr("class").split(" ");return c.indexOf(f)!==-1},a}(MODULE||{},jQuery),MODULE=function(a,b,c,d){a.moveStencil=function(b,d,g){var h=utils.stencil(b);if(!h)return;var i=FDBK.library.currentMockup.stencil(utils.stencilId(h));if(d.comesFromUndoManager&&!f(i.id))return;var j=i.left,k=i.top;c(h).position(d.left,d.top),g=e(g),g.forward&&FDBK.pub("collab-move-resize-stencil",h.id,{top:d.top,left:d.left}),g.updateModel&&(a.currentMockup.updateStencil(h.id,{top:d.top,left:d.left}),FDBK.pub("move-stencil",h.id)),d.comesFromUndoManager===!0&&a.showSelection(),g.undoable&&a.currentMockup.undo.undoable("Move element",a.moveStencil,[h.id,{left:j,top:k,comesFromUndoManager:!0}])},a.resizeStencil=function(b,g,h){var i=utils.stencil(b);if(!i)return;var j=a.currentMockup.stencil(i.id);h=e(h);if(g.comesFromUndoManager&&!f(j.id))return;h.undoable&&a.currentMockup.undo.undoable("Resize element",a.resizeStencil,[i.id,{width:j.width,height:j.height,top:j.top,left:j.left,comesFromUndoManager:!0},{forward:h.forward}]),c(i).size(g.width,g.height),c(i).position(g.left,g.top),j.type=="stencil"&&d().layout(i,!1),h.updateModel&&(a.currentMockup.updateStencil(i.id,{top:g.top,left:g.left,width:g.width,height:g.height}),FDBK.pub("resize-stencil",i.id)),g.comesFromUndoManager===!0&&a.showSelection(),h.forward&&FDBK.pub("collab-move-resize-stencil",i.id,{top:g.top,left:g.left,width:g.width,height:g.height})},a.addStencilFinal=function(f,g){g=e(g),f.templateName=f.templateName||(f.type==="group"?"tmplsvg-group-stencil":null),f.data=f.data||FDBK.getStencilTemplateDefaultData(f.templateName);var h=FDBK.getStencilDOM(f.templateName,f.data),i=FDBK.stencilTemplate(f.templateName),j=i?i.version||"1.0":"1.0";if(f.data.id&&FDBK.library.currentMockup.stencil(f.data.id)){console.log("Trying to add stencil with existing id");return}f.targetGroup&&(f.target=b("#"+f.targetGroup)),f.target=f.target||a.getActiveMockup();var k=d.add([h],f.target);f.targetGroup?a.setClassGrouped(k,!0):a.setClassGrouped(k,!1);var l=c(k).position();if(g.updateModel){var m=f.data.stencils;delete f.data.stencils;var n=c(k).measuredWidth(),o=a.currentMockup.addStencil(b.extend(!0,{},f.data,{type:f.type,name:f.templateName,version:j,left:l.x,top:l.y,width:c(k).measuredWidth(),height:c(k).measuredHeight()}),f.targetGroup);k.id=o,f.data.left!==undefined&&f.data.top!==undefined&&f.data.width!==undefined&&f.data.height!==undefined&&FDBK.library.resizeStencil(o,{width:f.data.width,height:f.data.height,top:f.data.top,left:f.data.left},{forward:!1,undoable:!1}),f.checkSize===!0&&c(k).resizeMode()==c.RESIZE_NONE&&!isNaN(n)&&n>f.data.width&&setTimeout(function(){FDBK.library.resizeStencil(o,{width:n,height:f.data.height,top:f.data.top,left:f.data.left},{undoable:!1})},0),g.undoable&&a.currentMockup.undo.undoable("Remove Stencil",a.removeStencil,[k.id,{},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]);if(f.type=="group"&&m&&m.length>0){var p,q,r=0;for(var s=m.length-1;s>=0;s--)p=m[s],substencilElem=a.addStencilFinal({type:p.type,templateName:p.name,data:p,targetGroup:o},{forward:!1,undoable:!1}),r=Math.max(r,c(substencilElem).position().x+c(substencilElem).measuredWidth());f.checkSize===!0&&r>f.data.width&&setTimeout(function(){FDBK.library.resizeStencil(o,{width:r,height:f.data.height,top:f.data.top,left:f.data.left},{undoable:!1})},0)}g.forward&&FDBK.pub("collab-add-stencil",k.id,f.targetGroup),FDBK.pub("add-stencil",k.id)}return k},a.removeStencil=function(c,d,g){var h=utils.stencil(c);if(!h)return;var i=FDBK.library.currentMockup.stencil(h.id);g=e(g);if(!f(i.id))return;var j=b(h).prev(".stencil")[0];after=b(h).next(".stencil")[0],stencilData=b.extend(!0,{},i);if(g.undoable){var k;a.isGrouped(h)&&b(h).parent(".stencil").length>0&&(k=b(h).parent(".stencil")[0].id),a.currentMockup.undo.startGroup("Add Stencil"),a.currentMockup.undo.undoable("Stack Stencil",a.orderStencil,[utils.stencilId(h),{before:utils.stencilId(j),after:utils.stencilId(after)},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]),a.currentMockup.undo.undoable("Add stencil",a.addStencilFinal,[{type:stencilData.type,templateName:stencilData.name,data:stencilData,targetGroup:k},{forward:g.undoForwardable===undefined?g.forward:g.undoForwardable}]),a.currentMockup.undo.endGroup()}g.forward&&FDBK.pub("collab-remove-stencil",h.id),FDBK.library.editor.editingStencil&&FDBK.library.editor.editingStencil.id==h.id&&FDBK.library.editor.stopEditing(!1);if(g.updateModel){var l=a.currentMockup.substencils(h.id);a.currentMockup.removeStencil(h.id),FDBK.pub("remove-stencil",l.map(function(a){return a.id}))}b(h).remove(),a.currentMockup.selection.indexOf(h)!==-1&&a.clearSelection()},a.groupStencils=function(b,c,d){d=e(d);var g=[],h=[],i,j,k=c.rect||{},l=b.slice(0);d.undoable&&a.currentMockup.undo.startGroup("Group stencils");for(var m=l.length-1;m>=0;m--){i=utils.stencil(l[m]);if(!i)continue;if(!f(i.id))continue;j=FDBK.library.currentMockup.stencil(i.id),a.removeStencil(i.id,{},d),j.top-=k.y,j.left-=k.x,g.push(j)}var n=a.addStencilFinal({type:"group",templateName:"tmplsvg-group-stencil",data:{top:k.y,left:k.x,width:k.width,height:k.height,stencils:g}},d);return d.undoable&&a.currentMockup.undo.endGroup(),n},a.ungroupStencils=function(b,c,d){d=e(d);var g=utils.stencil(b);if(!g)return;var h=FDBK.library.currentMockup.stencil(g.id),i=[];if(!f(h.id))return;d.undoable&&a.currentMockup.undo.startGroup("Ungroup Stencils"),FDBK.library.removeStencil(g.id,d);if(!h.stencils)return;var j;for(var k=h.stencils.length-1;k>=0;k--)j=h.stencils[k],j.top+=h.top,j.left+=h.left,g=FDBK.library.addStencilFinal({type:j.type,templateName:j.name,data:j},d),i.push(g);return d.undoable&&a.currentMockup.undo.endGroup(),i},a.lockStencil=function(c,d,f){var g=utils.stencil(c);if(!g)return;var h=b(g),i=FDBK.library.currentMockup.stencil(g.id);f=e(f);if(d&&d.comesFromUndoManager&&FDBK.library.currentMockup.groupedStencils[c]!==undefined)return;var j=h.prop("locked")?!1:!0;d&&d.lock!==undefined&&(j=d.lock),j?h.prop("locked","true"):h.removeProp("locked"),f.forward&&FDBK.pub("collab-lock-stencil",g.id,j),f.updateModel&&a.currentMockup.updateStencil(g.id,{locked:j}),f.undoable&&a.currentMockup.undo.undoable("Lock Stencil",a.lockStencil,[g.id,{lock:!j,comesFromUndoManager:!0}])},a.linkStencil=function(b,c,d){var f=utils.stencil(b);if(!f)return;var g=FDBK.library.currentMockup.stencil(utils.stencilId(f));d=e(d),d.undoable&&a.currentMockup.undo.undoable("Link Stencil",a.linkStencil,[f.id,{link:g.link}]),d.forward&&FDBK.pub("collab-link-stencil",f.id,c.link),d.updateModel&&(a.currentMockup.updateStencil(f.id,{link:c.link}),FDBK.pub("link-stencil",f.id,c.link))},a.updateStencilIndex=function(a,b,c){if(!f(a.id))return;FDBK.library.currentMockup.changeStencilIndex(a.id,b);var d=FDBK.library.currentMockup.stencilList();before=d[b+1]?d[b+1].id:undefined,after=d[b-1]?d[b-1].id:undefined,FDBK.library.orderStencil(a.id,{before:before,after:after},c)},a.orderStencil=function(c,d,g){var h=utils.stencil(c);if(!h)return;model=FDBK.library.currentMockup.stencil(utils.stencilId(h)),currentIndex=FDBK.library.currentMockup.indexOfStencil(h.id);if(!f(model.id))return;g=e(g),before=utils.stencil(d.before),after=utils.stencil(d.after),before?(b(before).after(h),g.updateModel&&a.currentMockup.stackStencil(utils.stencilId(h),"before",utils.stencilId(before))):after&&(b(after).before(h),g.updateModel&&a.currentMockup.stackStencil(utils.stencilId(h),"after",utils.stencilId(after))),!g.undoable,g.forward&&FDBK.pub("collab-order-stencil",h.id,currentIndex)},a.addMockup=function(c,d){d=e(d),c=c||{};var f=a.currentProject,g=c.props||{},h=c.shouldRenameAfterCreating||!1,i=c.switchToMockup===undefined?!0:c.switchToMockup,j=f.mockupList().map(function(a){return a.name});g.name=g.name||utils.uniqueName(FDBK.loc("_Untitled Page"),j);var k=f.addMockup(g),l=f.mockup(k),m=!i;a.addMockupUI(l,h,m),i&&(a.changeActiveMockup(k,!0),a.renderCurrentMockup(g.duplicateFrom),a.isMockupRendered(k)||a.setMockupRendered(k,!0));if(c.index!==undefined){var n=a.$projectStructure.find(".mockup-list-item[data-mockup="+k+"]");c.index>=a.$projectStructure.find("li").length-1?b(n).insertAfter(a.$projectStructure.find("li:nth-child("+c.index+")")):b(n).insertBefore(a.$projectStructure.find("li:nth-child("+(c.index+1)+")"))}return a.sortMockups(),FDBK.pub("project-changed","add",k),d.forward&&FDBK.pub("collab-add-mockup",k),k},a.removeMockup=function(c,d,f){function h(){b(a.$projectStructure.find("li[data-mockup="+c+"]")).remove(),b("#"+c).remove();var e=a.currentProject.indexOfMockup(c),h=e;e==a.currentProject.mockupList().length-1?h=e-1:e<1&&(h=0),a.removeMasterFromAllPages(c),a.currentProject.cleanUpLinks(c),f.forward&&FDBK.pub("collab-remove-mockup",c),a.currentProject.removeMockup(c),a.setMockupRendered(c,!1),d&&d.remote&&g!=c&&(h=a.currentProject.indexOfMockup(a.currentMockup.id));if(a.currentProject.mockupList().length==0)return;a.changeActiveMockup(a.currentProject.mockupList()[h].id),FDBK.pub("project-changed","remove",c)}f=e(f);var g=a.currentMockup.id;f.forward===!1?h():a.$projectStructure.find("li[data-mockup="+c+"]").slideUp("fast",h)},a.updateMockupName=function(b,c,d){d=e(d);var f=a.currentProject.mockup(b);a.currentProject.updateMockup(b,{name:c.value}),a.$projectStructure.find("li[data-mockup="+b+"]").find(".mockup-name").text(c.value).prop("title",c.value),FDBK.pub("project-changed","rename",b),FDBK.pub("mockup-renamed",f),FDBK.pub("renamed-mockup",{mockup:b,value:c.value}),d.forward&&FDBK.pub("collab-rename-mockup",b)},a.changeMockupOrder=function(b,c,d){d=e(d);var f=c.updateStructure||!1;if(f)if(c.index===0)a.$projectStructure.find("li[data-mockup="+b+"]").insertBefore(a.$projectStructure.find("li")[0]);else{var g=a.currentProject.indexOfMockup(b),h=c.index<g?c.index-1:c.index;a.$projectStructure.find("li[data-mockup="+b+"]").insertAfter(a.$projectStructure.find("li")[h])}d.forward&&FDBK.pub("collab-sort-mockup",b,c.index),a.sortMockups(),FDBK.pub("project-changed","order")},a.convertMasterToNormalPage=function(b,c){c=e(c);var d=a.currentProject.mockup(b);d.isMaster=!1,a.removeMasterFromAllPages(d.id),a.moveMockupSVG(d),FDBK.pub("masters-changed"),d.id==a.currentMockup.id&&FDBK.pub("mockup-changed",d),c.forward&&FDBK.pub("collab-mockup-convert-normal",b)},a.convertNormalToMasterPage=function(b,c){c=e(c);var d=a.currentProject.mockup(b);d.isMaster=!0;var f=d.master;f&&a.setMasterForMockup(b,{master:null}),a.moveMockupSVG(d),FDBK.pub("masters-changed"),d.id==a.currentMockup.id&&(f?a.changeActiveMockup(a.currentMockup.id):FDBK.pub("mockup-changed",a.currentMockup)),c.forward&&FDBK.pub("collab-mockup-convert-master",b)},a.setMasterForMockup=function(b,c,d){d=e(d);var f=a.currentProject.mockup(b),g=f.master;f.master=c.master,f.id==a.currentMockup.id&&a.changeActiveMockup(f.id),FDBK.pub("masters-changed"),d.forward&&FDBK.pub("collab-mockup-set-master",b,c.master),d.undoable&&f.undo.undoable("Change Page Master",a.setMasterForMockup,[b,{master:g}])},a.updateProjectName=function(c,d){d=e(d),c.value=c.value||FDBK.loc("_Untitled Project"),a.currentProject.name=c.value,a.setProjectTitle(c.value),b("#project-title-input").val(c.value),FDBK.pub("project-renamed",a.currentProject.name),d.forward&&FDBK.pub("collab-rename-project")};var e=function(a){return a=a||{},a.updateModel===undefined&&(a.updateModel=!0),a.undoable===undefined&&(a.undoable=!0),a.forward===undefined&&(a.forward=!0),a},f=function(a){return FDBK.library.currentMockup.groupedStencils[a]?!1:FDBK.library.currentMockup.stencil(a).locked?!1:!0};return a}(MODULE||{},jQuery,svg,layout),MODULE=function(a,b,c){function k(c){b("#create-link").addClass("disabled"),c&&c.length?(b("#lock-button, #create-selection-hotspot").removeClass("disabled"),d.removeClass("multiple group small-stencil").find(".ghost-guide").remove(),a.isMultiSelection()?(b("#group-button").removeClass("disabled"),b("#group-button").removeClass("active"),d.addClass("multiple").append(a.ghostGuidesForStencils(c))):(a.isGroup(c[0])?(d.addClass("group"),b("#group-button").removeClass("disabled"),b("#group-button").addClass("active")):(d.removeClass("group").find(".stencil-guide-ghost").remove(),b("#group-button").addClass("disabled"),b("#group-button").removeClass("active"),b("#create-link").removeClass("disabled")),a.isLocked(c[0])&&b("#group-button").addClass("disabled")),b("#arrange-button").removeClass("disabled"),b(c[0]).prop("locked")?(b("#align-button").addClass("disabled"),b("#lock-button").addClass("active"),d.addClass("locked").draggable("disable").resizable("disable")):(b("#align-button").removeClass("disabled"),b("#lock-button").removeClass("active"),d.removeClass("locked").draggable("enable").resizable("enable"))):(b("#lock-button, #group-button").removeClass("active"),b("#lock-button, #group-button, #align-button, #arrange-button, #create-selection-hotspot").addClass("disabled"))}function r(b){var c=b.map(function(b){return a.currentMockup.stencil(b.id)}),d={top:null,left:null,width:null,height:null};for(var e=0;e<c.length;e++)for(var f in d)d[f]===null?d[f]=c[e][f]:d[f]!==""&&d[f]!==c[e][f]&&(d[f]="");o.value=d.left,p.value=d.top,m.value=d.width,n.value=d.height}function w(a){var b=e.offset(),c=h[0];i={x:a.clientX-b.left,y:a.clientY-b.top,offsetLeft:b.left+c.scrollLeft,offsetTop:b.top+c.scrollTop,wrapper:c},v.style.top=i.y+"px",v.style.left=i.x+"px",v.style.width=0,v.style.height=0,v.className="active"}function B(){for(var b=0;b<a.currentMockup.selection.length;b++){var c=a.currentMockup.selection[b];a.lockStencil(c)}H()}function C(){a.currentMockup&&(d.removeData("svgElem").hide(),b(".annotation-handle").hide(),a.currentMockup.selection.length=0,FDBK.pub("selection-changed",a.currentMockup.selection),J(),N[0].stencilId=N[0].panelId=null)}function D(){if(a.isSingleSelection())return;a.currentMockup.selection.sort(function(a,c){return b(a).index()-b(c).index()})}function F(a,b){return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)}function G(b){var c=!1;for(var d=0;d<a.currentMockup.selection.length;d++)if(b==a.currentMockup.selection[d]){c=!0;break}return c}function H(){if(!FDBK.allowSelection())return;for(var e=0;e<a.currentMockup.selection.length;e++){var f=a.currentMockup.selection[e];if(!document.getElementById(f.id)){a.currentMockup.selection=[];break}}if(a.isMultiSelection()){var g=[],h=[];for(var i=0;i<a.currentMockup.selection.length;i++)b(a.currentMockup.selection[i]).prop("locked")?g.push(a.currentMockup.selection[i]):h.push(a.currentMockup.selection[i]);h.length&&(a.currentMockup.selection=h)}if(a.hasSelection()){var j={left:Number.MAX_VALUE,top:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE};for(var i=0;i<a.currentMockup.selection.length;i++){var k=K(a.currentMockup.selection[i]);j.left=Math.min(j.left,k.left),j.top=Math.min(j.top,k.top),j.right=Math.max(j.right,k.right),j.bottom=Math.max(j.bottom,k.bottom)}d.data("svgElem",a.currentMockup.selection),d.css({width:j.right-j.left+"px",height:j.bottom-j.top+"px",left:j.left,top:j.top,display:"block"});if(a.isSingleSelection()){var l=a.currentMockup.selection[0],m=c(l).resizeMode();switch(m){case c.RESIZE_HORIZONTAL:d.resizable("option","handles","e, w, e-side, w-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_VERTICAL:d.resizable("option","handles","n, s, n-side, s-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_ASPECT:d.resizable("option","handles","ne, nw, se, sw"),d.resizable("option","aspectRatio",!0);break;case c.RESIZE_ALL:d.resizable("option","handles","ne, nw, se, sw, n-side, s-side, w-side, e-side"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NWSE:d.resizable("option","handles","nw, se"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NESW:d.resizable("option","handles","ne, sw"),d.resizable("option","aspectRatio",!1);break;case c.RESIZE_NONE:d.resizable("option","handles"," ");break;case c.RESIZE_LINE:d.resizable("option","handles"," "),I()}d.resizable("option","minWidth",c(a.currentMockup.selection[0]).minWidth()),d.resizable("option","minHeight",c(a.currentMockup.selection[0]).minHeight());var n=d.data("resizable").options;d.resizable("destroy"),d.resizable(n);var o=d.attr("class").split(/\s+/),p=/^ghost-for-/;for(i=0;i<o.length;i++){var q=o[i];q.match(p)&&d.removeClass(q)}d.addClass(b(l).attr("class").split(" ").map(function(a){return"ghost-for-"+a}).join(" "))}FDBK.pub("selection-changed",a.currentMockup.selection)}else C()}function I(){var d=a.isSingleSelection()?a.currentMockup.selection[0]:null;if(d&&a.isAnnotation(d)&&!a.isLocked(d)){var e=b(d).find("line")[0];if(e){b(".annotation-handle").show(),b(".annotation-handle").removeClass("hide");var f=c(d).position(),g=c(e).linePosition(),h=b("#annotation-handle-1").outerWidth()/2;b("#annotation-handle-1").css({left:f.x+g.x1-h+"px",top:f.y+g.y1-h+"px"}),b("#annotation-handle-2").css({left:f.x+g.x2-h+"px",top:f.y+g.y2-h+"px"}),b("#annotation-handle-1").data("svgElem",[d]),b("#annotation-handle-2").data("svgElem",[d])}}else J()}function J(){b(".annotation-handle").addClass("hide")}function K(b){var c=a.currentMockup.stencil(b.id),d={left:c.left,top:c.top,right:c.left+c.width,bottom:c.top+c.height};return d}function L(a){var b={};return b.left=parseInt(a.css("left"),10),b.top=parseInt(a.css("top"),10),b.right=b.left+a.outerWidth(),b.bottom=b.top+a.outerHeight(),b}BrowserDetect.unsupportedBrowser&&b("#preloader").append('<h2>We\'re sorry, but your browser is not supported yet.</h2><p>Moqups works great with the latest version of <a href="https://www.google.com/chrome">Chrome</a>, <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or <a href="http://www.apple.com/safari/download/">Safari</a>.</p><span onclick="$(this).parent().remove();"><a href="#">Whatever, I\'ll take my chances!</a></span>'),window.top&&window.self&&window.top!==window.self&&(window.top.location=window.self.location);var d=b("#ghost"),e=a.$htmlStage=b("#htmlStage"),f=b("#svgObject"),g=b("#inspector"),h=b("#project-wrapper"),i,j;a.delayAction=function(){var a=0;return function(b,c){clearTimeout(a),a=setTimeout(b,c)}}(),b(window).focus(function(){FDBK.pub("window-focus")}),b(window).blur(function(){FDBK.pub("window-blur")}),a.chromeBadge={shouldShow:function(){var c=window.chrome&&(!window.chrome.app||!window.chrome.app.isInstalled)&&b.cookie("chromeBadge")!=="0"&&a.getUserSettings("chromeBadge")!=="0";return c},show:function(){if(this.shouldShow()){var a=this;b("#chrome-badge").fadeIn("fast").on("click",".close",function(){return a.hide(),!1}).on("click",".install",function(){return a.install(b(this).data("trigger")),!1})}},install:function(a){var c=this;if(chrome&&chrome.webstore){var d=b("link[rel=chrome-webstore-item]:first").attr("href");d&&chrome.webstore.install(d,function(){c.hide(),b("#welcome-dialog").is(":visible")?b("#welcome-content").html(b("#tmpl-welcome-installed").loc_tmpl()):(b("#welcome-content").html(b("#tmpl-welcome-other").loc_tmpl()),b("#welcome-dialog").find(".heading").prepend('<a href="#" class="close-modal">Close</a>')),FDBK.pub("chrome-install",a)},function(){})}},hide:function(){b("#chrome-badge").fadeOut("fast",function(){b.cookie("chromeBadge","0"),a.setUserSettings("chromeBadge","0")})},reset:function(){b.cookie("chromeBadge",null),a.setUserSettings("chromeBadge",null)},init:function(){var a=this;window.chrome&&(!window.chrome.app||!window.chrome.app.isInstalled)?(b(".add-to-chrome").show(),b(document).on("click",".add-to-chrome",function(){return a.install(b(this).data("trigger")),!1}),b("#welcome-content").html(b("#tmpl-welcome-chrome").loc_tmpl())):(b(".add-to-chrome").hide(),b("#welcome-content").html(b("#tmpl-welcome-other").loc_tmpl()),b("#welcome-dialog").find(".heading").prepend('<a href="#" class="close-modal">Close</a>')),this.show()}},a.downtimeWarning={show:function(){if(FDBK.DOWNTIME_WARNING&&!b.cookie("ignoreDW")){var a=this;b("#downtime-warning").fadeIn("fast").on("click",".close",function(){return a.hide(),!1})}},hide:function(){b("#downtime-warning").fadeOut("fast",function(){b.cookie("ignoreDW","1")})}},b(document).ajaxStart(function(){a.inProgressRequest=!0,a.delayAction(function(){a.inProgressRequest&&b("html").addClass("ajax")},2e3)}).ajaxStop(function(){a.inProgressRequest=!1,b("html").removeClass("ajax")}),a.hasSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length>0:!1},a.isSingleSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length==1:!1},a.isMultiSelection=function(){return a.currentMockup&&a.currentMockup.selection?a.currentMockup.selection.length>1:!1},a.selectElement=function(b,c){if(!FDBK.allowSelection())return;a.currentMockup.selection=[b],H(),c&&a.inspectorState.act("forceShow")},a.toggleElementFromSelection=function(b){var c=a.currentMockup.selection,d=c.map(function(a){return a.id}).indexOf(b.id);d===-1?c.push(b):c.splice(d,1)},a.focusArea="stage",a.isArea=function(b){return b==a.focusArea},a.getAllVisibleStencils=function(){return f.find(a.shouldShowHotspots()?".active-mockup .stencil":'.active-mockup .stencil:not([name="tmplsvg-hotspot"])')},a.ghostGuidesForStencils=function(b){var c="<div class='ghost-guide' style='width:{w}px;height:{h}px;top:{t}px;left:{l}px;'></div>",e=[],f,g,h,i,j,k=d.position();for(var l=0;l<b.length;l++)f=a.currentMockup.stencil(b[l].id),e.push(c.replace("{w}",utils.sanitize(f.width)).replace("{h}",utils.sanitize(f.height)).replace("{t}",utils.sanitize(f.top-k.top)).replace("{l}",utils.sanitize(f.left-k.left)));return e.join("")},a.$stencilTooltip=b(".tooltip-wrapper");var l=b("#stencil-tooltip")[0];a.updateStencilTooltip=function(a,b){switch(a){case"position":l.innerHTML="Left: "+b.left+"&#8193;Top: "+b.top;break;case"size":l.innerHTML="Width: "+b.width+"&#8193;Height: "+b.height;break;default:}},a.showStencilTooltip=function(){a.timeout&&clearTimeout(a.timeout),a.$stencilTooltip.addClass("show")},a.hideStencilTooltip=function(){a.timeout=setTimeout(function(){a.$stencilTooltip.removeClass("show")},500)};var m=b("#insp-width")[0],n=b("#insp-height")[0],o=b("#insp-x")[0],p=b("#insp-y")[0],q=b("#stencil-toolbar");FDBK.sub("selection-changed",function(b){a.hasSelection()?(q.show(),r(b)):q.hide()}),FDBK.sub("selection-transform",function(a,b,c){switch(b){case"start":q.addClass("disabled");break;case"timer-start":break;case"stop":q.removeClass("disabled"),r(c);break;case"timer-stop":r(c)}});var s=function(d){var e=b(d.currentTarget),f=e.data("action"),g=e.data("prop"),h=/^(\+|-)?((\d+(\.\d+)?)|(\.\d+))%$/,i=parseInt(m.value),j=parseInt(n.value),k=h.test(m.value),l=h.test(n.value),q=parseInt(o.value),r=parseInt(p.value),s;switch(f){case"resize":FDBK.library.currentMockup.undo.startGroup("Inspector Resize");for(var t=0;t<a.currentMockup.selection.length;t++){s=a.currentMockup.selection[t];var u=c(s).resizeMode();if(!a.isLocked(s)&&!a.isGroup(s)&&u!=c.RESIZE_NONE){var v=c(s).measuredWidth(),w=c(s).measuredHeight(),x=c(s).position().x,y=c(s).position().y;isNaN(i)&&(i=v),isNaN(j)&&(j=w),k&&(i=Math.round(v*i/100)),l&&(j=Math.round(w*j/100));var z=c(s).minWidth(),A=c(s).minHeight();i=Math.max(i,z),j=Math.max(j,A);switch(u){case c.RESIZE_ASPECT:var B;g=="width"?(B=v/w,j=i/B):(B=w/v,i=j/B);break;case c.RESIZE_VERTICAL:i=v;break;case c.RESIZE_HORIZONTAL:j=w}a.resizeStencil(s,{width:i,height:j,top:y,left:x},{forward:!0,undoable:!0,updateModel:!0})}}FDBK.library.currentMockup.undo.endGroup();break;case"move":FDBK.library.currentMockup.undo.startGroup("Inspector Move");for(var t=0;t<a.currentMockup.selection.length;t++){s=a.currentMockup.selection[t];var x=c(s).position().x,y=c(s).position().y,C=isNaN(q)?x:q,D=isNaN(r)?y:r;a.isLocked(s)||a.moveStencil(s,{top:D,left:C},{forward:!0,undoable:!0,updateModel:!0})}FDBK.library.currentMockup.undo.endGroup()}H()},t=utils.debounce(s,500);b(".stencilToolbarInspectableInput").on("change",s).on("keypress",function(a){var c=parseInt(a.target.value,10),d=null;if(!isNaN(c)){switch(a.keyCode){case 38:d=c+1;break;case 40:d=c-1}d!==null&&(a.target.value=d,t(a))}a.keyCode===27&&(b(this).blur(),x(a))}),a.updateUndoButton=function(){a.currentMockup.undo.undo_available>0?b("#undo-button").removeClass("disabled"):b("#undo-button").addClass("disabled")},a.updateRedoButton=function(){a.currentMockup.undo.redo_available>0?b("#redo-button").removeClass("disabled"):b("#redo-button").addClass("disabled")},b(document).on("click","#undo-button",function(){if(b(this).hasClass("disabled"))return;(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.undo()}),b(document).on("click","#redo-button",function(){if(b(this).hasClass("disabled"))return;(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.redo()}),b(document).on("keydown",null,"meta+z ctrl+z",function(){return(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.undo(),!1}),b(document).on("keydown",null,"meta+shift+z ctrl+shift+z",function(){return(a.isArea("stage")||a.isArea("toolbar"))&&a.currentMockup&&a.currentMockup.undo.redo(),!1});var u={};d.draggable({distance:3,snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,start:function(d,e){var f=a.currentMockup.selection;if(a.hasSelection()){u.startPos=c(f[0]).position(),u.startUi=e.position||{top:0,left:0},u.newDrag=!0;if(d.altKey){var g=f[0];a.copyStencils(),a.pasteStencils(!0);var h=b(this).data("draggable"),i=b("#htmlStage").offset().left,j=b("#htmlStage").offset().top;h.customSnapElements.push({item:g,width:c(g).measuredWidth(),height:c(g).measuredHeight(),top:c(g).position().y+j,left:c(g).position().x+i})}b(this).addClass("hide")}else b(this).hide();FDBK.pub("selection-transform","move","start",f)},drag:function(b,d){var e=d.position,f;if(b.shiftKey){var g=u.startUi,h=Math.abs(g.left-d.position.left),i=Math.abs(g.top-d.position.top),k=u.newDrag?Math.max(h,i)===h:u.xMax;u.xMax=k,u.newDrag=!1,k?e.top=g.top:e.left=g.left}a.updateStencilTooltip("position",e),j=!0;if(a.hasSelection())if(a.isMultiSelection()){var l=u.startPos.y+e.top-u.startUi.top,m=u.startPos.x+e.left-u.startUi.left,n=c(a.currentMockup.selection[0]).position(),o=m-n.x,p=l-n.y;for(var q=0;q<a.currentMockup.selection.length;q++)f=a.currentMockup.selection[q],selPos=c(f).position(),a.moveStencil(f,{top:selPos.y+p,left:selPos.x+o},{undoable:!1,forward:!1,updateModel:!1})}else f=a.currentMockup.selection[0],a.moveStencil(f,{top:e.top,left:e.left},{undoable:!1,forward:!1,updateModel:!1})},stop:function(b,d){var e=a.currentMockup.selection;a.snapoptions.stop(b,d);if(a.hasSelection()){a.currentMockup.undo.startGroup("Move selection");for(var f=0;f<e.length;f++){var g=c(e[f]).position();a.moveStencil(e[f],{top:g.y,left:g.x})}a.currentMockup.undo.endGroup(),delete u.startPos,delete u.startUi}FDBK.pub("selection-transform","move","stop",e)}}),a.liveResizeFunction=function(b,c){a.snapoptions.update(b,c),j=!0,a.isSingleSelection()&&(a.resizeStencil(a.currentMockup.selection[0],{width:d.width(),height:d.height(),top:parseInt(d.css("top"),10),left:parseInt(d.css("left"),10)},{forward:!1,undoable:!1,updateModel:!1}),a.updateStencilTooltip("size",{height:c.helper.height(),width:c.helper.width()}))},a.helperResizeFunction=function(b,c){a.snapoptions.update(b,c),j=!0,a.isSingleSelection()&&a.updateStencilTooltip("size",{height:c.helper.height(),width:c.helper.width()})},d.resizable({handles:"all",snap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,start:function(){var b=a.currentMockup.selection;FDBK.pub("selection-transform","resize","start",b)},resize:a.liveResizeFunction,stop:function(c,e){var g=a.currentMockup.selection,h=0,i=0;a.snapoptions.stop(c,e);if(a.isSingleSelection()){if(a.snapoptions.snapGrid||b(this).resizable("option","helper"))h=b(this).resizable("option","helper")?f.offset().left:0,i=b(this).resizable("option","helper")?f.offset().top:0,d.css({left:e.position.left-h,top:e.position.top-i,width:e.size.width,height:e.size.height});a.resizeStencil(g[0],{width:e.size.width,height:e.size.height,top:e.position.top-i,left:e.position.left-h})}FDBK.pub("selection-transform","resize","stop",g)}}),b("#clear-selection").on("mousedown",function(a){FDBK.allowSelection()&&(a.target===this||b(a.target).prop("id")==="containment")&&(b(document).disableSelection(),w(a))});var v=document.getElementById("selection-helper");f.on({mousedown:function(c){if(!FDBK.allowSelection())return;var e=b(c.target).closest("#"+a.currentMockup.id+" .stencil");e.length&&!e.prop("locked")?(e=e[0],c.shiftKey||c.ctrlKey||c.metaKey?(a.toggleElementFromSelection(e),H(),j=!0):(a.currentMockup.selection=[e],H(),d.trigger(c)),D()):w(c),e=null,wrapper=null,b(document).disableSelection()},dblclick:function(c){var d=b(c.target).closest(".active-master-mockup");d.length&&FDBK.allowEditMasters()&&a.changeActiveMockup(d[0].id)}}),d.on({mousedown:function(c){var f=d.hasClass("locked");b(c.target).hasClass("ui-resizable-handle")?a.updateStencilTooltip("size",{height:d.height(),width:d.width()}):a.updateStencilTooltip("position",d.position()),a.showStencilTooltip();if(b(c.target).hasClass("border")&&a.isSingleSelection()&&!c.shiftKey&&!c.ctrlKey&&!c.metaKey){var g={left:c.clientX-e.offset().left,top:c.clientY-e.offset().top,right:c.clientX-e.offset().left,bottom:c.clientY-e.offset().top};E(g,{multiple:!1,reset:!0},!0),H(),f&&!a.isLocked(a.currentMockup.selection[0])&&(d.removeClass("locked").draggable("enable").resizable("enable"),d.trigger(c)),a.isLocked(a.currentMockup.selection[0])&&d.trigger("mouseup")}},mouseup:function(a){if(!j)if(a.shiftKey||a.ctrlKey||a.metaKey){var b={left:a.clientX-e.offset().left,top:a.clientY-e.offset().top,right:a.clientX-e.offset().left,bottom:a.clientY-e.offset().top};E(b,{multiple:!1,reset:!1},!0),H()}},dblclick:function(){a.editor.enterEditMode()}}),b(document).on("keydown",null,"return",function(c){var d=b(".show-dropdown");d.length&&(d.find(".menu-item.selected").first().click(),FDBK.closeDropdowns());if(!b("#editArea").is(c.target)&&a.focusArea=="stage")return a.editor.enterEditMode(),!1}),b(document).on("mousemove",function(a){if(i){var b=a.clientX-i.offsetLeft+i.wrapper.scrollLeft,c=a.clientY-i.offsetTop+i.wrapper.scrollTop;v.style.width=Math.abs(b-i.x)+"px",v.style.height=Math.abs(c-i.y)+"px",v.style.left=Math.min(b,i.x)+"px",v.style.top=Math.min(c,i.y)+"px",v.style.display="block"}});var x=a.focusStage=function(c){a.focusArea!="stage"&&(b(document.activeElement).blur(),a.focusArea="stage",d.removeClass("blur"),b(".annotation-handle").removeClass("blur"))},y=a.blurStage=function(){d.addClass("blur"),a.inspectorState.act("hide")},z,A=a.preventClearSelection=function(a){if(a===undefined)return z;z=a};b(document).on({mousedown:function(c){!b("#editArea").is(c.target)&&a.editor.editingStencil!==null&&(b("#editArea").is(":visible")&&A(!0),a.editor.stopEditing(!0))},mouseup:function(c){var d=b(c.target);!j&&c.button!=2&&!A()&&(v.className==="active"?(c.shiftKey||c.ctrlKey||c.metaKey?E(L(b(v)),{multiple:!0,reset:!1},!1):parseInt(v.style.width,10)<5&&parseInt(v.style.height,10)<5?E(L(b(v)),{multiple:!1,reset:!0},!1):E(L(b(v)),{multiple:!0,reset:!0},!1),H()):!b(c.target).closest(".stencil").length&&b(c.target).closest("#clear-selection").length&&C()),FDBK.pub("selection-event:document:mouse-up"),d.closest("#sidebar-wrapper").length?(a.focusArea="sidebar",y()):d.closest("#toolbar-wrapper").length?(a.focusArea="toolbar",y()):d.closest("#comments-sidebar").length?(a.focusArea="comments",y()):d.closest(".modal").length||d.closest("#overlay").length?(a.focusArea="modal",y()):d.closest("#secondary-toolbar").length?(a.focusArea="secondary-toolbar",y()):x(c)}}),FDBK.sub("selection-event:document:mouse-up",function(){a.hideStencilTooltip(),b(document).enableSelection(),v.style.display="none",v.className="",i=null,j=null,A(!1)},this),b(document).on("click","#lock-button",function(){if(b(this).hasClass("disabled"))return;B()}),b(document).on("keydown",null,"meta+l ctrl+l",function(){if(b("#lock-button").hasClass("disabled"))return;return B(),!1}),a.isLocked=function(b){var c=a.currentMockup.stencil(b.id);return c&&c.locked},a.isAnnotation=function(b){var c=a.currentMockup.stencil(b.id);return c&&c.type==="annotation"},b(document).on("keydown",null,"meta+a ctrl+a",function(){return a.currentMockup&&(a.currentMockup.selection.length=0,a.getAllVisibleStencils().each(function(){a.currentMockup.selection.push(this)}),H()),!1}),b(document).on("keydown",null,"del backspace",function(b){if(a.isArea("stage")||a.isArea("toolbar"))if(a.hasSelection())return a.deleteSelection(),!1}),a.deleteSelection=function(){var c=a.currentMockup.selection.slice().filter(function(a){return!b(a).prop("locked")});if(c.length){a.currentMockup.undo.startGroup("Remove selection");for(var d=c.length-1;d>=0;d--)a.removeStencil(c[d]);a.currentMockup.undo.endGroup(),C()}},a.addStencil=function(b){return a.addStencilFinal({type:b.data&&b.data.type!==undefined?b.data.type:"stencil",templateName:b.name,data:b.data,target:b.target,targetGroup:b.targetGroup},{undoable:b.undoable,updateModel:!b.skipModel})},a.addStencilInstance=function(c,d,e,f){var g=a.getActiveMockup();f&&(g=b("#"+f),a.setClassGroped(c,!0));var h;return d?h=a.currentMockup.addStencil(d,f):(h=a.currentMockup.copyStencil(c.id),d=a.currentMockup.stencil(h)),c.id=h,g.append(c),FDBK.pub("add-stencil",c.id),e&&a.currentMockup.undo.undoable("Remove Stencil",a.removeStencil,[utils.stencilId(c)]),FDBK.pub("collab-add-stencil",h,f),c},a.createHotspotsForStencils=function(b){a.shouldShowHotspots()||a.showAllHotspots(),b=b||a.currentMockup.selection||[];var c=[],d;a.currentMockup.undo.startGroup("stencil hotspots");for(var e=0;e<b.length;e++){var f=a.currentMockup.stencil(b[e].id);f&&(d=a.addStencil({name:"tmplsvg-hotspot",undoable:!0}),a.resizeStencil(d,{width:f.width,height:f.height,top:f.top,left:f.left}),c.push(d))}if(!c.length){d=a.addStencil({name:"tmplsvg-hotspot",undoable:!0});var g=a.defaultPosition();a.moveStencil(d,{left:g.left,top:g.top}),c.push(d)}a.currentMockup.selection=c,a.showSelection(),a.isSingleSelection()&&a.inspectorState.act("show"),a.currentMockup.undo.endGroup()},a.shouldShowHotspots=function(){return document.documentElement.className.indexOf("hide-hotspots")===-1},a.toggleHotspotVisibility=function(){var c=b("#toggle-hotspots");c.hasClass("checked")?a.hideAllHotspots():a.showAllHotspots()},a.showAllHotspots=function(a){b("html").removeClass("hide-hotspots"),b("#toggle-hotspots").addClass("checked")},a.hideAllHotspots=function(c){b("html").addClass("hide-hotspots"),b("#toggle-hotspots").removeClass("checked"),a.currentMockup&&a.currentMockup.selection&&(a.currentMockup.selection=a.currentMockup.selection.filter(function(a){return a.getAttribute("name")!=="tmplsvg-hotspot"}),a.showSelection())};var E=function(b,c,d){var e=[],f,g=!1,h=a.getAllVisibleStencils();for(var i=0;i<h.length;i++){var j=K(h[i]);F(b,j)&&(e.push(h[i]),g=!0)}!c.multiple&&e.length>0&&(f=e[e.length-1],e.length=0,e.push(f),g=!0),c.reset&&(a.currentMockup.selection.length=0);for(var k=0;k<e.length;k++)!d&&!G(e[k])?(a.currentMockup.selection.push(e[k]),g=!0):d&&(a.toggleElementFromSelection(e[k]),g=!0);return g&&D(),a.currentMockup.selection};FDBK.sub("remote-stencil-update",function(b){var c=!1;for(var d=a.currentMockup.selection.length-1;d>=0;d--)if(a.currentMockup.selection[d].id==b){c=!0;break}c&&a.showSelection()}),a.adjustSelectionGhost=function(){if(a.currentMockup.selection.length===0)return;var b=a.currentMockup.stencil(a.currentMockup.selection[0].id),c=b.width,e=b.height;Math.min(c,e)<FDBK.config("stencilEditor.stencilTooSmallThreshold")?d.addClass("small-stencil"):d.removeClass("small-stencil")},this._inspectorQueue=[];var M=function(a){var b={height:h.height(),width:h.width(),top:h.offset().top,left:h.offset().left},c={offset:a.offset(),width:a.width(),height:a.height()},d={width:g.width(),height:g.height()},e=10,f=b.height+b.top-(c.offset.top+c.height)-d.height,i=c.offset.top-b.top-d.height,j=c.offset.left-b.left-d.width,k=b.width-b.left-(c.offset.left+c.width)-d.width,l,m,n,o,p;return f>=e?(l=c.offset.left+c.width/2-d.width/2,m=c.offset.top+c.height+5,n="bottom",o="",p=""):i>=e?(l=c.offset.left+c.width/2-d.width/2,m=c.offset.top-d.height-15,n="top",o="bottom",p="popoverTailDown"):k>=e?(l=c.offset.left+c.width+15,m=c.offset.top+c.height/2-d.height/2,n="right",o="right",p="popoverTailLeft"):j>=e?(l=c.offset.left-d.width-15,m=c.offset.top+c.height/2-d.height/2,n="left",o="left",p="popoverTailRight"):(l=c.offset.left+(c.width-d.width)/2,m=c.offset.top+(c.height-d.height)/2,o="",p="popoverTailNone"),{left:l,top:m,pos:n,tooltipWrapperClass:o,popoverTailClass:p}},N=b("#inspectorContent");a.showInspectorForSelection=function(c){if(a.currentMockup&&a.isSingleSelection()){var c=a.currentMockup.selection[0];if(!c||a.isGroup(c)||a.isLocked(c))return!1;var d=a.currentMockup.stencil(c.id);if(!d||!d.inspectables)return!1;var e=b(c).attr("name"),f=d.inspectables._inspector||e+"-panel";a.showInspector(f,d)}},a.showInspector=function(a,b,c){c=c||{};if(N[0].stencilId!=b.id||N[0].panelId!=a){var e=FDBK.getPanelDOM(a,b);N.html(e),N[0].stencilId=b.id,N[0].panelId=a,FDBK.pub("inspector-shown",a)}var f=M(c.anchor||d);d.find(".tooltip-wrapper").removeClass("bottom").addClass(f.tooltipWrapperClass),g.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(f.popoverTailClass),g.css({left:f.left,top:f.top,opacity:1})},a.hideInspector=function(){g.css({opacity:0,left:"-9999px",top:"-9999px"}),a.iconPicker.hide(),a.colorPicker.hide(),FDBK.pub("inspector-hidden",N[0].panelId)};var O=a.inspectorState=AppSeeds.StateManager.create("hidden shown latent inert").whenIn("root",{sleep:function(){this.goTo("inert")},forceShow:function(){this.goTo("shown")}}).whenIn("hidden",{show:function(){this.goTo("latent")}}).whenIn("shown",{enter:function(b){a.showInspectorForSelection()},exit:function(){a.hideInspector()},show:function(){this.goTo("latent")},hide:function(){this.goTo("latent")},remove:function(){this.goTo("hidden")}}).whenIn("latent",{show:function(){this.goTo("shown")},remove:function(){this.goTo("hidden")}}).whenIn("inert",{wake:function(){this.goTo("hidden")}}).goTo("hidden");return h.scroll(function(){a.inspectorState.act("hide")}),this._selectionCache=null,FDBK.sub("selection-changed",function(a){var b=(a||[]).map(function(a){return a.id}),c=utils.sameArrayContent(b,this._selectionCache||[]);c||this.inspectorState.act("remove"),this._selectionCache=b,this._selectionMoveTimer||(k(a),a&&a.length===1?(this.inspectorState.act("show"),this.showAnnotationHandles(),this.adjustSelectionGhost()):(this.inspectorState.act("remove"),this.hideAnnotationHandles()))},a),FDBK.sub("selection-transform",function(a,b,c){switch(b){case"timer-start":var e=this;this._selectionMoveTimer?clearTimeout(this._selectionMoveTimer):(this.showStencilTooltip(),this.inspectorState.act("hide")),this._selectionMoveTimer=setTimeout(function(a){!a||a.length!==1,e.hideStencilTooltip(),e._selectionMoveTimer=null,FDBK.pub("selection-transform","move","timer-stop",a)},500,c);break;case"start":this.inspectorState.act("hide"),d.addClass("hide"),this.hideAnnotationHandles();break;case"stop":d.removeClass("hide"),this.adjustSelectionGhost()}},a),a.replaceStencilCollab=function(a,c,d,e){if(FDBK.library.currentMockup.groupedStencils[c.id])return;FDBK.library.currentMockup.undo.undoable("Replace Collab Stencil",FDBK.library.replaceStencilCollab,[a,b.extend(!0,{},d),b.extend(!0,{},c),e]),FDBK.pub("collab-replace-stencil",a,c,d,e)},a.inspect=function(d,e,f){f=f||a.currentMockup.selection[0];var g=a.currentMockup.stencil(f.id),h=g.name,i=b.extend(!0,{},g),j={x:c(f).position().x,y:c(f).position().y,width:c(f).measuredWidth(),height:c(f).measuredHeight()},k=j,l=b(f).prev(".stencil")[0],m=b(f).next(".stencil")[0];a.inspectorState.act("sleep"),a.currentMockup.undo.startGroup("Inspect Stencil"),a.removeStencil(f,{},{forward:!1});for(var n in e)g.inspectables[n]===undefined&&console.info("Added new inspectable "+n+" to stencil"),g.inspectables[n]=e[n];f=null;var o=a.addStencilFinal({type:"stencil",templateName:h,data:g},{forward:!1});a.orderStencil(o,{before:l,after:m},{forward:!1});var p=c(o).minWidth(),q=c(o).minHeight();if(j.width<p||c.resetSizeOnInspect())k.width=p;if(j.height<q||c.resetSizeOnInspect())k.height=q;e._width&&(k.width=parseInt(e._width,10)),e._height&&(k.height=parseInt(e._height,10)),a.resizeStencil(o,{width:k.width,height:k.height,top:k.y,left:k.x},{forward:!1}),g=a.currentMockup.stencil(g.id);var r=a.currentMockup.indexOfStencil(g.id);a.replaceStencilCollab(a.currentMockup.id,g,i,r),a.currentMockup.undo.endGroup(),a.currentMockup.selection=[o],a.showSelection(),a.inspectorState.act("forceShow")},FDBK.sub("modal-opened",function(){b(document).trigger("mouseup"),a.focusArea="modal"}),FDBK.sub("modal-closed",function(a){x()}),FDBK.sub("moqups-loaded",function(){BrowserDetect.unsupportedBrowser||b("#preloader").hide(),x()}),a.loadAccountServiceData=function(){FDBK.AUTHORIZED_SERVICES=[],FDBK.API.xhr(FDBK.API.CALL_GET_SERVICES,{success:function(a){if(a.success){FDBK.AUTHORIZED_SERVICES=a.object;for(var b=0;b<FDBK.AUTHORIZED_SERVICES.length;b++)switch(FDBK.AUTHORIZED_SERVICES[b].serviceProvider){case"googledrive":FDBK.AUTHORIZED_SERVICES[b].serviceName="Google Drive";break;case"dropbox":FDBK.AUTHORIZED_SERVICES[b].serviceName="Dropbox";break;default:FDBK.AUTHORIZED_SERVICES[b].serviceName=FDBK.AUTHORIZED_SERVICES[b].serviceProvider}}FDBK.pub("account-service-data-loaded")}})},a.isServiceAuthorized=function(a){for(var b=0;b<FDBK.AUTHORIZED_SERVICES.length;b++)if(FDBK.AUTHORIZED_SERVICES[b].serviceProvider==a)return!0;return!1},a.getUserData=function(){var c=function(){a.applyUserSettings(),a.setLoggedState(!1);if(a.projectIdToLoad){var b=a.projectIdToLoad,c,d=a.projectIdToLoad.split("/").filter(function(a){return a&&a.length>0});d.length>1&&(b=d[0],c=d[1]),c?(a.projectIdToLoad=b,a.validateActivationToken(c,function(){FDBK.pub("moqups-loaded")})):(FDBK.pub("moqups-loaded"),a.showLoginDialog())}else a.openDefaultProject("sampleProjectSans")};FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(d){d.success?(FDBK.USER_DATA=b.extend(FDBK.USER_DATA,d.object.user),a.setLoggedState(!0),a.loadAccountServiceData(),a.loadUserSettings(),FDBK.START_IN_RECOVERY_MODE||(a.projectIdToLoad?(a.projectIdToLoad=a.projectIdToLoad.split("/")[0],(!a.currentProject||a.currentProject.isClean())&&a.fetchProject(a.projectIdToLoad),a.projectIdToLoad=null):FDBK.USER_DATA.lastModifiedProject&&(!a.currentProject||!!a.currentProject.isClean())&&a.fetchProject(FDBK.USER_DATA.lastModifiedProject)),FDBK.pub("moqups-loaded"),FDBK.START_IN_RECOVERY_MODE=!1):c()},error:function(){c()}}),window.onbeforeunload=function(){if(FDBK.config("projectManager.warnOnBeforeUnload")&&a.currentProject&&!a.currentProject.isClean())return"You have unsaved changes!"}},a.checkSession=function(){FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(b){b.success?FDBK.pub("session-check-result",!0):(FDBK.pub("session-check-result",!1),a.setLoggedState(!1),a.showLoginDialog(),FDBK.showServerError({message:FDBK.loc("_Your session has been lost. Please login again to avoid data loss.")}))},error:function(){FDBK.pub("session-check-result",!1),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal"}]})}})},a.openDefaultProject=function(c){if(!a.currentProject&&!FDBK.START_IN_RECOVERY_MODE){var d=FDBK.defaultProjects[c]||FDBK.defaultProjects.emptyProject;a.openProject(d);var e=b(".active-mockup").find(".stencil").first()[0];e&&a.selectElement(e,!0)}FDBK.pub("moqups-loaded")},a.checkHash=function(){var b=window.location.hash;if(b)switch(b){case"#!/register":a.isUserLoggedIn()||a.showRegisterDialog();break;case"#!/sign-in":a.isUserLoggedIn()||a.showLoginDialog();break;case"#!/reset":a.isUserLoggedIn()||a.showResetDialog();break;case"#!/recovery":FDBK.START_IN_RECOVERY_MODE=!0,FDBK.showRecoveryDialog();break;case"#!/pricing":FDBK.showPricingPlans();break;case"#!/newsletter-pricing":FDBK.showPricingPlans(),FDBK.pub("newsletter-visit");break;default:if(b.indexOf("#!/edit/")!=-1){var c=b.split("#!/edit/");if(c.length==2){var d=c[1].split("/");d.length==3?a.projectIdToLoad=d[1]+"/"+d[2]:d.length>1?a.projectIdToLoad=d[1]:a.projectIdToLoad=d[0]}}else b.indexOf("#reset?rt")!=-1&&!a.isUserLoggedIn()&&(FDBK.resetToken=b.split("#reset?rt=")[1],FDBK.openModal("#password-dialog","reset/"+FDBK.resetToken))}},a.setShortcuts=function(){var a={"short":FDBK.winShortcuts};BrowserDetect.isMac&&(a={"short":FDBK.macShortcuts}),b("#shortcuts-dialog").append(b("#tmpl-shortcuts").loc_tmpl(a)),b("#contextMenu").append(b("#tmpl-context-menu").loc_tmpl(a)),b("#moqups-dropdown").append(b("#tmpl-moqups").loc_tmpl(a)),b("#centered-buttons").append(b("#tmpl-centered-buttons").loc_tmpl(a)).before(b("#tmpl-undo-redo").loc_tmpl(a));var c=function(){b(this).html(a.short[b(this).data("short")].name)};b("[data-short]").each(c),FDBK.sub("inspector-shown",function(){b("#inspectorContent [data-short]").each(c)})},FDBK.sub("dom-ready",function(){(function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(d,e))})(document,"script","twitter-wjs"),uvOptions={},function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://":"http://")+"widget.uservoice.com/zb8lz2gaixOFeGQy59b4Q.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://apis.google.com/js/plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),b(".facebook-widget-placeholder").html('<iframe src="//www.facebook.com/plugins/like.php?href=https%3A%2F%2Fmoqups.com&amp;send=false&amp;layout=button_count&amp;width=86&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:86px; height:21px;" allowTransparency="true"></iframe>')}),FDBK.sub("new-payment-successful",function(a){!b("#dynamic-tracking").find("img").length&&FDBK.isProductionEnv&&b("#dynamic-tracking").html(b("#tmpl-conversion-tracking-images").loc_tmpl({price:a}))}),FDBK.sub("dom-ready",function(){function c(){a.setShortcuts(),a.getUserData()}FDBK._stencilsDefsReady?c():FDBK.sub("stencils-and-defs-loaded",function(){c()}),b.cookie("moqups_ref")||b.cookie("moqups_ref",document.referrer,{expires:3650,path:"/"}),a.chromeBadge.init(),a.downtimeWarning.show()}),a.showSelection=H,a.clearSelection=C,a.getSvgPoints=K,a.$svgObject=f,a.$ghost=d,a.$inspector=g,a.$projectWrapper=h,a.reOrderCurrentSelection=D,a.showAnnotationHandles=I,a.hideAnnotationHandles=J,a.projectIdToLoad=null,a}(MODULE||{},jQuery,svg);(function(){var a=function(a){this.init(a)};a.prototype.available=function(){try{return window.localStorage.setItem("Store.testKey",""),window.localStorage.removeItem("Store.testKey"),!0}catch(a){return!1}},a.prototype.init=function(a){},a.prototype.save=function(a,b){this.available()||this.callback("onNotAvailable")},a.prototype.load=function(a){if(this.available()){var b=this.index.filter(function(b){return b.key=a})[0];if(b)return window.localStorage.getItem(b)}else this.callback("onNotAvailable");return null},a.prototype.loadIndex=function(){if(this.available()){var a=window.localStorage.getItem("Store.index");try{this.index=a?JSON.parse(a):null}catch(b){}}else this.callback("onNotAvailable")},a.prototype.guid=function(){},a.prototype.callback=function(a){},window.Store=a})(),FDBK.mixinModule("recovery",{initModule:function(){if(FDBK.config("projectManagement.recovery.enabled")&&this.hasLocalStorage()){var a=this;this._localProjects=this.deserializeLocalProjects(window.localStorage.getItem(this.LS_PROJECTS_INFO_KEY)).sort(function(a,b){return new Date(b.date)-new Date(a.date)}),this.$projectsRecoveryDialog=$("#projects-recovery-dialog"),this.$projectsRecoveryTmpl=$("#tmpl-recover-projects"),this.$diagnosticDialog=$("#project-diagnostic-dialog"),FDBK.sub("project-saved-locally",function(a){console.info("Your project was saved to local storage. v:",a)}),FDBK.sub("open-project",function(){var b=FDBK.library.serviceClient._doc?FDBK.library.serviceClient._doc.version:null,c=a._localProjects.filter(function(a){return a.id==FDBK.library.currentProject.uniqueId}),d=a.localProject(FDBK.library.currentProject.uniqueId);if(d&&b&&c&&c.length==1){var e=c[0],f=(new FDBK.Project(JSON.parse(a.localProject(e.id)))).toServerJSON();e.version!==undefined&&e.version>b?function g(){FDBK.openConfirmDialog({heading:FDBK.loc("_Unsaved changes"),message:FDBK.loc("_NewerVersionLocallyMessage")+"<p><b>"+FDBK.loc("_Local version")+"</b><p>"+'<p><a href="#" id="recover-view-local-button" style="margin-right:5px">'+FDBK.loc("_View")+"</a> "+FDBK.loc("_Last saved")+" "+moment(e.date).format("MMMM Do h:mm a")+" ("+moment(e.date).fromNow()+")</b></p><br/>"+"<p><b>"+FDBK.loc("_Remote version")+"</b><p>"+'<p><a href="#" id="recover-view-remote-button" style="margin-right:5px">'+FDBK.loc("_View")+"</a> "+FDBK.loc("_Last saved")+" "+moment(FDBK.library.currentProject.lastUpdateDate).format("MMMM Do h:mm a")+" ("+moment(FDBK.library.currentProject.lastUpdateDate).fromNow()+")</b></p><br/>",buttons:[{text:FDBK.loc("_Keep local version"),classes:"right",onClick:function(){FDBK.library.serviceClient.replaceProjectData(f,function(){FDBK.library.closeCurrentProject(),FDBK.library.fetchProject(e.id)})}},{text:FDBK.loc("_Keep remote version"),classes:"close-modal right",onClick:function(){a.initAutoSave()}}]}),$("#recover-view-local-button").click(function(){g(),FDBK.library.previewProject(f,!1)}),$("#recover-view-remote-button").click(function(){g(),FDBK.library.previewProject(null,!1)})}():a.initAutoSave()}else a.initAutoSave()}),this.$projectsRecoveryDialog.on("click",".project-name",function(){var b=$(this).closest(".project").data("project-id");return a.openLocalProject(b),!1}).on("click",".remove-project",function(){var b=$(this).closest(".project").data("project-id");return a.deleteLocalProject(b),$(this).closest(".project").remove(),FDBK.hideTooltip(),!1}).on("click",".remove-all-projects",function(){return confirm(FDBK.loc("_Remove all projects"))&&(a.deleteAllLocalProjects(),FDBK.closeModal()),!1}),$(document).on("keydown",null,"ctrl+shift+y meta+shift+y",function(){return FDBK.diagnostic(),!1}),this.$diagnosticDialog.on("click","#diagnostic-load",function(){a._diagnosticLoad()}).on("click","#diagnostic-check",function(){a._diagnosticCheck()}).on("click","#diagnostic-check-repair",function(){a._diagnosticCheckRepair()}).on("click","#diagnostic-open",function(){a._diagnosticOpen()}).on("click","#diagnostic-minify",function(){a._diagnosticMinify()}).on("click","#diagnostic-beautify",function(){a._diagnosticBeautify()}).on("click","#diagnostic-dump-local-storage",function(){a._diagnosticDumpLocalStorage()}).on("click","#diagnostic-save-file",function(){a._diagnosticSaveFile()}),this.cleanOrphanProjects()}},initAutoSave:function(){this.localSaveTimer=AppSeeds.Scheduler.create(FDBK.saveProjectLocally,null,this).repeat(FDBK.config("projectManagement.recovery.saveInterval")).now()},diagnostic:function(){this.$diagnosticDialog.find("textarea").val(""),this._diagnosticResult(null),FDBK.openModal("#project-diagnostic-dialog")},_diagnosticDumpLocalStorage:function(){var a=new Blob(this._localProjects.map(function(a){try{return JSON.stringify(JSON.parse(FDBK.localProject(a.id)),null,2)}catch(b){return FDBK.localProject(a.id)}}),{type:"text/plain "}),b=URL.createObjectURL(a);window.open(b,"_blank"),window.focus()},_diagnosticOpen:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}b&&(FDBK.library.closeCurrentProject(),b.uniqueId=null,FDBK.library.openProject(b),FDBK.closeModal("#project-diagnostic-dialog"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticSaveFile:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=new Blob([a],{type:"text/plain"}),e=URL.createObjectURL(d);window.open(e,"_blank"),window.focus()}}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticLoad:function(){this.$diagnosticDialog.find("textarea").val(JSON.stringify(FDBK.library.currentProject.toServerJSON(),null,2)),this._diagnosticResult(null)},_diagnosticResult:function(a){var b=this.$diagnosticDialog.find("#diagnostic-result");a===null?b.html(""):typeof a=="object"?b.html(Object.keys(a).map(function(b){return"<strong>"+b+"</strong> "+JSON.stringify(a[b])+" / "}).join("")):typeof a=="string"&&b.html(utils.sanitize(a))},_checkForErrors:function(a,b){var c={},d={},e=[],f=[],g=[],h=[],i=b?{}:null;for(var j=0;j<a.mockups.length;j++){var k=a.mockups[j],l=function(a,d){for(var f=0;f<a.length;f++){var h=a[f];h?(b&&d&&h.id.split("-")[0]!==d&&(h.id=utils.guid(d+"-")),c[h.id]?(g.push(h.id),b&&(h.id=utils.guid(k.id+"-"))):c[h.id]=!0,h.type==="group"&&h.stencils&&l(h.stencils,b?d:null)):e.push([k.id,f])}b&&(k.stencils=k.stencils.filter(function(a){return a}))};k?(d[k.id]?(h.push(k.id),b&&(k.id=utils.guid("a"))):d[k.id]=!0,l(k.stencils,b?k.id:null)):f.push(j),b&&(a.mockups=a.mockups.filter(function(a){return a}))}return{duplicateMockups:h,duplicateStencils:g,nullStencils:e,nullMockups:f}},_diagnosticBeautify:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}b&&(this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult("JSON is now beautified"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticMinify:function(a){var b=this.$diagnosticDialog.find("textarea").val(),a;if(b){try{a=JSON.parse(b)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}a&&(this.$diagnosticDialog.find("textarea").val(JSON.stringify(a)),this._diagnosticResult("JSON is now minified"))}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticCheck:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=this._checkForErrors(b,!1);this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult(d)}}else this._diagnosticResult("Diagnostic textarea is empty.")},_diagnosticCheckRepair:function(){var a=this.$diagnosticDialog.find("textarea").val(),b;if(a){try{b=JSON.parse(a)}catch(c){console.info("Invalid JSON",c),this._diagnosticResult("JSON is invalid, check console for details.")}if(b){var d=this._checkForErrors(b,!0);this.$diagnosticDialog.find("textarea").val(JSON.stringify(b,null,2)),this._diagnosticResult(d)}}else this._diagnosticResult("Diagnostic textarea is empty.")},LS_PROJECT_KEY:"project:{id}",LS_PROJECTS_INFO_KEY:"projects",LS_PROJECTS_LIMIT:FDBK.config("projectManagement.recovery.limit"),cleanOrphanProjects:function(){for(var a in window.localStorage){if(a.indexOf("project:")==-1)continue;var b=this._localProjects.filter(function(b){return"project:"+b.id===a});(!b||b.length===0)&&window.localStorage.removeItem(a)}},saveProjectLocally:function(){var a=FDBK.library.currentProject;if(a){var b=a.uniqueId||a.tempId||"unsaved",c=0;b&&FDBK.library.serviceClient._doc&&(c=FDBK.library.serviceClient._doc.version,c+=FDBK.library.serviceClient._doc.inflightOp||FDBK.library.serviceClient._doc.pendingOp?1:0);try{window.localStorage.setItem(this.LS_PROJECT_KEY.replace("{id}",b),JSON.stringify(a.toServerJSON()))}catch(d){console.error("Error writing in local storage (limit probably reached)");return}this.updateProjectsInfo({id:b,name:a.name||FDBK.loc("_Untitled Project"),date:(new Date).toISOString(),version:c}),FDBK.pub("project-saved-locally",c)}},openLocalProject:function(a){var b=this.localProject(a);try{var c=JSON.parse(b);FDBK.library.closeCurrentProject(),c.uniqueId=null,FDBK.library.openProject(c),FDBK.closeModal()}catch(d){console.error("Error opening local project: JSON is malformed")}},deleteLocalProject:function(a){this.hasLocalStorage()&&(window.localStorage.removeItem("project:"+a),this._localProjects=this._localProjects.filter(function(b){return b.id!==a}),this.updateProjectsInfo())},deleteAllLocalProjects:function(){if(this.hasLocalStorage()){var a=this._localProjects;for(var b=0;b<a.length;b++)this.deleteLocalProject(a[b].id)}},updateProjectsInfo:function(a){if(a){var b=this._localProjects.filter(function(b){return b.id===a.id});if(b&&b.length)b[0].date=a.date,b[0].name=a.name,b[0].version=a.version;else{this._localProjects.splice(0,0,a);while(this._localProjects.length>this.LS_PROJECTS_LIMIT){var c=this._localProjects[this._localProjects.length-1].id;this.deleteLocalProject(c),this._localProjects.splice(this._localProjects.length-1,1)}}}var d=this.serializeLocalProjects(this._localProjects);if(this.hasLocalStorage())try{window.localStorage.setItem(this.LS_PROJECTS_INFO_KEY,d)}catch(e){console.error("Error writing to local storage (limit probably reached)")}},hasLocalStorage:function(){try{return localStorage.setItem("moqups-dummy","moqups-dummy"),localStorage.removeItem("moqups-dummy"),!0}catch(a){return!1}},showRecoveryDialog:function(){if(FDBK.config("projectManagement.recovery.enabled")&&this.hasLocalStorage()){var a=this._localProjects;this.$projectsRecoveryDialog.empty().append(this.$projectsRecoveryTmpl.loc_tmpl({projects:a})),FDBK.openModal("#projects-recovery-dialog","recovery")}else FDBK.buildHash()},deserializeLocalProjects:function(a){if(a)try{return JSON.parse(a)}catch(b){}return[]},serializeLocalProjects:function(a){return JSON.stringify(a)},localProject:function(a){return this.hasLocalStorage()?window.localStorage.getItem("project:"+a):null}}),FDBK.defaultProjects.emptyProject={name:FDBK.loc("_Untitled Project"),mockups:[{name:FDBK.loc("_Untitled Page"),stageWidth:960,stageHeight:700,stencils:[]}],font:"font-sans"},FDBK.defaultProjects.sampleProject={name:FDBK.loc("_Quick Introduction to Moqups"),stageWidth:960,stageHeight:700,mockups:[{id:"a16b2c2a4",name:"Playground",stageWidth:960,stageHeight:700,stencils:[{text:"Need more help? Press F1",inspectables:{color:"#ffffff",font_size:14,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:705,top:466,width:168,height:18,id:"a16b2c2a4-107"},{text:"We've tried to make things simple and fairly intuitive so you can unleash your creativity without any obstacles.",inspectables:{color:"#000000",font_size:"14",text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:105,width:785,height:22,id:"a16b2c2a4-104"},{text:"Stencils are objects that mimic various user interface elements. We have plenty of them and we'll keep adding more to cover various needs.",inspectables:{color:"#232323",font_size:16,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:309,width:768,height:40,id:"a16b2c2a4-102"},{text:"Some stencils have **editable content** and others have **configurable properties** like color, shape,\nstates, etc. There are stencils that don't have configuration options or they can't be edited at all.\nFeel free to play around with them to discover who's who.",inspectables:{color:"#232323",font_size:16,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:354,width:768,height:60,id:"a16b2c2a4-101"},{text:"",inspectables:{bg:"#ffffff",stroke:"#444444",stroke_width:"2",stroke_style:"solid",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:294,width:800,height:130,id:"a16b2c2a4-100"},{text:"Moqups is a nifty HTML5 App used to create wireframes, mockups or UI concepts,\nprototypes depending on how you like to call them.\n",inspectables:{color:"#000000",font_size:18,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:55,width:768,height:40,id:"a16b2c2a4-97"},{text:"This is a bit tricky to master until you get a hold of it.",inspectables:{color:"#444444",bg:"#fefce0",stroke:"#444444",direction:"top-left"},type:"stencil",name:"tmplsvg-tooltip",version:"1.0",left:385,top:216,width:374,height:48,id:"a16b2c2a4-95"},{text:"Select and click again to configure",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-settings",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:385,top:181,width:290,height:32,id:"a16b2c2a4-94"},{text:"Click to select",inspectables:{color:"#000000",fill_color:"#ffd783",stroke_color:"#000000",icon:"",orientation:"back"},type:"stencil",name:"tmplsvg-ios-button",version:"1.0",left:250,top:181,width:120,height:32,id:"a16b2c2a4-93"},{text:"Double click to edit",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-file-edit",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:690,top:181,width:190,height:32,id:"a16b2c2a4-92"},{x:76,y:407,text:"undo/redo all your changes",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:560,width:226,height:23,id:"a16b2c2a4-90"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-undo",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:559,width:24,height:24,id:"a16b2c2a4-89"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-file",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:604,width:24,height:24,id:"a16b2c2a4-87"},{x:76,y:407,text:"and much more to discover...",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:605,width:237,height:23,id:"a16b2c2a4-77"},{x:135,y:419,text:"export your mockups to PDF or PNG",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:605,width:302,height:23,id:"a16b2c2a4-88"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-check",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:604,width:24,height:24,id:"a16b2c2a4-74"},{x:76,y:407,text:"type anywhere to start searching stencils",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:515,width:350,height:23,id:"a16b2c2a4-61"},{x:664,y:175,text:"Quick tips:",inspectables:{color:"#ffffff",font_size:20,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:100,top:460,width:102,height:26,id:"a16b2c2a4-28"},{x:100,y:475,text:"",inspectables:{bg:"#606060",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:454,width:800,height:38,id:"a16b2c2a4-91"},{x:76,y:407,text:"upload your own custom images",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:566,top:515,width:264,height:23,id:"a16b2c2a4-47"},{x:135,y:379,text:"connect pages in your project with links",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:561,width:333,height:23,id:"a16b2c2a4-46"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-image",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:514,width:24,height:24,id:"a16b2c2a4-60"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-link",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:559,width:24,height:24,id:"a16b2c2a4-59"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-find",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:512,width:24,height:24,id:"a16b2c2a4-26"},{text:"",inspectables:{bg:"#c9f1fd",stroke:"#000000",stroke_width:"2",stroke_style:"dashed",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:40,width:800,height:100,id:"a16b2c2a4-99"},{text:"Icon",inspectables:{fill_color:"#aedd94",icon:"icon-circle-question",size:"128"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:170,width:94,height:94,id:"a16b2c2a4-103"}]}]},FDBK.defaultProjects.sampleProjectSans={name:FDBK.loc("_Quick Introduction to Moqups"),stageWidth:960,stageHeight:700,font:"font-sans",mockups:[{id:"a16b2c2a4",name:"Playground",stageWidth:960,stageHeight:700,stencils:[{text:"Need more help? Press F1",inspectables:{color:"#ffffff",font_size:14,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:695,top:468,width:168,height:18,id:"a16b2c2a4-107"},{text:"We've tried to make things simple and fairly intuitive so you can unleash your creativity without any obstacles.",inspectables:{color:"#000000",font_size:"14",text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:105,width:785,height:22,id:"a16b2c2a4-104"},{text:"Stencils are objects that mimic various user interface elements. We have plenty of them and we'll keep adding more to cover various needs.\n\nSome stencils have **editable content** and others have **configurable properties** like color, shape, states, etc.\nThere are stencils that don't have configuration options or they can't be edited at all.\n\nFeel free to play around with them to discover who's who.",inspectables:{color:"#232323",font_size:16,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:304,width:783,height:125,id:"a16b2c2a4-101"},{text:"",inspectables:{bg:"#ffffff",stroke:"#444444",stroke_width:"2",stroke_style:"solid",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:290,width:800,height:140,id:"a16b2c2a4-100"},{text:"Moqups is a nifty HTML5 App used to create wireframes, mockups or UI concepts, prototypes\ndepending on how you like to call them.",inspectables:{color:"#000000",font_size:18,text_align:"left"},type:"stencil",name:"tmplsvg-text",version:"1.0",left:97,top:55,width:783,height:50,id:"a16b2c2a4-97"},{text:"This is a bit tricky to master until you get a hold of it.",inspectables:{color:"#444444",bg:"#fefce0",stroke:"#444444",direction:"top-left"},type:"stencil",name:"tmplsvg-tooltip",version:"1.0",left:395,top:211,width:374,height:48,id:"a16b2c2a4-95"},{text:"Select and click again to configure",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-settings",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:395,top:176,width:290,height:32,id:"a16b2c2a4-94"},{text:"Click to select",inspectables:{color:"#000000",fill_color:"#ffd783",stroke_color:"#000000",icon:"",orientation:"back"},type:"stencil",name:"tmplsvg-ios-button",version:"1.0",left:260,top:176,width:120,height:32,id:"a16b2c2a4-93"},{text:"Double click to edit",inspectables:{radius:4,color:"#000000",fill_color:"#f7f6f6",stroke_color:"#000000",icon:"icon-file-edit",dropdown:"",size:"16"},type:"stencil",name:"tmplsvg-button",version:"1.0",left:700,top:176,width:180,height:32,id:"a16b2c2a4-92"},{x:76,y:407,text:"undo/redo all your changes",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:561,width:226,height:23,id:"a16b2c2a4-90"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-undo",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:560,width:24,height:24,id:"a16b2c2a4-89"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-file",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:605,width:24,height:24,id:"a16b2c2a4-87"},{x:76,y:407,text:"and much more to discover...",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:565,top:606,width:237,height:23,id:"a16b2c2a4-77"},{x:135,y:419,text:"export your mockups to PDF or PNG",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:606,width:302,height:23,id:"a16b2c2a4-88"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-check",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:605,width:24,height:24,id:"a16b2c2a4-74"},{x:76,y:407,text:"type anywhere to start searching stencils",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:516,width:350,height:23,id:"a16b2c2a4-61"},{x:664,y:175,text:"Quick tips:",inspectables:{color:"#ffffff",font_size:20,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:97,top:461,width:93,height:26,id:"a16b2c2a4-28"},{x:100,y:475,text:"",inspectables:{bg:"#606060",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:455,width:800,height:38,id:"a16b2c2a4-91"},{x:76,y:407,text:"upload your own custom images",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:566,top:516,width:264,height:23,id:"a16b2c2a4-47"},{x:135,y:379,text:"connect pages in your project with links",inspectables:{color:"#232323",font_size:18,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-heading-one",version:"1.0",left:135,top:562,width:333,height:23,id:"a16b2c2a4-46"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-image",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:530,top:515,width:24,height:24,id:"a16b2c2a4-60"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-link",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:560,width:24,height:24,id:"a16b2c2a4-59"},{text:"Icon",inspectables:{fill_color:"#232323",icon:"icon-find",size:"24"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:513,width:24,height:24,id:"a16b2c2a4-26"},{text:"",inspectables:{bg:"#c9f1fd",stroke:"#000000",stroke_width:"2",stroke_style:"dashed",checked:"checked",border:"true"},type:"stencil",name:"tmplsvg-rect",version:"1.0",left:80,top:40,width:800,height:100,id:"a16b2c2a4-99"},{text:"Icon",inspectables:{fill_color:"#aedd94",icon:"icon-circle-question",size:"128"},type:"stencil",name:"tmplsvg-icon",version:"1.0",left:100,top:165,width:94,height:94,id:"a16b2c2a4-103"}]}]};var MODULE=function(a,b){var c=null,d=0,e=null,f=b("#project-export-status"),g=null,h=null,i={LOCAL:{url:FDBK.API.CALL_EXPORT_LOCAL,needsAuth:!1,id:"localexport",icon:"download",display:"My Computer",onSuccess:function(a){a.object.status=="success"&&a.object.url&&v(a.object.url),m(),c=null}},GOOGLE_DRIVE:{url:FDBK.API.CALL_EXPORT_GOOGLE_DRIVE,needsAuth:!0,id:"googledrive",icon:"googledrive",display:"Google Drive",onSuccess:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Export finished!"),message:FDBK.loc("_The project was exported to your Google Drive account."),buttons:[{text:FDBK.loc("_Close"),classes:"right"}]})}},DROPBOX:{url:FDBK.API.CALL_EXPORT_DROPBOX,needsAuth:!0,id:"dropbox",icon:"dropbox",display:"Dropbox",onSuccess:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Export finished!"),message:FDBK.loc("_The project was exported to your Dropbox account."),buttons:[{text:FDBK.loc("_Close"),classes:"right"}]})}}};a.showExport=function(){if(a.isUserLoggedIn())if(a.currentProject.isNew())a.saveProject(!0,function(){a.showExport()});else{if(c){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There is an export in progress. Please try again after it's finished."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]});return}FDBK.openModal("#export-dialog"),j()}else a.askForSession()};var j=function(){b("#export-pages .export-page").remove();var a=FDBK.library.currentProject.normalPages(),c=a.length;if(c<1)b("#export-no-pages").show(),b("#export-with-pages").hide();else{b("#export-no-pages").hide(),b("#export-with-pages").show(),c>1?b(".page-options").show():b(".page-options").hide();var d=function(b){for(var c=0;c<a.length;c++)if(a[c].id===b.id)return c;return-1};FDBK.library.currentMockup.isMaster||b("#export-pages").append(b("<option></option>").val(d(FDBK.library.currentMockup)+1).text("-- Current Page --").addClass("export-page"));for(var e=0;e<c;e++)b("#export-pages").append(b("<option></option>").val(e+1).text(e+1+". "+a[e].name).addClass("export-page"));b("#export-range-from").attr("max",utils.sanitize(c)),b("#export-range-to").attr("max",utils.sanitize(c)),b("#export-range-to").val(c),b("#export-type").change(function(){var a=b("#export-type option:selected");b(".export-state").hide();switch(b(a).val()){case"all":break;case"single":b(".export-state-single").show();break;case"range":b(".export-state-range").show()}}),b("#export-form .button").remove();for(var f in i){var g=i[f];b(".export-buttons").append('<a href="#" data-service="'+f+'" class="button simple start-export">'+'<img class="icon '+g.icon+'" src="'+FDBK.CSS_BASE_URL+'images/pixel.gif" alt="">'+g.display+"<a/>")}}};b("#export-form").on("click",".start-export",function(c){var d=b(c.currentTarget).data("service");h=i[d];var e=b(".export-format:checked").val(),f=b("#export-type option:selected").val(),g,j;f=="all"&&FDBK.library.currentProject.normalPages().length==1&&(f="single"),f=="single"?g=j=b("#export-pages option:selected").val():f=="range"&&(g=b("#export-range-from").val(),j=b("#export-range-to").val());var k;if(f=="all"||f=="range")k=FDBK.library.currentProject.name||"Untitled";else if(f=="single"){var l=FDBK.library.currentProject.normalPages()[Math.max(0,g-1)];k=l.name}else k="Untitled";e&&f&&a.exportProject(d,e,{name:k,range:f,startPage:g,endPage:j})}),a.exportProject=function(b,c,d){g=c;var e=i[b].url;i[b].needsAuth&&r();var h=d.name+" | "+d.range+" | "+d.startPage&&d.endPage?d.startPage+" -> "+d.endPage:"";FDBK.trackEvent("Export","Export "+c.toUpperCase(),h),f.text(FDBK.loc("_Export in progress...")).addClass("shown"),a.currentProject.isClean()?n(e,d):a.saveProject(!0,function(){n(e,d)}),FDBK.openConfirmDialog({heading:FDBK.loc("_Export Project"),message:FDBK.loc("_Please wait, your export request is being processed..."),buttons:[{text:FDBK.loc("_Export in the background"),classes:"close-modal"}]})};var k=function(){t();var b=function(a){a&&(f.text(FDBK.loc("_Export failed")).addClass("shown"),setTimeout(function(){f.removeClass("shown")},3e3),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error exporting your project. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]}),FDBK.unsub("session-check-result",b))};FDBK.sub("session-check-result",b),a.checkSession()},l=function(){m(),e=AppSeeds.Scheduler.create(u,[],this).repeat(FDBK.config("export.checkStatusInterval")).now()},m=function(){d=0,e&&e.stop()},n=function(b,d){b&&d&&FDBK.API.xhr(b,{urlParams:[g],data:{name:d.name,projectUniqueId:a.currentProject.uniqueId,range:d.range,startPage:d.startPage,endPage:d.endPage},contentType:"application/x-www-form-urlencoded",success:function(a){a.success?(a.object.authorizationUrl?(FDBK.openConfirmDialog({heading:FDBK.loc("_Export Project"),message:FDBK.loc("_Please wait, your export request is being processed..."),buttons:[{text:FDBK.loc("_Export in the background"),classes:"close-modal"},{text:FDBK.loc("_Cancel"),classes:"close-modal right cancel-auth-button",onClick:function(){f.removeClass("shown"),t(),m(),c=null}}]}),s(a.object.authorizationUrl)):t(),c=a.object.exportId,l()):k()},error:function(){k()}})},o,p,q=!1,r=function(){o=window.open("about:blank","Authorize","height=600,width=1000"),o.focus(),q=!1,p=AppSeeds.Scheduler.create(function(){if(!o||o.closed)q=!0,p.stop()}).repeat(1e3).now()},s=function(a){if(!o)return;try{o.location.href=a}catch(b){}window.focus&&o.focus()},t=function(a){if(!o)return;o.close(),o=null},u=function(){if(!c){k(),m();return}FDBK.API.xhr(FDBK.API.CALL_GET_EXPORT_STATUS,{data:{exportId:c},success:function(a){d=0;if(a.success&&a.object){a.object.status=="inprogress"&&b(".cancel-auth-button").hide(),q&&a.object.status=="auth_wait"&&(q=!1,m(),c=null,f.text(FDBK.loc("_Export failed")).addClass("shown"),setTimeout(function(){f.removeClass("shown")},3e3),FDBK.closeModal());if(a.object.status=="success")FDBK.closeModal(),h.onSuccess&&h.onSuccess(a),m(),f.text(FDBK.loc("_Export finished!")).addClass("shown"),setTimeout(function(){f.removeClass("shown")},3e3),c=null,t();else if(a.object.status=="fail"||a.object.status=="auth_fail")k(),m(),c=null,t()}else d+=1,d==3&&k()},error:function(){d+=1,d==3&&k()}})},v=function(a){b("[name=exportIframe]").remove();if(!a)return;a=FDBK.BASE_URL+a;var c=b('<iframe src="'+a+'" name="exportIframe"></iframe>');c.appendTo("body")};return a}(MODULE||{},jQuery),MODULE=function(a,b){function h(a){var c=utils.rgb2hex(b(a.currentTarget).css("backgroundColor"));e.is(":focus")||(f.css("backgroundColor",c),e.val((c+"").toUpperCase()))}function i(){e.is(":focus")||(f.css("backgroundColor",g),e.val((g+"").toUpperCase()))}function j(a){var b=e.val();if(a.shiftKey&&a.which>=48&&a.which<=57)return a.which==51&&b.indexOf("#")==-1?!0:!1;if(a.ctrlKey||a.metaKey||a.altKey)return!0;if(a.which>70&&a.which<91)return!1}function k(a){var h=e.val();h.length>0&&h[0]!="#"&&(h="#"+h,e.val(h));if(a.which==27){e.val((g+"").toUpperCase()).blur(),f.css("backgroundColor",g);return}if(a.which==13){h.length!=7&&h.length!=4&&(h=g),c.find("div").css("backgroundColor",h),c.trigger("change",h),l();return}f.css("backgroundColor",h),b("#colorPickerPanel").find("span").removeClass("selected"),d[g+""]&&d[g+""].addClass("selected")}function l(){b("#colorPickerPanel").hide("fade",100),b("#colorPickerPanel").off("mousemove","span",h),b("#colorPickerPanel").off("mouseout",".colorPicker",i),e.off("keydown",j),e.off("keyup",k),e.blur(),c=null}function m(){d={};var a=b("#colorPickerPanel").find("span"),c;for(var e=0;e<a.length;e++)c=utils.rgb2hex(b(a[e]).css("backgroundColor"))+"",d[c]=b(a[e])}function n(){$cp=b("#colorPickerPanel");var a=utils.optimalPopoverPosition(c,$cp);$cp.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(a.popoverTailClass),$cp.css({left:a.left,top:a.top,opacity:1})}var c=null,d=null,e=b("#colorCode"),f=b("#colorPickerPanel .colorPreview"),g=null;return b("#colorPickerPanel").on("click","span",function(a){b("#colorPickerPanel").find("span").removeClass("selected");var d=utils.rgb2hex(b(a.currentTarget).css("backgroundColor"));c.find("div").css("backgroundColor",d),c.trigger("change",d),g=d,l()}),b("#colorPickerPanel").on("color-picker",function(a,o){c=b(o),b("#colorPickerPanel").find("span").removeClass("selected"),b(o).is(c)&&b("#colorPickerPanel").is(":visible")?l():(b("#colorPickerPanel").on("mousemove","span",h),b("#colorPickerPanel").on("mouseout",".colorPicker",i),e.on("keydown",j),e.on("keyup",k),d||m(),g=utils.rgb2hex(c.find("div").css("backgroundColor")),e.val((g+"").toUpperCase()),f.css("backgroundColor",g+""),d[g+""]&&d[g+""].addClass("selected"),b("#colorPickerPanel").show("fade",100),c=b(o),n(),b("body").one("click",function(a){b(a.target).closest("#colorPickerPanel").length===0&&b("#colorPickerPanel").is(":visible")&&l()}))}),b("#applyColor").on("click",function(){var a=e.val();a.length!=7&&a.length!=4&&(a=g),c.find("div").css("backgroundColor",a),c.trigger("change",a),l()}),b("body").on("click",".color-picker",function(a){b("#colorPickerPanel").trigger("color-picker",a.currentTarget),a.stopImmediatePropagation()}),a.colorPicker={hide:l},a}(MODULE||{},jQuery),MODULE=function(a,b){var c=b("#inspector");return b("#iconPickerPanel").on("changeIcon",function(b,c){a.inspect(b,{icon:c})}),c.on("change","#color-text",function(b,c){a.inspect(b,{color:c})}),c.on("change","#size-text",function(c){a.inspect(c,{font_size:Math.max(6,parseInt(c.target.value,10)||0)}),b(this).blur()}),c.on("change","#line-height-text",function(c){a.inspect(c,{line_height:parseFloat(c.target.value)}),b(this).blur()}),c.on("change","#blokk-text",function(c){a.inspect(c,{blokk:b(c.target).is(":checked")?"true":"false"})}),c.on("change","#color-background",function(b,c){a.inspect(b,{bg:c})}),c.on("change","#color-stroke",function(b,c){a.inspect(b,{stroke:c})}),c.on("click","#inspectable_checked",function(b){a.inspect(b,{checked:b.currentTarget.checked?"checked":""})}),c.on("click","#inspectable_disabled",function(b,c){a.inspect(b,{disabled:b.currentTarget.checked?"checked":""})}),c.on("click",".tooltipTailButton",function(c,d){a.inspect(c,{direction:b(c.currentTarget).data("type")})}),c.on("click",".shapeTypeButton",function(c,d){a.inspect(c,{type:b(c.currentTarget).data("type")})}),c.on("click",".textAlignButton",function(c,d){a.inspect(c,{text_align:b(c.currentTarget).data("align")})}),c.on("change","input[name=inspectable_ios_switch]:radio",function(c){a.inspect(c,{checked:c.target.value=="true"?"checked":""}),b(this).blur()}),c.on("change","input[name=inspectable_avatar]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_ios_keyboard]:radio",function(c){a.inspect(c,{mode:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_window_type]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_ribbon]:radio",function(c){a.inspect(c,{type:c.target.value}),b(this).blur()}),c.on("change","input[name=inspectable_tab_bar]:radio",function(c){a.inspect(c,{mode:c.target.value}),b(this).blur()}),c.on("click",".buttonRadiusButton",function(c){a.inspect(c,{radius:b(c.currentTarget).data("type")})}),c.on("click","#inspectable_button_dropdown",function(b){a.inspect(b,{dropdown:b.currentTarget.checked?"true":""})}),c.on("click",".buttonOrientationButton",function(c){a.inspect(c,{orientation:b(c.currentTarget).data("type")})}),c.on("change","#inspectable_banner_size",function(c){if(c.target.value){var d=c.target.value.match(/(\d+)\*(\d+)/);a.inspect(c,{text:c.target.value,_width:d[1],_height:d[2]})}b(this).blur()}),c.bind("DOMNodeInserted",function(a){var c=b(a.target);c.hasClass("inspectableSlider")&&c.slider({value:c.data("val"),min:0,max:50})}),c.on("slidestart",".inspectableSlider",function(b){a.preventClearSelection(!0)}).on("slidestop",".inspectableSlider",function(b){a.preventClearSelection(!1)}).on("slidechange",".inspectableSlider",function(c){var d={},e=b(c.currentTarget).slider("value"),f=b(c.currentTarget).data("insp");d[f]=e,a.inspect(c,d)}),c.on("change","input[name=inspectable_iphone_orientation]:radio",function(b){var c=b.target.value,d,e;c=="portrait"?(d=250,e=491):(d=491,e=250),a.inspect(b,{orientation:b.target.value,_width:d,_height:e})}),c.on("change","input[name=inspectable_ipad_orientation]:radio",function(b){var c=b.target.value,d,e;c=="portrait"?(d=537,e=687):(d=687,e=537),a.inspect(b,{orientation:b.target.value,_width:d,_height:e})}),c.on("click","#inspectable_ios_menu_background",function(b){b.currentTarget.checked?a.inspect(b,{background:"true"}):a.inspect(b,{background:""})}),c.on("click","#inspectable-grid-header",function(b){b.currentTarget.checked?a.inspect(b,{header:"true"}):a.inspect(b,{header:""})}),c.on("click","#inspectable-grid-zebra",function(b){b.currentTarget.checked?a.inspect(b,{zebra:"true"}):a.inspect(b,{zebra:""})}),c.on("click","#inspectable-grid-sortable",function(b){b.currentTarget.checked?a.inspect(b,{sortable:"true"}):a.inspect(b,{sortable:""})}),c.on("click","#inspectable-grid-border",function(b){b.currentTarget.checked?a.inspect(b,{border:"true"}):a.inspect(b,{border:""})}),c.on("click","#inspectable-grid-vertical-lines",function(b){b.currentTarget.checked?a.inspect(b,{vertical_lines:"true"}):a.inspect(b,{vertical_lines:""})}),c.on("click","#inspectable-grid-horizontal-lines",function(b){b.currentTarget.checked?a.inspect(b,{horizontal_lines:"true"}):a.inspect(b,{horizontal_lines:""})}),c.on("change",".color-picker",function(c,d){var e=b(c.currentTarget).data("type");if(e){var f={};f[e]=d,a.inspect(c,f)}}),c.on("change","#inspectable_icon_size",function(c){a.inspect(c,{size:c.target.value,_width:parseInt(c.target.value),_height:parseInt(c.target.value)}),b(this).blur()}),c.on("change","#inspectable_icon_size_alt",function(c){a.inspect(c,{size:c.target.value}),b(this).blur()}),c.on("click","#inspectable_border",function(b){b.currentTarget.checked?a.inspect(b,{border:"true"}):a.inspect(b,{border:""})}),c.on("change","#inspectable-stroke-width",function(c){var d,e;b(c.currentTarget).data("type")=="horizontal"&&(d=c.target.value),b(c.currentTarget).data("type")=="vertical"&&(e=c.target.value),a.inspect(c,{stroke_width:c.target.value,_height:d,_width:e}),b(this).blur()}),c.on("change","#inspectable-stroke-style",function(c){a.inspect(c,{stroke_style:c.target.value}),b(this).blur()}),c.on("click",".lineTypeButton",function(c){var d=b(c.currentTarget);b(".lineModeButton").removeClass("active"),b("#line-"+d.data("type")+"-default").addClass("active"),b(".lineStencilButtonGroup").hide(),b("#line-inspector-button-"+d.data("type")).show(),a.inspect(c,{line_type:d.data("type"),line_mode:b(c.currentTarget).data("mode"),resize_mode:b(c.currentTarget).data("resize-mode")})}),c.on("click",".lineModeButton",function(c){a.inspect(c,{line_mode:b(c.currentTarget).data("mode"),resize_mode:b(c.currentTarget).data("resize-mode")})}),c.on("click",".lineMarkerButton",function(c){var d=b(c.currentTarget),e=b(c.currentTarget).data("marker-type"),f={};d.hasClass("pressed")?(d.removeClass("pressed"),f[e]="false"):(d.addClass("pressed"),f[e]="true"),a.inspect(c,f)}),c.on("click",".noteTypeButton",function(c){var d=b(c.currentTarget);a.inspect(c,{note_style:d.data("note-style")})}),c.on("change",".mockup-linking-list",function(c){var d=b(this).val(),e=d?{type:FDBK.OBJECT_LINK_TYPE_MOCKUP,ref:d}:null,f=b(this).data("stencil");a.linkStencil(f,{link:e},{undoable:!1}),b(this).blur()}),c.on("click","#inspectable_horizontal_arrow_menu_background",function(b){b.currentTarget.checked?a.inspect(b,{hide_arrow:"true"}):a.inspect(b,{hide_arrow:"false"})}),a}(MODULE||{},jQuery),MODULE=function(a,b){function e(){d=b("#svg-icon-library-webalys path");var a=d.get();for(var e=0;e<a.length-1;e++)c.push(a[e].getAttribute("id"))}function v(a){a=b(a),a.hasClass("allow-clear")?(s.show(),r.css("width","150px")):(s.hide(),r.css("width","200px")),h||D(),i=!0,q.on("mousemove",x),b("body").bind("keydown",B),b(document).on("mousedown",y),b(document).on("mouseup",z),r.on("keyup",A);var c=utils.optimalPopoverPosition(b(a),p);p.find(".popoverTail").removeClass("popoverTailDown popoverTailLeft popoverTailRight popoverTailNone").addClass(c.popoverTailClass),p.css({left:c.left,top:c.top,opacity:1}),p.show("fade",100),r.focus()}function w(){if(!i)return;p.hide("fade",100),q.off("mousemove",x),b("body").unbind("keydown",B),b(document).off("mousedown",y),b(document).off("mouseup",z),r.off("keyup",A),r.blur(),q.find("li").show(),n=null,i=!1,t="",r.val(""),q.animate({scrollTop:0},"fast")}function x(a){a.stopPropagation(),a.preventDefault();var c=b(a.target).closest(".iconListItem");c&&b(c)[0]!=b(k)[0]&&(b(k).removeClass("selected"),b(c).addClass("selected"),k=c,j=b(c).index())}function y(a){b(a.target).closest("#iconSearch")===0&&(a.stopPropagation(),a.preventDefault())}function z(a){if(b(a.target).closest("#iconSearch").length===0){var c=b(a.target).closest(".iconListItem"),d=b(a.target).closest(p).length===0;c.length>0&&(o=b(c).index(),C(),d=!0),b(a.target).attr("id")=="iconClear"&&(o=-1,C(),d=!0),a.stopPropagation(),a.preventDefault(),d&&w()}}function A(a){if(r.val()==t)return;f.length!=c.length&&E(),t=r.val();var d=q.find("li"),e,g,h,i=t.split(/[\s\W]+/i),l="(?:";for(var m=0;m<i.length;m++)i[m].length>0&&(m>0&&(l+="|"),l+=i[m].toLowerCase());l+=")+";for(var n=0;n<f.length;n++){e=f[n],h=!1;for(var o=0;o<e.length;o++){g=e[o];if(g.toLowerCase().match(l)){b(d[n]).show(),h=!0;break}}h||b(d[n]).hide()}var p=q.find("li:visible");b(k).removeClass("selected"),p?(b(p[0]).addClass("selected"),j=0,k=b(p[0])):j=-1}function B(a){var d=j,e=!1;a.which==37?(d-=1,e=!0):a.which==38?(d-=l,e=!0):a.which==39?(d+=1,e=!0):a.which==40?(d+=l,e=!0):a.which==13?j>=0&&(o=b(q.find("li:visible")[j]).index(),e=!0,C(),w()):a.which==27&&(e=!0,w()),e&&(a.stopPropagation(),a.preventDefault());var f=q.find("li:visible").length;if(d!=j&&d>=0&&d<c.length){b(k).removeClass("selected"),k=q.find("li:visible")[d],b(k).addClass("selected"),j=d;var h=Math.floor(j/l)*g,i=q.scrollTop();(i+q.height()-g<h||h<i)&&q.animate({scrollTop:h},"fast")}}function C(){if(o>=0){var a=F(o);b(u).empty().append(a),p.trigger("changeIcon",c[o])}else b(u).empty(),p.trigger("changeIcon","")}function D(){var a="";for(var b=0;b<c.length;b++){var d=c[b].replace("icon-","").replace("-"," ");a+='<li class="'+c[b]+' iconListItem" title="'+d+'">'+F(b)+"</li>"}q.append(a),h=!0,l=Math.floor(q.width()/g),m=Math.ceil(c.length/l)}function E(){f=[];var a,b;for(var d=0;d<c.length;d++){b=c[d].split("-"),a=[];for(var e in b)b[e]!="icon"&&a.push(b[e]);f[d]=a}}function F(a){return'<svg  xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16">'+b(d.get(a)).clone().outerHTML()+"</svg>"}var c=[],d;FDBK._SVGDefsLoaded?e():FDBK.sub("svg-defs-loaded",e);var f=[],g=30,h=!1,i=!1,j=-1,k=null,l=0,m=0,n=null,o=-1,p=b("#iconPickerPanel"),q=b("#iconList"),r=b("#iconSearch"),s=b("#iconClear"),t="",u;return b("body").on("click",".icon-picker",function(a){u=b(a.target).closest(".icon-picker"),v(u)}),a.iconPicker={showFrom:v,hide:w},a}(MODULE||{},jQuery),MODULE=function(a,b){function e(){b("#projects-dialog").html(b("#tmpl-projects").loc_tmpl({projects:c,user:FDBK.USER_DATA,baseUrl:FDBK.BASE_URL,activeProjects:a.getActiveProjectsCount(),limit:FDBK.getPlanProjectsLimit(),planName:FDBK.getCurrentPlanName,isPremium:FDBK.hasPremiumPlan()}))}function f(){if(!FDBK.library.isUserLoggedIn())FDBK.library.askForSession();else{FDBK.openModal("#new-project-dialog");var a=b("#new-project-dialog"),c=b("[name=create-privacy]");a.find("input[name=name]").focus(),a.find(".status").hide(),FDBK.allowPrivacy()?(c.filter("[value=private]").prop("checked",!0),a.find(".status.private").show()):(c.filter("[value=public]").prop("checked",!0),a.find(".status.public").show())}}function g(){if(a.isUserLoggedIn()){if(FDBK.allowSaveProject()){FDBK.openModal("#save-project-as-dialog");var c=b("#save-project-as-dialog").find("input[name=name]").val(k(a.currentProject.name));c.focus()[0].setSelectionRange(0,1e3)}}else a.askForSession()}function h(){b("#projects-dialog").find(".project.disabled").removeClass("disabled").find(".button").removeClass("disabled")}function i(c){var d=k(b("#"+c).find("h3 a").text());FDBK.showServerError({message:FDBK.loc(FDBK.loc("_Duplicating Project..."))});var e=function(b){b.success?a.getAllProjects():(FDBK.showServerError({message:FDBK.loc("_There was an error duplicating your project")}),h())},f=function(){FDBK.showServerError({message:FDBK.loc("_There was an error duplicating your project")}),h()};FDBK.API.xhr(FDBK.API.CALL_DUPLICATE_PROJECT,{data:{uniqueId:c,name:d},contentType:"application/x-www-form-urlencoded;",success:function(a){FDBK.config("projectManagement.useContentStreaming")?FDBK.API.xhr(FDBK.API.CALL_CLONE_PROJECT_CONTENT_STREAM,{BASE_URL:FDBK.WEB_SOCKET_URL,data:{newId:a.object.uniqueId,newName:d},contentType:"application/x-www-form-urlencoded;",urlParams:[c,"clone"],success:function(b){b.success?e(a):f()},error:function(){f()}}):e(a)},error:function(a){a.status===403?FDBK.showActiveProjectsAlert():f()}})}function j(b){a.currentProject&&!a.currentProject.isClean()?FDBK.openConfirmDialog({heading:FDBK.loc("_Open project"),message:FDBK.loc("_You have unsaved changes in current project."),buttons:[{text:FDBK.loc("_Save changes"),classes:"primary-action",onClick:function(){a.saveProject(!0,function(){a.fetchProject(b)}),a.autoSave&&a.autoSave.reset()}},{text:FDBK.loc("_Ignore"),onClick:function(){a.fetchProject(b)}},{text:FDBK.loc("_Cancel"),classes:"right close-modal"}]}):(FDBK.closeModal(),a.fetchProject(b))}function k(a){return a+" "+FDBK.loc("_Copy")}var c=null;a.$projectStructure=b("#project-structure"),a.currentProject=null,a.currentMockup=null,a.renderedMockups=[],a.lastSaveFailed=!1,a.ignoreAutoSaveErrors=!1,a.serviceClient=FDBK.config("projectManagement.useContentStreaming")?new FDBK.StreamingClient:null,a.saveFailed=function(c,d){a.lastSaveFailed=!0;var e=c?!1:a.ignoreAutoSaveErrors,f=function(c){c&&d=="session.user.not.matching"?(FDBK.CACHED_PROJECT=JSON.stringify(a.currentProject),FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There is a problem with your session. Please reload the page")})):e||(FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your changes. Please wait while we try again..."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"},{text:FDBK.loc("_Ignore"),classes:"right primary-action",onClick:function(){a.ignoreAutoSaveErrors=!0}}]}),FDBK.sub("project-saved",function(){a.lastSaveFailed=!1,b(".modal.active").length>0&&FDBK.closeModal()}),FDBK.unsub("session-check-result",f))};FDBK.sub("session-check-result",f),a.checkSession()},a.setMockupRendered=function(c,d){var e=a.renderedMockups.indexOf(c);d&&e==-1?a.renderedMockups.push(c):!d&&e!=-1&&(b("#"+c).empty(),a.renderedMockups.splice(e,1))},a.isMockupRendered=function(b){return a.renderedMockups.indexOf(b)!=-1},a.setProjectTitle=function(c){utils.setDocumentTitle(c),b("#current-project-name").text(c),a.updatePresencePrivacy()},a.appendMockupSVG=function(b){var c=a.getMockupSVG(b.id);b.isMaster?a.$svgObject.find("#grid").after(c):a.$svgObject.append(c)},a.moveMockupSVG=function(c){var d=b("#"+c.id);if(!d.length){console.error("Can't find mockup SVG!");return}c.isMaster?d.detach().insertAfter(a.$svgObject.find("#grid")):d.detach().appendTo(a.$svgObject)},a.convertCurrentPageToMaster=function(b){b=b||{},a.currentMockup.master&&b.merge&&a.mergeMasterIntoCurrentPage(),a.convertNormalToMasterPage(a.currentMockup.id)},a.convertCurrentPageToNormalPage=function(){a.convertMasterToNormalPage(a.currentMockup.id)},a.applyCurrentMasterToAllPages=function(){if(!a.currentMockup.isMaster){error.console("Current mockup is not a master");return}var b=a.currentMockup.id,c=a.currentProject.normalPages();for(var d=0;d<c.length;d++)a.setMasterForMockup(c[d].id,{master:b})},a.removeCurrentMasterFromAllPages=function(){a.removeMasterFromAllPages(a.currentMockup.id)},a.removeMasterFromAllPages=function(b){var c=a.currentProject.pagesForMaster(b);for(var d=0;d<c.length;d++)a.setMasterForMockup(c[d].id,{master:null})};var d;return FDBK.sub("master-edited",function(b){FDBK.library.currentMockup.master===b&&(d&&window.clearTimeout(d),d=window.setTimeout(function(){a.changeActiveMockup(a.currentMockup.id)},1e3))}),a.setMasterForCurrentPage=function(b){a.setMasterForMockup(a.currentMockup.id,{master:b})},a.mergeMasterIntoCurrentPage=function(){var c=a.currentProject.mockup(a.currentMockup.master),d=b.extend(!0,{},{stencils:c.stencils}).stencils;((function(a){var b=arguments.callee;a.forEach(function(a){a.id=null,a.type==="group"&&b.call(this,a.stencils)},this)})).call(this,d),a.currentMockup.undo.startGroup("Merge master in mockup"),a.setMasterForMockup(a.currentMockup.id,{master:null});var e,f,g=a.currentMockup.stencilList()[a.currentMockup.stencilList().length-1];for(var h=d.length-1;h>=0;h--)e=d[h],f=a.addStencilFinal({type:e.type,templateName:e.name,data:e}),g&&a.orderStencil(f.id,{after:g.id});a.currentMockup.undo.endGroup()},a.newPageWithCurrentMaster=function(){a.addMockup({props:{master:a.currentMockup.id}})},a.addMockupUI=function(c,d,e){a.appendMockupSVG(c);var f=a.getMockupListItemView(c,!0);if(e)f.appendTo(a.$projectStructure);else{f.hide();if(a.currentProject.size()>1&&a.$projectStructure.find("li.selected").length>0){var g=a.$projectStructure.find(".mockup-list-item"+(a.currentMockup?"[data-mockup="+a.currentMockup.id+"]":":last"));f.insertAfter(g)}else f.appendTo(a.$projectStructure);f.slideDown("fast",function(){d&&a.startRenameMockup(b(this))})}},a.copyMockup=function(c){var d=a.getMockupById(c);if(d){var e=b.extend(!0,{},d.propertiesToDuplicate(),{name:utils.uniqueName(d.name,a.currentProject.mockupList().map(function(a){return a.name})),duplicateFrom:d.id});a.addMockup({props:e,shouldRenameAfterCreating:!0})}},a.getMockupById=function(c){var d=null;return b.each(a.currentProject.mockups,function(a,b){b.id===c&&(d=b)}),d},a.sortMockups=function(){var c=a.$projectStructure.find(".mockup-list-item").map(function(a,c){return b(c).data("mockup")}).get();a.currentProject.sortMockups(c)},a.getActiveMockup=function(){return b("#"+a.currentMockup.id)},a.changeActiveMockup=function(c,d){var e=a.currentProject.mockup(c);a.$projectStructure.find("li[data-mockup="+c+"]").addClass("selected").siblings().removeClass("selected"),a.$svgObject.find(".mockup").attr("class","mockup").end(),b("#"+c).attr("class","mockup active-mockup"),e.master&&(a.isMockupRendered(e.master)||(a.setMockupRendered(e.master,!0),a.currentMockup=a.currentProject.mockup(e.master),a.renderCurrentMockup()),b("#"+e.master).attr("class","mockup active-master-mockup")),a.currentMockup=e,d!==!0&&!a.isMockupRendered(c)&&(a.setMockupRendered(c,!0),a.renderCurrentMockup()),a.setStageSize(),a.updateUndoButton(),a.updateRedoButton(),a.showSelection(),FDBK.pub("mockup-changed",a.currentMockup)},a.startRenameMockup=function(c){var d=a.currentProject.mockup(c.data("mockup"));b("<input type='text' class='mockup-name-edit-input' maxlength='255'/>").val(d.name).appendTo(c.addClass("editing").find(".mockup-name").hide().end()).focus().select()},a.endRenameMockup=function(b,c){if(!b.hasClass("editing"))return!1;var d=b.find(".mockup-name"),e=b.data("mockup");c&&a.updateMockupName(e,{value:c}),b.removeClass("editing").find(".mockup-name-edit-input").remove(),d.show(),FDBK.pub("renamed-mockup",{mockup:e,value:c})},a.endRenameAllMockups=function(){a.$projectStructure.find(".editing").each(function(c,d){var e=b(d);a.endRenameMockup(e,e.find(".mockup-name-edit-input").val())})},a.closeCurrentProject=function(){a.currentMockup&&(a.clearSelection(),a.$svgObject.find(".mockup").remove(),a.$projectStructure.empty(),a.currentProject=null,a.currentMockup=null,a.renderedMockups.length=0,a.setShareInterface()),FDBK.pub("close-project")},a.openProject=function(b,c){a.currentProject=new FDBK.Project(b,c);var d=a.currentProject;a.setProjectTitle(d.name);var e=d.mockupList();if(e.length===0)a.addMockup();else for(var f=0;f<e.length;f++)a.addMockupUI(e[f],!1,!0);a.changeActiveMockup(d.mockupList()[0].id),a.setShareInterface(),FDBK.pub("open-project")},FDBK.sub("open-project",function(){b("body").addClass("project-loaded").removeClass("project-loading")}).sub("close-project",function(){b("body").removeClass("project-loaded")}).sub("fetching-project",function(){b("body").addClass("project-loading")}),a._saveStatusSchedule=AppSeeds.Scheduler.create(function(){b("#project-save-status").removeClass("shown")}).delay(3e3),FDBK.sub("project-saved",function(){a.refreshAllProjects()}),FDBK.sub("project-sanity-check-passed",function(){b("#project-save-status").addClass("shown"),a._saveStatusSchedule.reset()}),a.initAutoSave=function(){FDBK.config("projectManagement.autoSave")&&a.isUserLoggedIn()&&(a.autoSave&&a.autoSave.stop(),a.autoSave=AppSeeds.Scheduler.create(a.saveProject,[!1],a).repeat(FDBK.config("projectManagement.autoSaveInterval")).now())},FDBK.sub("open-project",function(){FDBK.allowEditPages()?b(".edit-action").removeClass("disabled"):a.$projectStructure.find(".sort-handle").remove(),a.currentProject.readOnly&&b("#project-read-only-status").addClass("shown")}),FDBK.sub("close-project",function(){b(".edit-action").addClass("disabled"),b("#project-read-only-status").removeClass("shown")}),FDBK.sub("open-project project-saved",function(){FDBK.CACHED_PROJECT=JSON.stringify(a.currentProject)}),FDBK.sub("open-project user-logged-in",function(){a.initAutoSave()}),FDBK.sub("window-blur close-project",function(){a.autoSave&&a.autoSave.stop()}),FDBK.sub("window-focus",function(){a.autoSave&&a.autoSave.reset()}),a.hasProjectToRecover=function(){return a.hasLocalStorage()?window.localStorage.getItem("project"):!1},a.recoverProject=function(){if(a.hasLocalStorage()){var b=window.localStorage.getItem("project");b?FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project confirmation"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action",onClick:function(){try{a.closeCurrentProject(),a.openProject(JSON.parse(b))}catch(c){FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project failure"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]});return}FDBK.config("projectManagement.recovery.deleteAfterRecovery")&&window.localStorage.removeItem("project")}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project not found"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})}else FDBK.openConfirmDialog({heading:FDBK.loc("_Recover project heading"),message:FDBK.loc("_Recover project not supported"),buttons:[{text:FDBK.loc("_OK"),classes:"primary-action close-modal"}]})},a.saveRetryCount=0,a.saveRetryLimit=3,a.saveProject=function(b,c){if(a.currentProject&&!b&&a.currentProject.isClean()&&!a.lastSaveFailed)return;if(FDBK.config("projectManagement.useContentStreaming")){a.currentProject&&a.currentProject.isNew()?a.serviceClient.createProject(a.currentProject.toServerJSON()):a.serviceClient.saveAction(b);return}if(!FDBK.allowSaveProject())return;a.currentProject.isNew()?FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT,{data:JSON.stringify(a.currentProject.toServerJSON()),success:function(b){b.success&&b.object?(a.currentProject.uniqueId=b.object.uniqueId,a.setShareInterface(),a.saveProject(),c&&c()):a.checkSession()},error:function(a){a.status===403&&FDBK.showActiveProjectsAlert(!0)}}):(FDBK.API.xhr(FDBK.API.CALL_UPDATE_PROJECT_METADATA,{data:JSON.stringify(a.currentProject.getMetadataJSON()),success:function(b){b.success||a.checkSession()},error:function(){a.checkSession()}}),FDBK.API.xhr(FDBK.API.CALL_UPDATE_PROJECT_CONTENT,{data:{uniqueId:a.currentProject.uniqueId,jsonData:JSON.stringify(a.currentProject.getContentJSON())},contentType:"application/x-www-form-urlencoded",success:function(d){a.saveRetryCount=0,d.success?(c&&c(),FDBK.pub("project-saved")):a.saveFailed(b,d.message)},error:function(d){d.length>0&&d[0].status&&d[0].status+""=="408"&&a.saveRetryCount<a.saveRetryLimit-1?(a.saveRetryCount++,a.saveProject(b,c)):a.saveFailed(b)},crossdomain:!0}))},a.previewProject=function(c,d){c=c||a.currentProject,d=d===undefined?!0:d,c&&(c=b.extend(!0,{},c),d&&FDBK.buildHash("preview"+(a.currentProject&&a.currentProject.uniqueId?"/"+a.currentProject.uniqueId:"")),b("body").append('<iframe name="previewProject" id="previewProject" src="'+FDBK.PREVIEW_URL+'" width="100%" height="100%" frameborder="0"></iframe>'),b("#previewProject").load(function(){a.hasActivePreview=!0;var d=b("#previewProject").contents().find("#project-close-button");if(d.length){d.show().click(function(){return window.parent.FDBK.library.closePreview(),!1}),b(this).contents().find("#moqups").removeAttr("href");var e=this.contentWindow;c.ownerIsPremium=FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject(),e.FDBK.USER_DATA=b.extend(!0,{},FDBK.USER_DATA),e.FDBK.viewProject(c),a.currentMockup.isMaster||e.FDBK.switchToMockup(e.FDBK.library.currentProject.mockup(a.currentMockup.id)),e.focus()}else b(this).contents().find("body").css("text-align","center");b(this).contents().on("keydown",function(a){a.keyCode==27&&window.parent.FDBK.library.closePreview()})}))},a.closePreview=function(){if(!b("#previewProject").length)return;b("#previewProject").remove(),window.focus(),a.hasActivePreview=!1,FDBK.buildHash()},b(window).on("hashchange",function(){a.hasActivePreview&&a.closePreview()}),a.openProjectViewer=function(){var a=b("#share-url").val();a&&window.open(a)},a.getActiveProjectsCount=function(){var a=0;return b.each(c,function(b,c){c.permission!=="collab_edit"&&a++}),a},a.getAllProjects=function(d){var f=b("#projects-dialog");f.html(b("#tmpl-loading-projects").loc_tmpl()),FDBK.openModal("#projects-dialog"),d&&FDBK.showServerError({message:FDBK.loc("_Project not found.")}),FDBK.API.xhr(FDBK.API.CALL_GET_ALL_PROJECTS,{success:function(d){if(d.object){a.currentProject&&!a.currentProject.uniqueId&&d.object.splice(0,0,a.currentProject),c=d.object;var g=f.find(".server-errors :visible").text();e();if(a.currentProject){var h=f.find("#unsaved, #"+a.currentProject.uniqueId).addClass("current selected");FDBK.scrollToSelectedItem(b("#projects-list"),h.prevAll(".project").length,".project")}g&&g.length>0&&FDBK.showServerError({message:g})}}})},a.getArchivedProjects=function(){var a=b("#projects-dialog");a.html(b("#tmpl-loading-archived-projects").loc_tmpl()),FDBK.API.xhr(FDBK.API.CALL_GET_ARCHIVED_PROJECTS,{success:function(c){c.object&&a.html(b("#tmpl-archived-projects").loc_tmpl({projects:c.object,user:FDBK.USER_DATA,baseUrl:FDBK.BASE_URL,isPremium:FDBK.hasPremiumPlan()}))}})},a.refreshAllProjects=function(){b("#projects-dialog").is(":visible")&&a.getAllProjects()},a.selectPrevMockup=function(){if(a.currentProject){var b=a.currentProject.mockupList();if(b.length>0){var c=a.currentProject.indexOfMockup(a.currentMockup.id);if(c>0){var d=b[c-1].id;a.changeActiveMockup(d),FDBK.itemIsVisible(a.$projectStructure,c-1)||a.scrollToSelectedMockup()}}}},a.selectNextMockup=function(){if(a.currentProject){var b=a.currentProject.mockupList();if(b.length>0){var c=a.currentProject.indexOfMockup(a.currentMockup.id);if(c<b.length-1){var d=b[c+1].id;a.changeActiveMockup(d),FDBK.itemIsVisible(a.$projectStructure,c+1)||a.scrollToSelectedMockup()}}}},a.$projectStructure.sortable({axis:"y",containment:"parent",delay:200,distance:2,tolerance:"pointer",handle:".sort-handle",start:function(){a.endRenameAllMockups()},update:function(b,c){var d=c.item.data("mockup");a.changeMockupOrder(d,{index:c.item.index()})}}),a.newProject=function(){a.currentProject&&!a.currentProject.isClean()?FDBK.openConfirmDialog({heading:FDBK.loc("_Create new project"),message:FDBK.loc("_You have unsaved changes in current project."),buttons:[{text:FDBK.loc("_Save changes"),classes:"primary-action",onClick:function(){a.saveProject(!0,function(){f()}),a.autoSave&&a.autoSave.reset()}},{text:FDBK.loc("_Ignore"),onClick:function(){f()}},{text:FDBK.loc("_Cancel"),classes:"right close-modal"}]}):f()},b("#new-project-form").submit(function(){var c=b.extend(!0,{},FDBK.defaultProjects.emptyProject),d=b(this).serializeArray();c.name=FDBK.loc("_Untitled Project");for(var e=0;e<d.length;e++)d[e].value&&(c[d[e].name]=b.trim(d[e].value));return b(this).find("input[name=name]").val(""),FDBK.config("projectManagement.useContentStreaming")?(a.serviceClient.createProject(c,function(){var c=b("[name=create-privacy]:checked").val()==="private";a.changePrivacy(c)}),b("#project-meta-name").text(c.name),FDBK.closeModal()):(a.openProject(c),a.saveProject()),!1}),a.saveProjectAsCopy=function(){g()},b("#duplicate-project-form").submit(function(){var c=b.trim(b(this).find("input[name=name]").val());c.length===0&&(c=FDBK.loc("_Untitled Project"));if(FDBK.config("projectManagement.useContentStreaming")){var d=a.currentProject.toServerJSON();d.uniqueId=null,d.name=c,a.serviceClient.createProject(d),b("#project-meta-name").text(d.name)}else a.currentProject.name=c,a.currentProject.uniqueId=null,FDBK.pub("project-renamed"),a.saveProject(!0);return b(this).find("input[name=name]").val(""),FDBK.closeModal(),!1}),a.archiveProject=function(d){a.currentProject&&a.currentProject.uniqueId===d&&FDBK.pub("project-not-available"),FDBK.API.xhr(FDBK.API.CALL_ARCHIVE_PROJECT,{data:{uniqueId:d},success:function(f){if(f.success){var g=-1;b.each(c,function(a,b){b.uniqueId===d&&(g=a)}),g!==-1&&(c.splice(g,1),e(),a.currentProject&&a.currentProject.uniqueId===d&&a.closeCurrentProject(),b("#projects-list").find(".project").length||a.getAllProjects(),FDBK.showServerError({message:"Your project has been succesfully archived. You can find it under the Archived Projects tab."}))}else h()},error:function(){h()}})},a.restoreProject=function(c){var d=b("#projects-dialog");FDBK.API.xhr(FDBK.API.CALL_UNARCHIVE_PROJECT,{data:{uniqueId:c},success:function(e){e.success?(d.find("#"+c).remove(),b("#projects-list").find(".project").length||a.getArchivedProjects(),FDBK.showServerError({message:"Your project has been succesfully restored. You can find it under the Active Projects tab."})):h()},error:function(a){h(),a.status===403&&FDBK.showActiveProjectsAlert()}})},a.deleteProject=function(d){confirm(FDBK.loc("_Delete Project"))?FDBK.API.xhr(FDBK.API.CALL_DELETE_PROJECT,{data:{uniqueId:d},success:function(f){if(f.success){var g=-1;b.each(c,function(a,b){b.uniqueId===d&&(g=a)}),g!==-1?(c.splice(g,1),e(),b("#projects-list").find(".project").length||a.getAllProjects()):(b("#projects-dialog").find("#"+d).remove(),b("#projects-list").find(".project").length||a.getArchivedProjects()),a.currentProject&&a.currentProject.uniqueId===d&&a.closeCurrentProject()}else h()},error:function(){h()}}):h()},b(document).on("click",".projects-dialog .project",function(){b(this).siblings().removeClass("selected").end().addClass("selected")}),b("#projects-dialog").on("dblclick",".project",function(){var c=b(this).prop("id");a.currentProject.uniqueId===c?FDBK.closeModal():j(c)}).on("mouseup",".actions .button",function(){var c=b(this).data("action");if(!b(this).hasClass("disabled")&&c){var d=b(this).parents(".project").prop("id");FDBK.hideTooltip(),b(this).parents(".project").addClass("disabled").find(".button").addClass("disabled");switch(c){case"archive":a.archiveProject(d);break;case"restore":a.restoreProject(d);break;case"delete":a.deleteProject(d);break;case"edit":a.currentProject&&a.currentProject.uniqueId===d?FDBK.closeModal():j(d);break;case"duplicate":i(d)}}}).on("mousedown","h3 a",function(){var a=b(this).parents(".project").prop("id");b(this).parents(".project").hasClass("current")?FDBK.closeModal():a!="unsaved"&&j(a)}),a.fetchProjectContent=function(c,d){FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT,{urlParams:[c],success:function(c){c.object?(d.jsonData=JSON.parse(c.object.jsonData),a.openProject(d,!0),b("#project-save-status").removeClass("shown")):a.projectNotFound()},error:function(){a.projectNotFound()},crossdomain:!0})},a.fetchProject=function(c,d){a.closeCurrentProject(),FDBK.pub("fetching-project",c),FDBK.config("projectManagement.useContentStreaming")?FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT,{data:{uniqueId:c},contentType:"application/json;charset=UTF-8;",success:function(e){if(!e.object||!e.success){a.projectNotFound();return}e.object.jsonData=null,a.serviceClient.getProjectJSON(c,function(c,f){if(c){a.projectNotFound(c);return}for(var g in e.object)f[g]||(f[g]=e.object[g]);d?d():a.openProject(f,!0),b("#project-save-status").removeClass("saved")})},error:function(){a.projectNotFound()}}):FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT,{data:{uniqueId:c},contentType:"application/json;charset=UTF-8;",success:function(c){c.object?(a.openProject(c.object,!0),b("#project-save-status").removeClass("shown")):a.projectNotFound()},error:function(){a.projectNotFound()}})},a.projectNotFound=function(b){a.getAllProjects(!0),b&&FDBK.showServerError({message:b+". "+FDBK.loc("_Please contact us if the problem persists.")})},a.presence={tmplUser:b("#tmpl-presence-avatar"),$container:b("#presence"),$ghostContainer:b("#presence-ghost-wrapper"),currentUsers:[],colors:["#D5161B","#EA6012","#FEC311","#3C2886","#1679C3","#48B8BB","#156D49","#C44888","#332F8A","#B19A5F"],init:function(){FDBK.sub("presence-update-users",this.updateUsers,this),FDBK.sub("presence-user-selection",this.drawUserSelection,this),FDBK.sub("remote-stencil-update",this.updateStencilSelection,this),FDBK.sub("mockup-changed",this.clearAllUsersSelection,this)},updateUsers:function(a){var b=this.currentUsers,c=b.filter(function(b){return!a.filter(function(a){return a.username===b.username}).length}),d=a.filter(function(a){return!b.filter(function(b){return a.username===b.username}).length});c.forEach(this.removeUser,this),d.forEach(this.addUser,this)},addUser:function(a){if(this.user(a)||FDBK.USER_DATA&&FDBK.USER_DATA.userName===a.username)return;a.color=this.colors[this.currentUsers.length%this.colors.length],a.avatar=utils.gravatarImageURL(a.email,60),this.currentUsers.push(a);var c=b.loc_tmpl(this.tmplUser,a);this.$container.is(":not(:visible)")&&this.$container.show(),b(c).appendTo(this.$container),setTimeout(function(){b(c).addClass("visible")},0)},userDOM:function(a){return this.$container.find('[data-username="'+a.username+'"]')},user:function(a){return this.currentUsers.filter(function(b){return b.username===a.username})[0]},removeUser:function(a){var b=this.userDOM(a);b.removeClass("visible"),setTimeout(function(){b.remove()},200);var a=this.user(a);a&&this.currentUsers.splice(this.currentUsers.indexOf(a),1),this.currentUsers.length===0&&this.$container.fadeOut(),this.clearUserSelection(a.username)},clearAllUsersSelection:function(){this.$ghostContainer.empty()},clearUserSelection:function(a){this.$ghostContainer.find(".ghost-guide[data-username="+a+"]").remove()},updateStencilSelection:function(c){var d=a.currentMockup.stencil(c),e=b('.ghost-guide[data-stencil="'+c+'"]');d&&e&&e.css({top:d.top,left:d.left,width:d.width,height:d.height})},drawUserSelection:function(c,d,e){var f=this.user({username:d}),g=f?f.color:"transparent";this.clearUserSelection(d);for(var h=0;h<e.length;h++){var i=a.currentMockup.stencil(e[h]);i&&b("<div class='ghost-guide' data-username='"+d+"' data-stencil='"+i.id+"'></div>").css({top:i.top,left:i.left,width:i.width,height:i.height,"border-color":g,"border-style":"dotted"}).appendTo(this.$ghostContainer)}}},a.presence.init(),a.updatePresencePrivacy=function(){var c=b("#presence-wrapper");c.find(".privacy").hide(),a.currentProject.isPublic?c.find(".public").show():c.find(".private").show()},a}(MODULE||{},jQuery),MODULE=function(a,b){function f(){FDBK.showServerError({message:'Collaborative editing is not available for your plan. <a href="#" class="open-dialog" data-dialog="plans-pricing">Upgrade Now!</a>',style:"upgrade"})}function g(a){b("#invite-buttons, #default-collab-buttons, #unsaved-collab-buttons").hide(),b("#collaborators").removeClass("share-mode"),b(a).show()}function h(){d.isPrivate=!a.currentProject.isPublic,d.isOwner=FDBK.library.currentProject.canChangeCollaborators(),b("#share-settings-dialog").html(b("#tmpl-share").loc_tmpl({projectRights:d,shareSettings:c})),i(),j(),k(),g("#default-collab-buttons"),FDBK.API.xhr(FDBK.API.CALL_GET_COLLABORATORS,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId},success:function(a){if(!a.success||!a.object)p();else{e=[];for(var b=0;b<a.object.length;b++){var c=a.object[b],d={email:c.email,name:c.fullName,permission:c.permission,gravatar:utils.gravatarImageURL(c.email),currentUser:c.email===FDBK.USER_DATA.email};e.push(d)}j()}},error:function(){p()},traditional:!0})}function i(){b("#privacy-settings").html(b("#tmpl-privacy-settings").loc_tmpl({projectRights:d,project:FDBK.library.currentProject,user:FDBK.USER_DATA,baseUrl:FDBK.BASE_URL}))}function j(){var a=e.sort(function(a,b){return a.permission=="owner"?-1:b.permission=="owner"?1:a.currentUser?-1:b.currentUser?1:0});b(".collaborators").html(b("#tmpl-collaborators").loc_tmpl({projectRights:d,collaborators:a}))}function k(){b("#email-settings").html(b("#tmpl-email-settings").loc_tmpl({shareSettings:c}))}function l(a){var d=/\s*,\s*/,f=a.replace(/\n\r?/g,",").split(d),g=/^.+@.+$/i,h=[];for(var i=0;i<f.length;i++){f[i]=b.trim(f[i]);if(f[i]!==""&&g.test(f[i])){var j={email:f[i],name:null,permission:c.permission,currentUser:!1,gravatar:utils.gravatarImageURL(f[i])};m(f[i])<0&&e.push(j),h.push(j)}}return h}function m(a){var c=-1;return b.each(e,function(b,d){d.email==a&&(c=b)}),c}function n(b,c){e[m(b)].permission=c,c=c.replace("collab_",""),FDBK.API.xhr(FDBK.API.CALL_UPDATE_COLLABORATOR,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,emails:b,level:c},success:function(a){a.success||p(),FDBK.pub("changed-collaborators")},error:function(){p()},traditional:!0})}function o(b){e.splice(m(b),1),j(),FDBK.API.xhr(FDBK.API.CALL_REMOVE_COLLABORATOR,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,emails:b},success:function(a){a.success||p(),FDBK.pub("changed-collaborators")},error:function(){p()},traditional:!0})}function p(a){a=a||FDBK.loc("_Oops. Something went wrong. Please try again."),FDBK.showServerError({message:a,style:"error"})}var c={sendEmail:!0,customMessage:!1,customMessageText:"",sendCopy:!1,permission:"collab_view"},d={isPrivate:!1,isOwner:!1},e=[];return a.setShareInterface=function(){var c=b("#share-url"),d=b(".share-action"),e=b("#open-project-viewer");if(FDBK.allowShareProject()){if(a.currentProject.uniqueId&&a.isUserLoggedIn()){var f=FDBK.viewURL();e.attr("href",f),c.val(f).prop("title",f).parent().show()}else e.attr("href","#"),c.val("").prop("title","").parent().hide();d.removeClass("disabled")}else d.addClass("disabled");FDBK.buildHash()},a.shareProject=function(){a.isUserLoggedIn()?a.currentProject.isNew()?a.saveProject(!0,function(){a.shareProject()}):(FDBK.openModal("#share-settings-dialog"),h()):a.askForSession()},FDBK.sub("project-changed open-project plan-updated",function(){c.permission=FDBK.allowCollaboration()?"collab_edit":"collab_view",e=[]}),b(document).on("click","[name=project-link]",function(){this.setSelectionRange(0,1e3)}),b(document).on("focus","[name=emails]",function(){g("#invite-buttons"),b("#collab-options").show(),b("#collaborators").addClass("share-mode")}),b(document).on("click","#save-share",function(){var d=b("#collaborators").find("[name=emails]"),f=l(d.val());j(),d.val(""),g("#default-collab-buttons"),b("#collab-options").hide();if(f.length>0){var h="";for(var i=0;i<f.length;i++)h+=f[i].email,i!=f.length-1&&(h+=", ");var k={projectUniqueId:a.currentProject.uniqueId,emails:h,level:c.permission,sendEmail:c.sendEmail};k.level=k.level.replace("collab_",""),c.sendEmail&&(k.sendCopyToMe=c.sendCopy),c.customMessage&&(c.customMessageText=b.trim(b("[name=custom-message]").val()),k.customMessage=c.customMessageText),FDBK.API.xhr(FDBK.API.CALL_ADD_COLLABORATORS,{contentType:"application/x-www-form-urlencoded",data:k,success:function(a){if(a.success&&a.object){for(var c=0;c<a.object.length;c++){var d=m(a.object[c].email);if(d<0)continue;e[d].name=a.object[c].fullName,e[d].gravatar=utils.gravatarImageURL(a.object[c].email),e[d].permission=a.object[c].permission}j(),FDBK.pub("changed-collaborators"),FDBK.showServerError({message:FDBK.pluralize("_Project was shared with new collaborators",f.length)}),b("#collaborators-list").scrollTop(b("#collaborators-list")[0].scrollHeight)}else p()},error:function(){p()},traditional:!0})}}),b(document).on("click","#cancel-share",function(){g("#default-collab-buttons"),b("#collab-options").hide()}),b(document).on("click","#cancel-changes",function(){g("#default-collab-buttons")}),b(document).on("click","#save-changes",function(){g("#default-collab-buttons")}),b(document).on("click","#collaborators [data-action=delete]",function(){var a=b(this).parents(".collaborator").data("email");FDBK.allowCollaboration()?confirm(FDBK.loc("_Are you sure you want to remove this collaborator?"))&&o(a):o(a),FDBK.hideTooltip()}),FDBK.sub("action-clicked",function(a){var b;a.$action.hasClass("permission")?(b=a.$action.data("permission"),b=="collab_edit"&&!FDBK.allowCollaboration()?f():(a.$dropdown.data("permission",b),b=="collab_view"?a.$dropdown.find(".button span").text("Can View"):a.$dropdown.find(".button span").text("Can Edit"),n(a.$dropdown.parents(".collaborator").data("email"),b))):a.$action.hasClass("bulk-permission")&&(b=a.$action.data("permission"),b=="collab_edit"&&!FDBK.allowCollaboration()?f():(a.$dropdown.data("permission",b),c.permission=b,b=="collab_view"?a.$dropdown.find(".button span").text("Can View"):a.$dropdown.find(".button span").text("Can Edit")))}),b(document).on("change","[name=create-privacy]",function(){var a=b("[name=create-privacy]"),c=b("[name=create-privacy]:checked").val()==="private",d=b("#new-project-dialog");d.find(".status").hide(),c?FDBK.allowPrivacy()?d.find(".status.private").show():(d.find(".status.public").show(),a.filter("[value=public]").prop("checked",!0),FDBK.showServerError({message:'This feature requires a premium subscription.<br/><a href="#" class="open-dialog" data-dialog="plans-pricing">Upgrade Now!</a>',style:"upgrade"})):d.find(".status.public").show()}),b(document).on("change","[name=privacy]",function(){var c=b("[name=privacy]"),e=b("[name=privacy]:checked").val()==="private";e?FDBK.allowPrivacy()?(d.isPrivate=e,i(),a.changePrivacy(d.isPrivate)):(c.filter("[value=public]").prop("checked",!0),FDBK.showServerError({message:'This feature requires a premium subscription.<br/><a href="#" class="open-dialog" data-dialog="plans-pricing">Upgrade Now!</a>',style:"upgrade"})):(c.filter("[value=private]").prop("checked",!0),confirm(FDBK.loc("_Are you sure you want to make this project public?"))&&(d.isPrivate=e,i(),a.changePrivacy(d.isPrivate),c.filter("[value=public]").prop("checked",!0)))}),a.changePrivacy=function(b){var c=b?"private_":"public_";if(!FDBK.library.currentProject)return;FDBK.API.xhr(FDBK.API.CALL_SET_PROJECT_PRIVACY,{contentType:"application/x-www-form-urlencoded",data:{projectUniqueId:a.currentProject.uniqueId,privacy:c},traditional:!0,success:function(a){a.success?(FDBK.library.currentProject.isPublic=!b,FDBK.library.updatePresencePrivacy()):p(),FDBK.pub("project-privacy-changed")},error:function(){p()}})},b(document).on("change","[name=send-email]",function(){c.sendEmail=b(this).is(":checked"),k()}),b(document).on("change","[name=send-copy]",function(){c.sendCopy=b(this).is(":checked")}),b(document).on("click",".toggle-custom-message",function(){var a=b("[name=custom-message]");a.length?(c.customMessageText=b.trim(a.val()),c.customMessage=!1):c.customMessage=!0,k()}),b(document).on("mousedown","#collaborators",function(a){b(a.target).closest(".dropdown-wrapper").length||FDBK.closeDropdowns()}),a}(MODULE||{},jQuery),MODULE=function(a,b,c,d){return a.getMockupListItemView=function(a,c){var d='<li class="mockup-list-item" data-mockup="'+utils.sanitize(a.id)+'">'+'<span class="page-is-master"'+(a.isMaster?"":'style="display:none"')+">M</span>"+'<span class="sort-handle" title="Drag to change page order">&#8801;</span>'+'<span title="'+utils.sanitize(a.name)+'" class="mockup-name ellipsis">'+utils.sanitize(a.name)+"</span>"+"</li>";return c?b(d):d},a.getMockupSVG=function(a){return b.parseXML('<svg xmlns="http://www.w3.org/2000/svg" id="'+utils.sanitize(a)+'" class="mockup"></svg>').childNodes[0]},a.renderStencil=function(a,e,f){if(!a)return;var g,h,i,j,k=f?"stencil-grouped":"stencil";switch(a.type){case"group":h=b.parseXML('<svg xmlns="http://www.w3.org/2000/svg"></svg>').childNodes[0],j=a.stencils,g=null,k+=" group";break;case"stencil":h=FDBK.getStencilDOM(a.name,a),j=null}i=d.add([h],e,!0),i.id=a.id,a.type=="group"&&(i.modelReference=a),i.setAttribute("width",a.width),i.setAttribute("measured-width",a.width),i.setAttribute("height",a.height),i.setAttribute("measured-height",a.height),i.setAttribute("x",a.left),i.setAttribute("y",a.top);if(j)for(var l=j.length-1;l>=0;l--)arguments.callee.call(this,j[l],i,!0);i.className.baseVal=k,a.type!="group"&&d().layout(i,!0);if(a.type!="group"){var m=c(i).measuredWidth();m>a.width&&!FDBK.VIEWER_MODE&&(a.width=m,FDBK.pub("collab-move-resize-stencil",a.id))}k+=" stencil-dom-optimizer";var n=FDBK.stencilTemplate(a.name);return n&&n.excludeFromPrint&&(k+=" exclude-from-print"),i.className.baseVal=k,a.locked&&b(i).prop("locked","true"),h=null,i},a.renderMockup=function(c,d){var e=a.getMockupSVG(c.id);d.append(e),d.find(".mockup").attr("class","mockup"),b("#"+c.id).attr("class","mockup active-mockup"),a.currentMockup=a.currentProject.mockup(c.id),a.renderCurrentMockup()},a.renderFallbackPNGMockup=function(a,b,c){var d;b?d="<img id='"+utils.sanitize(a.id)+"' class='mockup mockup-fallback-png' src='"+b+"'/>":d="<p id='"+utils.sanitize(a.id)+"' class='mockup fallback-not-available'>"+utils.sanitize(a.name)+": "+FDBK.loc("_Fallback image not available")+"</p>",c.append(d)},a.renderCurrentMockup=function(d){var e=a.currentMockup,f=b("#"+e.id);if(d&&FDBK.config("projectManagement.duplicateMockupMethod")==="dom-based"){var g,h=b("#"+d).clone().attr("id",utils.sanitize(e.id)).attr("class","mockup active-mockup").find(".stencil, .stencil-grouped").each(function(b,c){c.id=c.id.replace(d,e.id),g=a.currentMockup.stencil(c.id),g&&(g.locked&&(c.locked="true"),c.templateName=g.name)}).end();f.replaceWith(h)}else{var i=e.stencilList();f.attr("class","mockup active-mockup").append("<style id='reflow-optimization-style'>.stencil-dom-optimizer {display:none !important;}</style>");for(var j=i.length-1;j>=0;j--)var k=a.renderStencil(i[j],f);var l=document.getElementById("reflow-optimization-style");l.parentNode.removeChild(l);var m=b(f).find(".group").get().reverse();b(m).each(function(){var a=this,d=b(a).find(".stencil-grouped").get(),e=0;b(d).each(function(){e=Math.max(e,c(this).position().x+c(this).measuredWidth())}),a.setAttribute("width",e),a.setAttribute("measured-width",e);var f=e>a.modelReference.width;f&&!FDBK.VIEWER_MODE&&(a.modelReference.width=e,FDBK.pub("collab-move-resize-stencil",a.modelReference.id))})}},a}(MODULE||{},jQuery,svg,layout),MODULE=function(a,b){function g(b){if(typeof b!="undefined"&&b.length&&window.FormData){f.find("input").prop("disabled",!0),c=new FormData;for(var d=0;d<b.length;d++)c.append("images[]",b[d]);h(c)}a.resetUploadInput()}function h(b){e.find("span").text(FDBK.loc("_Uploading")).end().show(),d=new XMLHttpRequest,d.upload.onprogress=function(a){if(a.lengthComputable){var b=parseInt(a.loaded/a.total*100,10);e.find("span").text(FDBK.loc("_Uploading")+" "+b+"%")}},d.onload=function(){var b;try{b=JSON.parse(d.responseText)}catch(c){b={object:{errors:[]}}}if(b&&b.object&&b.object.errors){var g=b.object.errors.slice(),h="";if(g&&g.length){for(var j=0;j<g.length;j++)h+="<strong>"+g[j].filename+"</strong>"+" : "+FDBK.loc(g[j].error)+"<br/>";i(FDBK.loc("imageUploadErrorTitle"),h)}}else b&&!b.hasRight?FDBK.showUploadLimitAlert():(!b.object||!b)&&i(FDBK.loc("imageUploadTitle"),FDBK.loc("imageGenericError"));e.hide(),f.find(".done").show(),a.getAllImages(),d=null},d.open(FDBK.API.CALL_UPLOAD.type,FDBK.BASE_URL+FDBK.API.CALL_UPLOAD.url,!0),d.send(b)}function i(a,b){FDBK.openConfirmDialog({heading:a,message:b,buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}var c,d,e=b("#drop-zone").find(".progress"),f=b("#drop-zone");return e.on("click",function(){d&&(d.abort(),b(this).hide())}),b(document).on("mousedown",function(){a.uploadInputIsFocused&&a.resetUploadInput()}),b(document).on("dragover drop",function(a){a.originalEvent.dataTransfer&&(a.originalEvent.dataTransfer.effectAllowed="copy",a.originalEvent.dataTransfer.dropEffect="copy"),a.preventDefault()}),b(document).on("drop",function(c){if(c.originalEvent.dataTransfer){var d=c.originalEvent.dataTransfer.files;if(d.length)if(a.isUserLoggedIn()){var e=b("#tabs").find("[data-panel=images]");e.hasClass("active")||e.trigger("click"),g(d)}else a.askForSession()}}),b(document).on("click","#drop-zone input",function(){a.uploadInputIsFocused=!0}),b(document).on("change","#drop-zone input",function(){g(this.files)}),a.resetUploadInput=function(){f.find("input").remove().end().append('<input name="images" type="file" multiple="multiple">'),a.uploadInputIsFocused=!1},a.initImages=function(){var c=b("#all-images");c.hasClass("isotope")?c.isotope("destroy").empty():c.empty(),b("#tmpl-images").loc_tmpl({images:FDBK.CACHED_IMAGES,loggedIn:a.isUserLoggedIn(),constants:{IMAGE_BASE_URL:FDBK.ASSET_IMAGE_BASE_URL}}).appendTo("#all-images"),c.isotope({itemSelector:"li",layoutMode:"fitRows"}),d||(e.hide(),f.find(".done").hide())},a.getAllImages=function(){FDBK.library.isUserLoggedIn()?(f.removeClass("disabled").find("input").prop("disabled",!1),FDBK.API.xhr(FDBK.API.CALL_GET_ALL_IMAGES,{success:function(b){FDBK.CACHED_IMAGES=b.object.reverse(),a.initImages()},error:function(){}})):(f.addClass("disabled").find("input").prop("disabled",!0),a.initImages())},a.deleteImage=function(b){FDBK.library.isUserLoggedIn()&&FDBK.API.xhr(FDBK.API.CALL_DELETE_IMAGE,{data:{imageId:b},success:function(){a.getAllImages()}})},a}(MODULE||{},jQuery),MODULE=function(a,b){var c=!1,d=function(){return a.$ghost.hasClass("locked")},e="right left up down shift+right shift+left shift+up shift+down alt+right alt+left alt+up alt+down alt+shift+right alt+shift+left alt+shift+up alt+shift+down",f=function(b){var c,d,e=Number.MAX_VALUE,f=Number.MAX_VALUE;for(var g=0;g<a.currentMockup.selection.length;g++)c=a.currentMockup.selection[g],d=svg(c).position(),a.moveStencil(c,{top:d.y+b.top,left:d.x+b.left},{undoable:!1,forward:!1,updateModel:!1}),d.y<e&&(e=d.y),d.x<f&&(f=d.x);a.updateStencilTooltip("position",{left:f+b.left,top:e+b.top}),FDBK.library.$ghost.css({left:f+b.left,top:e+b.top})};return b(document).bind("keydown",e,function(e){if(a.isArea("stage")&&a.hasSelection()){if(e.altKey&&!c){var f=e.which==37?-10:e.which==39?10:0,g=e.which==38?-10:e.which==40?10:0;a.duplicateStencils(f,g),c=!0}if(!d()){for(var h=0;h<a.currentMockup.selection.length;h++){var i=a.currentMockup.selection[h];b(i).data("startPos")===undefined&&b(i).data("startPos",svg(i).position())}FDBK.library.$ghost.addClass("hide"),FDBK.pub("selection-transform","move","timer-start",a.currentMockup.selection)}return!1}}).bind("keyup",e,function(){if(a.isArea("stage")&&a.hasSelection()&&!d()){var e=a.currentMockup.selection[0];if(b(e).data("startPos")!==undefined){a.currentMockup.undo.startGroup("Move selection");for(var f in a.currentMockup.selection){var g=a.currentMockup.selection[f];a.moveStencil(g,{top:svg(g).position().y,left:svg(g).position().x},{undoable:!1}),a.showSelection(),a.currentMockup.undo.undoable("Move element by",a.moveStencil,[utils.stencilId(g),{left:b(g).data("startPos").x,top:b(g).data("startPos").y,comesFromUndoManager:!0}]),b(g).removeData("startPos")}a.currentMockup.undo.endGroup(),FDBK.library.$ghost.removeClass("hide")}return c=!1,!1}}).bind("keydown","shift+right alt+right alt+shift+right right",function(b){var c=b.shiftKey?10:1;if(a.hasSelection()&&a.isArea("stage")&&!d())return f({left:c,top:0}),!1}).bind("keydown","shift+left alt+left alt+shift+left left",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:-c,top:0}),!1}}).bind("keydown","shift+up alt+up alt+shift+up up",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:0,top:-c}),!1}}).bind("keydown","shift+down alt+down alt+shift+down down",function(b){if(a.hasSelection()&&a.isArea("stage")&&!d()){var c=b.shiftKey?10:1;return f({left:0,top:c}),!1}}),a}(MODULE||{},jQuery),MODULE=function(a,b){function i(a){var d=function(a,c){b("."+a).css({left:c.left,top:c.top})};switch(a){case g.HORIZONTAL:d(a,{left:c.position().left+c.outerWidth(),top:c.position().top});break;case g.VERTICAL:d(a,{left:c.position().left,top:c.position().top+c.outerHeight()});break;case g.CENTER:d(a,{left:c.position().left+c.outerWidth()-5,top:c.position().top+c.outerHeight()-5})}}function j(a){var d=b("."+a);switch(a){case g.HORIZONTAL:d.css({height:c.outerHeight()+"px"});break;case g.VERTICAL:d.css({width:c.outerWidth()+"px"});break;case g.CENTER:}}function k(a){b("#resize-tooltip-first").text("Width: "+a.width),b("#resize-tooltip-second").text("Height: "+a.height)}function l(a){var d=Math.max(0+c.position().left+10,a.pageX-c.offset().left-b(".resize-stencil-tooltip").width()),e=Math.max(0+c.position().top+10,a.pageY-c.offset().top-10);b(".resize-tooltip-wrapper").css({left:d,top:e})}var c=b("#htmlStage"),d=b("#grid"),e=b("#gridPattern"),f=b(".stage-resize-handle"),g={HORIZONTAL:"resize-horizontal",VERTICAL:"resize-vertical",CENTER:"resize-center"},h={};return a.enableStageResize=function(){f.show(),b.each(g,function(a,b){i(b),j(b)})},a.disableStageResize=function(){f.hide()},FDBK.sub("selection-transform",function(b,c,d){c==="start"?a.disableStageResize():c==="stop"&&FDBK.allowProjectSettings()&&a.enableStageResize()},a),FDBK.sub("open-project",function(){FDBK.allowProjectSettings()&&a.enableStageResize()}),FDBK.sub("close-project",function(){a.disableStageResize()}),f.draggable({distance:0,containment:[320,169,4e3,4e3],start:function(c,d){h={width:a.currentMockup.stageWidth,height:a.currentMockup.stageHeight},b(this).hasClass(g.HORIZONTAL)&&b("."+g.HORIZONTAL).draggable("option","axis","x"),b(this).hasClass(g.VERTICAL)&&b("."+g.VERTICAL).draggable("option","axis","y"),b(this).hasClass(g.CENTER)?b(this).draggable("option","containment",[310,159,4e3,4e3]):b(this).draggable("option","containment",[320,169,4e3,4e3]),b(".resize-tooltip-wrapper").show(),k({width:a.currentMockup.stageWidth,height:a.currentMockup.stageHeight}),l(c)},drag:function(d,e){var f={width:null,height:null};b(this).hasClass(g.HORIZONTAL)&&(f.width=e.position.left-c.position().left),b(this).hasClass(g.VERTICAL)&&(f.height=e.position.top-c.position().top),b(this).hasClass(g.CENTER)&&(f.width=e.position.left-c.position().left+10,f.height=e.position.top-c.position().top+10),a.setStageSize(f.width,f.height),k({width:f.width||a.currentMockup.stageWidth,height:f.height||a.currentMockup.stageHeight}),l(d)},stop:function(c,d){b(".resize-tooltip-wrapper").hide();var e=parseInt(b("#stage-width").val(),10),f=parseInt(b("#stage-height").val(),10);a.setUserSettings("stageSizeWidth",e),a.setUserSettings("stageSizeHeight",f),a.currentMockup.stageWidth=e,a.currentProject.stageWidth=e,a.currentMockup.stageHeight=f,a.currentProject.stageHeight=f,a.currentMockup.undo.undoable("Change Stage Size",a.setStageSize,[h.width,h.height,!0]),FDBK.pub("collab-update-stagesize",a.currentMockup.id)}}),a.setStageSize=function(e,f,g){g&&a.currentMockup.undo.undoable("Change Stage Size",a.setStageSize,[a.currentMockup.stageWidth,a.currentMockup.stageHeight,!0]),e&&g&&(a.currentMockup.stageWidth=e,a.currentProject.stageWidth=e),f&&g&&(a.currentMockup.stageHeight=f,a.currentProject.stageHeight=f),e=e||a.currentMockup.stageWidth,f=f||a.currentMockup.stageHeight,c.css({width:e,height:f}),b("#clear-selection").css({"min-height":f+40}),d[0].setAttribute("width",e),d[0].setAttribute("height",f),b("#stage-width").val(e),b("#stage-height").val(f),(e||f)&&g&&FDBK.pub("collab-update-stagesize",a.currentMockup.id),a.enableStageResize()},a.updateStageGrid=function(a,b){var c=e.children();for(var d=0;d<c.length;d++)d<=3?(c[d].setAttribute("y1",(d+1)*b),c[d].setAttribute("y2",(d+1)*b),c[d].setAttribute("x2",5*a)):d>3&&d<=7?(c[d].setAttribute("x1",(d-4+1)*a),c[d].setAttribute("x2",(d-4+1)*a),c[d].setAttribute("y2",5*b)):d==8?(c[d].setAttribute("x1",5*a),c[d].setAttribute("x2",5*a),c[d].setAttribute("y2",5*b)):(c[d].setAttribute("y1",5*b),c[d].setAttribute("y2",5*b),c[d].setAttribute("x2",5*a));e[0].setAttribute("width",5*a),e[0].setAttribute("height",5*b)},a}(MODULE||{},jQuery),MODULE=function(a,b){function e(b){var c=a.$ghost.data("resizable").options;b?(c.helper=null,c.resize=a.liveResizeFunction):(c.helper="ui-resizable-helper",c.resize=a.helperResizeFunction),a.$ghost.resizable("destroy"),a.$ghost.resizable(c)}function f(a){var c=b("#grid");a?c.show():c.hide()}function g(){var e=Math.min(Math.max(MIN_STAGE_WIDTH,b("#stage-width").val()),MAX_STAGE_WIDTH),f=Math.min(Math.max(c,b("#stage-height").val()),d),g=b("#grid-width").val(),h=b("#grid-height").val();if(e!=a.getUserSettings("stageSizeWidth")||f!=a.getUserSettings("stageSizeHeight")||g!=a.getUserSettings("gridSizeWidth")||h!=a.getUserSettings("gridHeight"))a.setStageSize(e,f,!0),a.snapoptions.setGrid(g,h),a.updateStageGrid(g,h),a.setUserSettings(["stageSizeWidth","stageSizeHeight","gridSizeWidth","gridHeight"],[e,f,g,h])}function h(c){c&&b(c.target).hasClass("project-title-input")?a.updateProjectName({value:b("#project-title-input").val()}):g()}function i(a){if(b(a.target).closest(".settings-dropdown").length&&b(a.target).hasClass("text-input")){if((a.which<48||a.which>57)&&a.which!==0&&a.which!=8&&a.which!=9&&a.which!=13&&a.which!=46)return!1;a.which==13&&h()}}var c=MIN_STAGE_WIDTH=100,d=MAX_STAGE_WIDTH=2e4;return b(document).on("click","#snap-grid-checkbox",function(){a.snapoptions.gridsystem()!==!1?(a.snapoptions.gridsystemSnapping=b(this).is(":checked"),a.setUserSettings("snapToGrid",b(this).is(":checked"))):a.snapoptions.gridEnabled()?(a.snapoptions.gridEnabled(!1),a.setUserSettings("snapToGrid",!1)):(a.snapoptions.gridEnabled(!0),a.setUserSettings("snapToGrid",!0))}),b(document).on("click","#snap-objects-checkbox",function(){var c=b(this).is(":checked");a.snapoptions.snap.snapToObjects=c,a.setUserSettings("snapToObjects",c)}),b(document).on("click","#smart-guides-checkbox",function(){var c=b(this).is(":checked");a.snapoptions.snap.showGuides=c,a.setUserSettings("showGuides",c)}),b(document).on("click","#live-resize-checkbox",function(){var c=b(this).is(":checked");a.setUserSettings("liveResize",c),e(c)}),b(document).on("click",".gridSettingsButton",function(){var c=b(this).data("type"),d=b("#snap-grid-checkbox").is(":checked");switch(c){case"hide-grid":b(".toggle-gridsystem").hide(),b(".grid-size-inputs").hide(),b("#snap-grid-checkbox").removeAttr("checked").closest("label").hide(),f(!1),a.setUserSettings(["gridVisible","gridsystemEnabled","snapToGrid"],[!1,!1,!1]),a.snapoptions.gridsystem(!1),a.snapoptions.gridEnabled(!1);break;case"show-grid":b(".toggle-gridsystem").hide(),b(".grid-size-inputs").show(),b("#snap-grid-checkbox").closest("label").show(),f(!0),a.setUserSettings(["gridVisible","gridsystemEnabled"],[!0,!1]),a.snapoptions.gridsystem(!1),a.snapoptions.gridEnabled(d);break;case"show-gridsystem":b(".toggle-gridsystem").show(),b(".grid-size-inputs").hide(),b("#snap-grid-checkbox").closest("label").show(),f(!1);var e=b(".gridSystemButton.active").data("type");a.setUserSettings(["gridVisible","gridsystemEnabled","selectedgridSystem"],[!1,!0,e]),a.snapoptions.gridsystem(e),a.snapoptions.gridEnabled(!1),a.snapoptions.gridsystemSnapping=d}}),b(document).on("click",".gridSystemButton",function(){var c=b(this).data("type");a.setUserSettings("selectedgridSystem",c),a.snapoptions.gridsystem(c)}),b("#project-settings").on("blur","input",h),b(document).on("keypress",i),FDBK.sub("open-project",function(){FDBK.allowProjectSettings()&&b("#open-settings").removeClass("disabled"),FDBK.allowSaveProject()&&b(".save-action").removeClass("disabled"),b("#project-title-input").val(a.currentProject.name)}),FDBK.sub("project-renamed",function(){b("#project-title-input").val(a.currentProject.name)}),FDBK.sub("close-project",function(){b("#open-settings").addClass("disabled"),b(".save-action").addClass("disabled")}),a.setGridVisible=f,a.setLiveResize=e,a}(MODULE||{},jQuery),MODULE=function(a,b){function f(c){b(c.target).closest("#contextMenu").length||a.hideContextMenu()}function g(){a.hasSelection()&&(i(),a.deleteSelection(),e=!0)}function h(){i(),e=!1}function i(){if(a.hasSelection()){c=a.currentMockup.id;var e=a.currentMockup.selection;d=[];function f(a){if(a.stencils&&a.stencils.length>0)for(var b=0;b<a.stencils.length;b++)a.stencils[b].id=null,arguments.callee(a.stencils[b])}for(var g=0;g<e.length;g++){item=e[g];var h=b.extend(!0,{},a.currentMockup.stencil(item.id));h.id=null,f(h),d.push(h)}}}function j(b,f,g){if(a.currentMockup&&d.length>0){a.currentMockup.id!=c&&(b=!0),f=f!==undefined?f:a.isSingleSelection()?0:10,g=g!==undefined?g:a.isSingleSelection()?svg(a.currentMockup.selection[0]).measuredHeight()+10:10,a.currentMockup.undo.startGroup("Paste"),a.currentMockup.selection=[];var h,j=[],k;for(var l=0;l<d.length;l++)h=d[l],b||(h.top+=g,h.left+=f),k=a.addStencilFinal({type:h.type,templateName:h.name,data:h}),j.push(k);a.currentMockup.selection=j,a.showSelection(),i(),a.currentMockup.undo.endGroup();var m=function(b){if(!b)return;if(b.link&&b.link.type=="mockup"){var c=a.currentProject.mockup(b.link.ref);c||(b.link=null)}if(b.type==="group"&&b.stencils)for(var d=0;d<b.stencils;d++)m(b.stencils[d])};for(var n in d){var o=a.currentMockup.stencil(n);m(o)}e=!1}}var c="",d=[],e=!1;return b("#contextMenu").on("click",".context-menu",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("type");switch(c){case"cut":g();break;case"copy":h();break;case"paste":j(e);break;case"duplicate":a.currentMockup&&(h(),j(e));break;case"delete":a.deleteSelection();break;case"edit":a.editor.enterEditMode();break;case"share":b("#open-share-preview").trigger("mousedown");break;case"hotspot":a.createHotspotsForStencils();break;case"linking":FDBK.showLinkInspectorForSelection()}a.hideContextMenu()}}),a.$projectWrapper.mouseup(function(c){if(c.button==2){if(b("#editArea").is(c.target))return;a.inspectorState.act("hide");var d=b("#contextMenu"),e=d.outerWidth(),g=d.outerHeight();d.find(".disabled").removeClass("disabled"),a.isSingleSelection()?svg(a.currentMockup.selection[0]).isEditable()||d.find(".editable").addClass("disabled"):d.find(".editable").addClass("disabled"),a.hasSelection()||d.find(".selection").addClass("disabled"),a.hasClipboardData()||d.find(".clipboard").addClass("disabled");var h=c.clientX+e>document.body.clientWidth?c.clientX-e:c.clientX,i=c.clientY>document.body.clientHeight/2?c.clientY-g:c.clientY,j=i+g-document.body.clientHeight;d.css({left:h,top:Math.max(j>0?i-j:i,5)}).fadeIn(50),b(document).on("mousedown",f),FDBK.pub("contextmenu-visible")}}).add("#contextMenu").bind("contextmenu",function(a){if(!b("#editArea").is(a.target))return!1}),a.hideContextMenu=function(){b("#contextMenu").hide(),a.isSingleSelection()&&a.inspectorState.act("show"),b(document).off("mousedown",f),FDBK.pub("contextmenu-hidden")},b(document).bind("keydown","meta+x ctrl+x",function(){if(a.isArea("stage"))return g(),!1}),b(document).bind("keydown","meta+c ctrl+c",function(){if(a.isArea("stage"))return h(),!1}),b(document).bind("keydown","meta+v ctrl+v",function(){if(a.isArea("stage"))return j(e),!1}),b(document).bind("keydown","meta+shift+v ctrl+shift+v",function(){if(a.isArea("stage"))return j(!0),!1}),b(document).bind("keydown","meta+d ctrl+d",function(){if(a.isArea("stage"))return a.currentMockup&&!a.$ghost.hasClass("locked")&&(h(),j(e)),!1}),a.hasClipboardData=function(){return d.length},a.duplicateStencils=function(b,c){a.currentMockup.undo.startGroup("Duplicate Stencils"),h(),j(!1,b,c),a.currentMockup.undo.endGroup()},a.cutStencils=g,a.copyStencils=h,a.pasteStencils=j,a}(MODULE||{},jQuery),MODULE=function(a,b){function c(c,d){var e;return b.each(d,function(b,d){var f=a.getSvgPoints(d);if(e!==undefined){if(c=="left"||c=="top")e=f[c]<e?f[c]:e;else if(c=="right"||c=="bottom")e=f[c]>e?f[c]:e}else e=f[c]}),e}function d(a,c,d){var e=0;return b.each(c,function(b,c){var d=svg(c).measuredWidth(),f=svg(c).measuredHeight();a=="horizontal"?e+=d:e+=f}),(d-e)/(c.length-1)}function e(a,c){var d;return a=a.charAt(0).toUpperCase()+a.substring(1),b.each(c,function(b,c){d!==undefined?d=svg(c)["measured"+a]()>svg(d)["measured"+a]()?c:d:d=c}),d}function f(b){var c=e("width",b);return a.getSvgPoints(c).left+svg(c).measuredWidth()/2}function g(b){var c=e("height",b);return a.getSvgPoints(c).top+svg(c).measuredHeight()/2}function h(d){if(a.hasSelection()&&d){var e=a.currentMockup.selection[0],h=function(){},i=0,j=0;switch(d){case"left":a.isMultiSelection()&&(i=c("left",a.currentMockup.selection)),h=function(b){j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"right":i=a.currentMockup.stageWidth-svg(e).measuredWidth();var k=c("right",a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(i=k-svg(b).measuredWidth()),j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"top":a.isMultiSelection()&&(j=c("top",a.currentMockup.selection)),h=function(b){i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})};break;case"bottom":j=a.currentMockup.stageHeight-svg(e).measuredHeight();var l=c("bottom",a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(j=l-svg(b).measuredHeight()),i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})};break;case"center":i=Math.ceil((a.currentMockup.stageWidth-svg(e).measuredWidth())/2);var m=f(a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(i=Math.ceil(m-svg(b).measuredWidth()/2)),j=svg(b).position().y,a.moveStencil(b,{top:j,left:i})};break;case"middle":j=Math.ceil((a.currentMockup.stageHeight-svg(e).measuredHeight())/2);var n=g(a.currentMockup.selection);h=function(b){a.isMultiSelection()&&(j=Math.ceil(n-svg(b).measuredHeight()/2)),i=svg(b).position().x,a.moveStencil(b,{top:j,left:i})}}a.currentMockup.undo.startGroup("Align selection"),b.each(a.currentMockup.selection,function(a,b){h(b)}),a.currentMockup.undo.endGroup(),a.showSelection()}}function i(e){if(a.isMultiSelection()){var f=a.currentMockup.selection.slice();e=="horizontal"?f.sort(function(a,b){return svg(a).position().x-svg(b).position().x}):e=="vertical"&&f.sort(function(a,b){return svg(a).position().y-svg(b).position().y});var g=c("left",a.currentMockup.selection),h=c("top",a.currentMockup.selection),i=c("bottom",a.currentMockup.selection),j=c("right",a.currentMockup.selection),k=e=="horizontal"?j-g:i-h,l=d(e,a.currentMockup.selection,k),m=0;switch(e){case"horizontal":m=g,a.currentMockup.undo.startGroup("Distribute selection horizontally"),b.each(f,function(b,c){var d=m,e=svg(c).position().y;a.moveStencil(c,{top:e,left:d}),m+=svg(c).measuredWidth()+l}),a.currentMockup.undo.endGroup();break;case"vertical":m=h,a.currentMockup.undo.startGroup("Distribute selection vertically"),f.sort(function(a,b){return svg(a).position().y-svg(b).position().y}),b.each(f,function(b,c){var d=svg(c).position().x,e=m;a.moveStencil(c,{top:e,left:d}),m+=svg(c).measuredHeight()+l}),a.currentMockup.undo.endGroup()}a.showSelection()}}function j(d){if(a.isMultiSelection()){var e=a.currentMockup.selection,f=c("left",a.currentMockup.selection),g=c("top",a.currentMockup.selection),h=0;switch(d){case"horizontal":a.currentMockup.undo.startGroup("Layout selection horizontally"),e.sort(function(a,b){return svg(a).position().x-svg(b).position().x}),b.each(e,function(b,c){var d=f+h+b*10,e=svg(c).position().y;a.moveStencil(c,{top:e,left:d}),h+=svg(c).measuredWidth()}),a.currentMockup.undo.endGroup();break;case"vertical":a.currentMockup.undo.startGroup("Layout selection vertically"),e.sort(function(a,b){return svg(a).position().y-svg(b).position().y}),b.each(e,function(b,c){var d=svg(c).position().x,e=g+h+b*10;a.moveStencil(c,{top:e,left:d}),h+=svg(c).measuredHeight()}),a.currentMockup.undo.endGroup();break;default:}a.showSelection()}}return b("body").on("click",".align",function(){h(b(this).data("type"))}),b("body").on("click",".distribute",function(){i(b(this).data("type"))}),b("body").on("click",".layout",function(){j(b(this).data("type"))}),a}(MODULE||{},jQuery),MODULE=function(a,b){function c(c,f){if(a.hasSelection()&&f){c=c.map(function(a){return utils.stencil(a)});var g=c.length,h,i;i=c.map(function(a){return utils.stencilId(a)});switch(f){case"forward":d(c,i);break;case"front":var j=b(c[g-1]).nextAll();if(j.length>0){a.currentMockup.undo.startGroup("send to front");for(h=0;h<j.length;h++)d(c,i);a.currentMockup.undo.endGroup("send to front")}else d(c,i);break;case"backward":e(c,i);break;case"back":var k=b(c[0]).prevAll();if(k.length>0){a.currentMockup.undo.startGroup("send to back");for(h=0;h<k.length;h++)e(c,i);a.currentMockup.undo.endGroup("send to back")}else e(c,i)}}}function d(c,d){var e=c.length,g=b(c[e-1]).next(),h,j=!1;g.length>0&&(a.currentMockup.undo.startGroup("send forward"),f(c[e-1].id,g[0].id,null),j=!0);if(e>1)for(i=e-2;i>=0;i--)h=b(c[i]).next()[0],h&&c[i+1]!=h&&(j||a.currentMockup.undo.startGroup("send forward"),f(c[i].id,null,c[i+1].id),j=!0);j&&a.currentMockup.undo.endGroup()}function e(c,d){var e=c.length,g=b(c[0]).prev(),h,j=!1;g.length>0&&(a.currentMockup.undo.startGroup("send backward"),f(c[0].id,null,g[0].id),j=!0);if(e>1)for(i=1;i<e;i++)h=b(c[i]).prev()[0],h&&(c[i-1]!=h||i===0)&&(j||a.currentMockup.undo.startGroup("send backward"),f(c[i].id,c[i-1].id,null),j=!0);j&&a.currentMockup.undo.endGroup()}function f(c,d,e){var g=b(utils.stencil(c)),h=g.prev(".stencil")[0],i=g.next(".stencil")[0];a.currentMockup.undo.undoable("Stack Stencil",f,[c,utils.stencilId(h),utils.stencilId(i)]),a.stackStencil(c,d,e)}function g(b,c,d){a.orderStencil(b,{before:c,after:d})}return b("body").on("click",".arrange",function(){c(a.currentMockup.selection,b(this).data("type"))}),b(document).on("keydown",null,"meta+up ctrl+up",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"forward"),!1}),b(document).on("keydown",null,"meta+shift+up ctrl+shift+up",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"front"),!1}),b(document).on("keydown",null,"meta+down ctrl+down",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"backward"),!1}),b(document).on("keydown",null,"meta+shift+down ctrl+shift+down",function(){if(a.isArea("stage"))return c(a.currentMockup.selection,"back"),!1}),a.stackStencil=g,a}(MODULE||{},jQuery),MODULE=function(a,b,c){function m(){return d||(e=null,f=null,b("#stencil-preview").remove(),b('<div id="stencil-preview"></div>').appendTo(b("body")),d=!0),b("#stencil-preview")}function n(b,c){var d=FDBK.library.addStencilFinal({type:"stencil",templateName:b.name},{undoable:!0,undoForwardable:!0,forward:!1});return d&&o(d,c),FDBK.pub("collab-add-stencil",d.id),a.focusStage(),d}function o(b,d){d=d||{};var e=a.defaultPosition();a.moveStencil(b,{top:d.top===undefined?e.top:d.top,left:d.left===undefined?e.left:d.left},{forward:!1,undoable:!1});switch(FDBK.config("stencilSidebar.stencilInitBehavior")){case"edit":c(b).isEditable()?a.editor.startEditing(b):a.selectElement(b,!0);break;case"inspect":a.selectElement(b,!0);break;case"select":a.selectElement(b)}}function p(c,d,e){var f=b(c).clone(),g=f[0],h=a.addStencilFinal({type:"stencil",templateName:"tmplsvg-image",data:{path:f.data("thumb"),width:f.data("width"),height:f.data("height")}},{undoable:!0,undoForwardable:!0,forward:!1});o(h,d),e&&(a.$projectWrapper[0].scrollLeft=d.left||0,a.$projectWrapper[0].scrollTop=d.top||0),a.currentMockup.updateStencil(h.id,{path:f.data("path")}),FDBK.pub("collab-add-stencil",h.id);var i=FDBK.ASSET_IMAGE_BASE_URL+f.data("path");g.src=i,g.onload=function(){b(h).children("image").attr("xlink:href",i)},a.focusStage()}function r(c){switch(c){case"stencils":h=b("#stencils"),i=b("#stencils-holder"),j.prop("placeholder",FDBK.loc("_Search stencils")),b("#image-upload").css("z-index",9);break;case"images":h=b("#image-list").find("ul"),i=b("#all-images"),j.prop("placeholder",FDBK.loc("_Search images")),FDBK.CACHED_IMAGES?a.initImages():a.getAllImages(),b("#image-upload").css("z-index",11)}a.focusArea="sidebar",j.val(""),l.hide(),h.find("li").removeClass("found"),h.isotope({filter:"*",getSortData:g}),t(),b("#search-icon").removeClass("has-search")}function s(c){var d="",e=b.trim(j.val()).toLowerCase();if((c.which<37||c.which>40)&&c.which!=27&&c.which!=13){h.find(".found").removeClass("found");var f=e.split(/[\s\W]+/),g="(?:";for(var i=0;i<f.length;i++)f[i].length>0&&(i>0&&(g+="|"),g+=f[i]);g+=")+";var k=RegExp(g,"gi");a.delayAction(function(){if(e!==""&&d!=e||d!==""&&e===""){var a=h.find("li"),c,f,g;for(var i=0;i<a.length;i++){c=b(a[i]),g=FDBK.stencilTemplate(c.find("a").data("id")),f=g&&g.tags?g.tags:"";var j=c.find("span").text().match(k),m=f.toLowerCase().match(k),n=c.find("span").text().split(/[\s\W]+/).length;if(j||m){var o=j?j.length*10:0;o+=m?m.length:0,o+=j&&j.length==n?100:0,c.data("order",o),c.addClass("found")}}h.isotope("updateSortData",h.find("li.found")),h.isotope({filter:".found",sortBy:"order",sortAscending:!1}),d=e,l.show(),b("#search-icon").addClass("has-search")}else e===""&&(l.hide(),h.find("li").each(function(a,c){b(c).data("order",a)}),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0}),b("#search-icon").removeClass("has-search"));t()},300)}}function t(){h.find("li").removeClass("selected");var a=h.find("li");a.filter(".found").length>0&&(a=a.filter(".found"),a.sort(function(a,b){return g.order(a)>g.order(b)?-1:g.order(a)<g.order(b)?1:0})),b(a[0]).addClass("selected"),i.animate({scrollTop:0},"fast")}function u(a){var c=h.find("li");c.filter(".found").length>0&&(c=c.filter(".found"),c.sort(function(a,b){return g.order(a)>g.order(b)?-1:g.order(a)<g.order(b)?1:0}));var d=0,e=Math.floor(h.width()/b(c[0]).outerWidth()),f=b(c[0]).outerHeight();for(var j=0;j<c.length;j++)if(b(c[j]).hasClass("selected")){d=j;break}var k=d;a==38?k=d-e:a==39?k=d+1:a==40?k=d+e:a==37&&(k=d-1),k=k<0?c.length-1:k>c.length-1?0:k;if(k!=d){b(c[d]).removeClass("selected"),b(c[k]).addClass("selected");var l=Math.floor(k/e)*f,m=i.scrollTop();(m+i.height()-f<l||l<m)&&i.animate({scrollTop:l},"fast")}}var d=!1,e,f;a.defaultPosition=function(a){if(a&&a==="images")return{left:0,top:0};var c=b("#project-wrapper")[0];return{left:20+c.scrollLeft,top:20+c.scrollTop}},FDBK.getAllStencilIconsDOM?b("#stencils").html(FDBK.getAllStencilIconsDOM()):console.error("Wrong order of JS files; module.stencilTemplates not loaded yet.");var g={order:function(a){return b(a).data("order")||0}},h=b("#stencils"),i=b("#stencils-holder"),j=b("#search-input"),k=b("#search-icon"),l=b("#clear-search");k.click(function(){j.focus()}),j.on("blur",function(){q=""}),l.click(function(){b(this).hide(),j.val("").focus(),h.find("li").each(function(a,c){b(c).data("order",a)}),b("#search-icon").removeClass("has-search"),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0})}),b("#stencils, #image-list").on("click","li",function(){b(this).addClass("selected").siblings().removeClass("selected")}),b(document).on("click",".delete-image",function(c){var d=b(this).parents("li").prop("id").split("-")[1];c.shiftKey?a.deleteImage(d):FDBK.openConfirmDialog({heading:FDBK.loc("_Delete image"),message:FDBK.loc("_Selected image will be deleted."),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){a.deleteImage(d)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})}),b(document).on("dblclick",".image-item",function(){if(FDBK.allowNewStencils()){var c=b(this).find("img").first()[0];p(c,a.defaultPosition("images"),!0)}}),b("#image-list").on("mouseenter",".image-item",function(){FDBK.allowNewStencils()&&b(this).draggable({distance:10,helper:m,snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,containment:"body",cursorAt:{left:0,top:0},scope:"#containment",stop:function(){d=!1,a.snapoptions.stop()},start:function(){b(this).click();var a=b(this).find("img").first().data("width"),c=b(this).find("img").first().data("height"),d=b(this).find("img").first().clone();d.prop("width",a).prop("height",c),f=d[0],b("#stencil-preview").append(d)}})}),b(document).on("dblclick",".stencil-item",function(){FDBK.allowNewStencils()&&n({name:b(this).find("a").data("id"),undoable:!0})}),b(".stencil-item").draggable({distance:10,helper:m,containment:"body",cursorAt:{left:0,top:0},snap:".none",customSnap:a.snapoptions.snap,snapTolerance:a.snapoptions.snap.snapTolerance,snapGrid:a.snapoptions.snapGrid,scope:"#containment",stop:function(){d=!1,a.snapoptions.stop()},start:function(){function f(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)c.setAttribute(d,b[d]);return c}b(this).click(),a.inspectorState.act("remove");var d={version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",id:"preview-svg"},g=b("#stencil-preview");g.append(f("svg",d));var h=b("#preview-svg"),i=b(this).find("a").data("id");e=a.addStencil({name:i,target:h,skipModel:!0}),g.css({width:c(e).measuredWidth(),height:c(e).measuredHeight()}).offset({top:0}),BrowserDetect.browser.toLowerCase()=="firefox"&&h.css({top:0}),c(e).position(0,0),h.css("width",c(e).measuredWidth()),(c(e).measuredHeight()>2||BrowserDetect.browser.toLowerCase()!="firefox")&&h.css("height",c(e).measuredHeight())}}).draggable("disable"),FDBK.sub("open-project",function(){FDBK.allowNewStencils()&&b(".stencil-item").draggable("enable")}),FDBK.sub("close-project",function(){b(".stencil-item").draggable("disable")}),b("#containment").droppable({tolerance:"pointer",scope:"#containment",drop:function(a,c){var d=b("#htmlStage").offset();c.position.left-=d.left,c.position.top-=d.top;if(e)n({name:b(e).attr("name"),undoable:!0},c.position);else if(f)var g=p(f,c.position)}});var q="";return b(document).bind("keydown","meta+f ctrl+f",function(){return a.isArea("stage")&&!j.is(":focus")&&(j.focus(),q=""),!1}),b(document).keyup(function(c){if(a.isArea("sidebar"))if(c.which>36&&c.which<41)u(c.which);else if(c.which==27)l.trigger("click"),q="";else if(c.which==13&&FDBK.allowNewStencils()){l.trigger("click");if(b("#tabs").find(".active").data("panel")=="stencils"){var d=h.find(".selected:not(.isotope-hidden)").find("a");d.length>0&&n({name:d.data("id"),undoable:!0})}else{var d=h.find(".selected:not(.isotope-hidden)").find("img").first()[0];d.length>0&&p(d,a.defaultPosition("images"),!0)}}else if(c.which>=65&&c.which<=90&&!c.ctrlKey&&!c.shiftKey&&!c.altKey&&!c.metaKey&&q!==""){var e=String.fromCharCode(c.which).toLowerCase(),f=j.val();f.length==2&&j.val(f+e)}else c.which==8&&(q="");else a.isArea("stage")&&a.editor.editingStencil===null&&b("input:focus").length===0&&(c.which>=65&&c.which<=90&&!c.ctrlKey&&!c.shiftKey&&!c.altKey&&!c.metaKey&&!j.is(":focus")?q!==""?(j.mouseup(),j.focus(),q+=String.fromCharCode(c.which).toLowerCase(),j.val(q),s({which:0})):q=String.fromCharCode(c.which).toLowerCase():q="")}),FDBK.sub("user-logged-in",function(){b("#tabs").find(".active").click()}),b("#tabs").find(".button").click(function(){var a=b(this).data("panel");h.find("li").each(function(a,c){b(c).data("order",a)}),h.isotope("updateSortData",h.find("li")),h.isotope({filter:"*",sortBy:"order",sortAscending:!0}),r(a)}),j.keyup(s),r("stencils"),a}(MODULE||{},jQuery,svg,layout);FDBK.mixinModule("ui-components",{initModule:function(){BrowserDetect.browser=="Firefox"&&$("html").addClass("autoHideScroll"),FDBK.$tooltip=$("<div id='button-tooltip'></div>").appendTo("body"),$(window).resize(function(){var a=$(".show-dropdown > .button")[0];a&&FDBK.openDropdown(a)}),$(document).on("mousedown",".button",function(){if($(this).hasClass("disabled"))return;$(this).parent().hasClass("show-dropdown")?FDBK.closeDropdowns():$(this).parent().hasClass("dropdown-wrapper")?FDBK.openDropdown(this):($(this).addClass("active"),$(this).siblings(".dropdown").length||(FDBK.$activeButton=$(this)))}).on("mouseup",function(a){$(a.target).closest(".action").length&&!$(a.target).closest(".disabled").length?(FDBK.pub("action-clicked",{$action:$(a.target).closest(".action"),$dropdown:$(".show-dropdown")}),FDBK.closeDropdowns()):!$(a.target).closest(".dropdown-wrapper").length&&!$(a.target).closest(".dropdown").length&&FDBK.closeDropdowns(),$(a.target).closest(".button")&&!$(a.target).closest(".button").siblings(".dropdown").length&&FDBK.$activeButton&&(FDBK.$activeButton.removeClass("active"),FDBK.$activeButton=null)}).on("hover",".button",function(){if($(this).hasClass("disabled"))return;if($(this).parent().hasClass("detached"))return;$(".show-dropdown").length&&$(this).parent().hasClass("dropdown-wrapper")&&document.activeElement.nodeName!=="INPUT"&&FDBK.openDropdown(this)}).on("click",".toggle-buttons .button",function(){$(this).siblings().removeClass("active").end().addClass("active")}).on("mouseenter",".button, .custom-title",function(){FDBK.showTooltip($(this))}).on("mouseenter",".menu-item",function(){$(this).parents(".dropdown").find(".menu-item").removeClass("selected"),$(this).addClass("selected")}).on("mouseleave",".button, .custom-title",function(){FDBK.hideTooltip()}).on("click","a",function(a){$(this).attr("href")==="#"&&a.preventDefault()})},showTooltip:function(a){var b=a.attr("title");if(!b||a.parent().hasClass("show-dropdown"))return;FDBK.activeTooltip=a.removeAttr("title").data("title",b),FDBK.$tooltip.html(utils.sanitize(b)+"<span></span>").css({top:a.offset().top+a.outerHeight()+6,left:a.offset().left+Math.ceil(a.outerWidth()/2)-Math.ceil(FDBK.$tooltip.outerWidth()/2)}).show()},hideTooltip:function(){FDBK.activeTooltip&&(FDBK.activeTooltip.attr("title",FDBK.activeTooltip.data("title")),FDBK.activeTooltip=null,FDBK.$tooltip.hide())},openDropdown:function(a){FDBK.closeDropdowns();var b=$(a).addClass("active").parent();b.addClass("show-dropdown");if(b.hasClass("detached")){var c=b.find(".dropdown").first().clone();c.css({top:b.offset().top+b.outerHeight()+2,left:b.offset().left}),c.appendTo("body")}FDBK.hideTooltip(),FDBK.pub("dropdown-shown",$(a).parent())},closeDropdowns:function(){var a=$(".show-dropdown");a.removeClass("show-dropdown").find(".menu-item").removeClass("selected").end().find(".button").each(function(a,b){$(b).closest(".dropdown-content").length===0&&$(b).removeClass("active")}),FDBK.pub("dropdown-close"),$("body > .dropdown").remove(),FDBK.pub("dropdown-close",a)},openModal:function(a,b){if(BrowserDetect.unsupportedBrowser)return;if(!a)return;FDBK.closeModal(),$("#overlay").show().find(a).addClass("active"),FDBK.buildHash(b),FDBK.pub("modal-opened",a)},closeModal:function(){var a=$("#overlay").find(".modal.active").first().prop("id");if(!a)return;a="#"+a,$("#overlay").hide().find(a).removeClass("active"),FDBK.cleanAllErrors(a),FDBK.buildHash(),FDBK.pub("modal-closed",a)},openConfirmDialog:function(a){var b=$('<h2 class="heading">'+(a.showCloseButton?'<a href="#" class="close-modal">Close</a>':"")+"<strong>"+(a.heading||"Confirm action")+'</strong></h2><div class="server-errors"></div>'),c=$('<div class="modal-content"><p style="padding-bottom:20px;">'+a.message+"</p>"+"</div>"),d=$('<div class="clearfix"></div>');a.buttons&&a.buttons.length&&$.each(a.buttons,function(a,b){var c=$('<a href="#" class="button simple '+b.classes+'">'+b.text+"</a>");c.on("click",function(){typeof b.onBeforeClick=="function"&&b.onBeforeClick(),FDBK.closeModal(),typeof b.onClick=="function"&&b.onClick()}),d.append(c)}),c.append(d);var e=$("#confirm-dialog");e.empty().append(b,c);var f=a.width||"400px";e.css("width",f),FDBK.openModal("#confirm-dialog")},buildHash:function(a){if(a&&"#!/"+a!=window.location.hash)window.location.hash="#!/"+a;else if(FDBK.library&&FDBK.library.currentProject&&FDBK.library.currentProject.uniqueId){var b=FDBK.library.currentProject;window.location.hash="#!/edit/"+(b.ownerUserName?b.ownerUserName+"/":"")+b.uniqueId}else window.location.hash&&(window.location.hash="#!/")},cleanAllErrors:function(a){$(".reset-input").val(""),$(a).find("p.error").remove().end().find(".error").removeClass("error"),FDBK.showServerError({selector:a})},cleanServerError:function(){var a=$("#overlay").find(".modal.active").first();a.length&&a.find(".server-errors").empty()},showServerError:function(a){var b=$("#overlay").find(".modal.active").first();a&&a.selector&&(b=$(a.selector)),b.find(".server-errors").empty(),a&&a.message&&b.find(".server-errors").append('<div class="message '+(a.style?a.style:"")+'">'+a.message+"</div>")}});var MODULE=function(a,b){function c(){b("#project-structure-dropdown").toggleClass("force-dropdown").toggleClass("show-dropdown")}function d(){var a=b("#overlay").find(".active").find(".close-modal");a.length&&!a.first().hasClass("ignore-key")&&FDBK.closeModal()}b(document).bind("keydown","pageup",function(){return a.selectPrevMockup(),!1}),b(document).bind("keydown","pagedown",function(){return a.selectNextMockup(),!1}),b(document).bind("keydown","up",function(){if(!a.isArea("stage")){FDBK.navigateByKey({steps:1,direction:"asc"},b(".show-dropdown").find(".menu-item"));if(a.$projectStructure.is(":visible"))return a.selectPrevMockup(),!1}}),b(document).bind("keydown","down",function(){if(!a.isArea("stage")){FDBK.navigateByKey({steps:1,direction:"desc"},b(".show-dropdown").find(".menu-item"));if(a.$projectStructure.is(":visible"))return a.selectNextMockup(),!1}}),a.$projectStructure.on("click","li",function(c){b(this).hasClass("selected")?b(c.target).closest(".mockup-name").length&&a.startRenameMockup(b(this)):(a.endRenameAllMockups(),a.changeActiveMockup(b(this).data("mockup")))}),a.$projectStructure.on("keyup",".mockup-name-edit-input",function(c){(c.keyCode===13||c.keyCode===27)&&a.endRenameMockup(b(this).parents(".mockup-list-item"),c.keyCode===13?b(this).val().trim():null)}),a.$projectStructure.on("blur",".mockup-name-edit-input",function(){a.endRenameMockup(b(this).parents(".mockup-list-item"),b(this).val().trim())}),b(document).on("click",".edit-action",function(d){if(!b(this).hasClass("disabled")){var e=b(this).data("action"),f=a.$projectStructure.find(".selected").data("mockup");if(e&&FDBK.allowEditPages())switch(e){case"new":a.addMockup({props:{},shouldRenameAfterCreating:!0});break;case"delete":f&&(a.currentProject.size()>1?a.currentMockup.isEmpty()||d.shiftKey?a.removeMockup(f):(c(),FDBK.openConfirmDialog({heading:FDBK.loc("_Delete page"),message:FDBK.loc("_Selected page will be deleted."),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){a.removeMockup(f)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})):(c(),FDBK.openConfirmDialog({heading:FDBK.loc("_Delete page"),message:FDBK.loc("_Last Page"),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal primary-action"}]})));break;case"duplicate":f&&(a.endRenameAllMockups(),a.copyMockup(f))}}}),FDBK.sub("modal-closed",function(){b(".force-dropdown").length&&c()}),b(document).on("click",".open-projects",function(){return a.getAllProjects(),!1}),b(document).bind("keydown","meta+o ctrl+o",function(){return a.getAllProjects(),!1}),b(document).on("click",".open-archive",function(){a.getArchivedProjects()}),b(document).on("click",".new-project",function(){return a.newProject(),!1}),b(document).on("click","#save-project",function(){if(b(this).hasClass("disabled"))return;a.saveProject(!0),a.autoSave&&a.autoSave.reset()}),b(document).on("click","#save-project-as",function(){if(b(this).hasClass("disabled"))return;a.saveProjectAsCopy()}),b(document).on("click","#recover-project",function(){a.recoverProject()}),b(document).bind("keydown","meta+s ctrl+s",function(){return a.saveProject(!0),a.autoSave&&a.autoSave.reset(),!1}),b(document).bind("keydown","meta+shift+s ctrl+shift+s",function(){return a.saveProjectAsCopy(),!1}),b(document).on("keydown","input, textarea","meta+s ctrl+s",function(){return a.saveProject(!0),a.autoSave&&a.autoSave.reset(),!1}),b(document).on("click",".share-action",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("action");if(c){switch(c){case"export":a.showExport();break;case"email":a.shareProject();break;case"preview":a.previewProject();break;case"history":FDBK.showHistory();break;case"view":a.openProjectViewer()}FDBK.closeDropdowns()}}}),b(document).bind("keydown","meta+alt+x alt+ctrl+x",function(){a.showExport()}),b(document).bind("keydown","meta+alt+e alt+ctrl+e",function(){return a.shareProject(),!1}),b(document).bind("keydown","meta+shift+p alt+ctrl+p",function(){a.previewProject()}),b(document).on("click",".open-project-settings",function(){FDBK.closeModal(),FDBK.allowProjectSettings()&&b("#open-settings").trigger("mousedown")}),b(document).on("click",".open-dialog",function(){if(!b(this).hasClass("disabled")){var c=b(this).data("dialog");switch(c){case"shortcuts":FDBK.openModal("#shortcuts-dialog");break;case"billing":FDBK.openModal("#billing-dialog");break;case"profile":b("#profile-dialog").html(b("#tmpl-profile").loc_tmpl(FDBK.USER_DATA)),FDBK.openModal("#profile-dialog");break;case"account-settings":a.loadAccountServiceData(),FDBK.openModal("#account-settings-dialog")}}}),FDBK.sub("account-service-data-loaded",function(){b("#dynamic-account-settings").html(b("#tmpl-account-settings").loc_tmpl({services:FDBK.AUTHORIZED_SERVICES}))}),b(document).on("click",".revoke-access",function(){var c=null,d=b(this).data("provider");d=="googledrive"?c=FDBK.API.CALL_REVOKE_GOOGLE_DRIVE:d=="dropbox"&&(c=FDBK.API.CALL_REVOKE_DROPBOX);if(!c||b(this).hasClass("disabled"))return;b(this).addClass("disabled").parents(".app").css({opacity:.5}),FDBK.API.xhr(c,{success:function(b){b.success?a.loadAccountServiceData():(FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded"))},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"}),FDBK.pub("account-service-data-loaded")}})}),b(document).bind("keydown","f1 meta+shift+/",function(){return FDBK.openModal("#shortcuts-dialog"),!1}),b(document).on("keydown",null,"esc",function(){a.isArea("modal")?d():(FDBK.closeDropdowns(),a.hideContextMenu(),a.closePreview()),a.isArea("stage")&&a.clearSelection()}),b(document).on("keydown","input, textarea","esc",function(){d()}),b(document).on("keyup",null,"return",function(){if(a.isArea("modal")){var c=b("#overlay").find(".active").find(".primary-action");c.length&&c.trigger("click")}}),b(document).on("click",".open-feedback",function(){UserVoice&&UserVoice.showPopupWidget()}).on("click",".close-modal",function(){FDBK.closeModal()}),FDBK.sub("open-project",function(){b("#project-structure-button").removeClass("disabled")}),FDBK.sub("close-project",function(){b("#project-structure-button").addClass("disabled"),b("#undo-button, #redo-button").addClass("disabled")}),a.scrollToSelectedMockup=function(){var b=a.currentProject.indexOfMockup(a.currentMockup.id);FDBK.itemIsVisible(a.$projectStructure,b)||FDBK.scrollToSelectedItem(a.$projectStructure,b)},FDBK.sub("dropdown-shown",function(b){b.attr("id")==="project-structure-dropdown"&&a.scrollToSelectedMockup()}),FDBK.sub("loaded-user-settings",function(){b("[name=comments-notification-global]").prop("checked",FDBK.USER_DATA.notificationsCommentsEnabled)}),b(document).on("change","[name=comments-notification-global]",function(){var a=b(this).is(":checked");FDBK.API.xhr(FDBK.API.CALL_SET_NOTIFICATION,{data:{enabled:a,type:"comments"},contentType:"application/x-www-form-urlencoded"})});var e=function(c){if(FDBK.allowMasters())if(c.isMaster)b("#master-page-menu-for-master-page").show().siblings(".master-page-menu").hide();else{b("#master-page-menu-for-normal-page").show().siblings(".master-page-menu").hide(),b("#master-page-list [data-page-id="+c.master+"]").addClass("checked").siblings().removeClass("checked");var d=c.master?a.currentProject.mockup(c.master):null;b("#master-for-current-page").text(d?"Master: "+d.name:"No master"),d?b("#merge-master-into-page").removeClass("disabled"):b("#merge-master-into-page").addClass("disabled")}else b("#master-page-promo-menu").show().siblings(".master-page-menu").hide();b("#current-page-name").text(c.name),b("#project-structure-button .page-is-master").add("#project-structure [data-mockup="+c.id+"] .page-is-master").toggle(c.isMaster)};return FDBK.sub("user-logged-in plan-updated",function(){a.currentMockup&&e(a.currentMockup)}),FDBK.sub("mockup-changed",e),FDBK.sub("masters-changed open-project",function(){var c=a.currentProject.masterPages(),d='<li class="action menu-item" data-page-id="null">No master</li>';for(var e=0;e<c.length;e++)d+='<li class="action menu-item" data-page-id="'+utils.sanitize(c[e].id)+'">'+utils.sanitize(c[e].name)+"</li>";b("#master-page-list").html(d);var f=a.currentMockup;b("#master-page-list [data-page-id="+f.master+"]").addClass("checked").siblings().removeClass("checked");var g=f.master?a.currentProject.mockup(f.master):null;b("#master-for-current-page").text(g?"Master: "+g.name:"No master"),g?b("#merge-master-into-page").removeClass("disabled"):b("#merge-master-into-page").addClass("disabled")}),FDBK.sub("mockup-changed masters-changed open-project",function(){if(a.currentMockup.isMaster){var c=a.currentProject.pagesForMaster(a.currentMockup.id).length;b("#master-usage").text(FDBK.pluralize("_Master usage",c))}}),FDBK.sub("renamed-mockup",function(c){c.mockup===a.currentMockup.id&&c.value&&b("#current-page-name").text(c.value),FDBK.pub("masters-changed")}),b("#master-page-list").on("click",".menu-item",function(){var c=b(this).data("page-id");return a.setMasterForCurrentPage(c),!1}),b("#convert-to-master-page").on("click",function(){return a.currentMockup.master?FDBK.openConfirmDialog({heading:FDBK.loc("_Convert normal page to master page"),message:FDBK.loc("_Page has master page"),buttons:[{text:FDBK.loc("_Merge master first"),classes:"secondary-action",onClick:function(){a.convertCurrentPageToMaster({merge:!0})}},{text:FDBK.loc("_Remove master"),classes:"primary-action",onClick:function(){a.convertCurrentPageToMaster({merge:!1})}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):a.convertCurrentPageToMaster({merge:!1}),!1}),b("#convert-to-normal-page").on("click",function(){var b=function(){a.convertCurrentPageToNormalPage()};return a.currentProject.pagesForMaster(a.currentMockup.id).length?FDBK.openConfirmDialog({heading:FDBK.loc("_Convert master page to normal page"),message:FDBK.loc("_Master in use"),buttons:[{text:FDBK.loc("_Convert to normal page"),classes:"primary-action",onClick:b},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}):b(),!1}),b("#apply-master-to-all-pages").on("click",function(){return FDBK.openConfirmDialog({heading:FDBK.loc("_Apply master page to all pages"),message:FDBK.loc("_All normal pages will receive this as master."),buttons:[{text:FDBK.loc("_Apply master"),classes:"primary-action",onClick:function(){a.applyCurrentMasterToAllPages()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1}),b("#remove-master-from-all-pages").on("click",function(){return FDBK.openConfirmDialog({heading:FDBK.loc("_Remove master page from all pages"),message:FDBK.loc("_This master will be removed from any page currently using it."),buttons:[{text:FDBK.loc("_Remove master"),classes:"primary-action",onClick:function(){a.removeCurrentMasterFromAllPages()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1}),b("#merge-master-into-page").on("click",function(){return b(this).hasClass("disabled")?!1:(a.currentMockup.master&&FDBK.openConfirmDialog({heading:FDBK.loc("_Merge master into the current page"),message:FDBK.loc("_The content of the master page will be copied into the current page."),buttons:[{text:FDBK.loc("_Merge master"),classes:"primary-action",onClick:function(){a.mergeMasterIntoCurrentPage()}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]}),!1)}),b("#new-page-from-master").on("click",function(){return a.newPageWithCurrentMaster(),!1}),b("#show-project-history").on("click",function(){return FDBK.showHistory(),!1}),FDBK.sub("open-project",function(){b("#hotspot-menu-button, #create-hotspot, #create-selection-hotspot").removeClass("disabled")}).sub("close-project",function(){b("#hotspot-menu-button, #create-hotspot, #create-selection-hotspot").addClass("disabled")}),b(document).on("click","#current-project-name",function(){FDBK.closeModal(),FDBK.allowProjectSettings()&&(b("#open-settings").trigger("mousedown"),b("#project-title-input").select().focus())}),a}(MODULE||{},jQuery),MODULE=function(a,b){function d(a){return/^[a-z0-9._-]+$/i.test(a)}var c=!1;return a.setLoggedState=function(d){d?(c=!0,b.cookie("hasAccount","true",{expires:365,path:"/"}),FDBK.pub("user-logged-in")):(c=!1,FDBK.pub("user-logged-out")),a.setAccountMenu(),a.checkHash()},a.isUserLoggedIn=function(){return c},a.setAccountMenu=function(){var c=b("#account-menu");if(a.isUserLoggedIn()){var d=b.trim(FDBK.USER_DATA.fullName)?FDBK.USER_DATA.fullName:FDBK.USER_DATA.userName;c.html(b("#tmpl-logged").loc_tmpl({name:d,gravatar:utils.gravatarImageURL(FDBK.USER_DATA.email),isPremium:FDBK.hasPremiumPlan()}))}else c.html(b("#tmpl-nosession").loc_tmpl())},FDBK.sub("update-profile-dependencies plan-updated",function(){a.setAccountMenu()}),b(document).on("click",".open-login",function(){a.showLoginDialog()}),b(document).on("click",".open-register",function(){a.showRegisterDialog()}),b(document).on("click",".open-dialog",function(){!b(this).hasClass("disabled")&&b(this).data("dialog")=="reset"&&a.showResetDialog()}),b(document).on("submit","#login-form",function(){if(a.inProgressRequest)return!1;var c={j_username:b("[name=j_username]").val(),j_password:b("[name=j_password]").val(),ajax:"true"};b("#remember").is(":checked")&&(c.rememberme="true"),FDBK.API.xhr(FDBK.API.CALL_LOGIN,{contentType:"application/x-www-form-urlencoded",data:c,success:function(c){if(c.success){FDBK.pub("user-login-success"),b("#login-dialog").is(":visible")&&FDBK.closeModal();try{a.getUserData()}catch(d){}}else FDBK.showServerError({message:FDBK.loc("_Invalid username or password"),style:"error"}),b(".reset-input").val("")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),a.canViewProject=function(){var b=a.currentProject.canViewProject();return b||a.checkForActivationToken(),b},a.validateActivationToken=function(c,d){FDBK.API.xhr(FDBK.API.CALL_GET_TOKEN_INFO,{data:{token:c},success:function(e){e.success&&e.object.email?(a.showActivateDialog(),b("#tokenInput").val(c),b("#activateEmail").val(e.object.email),FDBK.showServerError({message:"Please choose your username and password"})):a.showLoginDialog(),b("#preloader").hide(),d&&d()},error:function(){a.showLoginDialog(),b("#preloader").hide(),d&&d()},traditional:!0})},a.checkForActivationToken=function(){var c=window.location.hash;if(c.indexOf("activate?at=")!=-1){var d=c.split("="),e=d[1];a.validateActivationToken(e)}else a.showLoginDialog(),FDBK.library.currentProject.permission=="forbidden"&&FDBK.showServerError({message:FDBK.loc("_You don't have access to this project")}),b("#toolbar-options").hide(),FDBK.centerTheProject(),b("#preloader").hide()},b(document).on("submit","#register-form",function(){if(a.inProgressRequest)return!1;var c={email:b.trim(b("#signupEmail").val()),userName:b.trim(b("#signupUsername").val()),password:b("#signupPassword").val()};return c.userName&&!d(c.userName)?(b("#signupUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_SIGN_UP,{data:JSON.stringify(c),success:function(d){if(d.success)FDBK.pub("account-created"),b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.pub("signup-error",e),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b(document).on("submit","#activate-form",function(){if(a.inProgressRequest)return!1;var c={token:b.trim(b("#tokenInput").val()),userName:b.trim(b("#activateUsername").val()),password:b("#activatePassword").val()};return c.userName&&!d(c.userName)?(b("#activateUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_ACTIVATE_USER,{contentType:"application/x-www-form-urlencoded",data:c,success:function(d){if(d.success)FDBK.pub("account-created"),b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b("#signupEmail").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&FDBK.API.xhr(FDBK.API.CALL_CHECK_EMAIL,{data:{email:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b("#signupUsername, #activateUsername").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&d(c)?FDBK.API.xhr(FDBK.API.CALL_CHECK_USER,{data:{name:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c&&!d(c)&&a.addClass("error").after('<p class="error">'+FDBK.loc("usernameNotValid")+"</p>")}),b("#signupPassword, #activatePassword").blur(function(){var a=b(this),c=a.val();a.parent().find("p").remove(),c&&c.length<5?a.addClass("error").after('<p class="error">'+FDBK.loc("passwordLength")+"</p>"):a.removeClass("error")}),a.askForSession=function(){b.cookie("hasAccount")||a.currentProject&&a.currentProject.uniqueId?(a.showLoginDialog(),FDBK.showServerError({message:FDBK.loc("_You need to sign in to perform this action.")})):(a.showRegisterDialog(),FDBK.showServerError({message:FDBK.loc("_You need an account to perform this action.")})),FDBK.pub("action-requires-account")},a.showLoginDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#login-dialog","sign-in"),b("[name=j_username]").focus()):FDBK.showCookiesAlert()},a.showRegisterDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#register-dialog","register"),FDBK.pub("opened-signup-dialog")):FDBK.showCookiesAlert()},a.showActivateDialog=function(){FDBK.hasCookies()?FDBK.openModal("#activate-dialog","activate"):FDBK.showCookiesAlert()},a.showResetDialog=function(){FDBK.openModal("#reset-dialog","reset")},b(document).on("submit","#reset-form",function(){if(a.inProgressRequest)return!1;var c=b("#recover-email"),d=b.trim(c.val());return c.removeClass("error").parent().find("p").remove(),d?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RECOVER_PASSWORD,{data:{email:d},success:function(a){a.success?FDBK.openModal("#reset-success-dialog"):c.addClass("error").after('<p class="error">'+FDBK.loc(a.message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c.addClass("error").after('<p class="error">'+FDBK.loc("emailBlank")+"</p>"),!1}),b(document).on("submit","#password-form",function(){if(a.inProgressRequest)return!1;var c=b("#newPassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==b("#reNewPassword").val()?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RESET_PASSWORD,{data:JSON.stringify({token:FDBK.resetToken,newPwd:c}),success:function(a){a.success?FDBK.openConfirmDialog({heading:FDBK.loc("_Password changed"),message:FDBK.loc("_Password successfully changed"),buttons:[{text:FDBK.loc("_Sign in"),classes:"right open-login primary-action"},{text:FDBK.loc("_Close"),classes:"close-modal"}]}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),b(document).on("submit","#profile-form",function(){FDBK.USER_DATA.fullName=b.trim(b(this).find("[name=fullName]").val()),FDBK.USER_DATA.email=b.trim(b(this).find("[name=email]").val()),FDBK.USER_DATA.company=b.trim(b(this).find("[name=company]").val()),FDBK.USER_DATA.location=b.trim(b(this).find("[name=location]").val()),FDBK.USER_DATA.url=b.trim(b(this).find("[name=url]").val()),FDBK.API.xhr(FDBK.API.CALL_UPDATE_CURRENT_USER,{data:JSON.stringify({email:FDBK.USER_DATA.email,fullName:FDBK.USER_DATA.fullName,company:FDBK.USER_DATA.company,location:FDBK.USER_DATA.location,url:FDBK.USER_DATA.url}),success:function(a){if(a.success)FDBK.closeModal(),FDBK.pub("update-profile-dependencies");else{var b;a.object.emailError?b=a.object.emailError:a.object.usernameError&&(b=a.object.usernameError),FDBK.showServerError({message:FDBK.loc(b),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b(document).on("submit","#change-form",function(){if(a.inProgressRequest)return!1;var c=b("#changePassword").val(),d=b("#oldPassword").val(),e=b("#changeRePassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==e?FDBK.API.xhr(FDBK.API.CALL_CHANGE_PASSWORD,{data:JSON.stringify({name:FDBK.USER_DATA.userName,oldPwd:d,newPwd:c}),success:function(a){a.success?FDBK.openConfirmDialog({heading:FDBK.loc("_Password changed"),message:FDBK.loc("_Password successfully changed"),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal primary-action"}]}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),a}(MODULE||{},jQuery);FDBK.mixinModule("objectLinking",{OBJECT_LINK_TYPE_URL:"url",OBJECT_LINK_TYPE_MOCKUP:"mockup",initModule:function(){function b(){return $.loc_tmpl("<option value={{= id }}>{{= name }}</option>",[{id:null,name:"None"}].concat(FDBK.library.currentProject.normalPages()))}function c(){$(".mockup-linking-list").each(function(){var a=$(this),c=FDBK.library.currentMockup.stencil(a.data("stencil"));a.html(b()).val(c&&c.link?c.link.ref:"")})}this.$objectLinkStatusRef=$("#object-link-status-ref"),this.$objectLinkStatusUI=$("#object-link-status"),this.$objectLinkSetupUI=$("#object-link-setup"),this.$objectLinkDisabledUI=$("#object-link-disabled"),this.$linkGhostWrapper=$("#link-ghost-wrapper");var a=this;FDBK.sub("project-changed open-project",function(a,b){a==="remove"?FDBK.library.currentProject.cleanUpLinks(b):c()},this),FDBK.sub("masters-changed",function(){var a=FDBK.library.currentProject,b=a.masterPages();for(var d=0;d<b.length;d++)a.cleanUpLinks(b[d].id);c()}),FDBK.sub("renamed-mockup",function(){c()}),FDBK.sub("inspector-shown",function(a){(a==="tmplsvg-hotspot-panel"||a==="tmplsvg-object-linking-panel")&&c()}),FDBK.sub("inspector-hidden",function(a){a==="tmplsvg-object-linking-panel"&&this.showLinkGhosts(FDBK.library.currentMockup.stencilList())});var d=!1;FDBK.sub("selection-transform",function(a,b,c){if(a==="move"||a==="resize")switch(b){case"start":case"timer-start":d||(d=!0,this.hideLinkGhosts(c));break;case"stop":case"timer-stop":d=!1,this.showLinkGhosts(c)}},this),FDBK.sub("link-stencil",function(a,b){this.showLinkGhosts([{id:a,link:b,skipSubstencils:!0}]),c()}),FDBK.sub("remove-stencil",function(a){var b=a.map(function(a){return{id:a,link:null,skipSubstencils:!0}});this.showLinkGhosts(b)}),FDBK.sub("add-stencil move-stencil resize-stencil",function(a){this.showLinkGhosts([{id:a}])}),FDBK.sub("open-project mockup-changed",function(){this.removeAllLinkGhosts(),this.showLinkGhosts(FDBK.library.currentMockup.stencilList())}),FDBK.sub("close-project",function(){this.removeAllLinkGhosts()}),$(document).on("click",".link-ghost-item:not(.temp)",function(){var a=$(this).data("stencil"),b=FDBK.library.currentMockup.stencil(a);return b&&FDBK.showLinkInspector(b,$(this)),!1}).on("keydown",null,"meta+k ctrl+k",function(a){FDBK.library.currentMockup&&FDBK.library.createHotspotsForStencils([]),a.preventDefault()}).on("keydown",null,"meta+shift+k ctrl+shift+k",function(a){FDBK.library.currentMockup&&FDBK.library.hasSelection()&&FDBK.library.createHotspotsForStencils(),a.preventDefault()}).on("keydown",null,"alt+k",function(a){FDBK.showLinkInspectorForSelection(),a.preventDefault()}).on("click","#create-hotspot",function(){return $(this).hasClass("disabled")?!1:(FDBK.library.createHotspotsForStencils([]),!1)}).on("click","#create-selection-hotspot",function(){return $(this).hasClass("disabled")?!1:(FDBK.library.createHotspotsForStencils(),!1)}).on("click","#toggle-hotspots",function(){return FDBK.library.toggleHotspotVisibility(),!1}).on("click","#create-link",function(){return $(this).hasClass("disabled")?!1:(FDBK.showLinkInspectorForSelection(),!1)})},showLinkInspectorForSelection:function(){if(FDBK.library.currentMockup&&FDBK.library.isSingleSelection()){var a=FDBK.library.currentMockup.selection[0],b=FDBK.library.currentMockup.stencil(a.id);FDBK.showLinkInspector(b,FDBK.tempLinkGhost(b))}},showLinkInspector:function(a,b){FDBK.library.clearSelection(),FDBK.library.inspectorState.act("forceShow"),FDBK.library.showInspector("tmplsvg-object-linking-panel",a,{anchor:b||$(utils.stencil(a.id))})},TMPL_LINK_GHOST:function(a){return $.loc_tmpl("<div class='ghost-item link-ghost-item {{= klass }}' data-stencil='{{= id }}'></div>",{id:a.id,klass:a.name==="tmplsvg-hotspot"?"link-for-hotspot":""})},getLinkGhost:function(a){if(a&&a.id)return this.$linkGhostWrapper.find("[data-stencil="+a.id+"]")},tempLinkGhost:function(a){if(a){var b=this.getLinkGhost(a);b.length||(b=this.TMPL_LINK_GHOST(a),this.$linkGhostWrapper.append(b)),b.addClass("temp").css({top:a.top+a.height,left:a.left+a.width})}return b},manageLinkGhost:function(a,b){var c=this.getLinkGhost(a);if(b){var d=FDBK.library.currentMockup.stencilPath(a.id).reduce(function(a,b){return{top:a.top+b.top,left:a.left+b.left}},{top:0,left:0});c.length?c.removeClass("temp"):(c=this.TMPL_LINK_GHOST(a),this.$linkGhostWrapper.append(c)),c.css({top:d.top+a.height,left:d.left+a.width}).show()}else c.remove()},showLinkGhosts:function(a){for(var b=0;b<a.length;b++){var c=a[b].id,d=FDBK.library.currentMockup.stencil(c),e=typeof a[b].link=="undefined"?d.link:a[b].link;if(d){this.manageLinkGhost(d,e);if(!a[b].skipSubstencils){var f=FDBK.library.currentMockup.substencils(c).slice(1);for(var g=0;g<f.length;g++)this.manageLinkGhost(f[g],f[g].link)}}else{var h=this.getLinkGhost(a[b]);h&&h.remove()}}},hideLinkGhosts:function(a){for(var b=0;b<a.length;b++){var c=FDBK.library.currentMockup.substencils(a[b].id);for(var d=0;d<c.length;d++){var e=c[d];if(e&&e.link){var f=this.getLinkGhost(e);f.length&&f.hide()}}}},removeAllLinkGhosts:function(){this.$linkGhostWrapper.empty()}});var MODULE=function(a,b){var c={};return a.loadUserSettings=function(b){FDBK.API.xhr(FDBK.API.CALL_GET_ALL_USER_SETTINGS,{success:function(d){if(d.success&&d.object){var e;for(var f=0;f<d.object.length;f++)e=d.object[f],c[e.key]=e.value;a.applyUserSettings(),FDBK.pub("loaded-user-settings")}else console.log("Error on loadUserSettings : ",d),a.applyUserSettings();b&&b.call()},error:function(){console.log("Failed loading user settings"),a.applyUserSettings(),b&&b.call()}})},a.saveUserSettings=function(a){var b=[];for(var d in c)if(c.hasOwnProperty(d)&&c[d]!==undefined){var e={key:d,value:c[d]+""};b.push(e)}FDBK.API.xhr(FDBK.API.CALL_SET_ALL_USER_SETTINGS,{data:JSON.stringify(b),success:function(){a&&a.call()},error:function(){a&&a.call()}})},a.getUserSettings=function(a){return c[a]!==undefined?c[a]==="true"?!0:c[a]==="false"?!1:c[a]:null},a.setUserSettings=function(b,d){if(b instanceof Array)for(var e=0;e<b.length;e++)c[b[e]]=d[e];else c[b]=d;a.isUserLoggedIn()&&a.saveUserSettings()},a.applyUserSettings=function(){var d={};d.gridVisible=a.getUserSettings("gridVisible")===null?!0:a.getUserSettings("gridVisible"),d.gridSizeWidth=a.getUserSettings("gridSizeWidth")||20,d.gridSizeHeight=a.getUserSettings("gridSizeWidth")||20,d.stageSizeWidth=a.getUserSettings("stageSizeWidth")||1200,d.stageSizeHeight=a.getUserSettings("stageSizeHeight")||960,d.liveResize=a.getUserSettings("liveResize")===null?!0:a.getUserSettings("liveResize"),d.snapToGrid=a.getUserSettings("snapToGrid")||!1,d.snapToObjects=a.getUserSettings("snapToObjects")===null?!0:a.getUserSettings("snapToObjects"),d.showGuides=a.getUserSettings("showGuides")===null?!0:a.getUserSettings("showGuides"),d.gridsystemEnabled=a.getUserSettings("gridsystemEnabled")===null?!1:a.getUserSettings("gridsystemEnabled"),d.selectedgridSystem=a.getUserSettings("selectedgridSystem")||a.snapoptions.GS_960_12,b("#project-settings").find(".dropdown-content").html(b("#tmpl-project-settings").loc_tmpl({gridWidth:d.gridSizeWidth,gridHeight:d.gridSizeHeight,gridVisible:d.gridVisible,gridsystemEnabled:d.gridsystemEnabled,gridSystemType:d.selectedgridSystem,snapToGrid:d.snapToGrid,liveResize:d.liveResize,snapToObjects:d.snapToObjects,showGuides:d.showGuides})),a.setGridVisible(d.gridVisible),a.snapoptions.setGrid(d.gridSizeWidth,d.gridSizeHeight),a.updateStageGrid(d.gridSizeWidth,d.gridSizeHeight),d.gridsystemEnabled?(a.snapoptions.gridsystem(d.selectedgridSystem),a.snapoptions.gridEnabled(!1),a.snapoptions.gridsystemSnapping=d.snapToGrid):a.snapoptions.gridEnabled(d.snapToGrid),a.setLiveResize(d.liveResize),a.snapoptions.snap.snapToObjects=d.snapToObjects,a.snapoptions.snap.showGuides=d.showGuides;var e=!1;for(var f in d)d.hasOwnProperty(f)&&!c.hasOwnProperty(f)&&(c[f]=d[f],e=!0);a.isUserLoggedIn()&&e&&a.saveUserSettings()},a}(MODULE||{},jQuery);FDBK.mixinModule("payments",{$plans:$("#plans-dialog"),newAccount:!1,paymentInProgress:!1,cardInfo:null,cardType:null,discountCode:null,currentPlan:null,nextPlan:null,hasSeenPricing:!1,countries:[{countryCode:"AD",countryName:"Andorra"},{countryCode:"AE",countryName:"United Arab Emirates"},{countryCode:"AF",countryName:"Afghanistan"},{countryCode:"AG",countryName:"Antigua and Barbuda"},{countryCode:"AI",countryName:"Anguilla"},{countryCode:"AL",countryName:"Albania"},{countryCode:"AM",countryName:"Armenia"},{countryCode:"AO",countryName:"Angola"},{countryCode:"AQ",countryName:"Antarctica"},{countryCode:"AR",countryName:"Argentina"},{countryCode:"AS",countryName:"American Samoa"},{countryCode:"AT",countryName:"Austria"},{countryCode:"AU",countryName:"Australia"},{countryCode:"AW",countryName:"Aruba"},{countryCode:"AX",countryName:"land"},{countryCode:"AZ",countryName:"Azerbaijan"},{countryCode:"BA",countryName:"Bosnia and Herzegovina"},{countryCode:"BB",countryName:"Barbados"},{countryCode:"BD",countryName:"Bangladesh"},{countryCode:"BE",countryName:"Belgium"},{countryCode:"BF",countryName:"Burkina Faso"},{countryCode:"BG",countryName:"Bulgaria"},{countryCode:"BH",countryName:"Bahrain"},{countryCode:"BI",countryName:"Burundi"},{countryCode:"BJ",countryName:"Benin"},{countryCode:"BL",countryName:"Saint Barthlemy"},{countryCode:"BM",countryName:"Bermuda"},{countryCode:"BN",countryName:"Brunei"},{countryCode:"BO",countryName:"Bolivia"},{countryCode:"BQ",countryName:"Bonaire"},{countryCode:"BR",countryName:"Brazil"},{countryCode:"BS",countryName:"Bahamas"},{countryCode:"BT",countryName:"Bhutan"},{countryCode:"BV",countryName:"Bouvet Island"},{countryCode:"BW",countryName:"Botswana"},{countryCode:"BY",countryName:"Belarus"},{countryCode:"BZ",countryName:"Belize"},{countryCode:"CA",countryName:"Canada"},{countryCode:"CC",countryName:"Cocos [Keeling] Islands"},{countryCode:"CD",countryName:"Democratic Republic of the Congo"},{countryCode:"CF",countryName:"Central African Republic"},{countryCode:"CG",countryName:"Republic of the Congo"},{countryCode:"CH",countryName:"Switzerland"},{countryCode:"CI",countryName:"Ivory Coast"},{countryCode:"CK",countryName:"Cook Islands"},{countryCode:"CL",countryName:"Chile"},{countryCode:"CM",countryName:"Cameroon"},{countryCode:"CN",countryName:"China"},{countryCode:"CO",countryName:"Colombia"},{countryCode:"CR",countryName:"Costa Rica"},{countryCode:"CU",countryName:"Cuba"},{countryCode:"CV",countryName:"Cape Verde"},{countryCode:"CW",countryName:"Curacao"},{countryCode:"CX",countryName:"Christmas Island"},{countryCode:"CY",countryName:"Cyprus"},{countryCode:"CZ",countryName:"Czechia"},{countryCode:"DE",countryName:"Germany"},{countryCode:"DJ",countryName:"Djibouti"},{countryCode:"DK",countryName:"Denmark"},{countryCode:"DM",countryName:"Dominica"},{countryCode:"DO",countryName:"Dominican Republic"},{countryCode:"DZ",countryName:"Algeria"},{countryCode:"EC",countryName:"Ecuador"},{countryCode:"EE",countryName:"Estonia"},{countryCode:"EG",countryName:"Egypt"},{countryCode:"EH",countryName:"Western Sahara"},{countryCode:"ER",countryName:"Eritrea"},{countryCode:"ES",countryName:"Spain"},{countryCode:"ET",countryName:"Ethiopia"},{countryCode:"FI",countryName:"Finland"},{countryCode:"FJ",countryName:"Fiji"},{countryCode:"FK",countryName:"Falkland Islands"},{countryCode:"FM",countryName:"Micronesia"},{countryCode:"FO",countryName:"Faroe Islands"},{countryCode:"FR",countryName:"France"},{countryCode:"GA",countryName:"Gabon"},{countryCode:"GB",countryName:"United Kingdom"},{countryCode:"GD",countryName:"Grenada"},{countryCode:"GE",countryName:"Georgia"},{countryCode:"GF",countryName:"French Guiana"},{countryCode:"GG",countryName:"Guernsey"},{countryCode:"GH",countryName:"Ghana"},{countryCode:"GI",countryName:"Gibraltar"},{countryCode:"GL",countryName:"Greenland"},{countryCode:"GM",countryName:"Gambia"},{countryCode:"GN",countryName:"Guinea"},{countryCode:"GP",countryName:"Guadeloupe"},{countryCode:"GQ",countryName:"Equatorial Guinea"},{countryCode:"GR",countryName:"Greece"},{countryCode:"GS",countryName:"South Georgia and the South Sandwich Islands"},{countryCode:"GT",countryName:"Guatemala"},{countryCode:"GU",countryName:"Guam"},{countryCode:"GW",countryName:"Guinea-Bissau"},{countryCode:"GY",countryName:"Guyana"},{countryCode:"HK",countryName:"Hong Kong"},{countryCode:"HM",countryName:"Heard Island and McDonald Islands"},{countryCode:"HN",countryName:"Honduras"},{countryCode:"HR",countryName:"Croatia"},{countryCode:"HT",countryName:"Haiti"},{countryCode:"HU",countryName:"Hungary"},{countryCode:"ID",countryName:"Indonesia"},{countryCode:"IE",countryName:"Ireland"},{countryCode:"IL",countryName:"Israel"},{countryCode:"IM",countryName:"Isle of Man"},{countryCode:"IN",countryName:"India"},{countryCode:"IO",countryName:"British Indian Ocean Territory"},{countryCode:"IQ",countryName:"Iraq"},{countryCode:"IR",countryName:"Iran"},{countryCode:"IS",countryName:"Iceland"},{countryCode:"IT",countryName:"Italy"},{countryCode:"JE",countryName:"Jersey"},{countryCode:"JM",countryName:"Jamaica"},{countryCode:"JO",countryName:"Jordan"},{countryCode:"JP",countryName:"Japan"},{countryCode:"KE",countryName:"Kenya"},{countryCode:"KG",countryName:"Kyrgyzstan"},{countryCode:"KH",countryName:"Cambodia"},{countryCode:"KI",countryName:"Kiribati"},{countryCode:"KM",countryName:"Comoros"},{countryCode:"KN",countryName:"Saint Kitts and Nevis"},{countryCode:"KP",countryName:"North Korea"},{countryCode:"KR",countryName:"South Korea"},{countryCode:"KW",countryName:"Kuwait"},{countryCode:"KY",countryName:"Cayman Islands"},{countryCode:"KZ",countryName:"Kazakhstan"},{countryCode:"LA",countryName:"Laos"},{countryCode:"LB",countryName:"Lebanon"},{countryCode:"LC",countryName:"Saint Lucia"},{countryCode:"LI",countryName:"Liechtenstein"},{countryCode:"LK",countryName:"Sri Lanka"},{countryCode:"LR",countryName:"Liberia"},{countryCode:"LS",countryName:"Lesotho"},{countryCode:"LT",countryName:"Lithuania"},{countryCode:"LU",countryName:"Luxembourg"},{countryCode:"LV",countryName:"Latvia"},{countryCode:"LY",countryName:"Libya"},{countryCode:"MA",countryName:"Morocco"},{countryCode:"MC",countryName:"Monaco"},{countryCode:"MD",countryName:"Moldova"},{countryCode:"ME",countryName:"Montenegro"},{countryCode:"MF",countryName:"Saint Martin"},{countryCode:"MG",countryName:"Madagascar"},{countryCode:"MH",countryName:"Marshall Islands"},{countryCode:"MK",countryName:"Macedonia"},{countryCode:"ML",countryName:"Mali"},{countryCode:"MM",countryName:"Myanmar [Burma]"},{countryCode:"MN",countryName:"Mongolia"},{countryCode:"MO",countryName:"Macao"},{countryCode:"MP",countryName:"Northern Mariana Islands"},{countryCode:"MQ",countryName:"Martinique"},{countryCode:"MR",countryName:"Mauritania"},{countryCode:"MS",countryName:"Montserrat"},{countryCode:"MT",countryName:"Malta"},{countryCode:"MU",countryName:"Mauritius"},{countryCode:"MV",countryName:"Maldives"},{countryCode:"MW",countryName:"Malawi"},{countryCode:"MX",countryName:"Mexico"},{countryCode:"MY",countryName:"Malaysia"},{countryCode:"MZ",countryName:"Mozambique"},{countryCode:"NA",countryName:"Namibia"},{countryCode:"NC",countryName:"New Caledonia"},{countryCode:"NE",countryName:"Niger"},{countryCode:"NF",countryName:"Norfolk Island"},{countryCode:"NG",countryName:"Nigeria"},{countryCode:"NI",countryName:"Nicaragua"},{countryCode:"NL",countryName:"Netherlands"},{countryCode:"NO",countryName:"Norway"},{countryCode:"NP",countryName:"Nepal"},{countryCode:"NR",countryName:"Nauru"},{countryCode:"NU",countryName:"Niue"},{countryCode:"NZ",countryName:"New Zealand"},{countryCode:"OM",countryName:"Oman"},{countryCode:"PA",countryName:"Panama"},{countryCode:"PE",countryName:"Peru"},{countryCode:"PF",countryName:"French Polynesia"},{countryCode:"PG",countryName:"Papua New Guinea"},{countryCode:"PH",countryName:"Philippines"},{countryCode:"PK",countryName:"Pakistan"},{countryCode:"PL",countryName:"Poland"},{countryCode:"PM",countryName:"Saint Pierre and Miquelon"},{countryCode:"PN",countryName:"Pitcairn Islands"},{countryCode:"PR",countryName:"Puerto Rico"},{countryCode:"PS",countryName:"Palestine"},{countryCode:"PT",countryName:"Portugal"},{countryCode:"PW",countryName:"Palau"},{countryCode:"PY",countryName:"Paraguay"},{countryCode:"QA",countryName:"Qatar"},{countryCode:"RE",countryName:"Runion"},{countryCode:"RO",countryName:"Romania"},{countryCode:"RS",countryName:"Serbia"},{countryCode:"RU",countryName:"Russia"},{countryCode:"RW",countryName:"Rwanda"},{countryCode:"SA",countryName:"Saudi Arabia"},{countryCode:"SB",countryName:"Solomon Islands"},{countryCode:"SC",countryName:"Seychelles"},{countryCode:"SD",countryName:"Sudan"},{countryCode:"SE",countryName:"Sweden"},{countryCode:"SG",countryName:"Singapore"},{countryCode:"SH",countryName:"Saint Helena"},{countryCode:"SI",countryName:"Slovenia"},{countryCode:"SJ",countryName:"Svalbard and Jan Mayen"},{countryCode:"SK",countryName:"Slovakia"},{countryCode:"SL",countryName:"Sierra Leone"},{countryCode:"SM",countryName:"San Marino"},{countryCode:"SN",countryName:"Senegal"},{countryCode:"SO",countryName:"Somalia"},{countryCode:"SR",countryName:"Suriname"},{countryCode:"SS",countryName:"South Sudan"},{countryCode:"ST",countryName:"So Tom and Prncipe"},{countryCode:"SV",countryName:"El Salvador"},{countryCode:"SX",countryName:"Sint Maarten"},{countryCode:"SY",countryName:"Syria"},{countryCode:"SZ",countryName:"Swaziland"},{countryCode:"TC",countryName:"Turks and Caicos Islands"},{countryCode:"TD",countryName:"Chad"},{countryCode:"TF",countryName:"French Southern Territories"},{countryCode:"TG",countryName:"Togo"},{countryCode:"TH",countryName:"Thailand"},{countryCode:"TJ",countryName:"Tajikistan"},{countryCode:"TK",countryName:"Tokelau"},{countryCode:"TL",countryName:"East Timor"},{countryCode:"TM",countryName:"Turkmenistan"},{countryCode:"TN",countryName:"Tunisia"},{countryCode:"TO",countryName:"Tonga"},{countryCode:"TR",countryName:"Turkey"},{countryCode:"TT",countryName:"Trinidad and Tobago"},{countryCode:"TV",countryName:"Tuvalu"},{countryCode:"TW",countryName:"Taiwan"},{countryCode:"TZ",countryName:"Tanzania"},{countryCode:"UA",countryName:"Ukraine"},{countryCode:"UG",countryName:"Uganda"},{countryCode:"UM",countryName:"U.S. Minor Outlying Islands"},{countryCode:"US",countryName:"United States"},{countryCode:"UY",countryName:"Uruguay"},{countryCode:"UZ",countryName:"Uzbekistan"},{countryCode:"VA",countryName:"Vatican City"},{countryCode:"VC",countryName:"Saint Vincent and the Grenadines"},{countryCode:"VE",countryName:"Venezuela"},{countryCode:"VG",countryName:"British Virgin Islands"},{countryCode:"VI",countryName:"U.S. Virgin Islands"},{countryCode:"VN",countryName:"Vietnam"},{countryCode:"VU",countryName:"Vanuatu"},{countryCode:"WF",countryName:"Wallis and Futuna"},{countryCode:"WS",countryName:"Samoa"},{countryCode:"XK",countryName:"Kosovo"},{countryCode:"YE",countryName:"Yemen"},{countryCode:"YT",countryName:"Mayotte"},{countryCode:"ZA",countryName:"South Africa"},{countryCode:"ZM",countryName:"Zambia"},{countryCode:"ZW",countryName:"Zimbabwe"}],planTooltips:{"active-projects":"Active projects are the projects you are currently working on. They are limited by your plan's quota.","archived-projects":"Never worry about exceeding you active projects quota. With unlimited archiving you can easily get the finished projects out of your way and restore them later.",images:"Need to generate interactive prototypes out of your finished designs or just to add some images to your mockup? The premium plans include generous upload space.",collaborators:"Moqups premium plans come with real-time collaboration enabled. You can add as many collaborators as you want to edit, view or comment on your project.",privacy:"Working on a top secret project?<br/>No problem, make it Private and give access only to people you trust.",masters:"Master pages help you set a common base for your pages so you can keep things consistent across the board. Forget about copy-pasting through dozens of pages.",revisions:"Project Revisions are super useful for when you want to save backup snapshots of your work in progress or branch off in a different direction with a brand new project."},freePricingPlans:[{planRestrictions:[{planId:1,restrictionType:"project",limit:2,action:"create"},{planId:1,restrictionType:"upload",limit:5,action:"upload"},{planId:1,restrictionType:"collaboration",limit:0,action:"add"}],plan:{price:0,startDate:1329854471e3,descriptionKey:"plan.free",isEnterprise:!1,endDate:null,name:"moqups-free",enabled:!0,createDate:1329854471e3,lastupdateDate:1329854471e3,id:1},planStatus:"current",actionUrl:null,actionMethod:"GET",ajaxRequestable:!0},{planRestrictions:[{planId:2,restrictionType:"project",limit:10,action:"create"},{planId:2,restrictionType:"upload",limit:1024,action:"upload"}],plan:{price:9,startDate:1329854472e3,descriptionKey:"plan.standard",isEnterprise:!1,endDate:null,name:"moqups-standard",enabled:!0,createDate:1329854472e3,lastupdateDate:1329854472e3,id:2},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-standard",actionMethod:"GET",ajaxRequestable:!1},{planRestrictions:[{planId:3,restrictionType:"project",limit:25,action:"create"},{planId:3,restrictionType:"upload",limit:2048,action:"upload"}],plan:{price:19,startDate:1329854472e3,descriptionKey:"plan.professional",isEnterprise:!1,endDate:null,name:"moqups-professional",enabled:!0,createDate:1329854472e3,lastupdateDate:1329854472e3,id:3},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-professional",actionMethod:"GET",ajaxRequestable:!1},{planRestrictions:[{planId:4,restrictionType:"project",limit:100,action:"create"},{planId:4,restrictionType:"upload",limit:10240,action:"upload"}],plan:{price:39,startDate:1329854472e3,descriptionKey:"plan.ultimate",isEnterprise:!1,endDate:null,name:"moqups-ultimate",enabled:!0,createDate:1329854472e3,lastupdateDate:1329854472e3,id:4},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-ultimate",actionMethod:"GET",ajaxRequestable:!1},{planRestrictions:[{planId:5,restrictionType:"project",limit:10,action:"create"},{planId:5,restrictionType:"upload",limit:1024,action:"upload"}],plan:{price:99,startDate:1370113272e3,descriptionKey:"plan.standard.yearly",isEnterprise:!1,endDate:null,name:"moqups-standard-yearly",enabled:!0,createDate:1370113272e3,lastupdateDate:1370113272e3,id:5},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-standard-yearly",actionMethod:"GET",ajaxRequestable:!1},{planRestrictions:[{planId:6,restrictionType:"project",limit:25,action:"create"},{planId:6,restrictionType:"upload",limit:2048,action:"upload"}],plan:{price:199,startDate:1370113272e3,descriptionKey:"plan.professional.yearly",isEnterprise:!1,endDate:null,name:"moqups-professional-yearly",enabled:!0,createDate:1370113272e3,lastupdateDate:1370113272e3,id:6},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-professional-yearly",actionMethod:"GET",ajaxRequestable:!1},{planRestrictions:[{planId:7,restrictionType:"project",limit:100,action:"create"},{planId:7,restrictionType:"upload",limit:10240,action:"upload"}],plan:{price:419,startDate:1370113272e3,descriptionKey:"plan.ultimate.yearly",isEnterprise:!1,endDate:null,name:"moqups-ultimate-yearly",enabled:!0,createDate:1370113272e3,lastupdateDate:1370113272e3,id:7},planStatus:"subscribe",actionUrl:"bt/form/create?plan=moqups-ultimate-yearly",actionMethod:"GET",ajaxRequestable:!1}],pricingPlans:null,pricingDetails:{"moqups-free":{fullName:"Free",standardFeatures:["2 Active Projects","5MB Image Storage","PDF/PNG Export"],extraFeatures:[],projectsLimit:2,imageStorage:"5MB",showPlan:!1,billingCycle:"month"},"moqups-standard":{fullName:"Standard",standardFeatures:["<em data-tooltip='active-projects'><strong>10</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>1GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:10,imageStorage:"1 GB",showPlan:!0,billingCycle:"month"},"moqups-professional":{fullName:"Professional",standardFeatures:["<em data-tooltip='active-projects'><strong>25</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>2GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:25,imageStorage:"2 GB",showPlan:!0,billingCycle:"month"},"moqups-ultimate":{fullName:"Ultimate",standardFeatures:["<em data-tooltip='active-projects'><strong>100</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>10GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:100,imageStorage:"10 GB",showPlan:!0,billingCycle:"month"},"moqups-standard-yearly":{fullName:"Standard",standardFeatures:["<em data-tooltip='active-projects'><strong>10</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>1GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:10,imageStorage:"1 GB",showPlan:!1,billingCycle:"year"},"moqups-professional-yearly":{fullName:"Professional",standardFeatures:["<em data-tooltip='active-projects'><strong>25</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>2GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:25,imageStorage:"2 GB",showPlan:!1,billingCycle:"year"},"moqups-ultimate-yearly":{fullName:"Ultimate",standardFeatures:["<em data-tooltip='active-projects'><strong>100</strong> Active Projects</em>","<em data-tooltip='archived-projects'>Unlimited Archived Projects</em>","<em data-tooltip='images'><strong>10GB</strong> Image Storage</em>","<em data-tooltip='collaborators'>Unlimited Collaborators</em>","<em data-tooltip='privacy'>Privacy Settings</em>","<em data-tooltip='masters'>Master Pages</em>"],extraFeatures:["<em data-tooltip='revisions'>Unlimited Revisions</em>","Save to Dropbox/GDrive","PDF/PNG Export","Lovely Support &hearts;"],projectsLimit:100,imageStorage:"10 GB",showPlan:!1,billingCycle:"year"}},initModule:function(){var a=this;$(document).on("mouseenter","#plans em",function(){var b=a.planTooltips[$(this).data("tooltip")],c=$(this);FDBK.$tooltip.html(b+"<span></span>").css({top:c.offset().top+c.outerHeight()+6,left:c.offset().left+Math.ceil(c.outerWidth()/2)-Math.ceil(FDBK.$tooltip.outerWidth()/2)}).addClass("plan-tooltip").show()}).on("mouseleave","#plans em",function(){FDBK.$tooltip.hide().removeClass("plan-tooltip")}),FDBK.sub("modal-closed",function(b){b==="#subscription-dialog"&&(a.paymentInProgress?(FDBK.openModal("#subscription-dialog"),FDBK.showServerError({message:FDBK.loc("_Processing payment...")})):a.cleanPaymentForm()),b==="#plans-dialog"&&a.newAccount&&!a.nextPlan&&(a.newAccount=!1,FDBK.openModal("#welcome-dialog"))}),FDBK.sub("account-created",function(){a.newAccount=!0}),FDBK.sub("user-logged-in",function(){a.pricingPlans=null,a.updateCurrentPlanPlaceholders(),a.nextPlan?a.changePlan():a.newAccount?FDBK.buildHash("pricing"):FDBK.USER_DATA.planStatus==="pastdue"?FDBK.openModal("#past-due-dialog"):FDBK.USER_DATA.planStatus==="expired"&&FDBK.openModal("#expired-dialog")}),$(document).on("click",".cancel-plan-update",function(){$("#plan-confirmation").fadeOut("fast",function(){$(this).remove(),FDBK.cleanServerError()})}),$(document).on("click","[data-dialog=plans-pricing]",function(){FDBK.showPricingPlans()}),$(document).on("click","[data-dialog=payment-history]",function(){FDBK.showPaymentHistory()}),$(document).on("click",".plan-picker",function(){if($(this).hasClass("disabled"))return;var b=$(this).data("name");$.each(a.pricingPlans,function(c,d){b===d.plan.name&&(a.nextPlan=d)});if(!a.nextPlan)return;FDBK.library.isUserLoggedIn()?a.changePlan():FDBK.library.showRegisterDialog(),FDBK.pub("picked-premium-plan",a.nextPlan.plan.name)}),$(document).on("click","[name=billing-cycle]",function(){a.generatePricingTable($(this).val())}),$(document).on("click","[name=payment-type]",function(){$("#subscription-dialog").find(".form-wrapper").hide(),$("#"+$(this).val()).show()}),$(document).on("click",".toggle-discount",function(){$("#discount-form").toggle()}),$(document).on("submit","#discount-form",function(){return a.applyDiscount(),!1}),$(document).on("click",".update-credit-card",function(){return a.nextPlan=null,a.initPaymentForm(),a.getCardInfo(),FDBK.cleanServerError(),FDBK.openModal("#subscription-dialog"),!1}),$(document).on("submit","#pay-bank-form",function(){FDBK.cleanServerError();var a=$(this);a.find("input").prop("disabled",!0),$("input[name=payment-type]").prop("disabled",!0),FDBK.showServerError({message:FDBK.loc("_Sending order...")}),FDBK.API.xhr(FDBK.API.CALL_BANK_TRANSFER,{data:JSON.stringify({planName:$("#transfer-plan").val(),name:$("#transfer-name").val(),email:$("#transfer-email").val(),phone:$("#transfer-phone").val(),country:$("#transfer-country").val(),address:$("#transfer-address-1").val(),address2:$("#transfer-address-2").val(),state:$("#transfer-state").val(),zip:$("#transfer-zip").val()}),success:function(b){b.success?FDBK.openModal("#bank-order-success-dialog"):(FDBK.showServerError({message:FDBK.loc("_Order could not be processed."),style:"error"}),a.find("input").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1))},error:function(){FDBK.showServerError({message:FDBK.loc("_Order could not be processed."),style:"error"}),a.find("input").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1)}})}),$(document).on("submit","#pay-subscription-form",function(){FDBK.cleanServerError(),$("#discount-form").hide();var b=$("<fieldset></fieldset>"),c=$(".cc-number-field").clone();c.val(c.val().replace(/\s/g,""));if(!c.val())return FDBK.showServerError({message:FDBK.loc("_Card number is required."),style:"error"}),!1;a.cardType=$.payment.cardType(c.val());var d=$(".cc-exp-field").clone();d.val(d.val().replace(/\s/g,""));if(!d.val())return FDBK.showServerError({message:FDBK.loc("_Card expiration date is required."),style:"error"}),!1;var e=$(".cc-cvv-field").clone(),f=$(".cc-name-field").clone();f.val($.trim(f.val()));if(!f.val())return FDBK.showServerError({message:FDBK.loc("_Name on card is required."),style:"error"}),!1;b.append(c,d,e,f);var g=$('[name="payment-iframe"]'),h=g[0].contentWindow.submitSubscription;return h?(FDBK.showServerError({message:FDBK.loc("_Processing payment...")}),a.paymentInProgress=!0,$(this).find("input").prop("disabled",!0),$("input[name=payment-type]").prop("disabled",!0),$(this).find(".plan-continue").addClass("disabled"),h(b),a.nextPlan&&FDBK.pub("new-payment-initiated")):a.nextPlan?g.prop("src",a.nextPlan.actionUrl):g.prop("src","bt/form/update"),!1}),$(document).on("click",".plan-continue",function(){if($(this).hasClass("disabled"))return;$(this).addClass("disabled");var b=$(this).data("action");b==="current"?a.renewPlan():b==="pastdue"?a.retryCharge():FDBK.API.xhr({url:$(this).data("url"),type:"GET",requiresLogin:!0},{success:function(c){c.success?(a.updatePlan(),b==="upgrade"?(FDBK.openModal("#upgrade-success-dialog"),FDBK.pub("user-upgraded-plan",a.getCurrentPlanName())):b==="downgrade"&&(FDBK.openModal("#downgrade-success-dialog"),FDBK.pub("user-downgraded-plan",a.getCurrentPlanName()))):c.message==="creditCardRequired"?(a.initPaymentForm(),$('[name="payment-iframe"]').prop("src","/bt/form/create?plan="+a.nextPlan.plan.name),FDBK.openModal("#subscription-dialog"),FDBK.showServerError({message:FDBK.loc(c.message)})):FDBK.showServerError({message:c.message,style:"error"})}})})},cleanPaymentForm:function(){$("#subscription-dialog").empty(),FDBK.showServerError({selector:"#subscription-dialog"})},applyDiscount:function(){var a=this,b=$.trim($("#customer_discount_code").val());if(b){FDBK.cleanServerError();var c=$("#pay-subscription-form").find("input[type=submit]");c.prop("disabled",!0),FDBK.API.xhr(FDBK.API.CALL_VERIFY_DISCOUNT_CODE,{data:{planName:a.nextPlan.plan.name,code:b},success:function(d){if(d.success)if(d.object.valid){FDBK.showServerError({message:FDBK.loc("_Discount code was successfully applied.")}),$(".toggle-discount").remove(),$("#total-price").text(d.object.newPrice),$("#discount-form").remove();var e=$('[name="payment-iframe"]'),f=e.prop("src");a.discountCode=b,e.prop("src",f+"&voucherCode="+b)}else FDBK.showServerError({message:FDBK.loc("_Invalid discount code."),style:"error"}),c.prop("disabled",!1);else FDBK.showServerError({message:FDBK.loc("_Discount code could not be processed."),style:"error"}),c.prop("disabled",!1)}})}else $(".toggle-discount").trigger("click")},renewPlan:function(){var a=this;FDBK.API.xhr({url:"/a/subscr/renew?planId="+a.getPlanId(FDBK.USER_DATA.plan),type:"GET",requiresLogin:!0},{success:function(b){b.success?(a.updatePlan(),FDBK.openModal("#renew-success-dialog")):FDBK.showServerError({message:b.message,style:"error"})}})},retryCharge:function(){var a=this;FDBK.API.xhr({url:"/a/subscr/retrycharge",type:"GET",requiresLogin:!0},{success:function(b){b.success?(a.updatePlan(),FDBK.openModal("#pastdue-success-dialog")):FDBK.showServerError({message:b.message,style:"error"})}})},changePlan:function(){var a=this;a.getCurrentPlan();if(a.currentPlan.plan.name==="moqups-free")a.initPaymentForm(),FDBK.cleanServerError(),FDBK.openModal("#subscription-dialog"),FDBK.pub("opened-payment-form");else{a.$plans.find(".modal-content").prepend($("#tmpl-plan-confirmation").loc_tmpl({currentPlan:a.currentPlan,nextPlan:a.nextPlan,leftDays:a.getLeftDays()}));var b=$("#plan-confirmation").fadeIn("fast");a.nextPlan.plan.price||(b.find(".plan-continue").addClass("disabled"),FDBK.API.xhr(FDBK.API.CALL_GET_ALL_PROJECTS,{success:function(c){if(c.object){var d=c.object,e=0;$.each(a.nextPlan.planRestrictions,function(a,b){b.restrictionType==="project"&&(e=b.limit)}),d.length>e?(b.find(".button").remove(),b.find(".alert").html('<strong class="title">Downgrade warning</strong>You currently have '+d.length+" active projects. The Free plan allows only 2 active projects.<br/>Please <strong>archive</strong> or <strong>delete</strong> at least "+(d.length-e)+' of your <a href="#" class="open-projects"><strong>active projects</strong></a> before downgrading.'),FDBK.pub("free-downgrade-blocked")):b.find(".plan-continue").removeClass("disabled")}}}))}},getCurrentPlan:function(){var a=this;return $.each(a.freePricingPlans,function(b,c){c.plan.name===FDBK.USER_DATA.plan&&($.extend(c.plan,a.pricingDetails[c.plan.name],!0),a.currentPlan=c)}),a.currentPlan},getYearlyPlanPrice:function(){var a=this,b=0;return a.nextPlan&&a.nextPlan.plan.billingCycle==="year"?b=a.nextPlan.plan.price:a.nextPlan&&$.each(a.freePricingPlans,function(c,d){d.plan.name===a.nextPlan.plan.name+"-yearly"&&(b=d.plan.price)}),b},getCurrentPlanName:function(){return FDBK.pricingDetails[FDBK.getCurrentPlan().plan.name].fullName},getPlanProjectsLimit:function(){var a=this,b=0;return a.getCurrentPlan(),$.each(a.currentPlan.planRestrictions,function(a,c){c.restrictionType==="project"&&(b=c.limit)}),b},getPlanId:function(a){var b=null,c=this;return $.each(c.freePricingPlans,function(c,d){a===d.plan.name&&(b=d.plan.id)}),b},getCardInfo:function(){var a=$(".show-card");a.html("Loading data..."),FDBK.API.xhr(FDBK.API.CALL_GET_CC_INFO,{success:function(b){a.html($.loc_tmpl("<strong>{{= maskedNumber }}</strong> (exp: {{= expirationMonth }}/{{= expirationYear }})",b.object))}})},getLeftDays:function(){var a=moment(FDBK.USER_DATA.nextBillingDate?FDBK.USER_DATA.nextBillingDate:FDBK.SERVER_TIME),b=moment(FDBK.SERVER_TIME),c=a.diff(b,"days");return c>0?c:0},showPricingPlans:function(){var a=this;FDBK.openModal("#plans-dialog","pricing"),FDBK.USER_DATA.plan==="moqups-free"||!FDBK.USER_DATA.plan?(a.pricingPlans=a.freePricingPlans,a.generatePricingTable()):a.pricingPlans?a.generatePricingTable():(a.generatePricingTable(),a.getPricingPlans()),a.hasSeenPricing=!0,FDBK.pub("opened-pricing-plans")},initPaymentForm:function(){var a=this;a.discountCode=null,$("#subscription-dialog").html($("#tmpl-subscription-form").loc_tmpl({currentPlan:a.getCurrentPlan(),nextPlan:a.nextPlan,yearlyPrice:a.getYearlyPlanPrice(),user:FDBK.USER_DATA,countries:a.countries})),$("input.cc-exp-field").payment("formatCardExpiry"),$("input.cc-number-field").payment("formatCardNumber"),$("input.cc-cvv-field").payment("formatCardCVC")},showPaymentHistory:function(){var a=this;FDBK.openModal("#payment-dialog"),$("#payment-history").html($("#tmpl-loading").loc_tmpl()),a.getPaymentHistory()},getPaymentHistory:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_PAYMENT_HISTORY,{success:function(b){var c=b.object.reverse(),d=c[0];$("#payment-history").html($("#tmpl-payment-history").loc_tmpl({payments:c,nextPayDate:d?d.nextPayDate:null,currentPlan:a.getCurrentPlan()})),a.getCardInfo()}})},getPricingPlans:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_PLANS,{success:function(b){b.success&&(a.pricingPlans=b.object,a.generatePricingTable())}})},generatePricingTable:function(a){var b=this,c=[],d=b.getCurrentPlan()?b.getCurrentPlan().plan.billingCycle:"month",e=a?a:d;b.pricingPlans&&$.each(b.pricingPlans,function(a,d){e==="month"?b.pricingDetails[d.plan.name]&&($.extend(d.plan,b.pricingDetails[d.plan.name],!0),d.actualStatus=FDBK.USER_DATA.planStatus,b.pricingDetails[d.plan.name].showPlan&&c.push(d)):b.pricingDetails[d.plan.name]&&b.pricingDetails[d.plan.name].billingCycle==="year"&&($.extend(d.plan,b.pricingDetails[d.plan.name],!0),d.actualStatus=FDBK.USER_DATA.planStatus,c.push(d))}),b.$plans.html($("#tmpl-plans").loc_tmpl({plans:c,hasSession:FDBK.library.isUserLoggedIn(),currentPlan:b.getCurrentPlan(),newAccount:b.newAccount,cycleOption:e}))},getCreateSubscriptionForm:function(){$("#pay-subscription-form").find("input").prop("disabled",!1),$("input[name=payment-type]").prop("disabled",!1),$(".cc-number-field").prop("name","customer[credit_card][number]"),$(".cc-exp-field").prop("name","customer[credit_card][expiration_date]"),$(".cc-name-field").prop("name","customer[credit_card][cardholder_name]"),$(".cc-cvv-field").prop("name","customer[credit_card][cvv]")},getUpdateSubscriptionForm:function(){$("#pay-subscription-form").find("input").prop("disabled",!1),$("#subscription-dialog").find(".plan-continue").removeClass("disabled"),$(".cc-number-field").prop("name","credit_card[number]"),$(".cc-exp-field").prop("name","credit_card[expiration_date]"),$(".cc-name-field").prop("name","credit_card[cardholder_name]"),$(".cc-cvv-field").prop("name","credit_card[cvv]")},updateCurrentPlanPlaceholders:function(){var a=this;$(".current-plan-name").text(a.getCurrentPlanName())},paymentSuccessful:function(){var a=this;a.paymentInProgress=!1,a.nextPlan?(FDBK.openModal("#upgrade-success-dialog"),FDBK.pub("new-payment-successful",a.nextPlan.plan.price),a.updatePlan()):FDBK.USER_DATA.planStatus==="expired"?a.renewPlan():FDBK.USER_DATA.planStatus==="pastdue"?a.retryCharge():FDBK.openModal("#card-success-dialog"),a.cardType=null},paymentUnsuccessful:function(a){var b=this;b.paymentInProgress=!1;var c=$('[name="payment-iframe"]'),d=b.discountCode?"&voucherCode="+b.discountCode:"";b.nextPlan?(c.prop("src",b.nextPlan.actionUrl+d),FDBK.pub("new-payment-error",{cardType:b.cardType,errorMessage:a,planName:b.nextPlan.plan.name,userName:FDBK.USER_DATA.userName,email:FDBK.USER_DATA.email})):c.prop("src","bt/form/update"),FDBK.showServerError({message:a,style:"error"}),b.cardType=null},updatePlan:function(){var a=this;a.nextPlan&&(FDBK.USER_DATA.plan=a.nextPlan.plan.name),FDBK.USER_DATA.planStatus="active",a.nextPlan=null,a.pricingPlans=null,a.newAccount=!1,a.updateCurrentPlanPlaceholders(),FDBK.pub("plan-updated")}}),FDBK.mixinModule("project-history",{history:null,_revisions:null,$history:!1,initModule:function(){function b(){return FDBK.allowRevisions()?(a.openInputConfirmationDialog({heading:FDBK.loc("_Create new revision"),message:FDBK.loc("_Please describe the changes you have made in this revision:"),primaryActionTitle:FDBK.loc("_Create Revision"),inputPlaceHolder:FDBK.loc("_Revised on ")+moment(new Date).format("dddd, ha"),primaryAction:function(b){a.createRevision(b)}}),$(".confirmation-title").focus(),!1):(FDBK.showRevisionsAlert(),!1)}this.$history=$("#history");var a=this;$("#project-history-button, #quick-revision").addClass("disabled"),FDBK.sub("open-project",function(){FDBK.library.currentProject.uniqueId&&$("#project-history-button, #quick-revision").removeClass("disabled")}),FDBK.sub("user-logged-out close-project",function(){$("#project-history-button, #quick-revision").addClass("disabled")}),$("#create-project-revision, #history-dialog-create-revision").on("click",b),$(document).on("keydown",null,"alt+ctrl+r meta+alt+r",function(){return FDBK.quickRevision(),!1}).on("keydown",null,"alt+ctrl+h meta+alt+h",function(){return FDBK.showHistory(),!1}),$("#quick-revision").on("click",function(){FDBK.quickRevision()}),this.$history.on("click",".revision-action",function(b){var c=$(this).data("action"),d=$(b.target).closest(".project")[0].id.replace("_",""),e=a.findRevision(d);if(c=="fork")a.fetchRevisions(d,function(b){if(!b)return;var c=b.data.snapshot;a.openInputConfirmationDialog({heading:FDBK.loc("_Create new project from revision"),message:FDBK.loc("_Enter new project name: "),primaryActionTitle:FDBK.loc("_Create Project"),inputPlaceHolder:FDBK.library.currentProject.name+" "+FDBK.loc("_Copy"),inputValue:FDBK.library.currentProject.name+" "+FDBK.loc("_Copy"),primaryAction:function(a){c.name=a,FDBK.library.closeCurrentProject(),FDBK.library.serviceClient.createProject(c,function(){FDBK.closeModal()})}}),$(".confirmation-title").focus()});else if(c=="view")a.fetchRevisions(d,function(a){if(!a)return;FDBK.library.previewProject(a.data.snapshot,!1)});else if(c=="restore"){var f=function(){a.fetchRevisions(d,function(a){function e(a,b){a||(FDBK.library.openProject(b,!0),$("#project-save-status").removeClass("saved"),FDBK.library.currentProject.updateAttributes(c),FDBK.pub("project-saved")),FDBK.closeModal()}var b=(new FDBK.Project(a.data.snapshot)).toServerJSON(),c=FDBK.library.currentProject.getAttributes(),d=FDBK.library.currentProject.uniqueId;FDBK.library.serviceClient.replaceProjectData(b,function(){FDBK.library.closeCurrentProject(),FDBK.library.serviceClient.getProjectJSON(d,e)})})};FDBK.openConfirmDialog({heading:FDBK.loc("_Restore project"),message:FDBK.loc("_Are you sure you want to restore the current project to an older revision ?"),buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal"},{text:FDBK.loc("_Restore project"),classes:"primary-action right",onClick:f}]})}else c=="delete"?FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Are you sure you want to delete this revision?"),buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal",onClick:function(){window.setTimeout(function(){a.history=a._revisions,a.showHistory()},0)}},{text:FDBK.loc("_Delete Revision"),classes:"primary-action right",onClick:function(){a.deleteRevision(d)}}]}):c=="rename"&&(a.openInputConfirmationDialog({heading:FDBK.loc("_Rename revision"),message:FDBK.loc("_Please describe the changes you have made in this revision:"),primaryActionTitle:FDBK.loc("_Rename revision"),inputPlaceHolder:e.title,inputValue:e.title,primaryAction:function(b){a.renameRevision(d,b)},cancelAction:function(){window.setTimeout(function(){a.history=a._revisions,a.showHistory()},0)}}),$(".confirmation-title").val(e.title).focus()[0].setSelectionRange(0,1e3))})},showHistory:function(){var a=this;FDBK.openModal("#history-dialog"),FDBK.allowRevisions()||FDBK.showServerError({message:'Project revisions are not available in your current plan. <br/><a href="#" class="open-dialog" data-dialog="plans-pricing">Upgrade Now!</a>',style:"upgrade"}),this.$history.empty();if(!this.history){this.$history.append('<p class="no-projects">Loading revisions...</p>'),this.fetchHistory();return}this.history.length===0&&this.$history.append($('<p class="no-projects">No revisions for this project</p>')),this.$history.append($("#tmpl-history").loc_tmpl(this.history)),this._revisions=this.history,this.history=null},showErrorOnFetch:function(){this.$history.empty(),this.$history.append($('<p class="no-projects">There was an error loading revisions.</p>'))},quickRevision:function(){if(!FDBK.allowRevisions())return FDBK.showRevisionsAlert(),!1;var a=FDBK.library.currentProject;if(a&&a.uniqueId){var b=FDBK.loc("_Revised on ")+moment(new Date).format("dddd, ha");this.createRevision(b)}},createRevision:function(a){FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{data:{title:a},contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions"],success:function(a){a.success?($("#project-revision-saved").addClass("shown"),setTimeout(function(){$("#project-revision-saved").removeClass("shown")},3e3)):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},findRevision:function(a){for(var b=0;b<this._revisions.length;b++)if(this._revisions[b]._id==a)return this._revisions[b];return nil},deleteRevision:function(a){var b=this;FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{type:"DELETE",contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){a.success?b.showHistory():FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Oops. Something went wrong. Please try again."),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},renameRevision:function(a,b){FDBK.API.xhr(FDBK.API.CALL_CREATE_PROJECT_REVISION,{data:{title:b},type:"PUT",contentType:"application/x-www-form-urlencoded",urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){a.success?($("#project-revision-saved").addClass("shown"),setTimeout(function(){$("#project-revision-saved").removeClass("shown")},3e3)):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error saving your revision"),buttons:[{text:FDBK.loc("_OK"),classes:"right primary-action"}]})}})},fetchHistory:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT_STREAM,{urlParams:[FDBK.library.currentProject.uniqueId,"revisions","?sort=createDate.desc&fields=_id,_docId,createDate,user,title"],success:function(b){b.success&&b.object?(a.history=b.object.reverse(),a.showHistory()):(a.showErrorOnFetch(),this.history=null)},error:function(){a.showErrorOnFetch(),this.history=null}})},fetchRevisions:function(a,b){var c=this;FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT_STREAM,{urlParams:[FDBK.library.currentProject.uniqueId,"revisions",a],success:function(a){if(a.success&&a.object)return b(a.object);b()},error:function(){b()}})},openInputConfirmationDialog:function(a){var b=function(){$(document).bind("keydown","return",d),$(".confirmation-title").bind("keydown","return",d),FDBK.sub("modal-closed",c)},c=function(){$(document).unbind("keydown",d),$(".confirmation-title").unbind("keydown",d),FDBK.unsub("modal-closed",c)},d=function(){var b=$(".confirmation-title").val()||$(".confirmation-title").attr("placeholder");return a.primaryAction(b),FDBK.closeModal(),!1};FDBK.openConfirmDialog({heading:a.heading,showCloseButton:!0,message:a.message+'<input name="name" class="confirmation-title reset-input" type="text" maxlength="255" placeholder="'+(a.inputPlaceHolder||"")+'" value="'+(a.inputValue||"")+'" style="margin:10px 0 0 0;width:360px">',buttons:[{text:FDBK.loc("_Cancel"),classes:"close-modal",onClick:function(){a.cancelAction&&a.cancelAction()}},{text:a.primaryActionTitle,classes:"right primary-action",onBeforeClick:d}]}),b()}}),FDBK.mixinModule("project-themes",{initModule:function(){if(FDBK.config("projectManagement.font.enabled")){var a=this;FDBK.sub("open-project",function(){a.applyProjectFont(FDBK.library.currentProject.font)}),FDBK.sub("loaded-user-settings",this.selectDefaultFont);if($("#project-fonts").length){for(var b=0,c="",d=FDBK.config("projectManagement.font.list");b<d.length;b++)c+='<label class="preview-font '+d[b].value+'" title="'+d[b].description+'" >      <input type="radio" name="font" value="'+d[b].value+'"/>'+d[b].name+"</label>";$("#project-fonts").append(c).find("[name=font]").on("change",function(){a.saveProjectFontPreference($(this).val())}).end(),this.selectDefaultFont()}}else $("#project-fonts").hide()},selectDefaultFont:function(){var a=FDBK.library.getUserSettings("defaultFont")||FDBK.config("projectManagement.font.default");$("#project-fonts").find('[value="'+a+'"]').attr("checked","checked")},applyProjectFont:function(a){var b=FDBK.config("projectManagement.font.list").map(function(a){return a.value}).join(" ");$("html").removeClass(b).addClass(a)},saveProjectFontPreference:function(a){FDBK.library.setUserSettings("defaultFont",a)}}),FDBK.mixinModule("projectRevisions",{getProjectSessions:function(a,b){},getProjectRevisionsForSession:function(a,b,c){},getProjectRevisionJSON:function(a,b,c){}}),FDBK.mixinModule("project-comments",{comments:[],commentsSelection:"all",COMMENTS_SELECTION_ALL:"all",COMMENTS_SELECTION_CURRENT:"current",$sidebarComments:null,$commentsWrapper:null,$commentsButton:null,replyToCommentId:!1,initModule:function(){function g(a){var c=null,d=FDBK.library.currentMockup.id,e=$("#new-comment"),g=e.val();if(b.replyToCommentId){c=b.replyToCommentId;var h=b.getComment(c);h&&h.pageId&&(d=h.pageId)}if($.trim(g)){var i={};FDBK.library.currentMockup.selection.length&&(i.stencilIds=FDBK.library.currentMockup.selection.map(function(a){return a.id})),b.postComment({uniqueId:"comment-"+utils.guid(),projectUniqueId:FDBK.library.currentProject.uniqueId,parentUniqueId:c,pageId:d,text:g,attributes:JSON.stringify(i),author:FDBK.USER_DATA}),e.val("").blur(),c&&$(".cancel-comment").click()}f()}this.$sidebarComments=$("#comments"),this.$commentsWrapper=$(".comments-wrapper"),this.$commentsButton=$("#comments-button"),this.$metaGhostWrapper=$("#meta-ghost-wrapper");var a=BrowserDetect.isMac?"&#8984;&#8617;":"Ctrl+Enter";$(".submit-comment-shortcut").html(a);var b=this;FDBK.sub("open-project",function(){this.$commentsButton.find(".comment-count").text(""),FDBK.VIEWER_MODE&&FDBK.library.currentProject.ownerIsPremium&&!FDBK.USER_DATA.userName&&(this.$commentsButton.hide(),$("#notification-settings").hide(),FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(a){a.success&&(FDBK.USER_DATA=$.extend(FDBK.USER_DATA,a.object.user)),b.$commentsButton.show(),FDBK.library.currentProject.canCommentProject()&&$("#notification-settings").show(),FDBK.pub("viewer-user-logged-in")},error:function(){b.$commentsButton.show()}}))}),FDBK.sub("user-logged-in open-project",function(){FDBK.library.isUserLoggedIn()&&FDBK.library.currentProject&&this.$commentsButton.removeClass("disabled")}),FDBK.sub("user-logged-out close-project",function(){this.$commentsButton.addClass("disabled").removeClass("pressed"),this.comments.length=0,this.$sidebarComments.empty(),$("body").removeClass("has-right-sidebar")}),FDBK.sub("viewer-user-logged-in mockup-changed",function(){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.showComments()}),FDBK.sub("open-project refresh-comments",function(a){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.fetchComments()}),FDBK.config("comments.stencilLinks.enabled")&&$(document).on("click",".comment-link",function(){FDBK.goToStencils($(this).data("stencil-ids").split(" "))}),b.$commentsButton.on("click",function(){if($(this).hasClass("disabled"))return;if(FDBK.VIEWER_MODE&&!FDBK.USER_DATA.userName){FDBK.library.askForSession();return}if(FDBK.VIEWER_MODE&&!FDBK.library.currentProject.canCommentProject()){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You're not authorized to comment on this project"),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal"}]});return}if(!FDBK.VIEWER_MODE&&!FDBK.hasPremiumPlan()&&!FDBK.library.currentProject.isPremiumProject()){FDBK.showCommentsAlert();return}$(this).toggleClass("pressed"),$("body").toggleClass("has-right-sidebar"),FDBK.centerTheProject&&setTimeout(function(){FDBK.centerTheProject()},300)}),$("#comments").on("click","a",function(a){var c=$(this).data("type"),d=$(a.target).closest(".comment"),e=d.data("id");c==="delete"?d.length>0&&(a.shiftKey?b.deleteComment(e):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Are you sure you want to delete this comment ?"),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){b.deleteComment(e)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})):c==="reply"?(b.replyToCommentId=e,$("#add-comment").find(".new").hide().end().find(".reply").show(),$(this).parents(".comment").siblings().addClass("disabled"),$("#new-comment").prop("placeholder","Reply to comment...").focus()):c==="unlink"&&b.unlinkComment(e)});var c=$("#comments-sidebar"),d=$("#add-comment"),e=function(){c.removeClass("hide-new-comment")},f=function(){c.addClass("hide-new-comment")};FDBK.config("comments.stencilLinks.enabled")&&FDBK.sub("selection-changed",function(a){a.length?d.addClass("link-to-stencil"):d.removeClass("link-to-stencil")}),$("#new-comment").on({focus:e}),$(document).on("click",".cancel-comment",function(){b.replyToCommentId=!1,$("#add-comment").find(".reply").hide().end().find(".new").show(),$(".comment").removeClass("disabled"),$("#new-comment").prop("placeholder","New comment..."),f()}),$(document).on("click",".send-comment",g),$("#new-comment").on("keydown",null,"meta+return ctrl+return",g),jQuery.fn.highlight=function(a,b){$(this).each(function(){var c=$(this);c.before("<div/>"),c.prev().width(c.width()).height(c.height()).css({position:"absolute","background-color":a,opacity:".7"}).fadeOut(b)})},FDBK.sub("open-project",function(){$("[name=comments-notification]").prop("checked",FDBK.library.currentProject.notificationsCommentsEnabled)}),$(document).on("change","[name=comments-notification]",function(){var a=$(this).is(":checked");FDBK.library.currentProject.notificationsCommentsEnabled=a,FDBK.API.xhr(FDBK.API.CALL_SET_NOTIFICATION,{data:{enabled:a,type:"comments",projectUniqueId:FDBK.library.currentProject.uniqueId},contentType:"application/x-www-form-urlencoded"})}),FDBK.config("comments.allVsCurrent.enabled")?($("#comments-selector").on("click","a",function(){var a=$(this).data("value");switch(a){case"all":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_ALL;break;case"current":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_CURRENT}$(this).addClass("selected").siblings("a").removeClass("selected"),b.showComments()}),$("#comments-selector a[data-value="+FDBK.commentsSelection+"]").addClass("selected")):$("#comments-selector").hide()},goToStencils:function(a){if(!a.length)return;var b=FDBK.library,c=b.currentProject.mockupFromStencilId(a[0]);if(!c){console.info("This stencil is not available; mockup not found.");return}c.id!==b.currentMockup.id&&(FDBK.VIEWER_MODE?FDBK.switchToMockup(c,!0):b.changeActiveMockup(c.id));var d=a.filter(function(a){return b.currentMockup.stencil(a)!==null&&document.getElementById(a)});if(d.length){FDBK.VIEWER_MODE?FDBK.highlightStencils(d):(b.currentMockup.selection=d.map(function(a){return document.getElementById(a)}),b.showSelection(),b.focusStage());var e=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).top})),f=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).left})),g=FDBK.VIEWER_MODE?document.getElementById("page"):document.getElementById("project-wrapper");g.scrollLeft=f,g.scrollTop=e}else FDBK.VIEWER_MODE||(b.currentMockup.selection.length=0,b.showSelection(),b.focusStage())},showCommentGhosts:function(a){for(var b=0;b<a.length;b++){var c=a[b].id,d=FDBK.library.currentMockup.stencil(c);d&&this.$metaGhostWrapper.find("[data-stencil="+c+"]").css({top:d.top,left:d.left})}this.$metaGhostWrapper.removeClass("hidden")},hideCommentGhosts:function(a){this.$metaGhostWrapper.addClass("hidden")},getCommentsForPage:function(a){return this.comments.filter(function(b){return!a||b.pageId===a})},getComment:function(a){var b=this.getCommentsForPage();for(var c=0;c<b.length;c++){var d=b[c];if(d.uniqueId==a)return d}return null},sortComments:function(){var a=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?-1:a.createDate<b.createDate?1:0:1:-1},b=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?1:a.createDate<b.createDate?-1:0:-1:1};this.comments=this.comments.filter(function(a){return!a.parentUniqueId}).sort(a).concat(this.comments.filter(function(a){return a.parentUniqueId}).sort(b))},getCommentSummary:function(a){var b="",c=this.getComment(a);return c.text.length<=30?b=c.text:b=c.text.substring(0,30)+"...",b},scrollSidebarToComment:function(a){var b=this.getComment(a),c=a;b.parentUniqueId&&(c=b.parentUniqueId);var d=this.$sidebarComments.find("[data-id="+c+"]");this.$commentsWrapper.scrollTop(this.$commentsWrapper.scrollTop()+d.position().top),this.$sidebarComments.find("[data-id="+a+"]").highlight("#c2e2fd",600)},showComments:function(a){var b=FDBK.commentsSelection===FDBK.COMMENTS_SELECTION_ALL?null:FDBK.library.currentMockup.id,c=this.getCommentsForPage(b);a&&a.highlight&&(this._commentHighlightTimer||(this._commentHighlightTimer=AppSeeds.Scheduler.create(function(){FDBK.$commentsButton.removeClass("button-highlighted")}).delay(1e3)),this.$commentsButton.addClass("button-highlighted"),this._commentHighlightTimer.reset());var d=FDBK.library.currentProject.canDeleteComments(),e=$("#tmpl-comment");this.$sidebarComments.empty(),this.$commentsButton.find(".comment-count").text(this.comments.length);if(c.length)for(var f=0;f<c.length;f++){var g=c[f];g=$.extend(!0,g,{canDeleteComment:d,commentMarkdownHtml:utils.markdown(g.text),timestamp:moment(Math.min(g.createDate,FDBK.SERVER_TIME)).from(Math.max(FDBK.SERVER_TIME,g.createDate))+"",author:{avatar:utils.gravatarImageURL(g.author.email)}}),!FDBK.config("comments.stencilLinks.enabled")&&g.attributes&&g.attributes.stencilIds&&delete g.attributes.stencilIds;var h=g.parentUniqueId?this.$sidebarComments.find("[data-id="+g.parentUniqueId+"]"):this.$sidebarComments;h.append(e.loc_tmpl(g))}else this.$sidebarComments.append('<p class="no-comments">'+FDBK.loc("_No comments for this page.")+"</p>")},ALL_PAGES:"ALL_PAGES_EVER",fetchComments:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_COMMENTS,{data:{projectUniqueId:FDBK.library.currentProject.uniqueId},success:function(b){b.success?(a.comments=(b.object||[]).map(a.prepareComments),a.sortComments(),a.showComments({highlight:!0})):a.showErrorOnFetchComments()},error:function(){a.showErrorOnFetchComments()}})},showErrorOnFetchComments:function(){},prepareComments:function(a){if(typeof a.attributes=="string")try{a.attributes=JSON.parse(a.attributes)}catch(b){console.warn("could not parse comment attributes")}return a},addComment:function(a,b){this.prepareComments(b),this.comments.push(b),this.sortComments(),this.showComments(),this.scrollSidebarToComment(b.uniqueId),FDBK.pub("comment-posted",a,b)},postComment:function(a){function g(a,c){var d=b.comments;for(var e=0;e<d.length;e++)d[e].uniqueId===a&&(d[e].uniqueId=c.uniqueId,d[e].createDate=c.createDate);b.showComments()}var b=this,c=FDBK.library.currentMockup.id,d=["projectUniqueId","parentUniqueId","pageId","text","attributes"],e={};for(var f=0;f<d.length;f++)e[d[f]]=a[d[f]];FDBK.API.xhr(FDBK.API.CALL_ADD_COMMENT,{data:JSON.stringify(e),success:function(b){b.success?g(a.uniqueId,b.object):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}}),b.addComment(c,a)},unlinkComment:function(a){},deleteComment:function(a){var b=this,c=FDBK.library.currentMockup.id;this.comments=this.comments.filter(function(b){return b.uniqueId!=a&&b.parentUniqueId!=a}),this.showComments(),FDBK.API.xhr(FDBK.API.CALL_DELETE_COMMENTS,{data:{uniqueId:a},success:function(a){a.success?FDBK.pub("comment-posted",c):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}})}})