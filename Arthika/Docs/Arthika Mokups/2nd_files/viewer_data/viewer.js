(function(a){function b(a){a.startMove=a.startMove?a.startMove:{startX:null,startY:null,timestamp:null};var b=(new Date).getTime();if(a.touches){var c=[{lastX:a.deltaX,lastY:a.deltaY,moved:null,startX:a.screenX-a.startMove.screenX,startY:a.screenY-a.startMove.screenY}],d={vector:a.vector,orientation:window.orientation||null,lastX:c[0].lastX>0?1:c[0].lastX<0?-1:0,lastY:c[0].lastY>0?1:c[0].lastY<0?-1:0,startX:c[0].startX>0?1:c[0].startX<0?-1:0,startY:c[0].startY>0?1:c[0].startY<0?-1:0};c[0].moved=Math.sqrt(Math.pow(Math.abs(c[0].startX),2)+Math.pow(Math.abs(c[0].startY),2))}return{type:a.type||null,originalEvent:a.event||null,delta:c||null,direction:d||{orientation:window.orientation||null,vector:a.vector||null},duration:a.startMove.timestamp?b-a.timestamp:null,rotation:a.rotation||null,scale:a.scale||null,description:a.description||[a.type,":",a.touches,":",c[0].lastX!=0?c[0].lastX>0?"right":"left":"steady",":",c[0].lastY!=0?c[0].lastY>0?"down":"up":"steady"].join("")}}function c(b){var c=["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"];a(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",c[window.orientation/90+1],window.orientation].join("")})}function d(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.touchstart,b),a.hasGestures?(b.currentTarget.addEventListener("touchmove",e,!1),b.currentTarget.addEventListener("touchend",f,!1)):(c.bind("mousemove",e),c.bind("mouseup",f));var d=c.data("ojQueryGestures"),g=b.touches?b.touches[0]:b,h={};h.oLastSwipemove={screenX:g.screenX,screenY:g.screenY,timestamp:(new Date).getTime()},h.oStartTouch={screenX:g.screenX,screenY:g.screenY,timestamp:(new Date).getTime()},c.data("ojQueryGestures",a.extend(!0,d,h))}function e(c){var d=jQuery(c.currentTarget),e=d.data("ojQueryGestures"),f=!!c.touches,g=f?c.changedTouches[0].screenX:c.screenX,h=f?c.changedTouches[0].screenY:c.screenY,i=e.oLastSwipemove,j=g-i.screenX,k=h-i.screenY;if(!!e.oLastSwipemove){var l=b({type:"swipemove",touches:f?c.touches.length:"1",screenY:h,screenX:g,deltaY:k,deltaX:j,startMove:i,event:c,timestamp:i.timestamp});d.triggerHandler(l.type,l)}var m={},n=c.touches?c.touches[0]:c;m.oLastSwipemove={screenX:n.screenX,screenY:n.screenY,timestamp:(new Date).getTime()},d.data("ojQueryGestures",a.extend(!0,e,m))}function f(c){var d=jQuery(c.currentTarget),g=!!c.changedTouches,h=g?c.changedTouches.length:"1",i=g?c.changedTouches[0].screenX:c.screenX,j=g?c.changedTouches[0].screenY:c.screenY;d.triggerHandler(a.jGestures.events.touchendStart,c),a.hasGestures?(c.currentTarget.removeEventListener("touchmove",e,!1),c.currentTarget.removeEventListener("touchend",f,!1)):(d.unbind("mousemove",e),d.unbind("mouseup",f));var k=d.data("ojQueryGestures"),l=Math.abs(k.oStartTouch.screenX-i)>a.jGestures.defaults.thresholdMove||Math.abs(k.oStartTouch.screenY-j)>a.jGestures.defaults.thresholdMove?!0:!1,m=Math.abs(k.oStartTouch.screenX-i)>a.jGestures.defaults.thresholdSwipe||Math.abs(k.oStartTouch.screenY-j)>a.jGestures.defaults.thresholdSwipe?!0:!1,n;for(n in k){var o=k.oStartTouch,p={},i=g?c.changedTouches[0].screenX:c.screenX,j=g?c.changedTouches[0].screenY:c.screenY,q=i-o.screenX,r=j-o.screenY,s=b({type:"swipe",touches:h,screenY:j,screenX:i,deltaY:r,deltaX:q,startMove:o,event:c,timestamp:o.timestamp}),t=["zero","one","two","three","four"],u=!1;switch(n){case"swipeone":if(g===!1&&h==1&&l===!1)break;if(g===!1||h==1&&l===!0&&m===!0)u=!0,s.type=["swipe",t[h]].join(""),d.triggerHandler(s.type,s);break;case"swipetwo":g&&h==2&&l===!0&&m===!0&&(u=!0,s.type=["swipe",t[h]].join(""),d.triggerHandler(s.type,s));break;case"swipethree":g&&h==3&&l===!0&&m===!0&&(u=!0,s.type=["swipe",t[h]].join(""),d.triggerHandler(s.type,s));break;case"swipefour":g&&h==4&&l===!0&&m===!0&&(u=!0,s.type=["swipe",t[h]].join(""),d.triggerHandler(s.type,s));break;case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":g&&l===!0&&m===!0&&(u=!0,s.type=["swipe",s.delta[0].lastX!=0?s.delta[0].lastX>0?"right":"left":"",s.delta[0].lastY!=0?s.delta[0].lastY>0?"down":"up":""].join(""),d.triggerHandler(s.type,s));break;case"tapone":case"taptwo":case"tapthree":case"tapfour":l!==!0&&u!==!0&&t[h]==n.slice(3)&&(s.description=["tap",t[h]].join(""),s.type=["tap",t[h]].join(""),d.triggerHandler(s.type,s))}var v={};d.data("ojQueryGestures",a.extend(!0,k,v)),d.data("ojQueryGestures",a.extend(!0,k,v))}d.triggerHandler(a.jGestures.events.touchendProcessed,c)}function g(b){var c=jQuery(b.currentTarget);c.triggerHandler(a.jGestures.events.gesturestart,b);var d=c.data("ojQueryGestures"),e={};e.oStartTouch={timestamp:(new Date).getTime()},c.data("ojQueryGestures",a.extend(!0,d,e))}function h(c){var d=jQuery(c.currentTarget),e,f,g,h,i=d.data("ojQueryGestures"),j;for(j in i)switch(j){case"pinch":e=c.scale;if(e<1&&e%1<1-a.jGestures.defaults.thresholdPinchclose||e>1&&e%1>a.jGestures.defaults.thresholdPinchopen)f=e<1?-1:1,h=b({type:"pinch",scale:e,touches:null,startMove:i.oStartTouch,event:c,timestamp:i.oStartTouch.timestamp,vector:f,description:["pinch:",f,":",e<1?"close":"open"].join("")}),d.triggerHandler(h.type,h);break;case"rotate":e=c.rotation;if(e<1&&-1*e>a.jGestures.defaults.thresholdRotateccw||e>1&&e>a.jGestures.defaults.thresholdRotatecw)f=e<1?-1:1,h=b({type:"rotate",rotation:e,touches:null,startMove:i.oStartTouch,event:c,timestamp:i.oStartTouch.timestamp,vector:f,description:["rotate:",f,":",e<1?"counterclockwise":"clockwise"].join("")}),d.triggerHandler(h.type,h)}}function i(c){var d=jQuery(c.currentTarget);d.triggerHandler(a.jGestures.events.gestureendStart,c);var e,f=d.data("ojQueryGestures"),g;for(g in f)switch(g){case"pinchclose":e=c.scale,e<1&&e%1<1-a.jGestures.defaults.thresholdPinchclose&&d.triggerHandler("pinchclose",b({type:"pinchclose",scale:e,vector:-1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"pinch:-1:close"}));break;case"pinchopen":e=c.scale,e>1&&e%1>a.jGestures.defaults.thresholdPinchopen&&d.triggerHandler("pinchopen",b({type:"pinchopen",scale:e,vector:1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"pinch:+1:open"}));break;case"rotatecw":e=c.rotation,e>1&&e>a.jGestures.defaults.thresholdRotatecw&&d.triggerHandler("rotatecw",b({type:"rotatecw",rotation:e,vector:1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"rotate:+1:clockwise"}));break;case"rotateccw":e=c.rotation,e<1&&-1*e>a.jGestures.defaults.thresholdRotateccw&&d.triggerHandler("rotateccw",b({type:"rotateccw",rotation:e,vector:-1,touches:null,startMove:f.oStartTouch,event:c,timestamp:f.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}d.triggerHandler(a.jGestures.events.gestureendProcessed,c)}a.jGestures={},a.jGestures.defaults={},a.jGestures.defaults.thresholdPinchopen=.05,a.jGestures.defaults.thresholdPinchmove=.05,a.jGestures.defaults.thresholdPinch=.05,a.jGestures.defaults.thresholdPinchclose=.05,a.jGestures.defaults.thresholdRotatecw=5,a.jGestures.defaults.thresholdRotateccw=5,a.jGestures.defaults.thresholdMove=20,a.jGestures.defaults.thresholdSwipe=100,a.jGestures.data={},a.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"],a.jGestures.data.hasGestures=function(){var b;for(b=0;b<a.jGestures.data.capableDevicesInUserAgentString.length;b++)if(navigator.userAgent.indexOf(a.jGestures.data.capableDevicesInUserAgentString[b])!==-1)return!0;return!1}(),a.hasGestures=a.jGestures.data.hasGestures,a.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"},jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour"},function(b,j){jQuery.event.special[j]={setup:function(){var e=b.split("_"),f=e[0],j=e[1].slice(0,e[1].length-2),l=jQuery(this);if(!l.data("ojQueryGestures")||!l.data("ojQueryGestures")[f]){var m=l.data("ojQueryGestures")||{},n={};n[f]=!0,a.extend(!0,m,n),l.data("ojQueryGestures",m);if(a.hasGestures)switch(j){case"orientationchange":l.get(0).addEventListener("orientationchange",c,!1);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":l.get(0).addEventListener("touchstart",d,!1);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":l.get(0).addEventListener("gesturestart",g,!1),l.get(0).addEventListener("gestureend",i,!1);break;case"pinch":case"rotate":l.get(0).addEventListener("gesturestart",g,!1),l.get(0).addEventListener("gesturechange",h,!1)}else switch(j){case"tap":case"swipe":l.bind("mousedown",d);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":}}return!1},add:function(a){var b=jQuery(this),c=b.data("ojQueryGestures");return c[a.type]={originalType:a.type},!1},remove:function(a){var b=jQuery(this),c=b.data("ojQueryGestures");return c[a.type]=!1,b.data("ojQueryGestures",c),!1},teardown:function(){var j=b.split("_"),l=j[0],m=j[1].slice(0,j[1].length-2),n=jQuery(this);if(!n.data("ojQueryGestures")||!n.data("ojQueryGestures")[l]){var o=n.data("ojQueryGestures")||{},p={};p[l]=!1,a.extend(!0,o,p),n.data("ojQueryGestures",o);if(a.hasGestures)switch(m){case"orientationchange":n.get(0).removeEventListener("orientationchange",c,!1);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":n.get(0).removeEventListener("touchstart",d,!1),n.get(0).removeEventListener("touchmove",e,!1),n.get(0).removeEventListener("touchend",f,!1);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":n.get(0).removeEventListener("gesturestart",g,!1),n.get(0).removeEventListener("gestureend",i,!1);break;case"pinch":case"rotate":n.get(0).removeEventListener("gesturestart",g,!1),n.get(0).removeEventListener("gesturechange",h,!1)}else switch(m){case"tap":case"swipe":n.unbind("mousedown",d),n.unbind("mousemove",e),n.unbind("mouseup",f);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":}}return!1}}})})(jQuery),function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires=="number"){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g=d.raw?function(a){return a}:decodeURIComponent,h=document.cookie.split("; ");for(var i=0,j;j=h[i]&&h[i].split("=");i++)if(g(j[0])===b)return g(j[1]||"");return null}}(jQuery);var Markdown;typeof exports=="object"&&typeof require=="function"?Markdown=exports:Markdown={},function(){function a(a){return a}function b(a){return!1}function c(){}function d(){}c.prototype={chain:function(b,c){var d=this[b];if(!d)throw new Error("unknown hook "+b);d===a?this[b]=c:this[b]=function(a){return c(d(a))}},set:function(a,b){if(!this[a])throw new Error("unknown hook "+a);this[a]=b},addNoop:function(b){this[b]=a},addFalse:function(a){this[a]=b}},Markdown.HookCollection=c,d.prototype={set:function(a,b){this["s_"+a]=b},get:function(a){return this["s_"+a]}},Markdown.Converter=function(){function h(a){return a=a.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(a,c,d,f,g,h){return c=c.toLowerCase(),b.set(c,D(d)),g?f:(h&&e.set(c,h.replace(/"/g,"&quot;")),"")}),a}function i(a){var b="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",c="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,j),a=a.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,j),a=a.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,j),a=a.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,j),a=a.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,j),a}function j(a,b){var c=b;return c=c.replace(/^\n+/,""),c=c.replace(/\n+$/g,""),c="\n\n~K"+(f.push(c)-1)+"K\n\n",c}function k(a,b){a=s(a);var c="<hr />\n";return a=a.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,c),a=a.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,c),a=t(a),a=w(a),a=B(a),a=i(a),a=C(a,b),a}function l(a){return a=y(a),a=m(a),a=E(a),a=p(a),a=n(a),a=F(a),a=a.replace(/~P/g,"://"),a=D(a),a=A(a),a=a.replace(/  +\n/g," <br>\n"),a}function m(a){var b=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return a=a.replace(b,function(a){var b=a.replace(/(.)<\/?code>(?=.)/g,"$1`");return b=L(b,a.charAt(1)=="!"?"\\`*_/":"\\`*_"),b}),a}function n(a){return a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,o),a=a.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,o),a=a.replace(/(\[([^\[\]]+)\])()()()()()/g,o),a}function o(a,c,d,f,g,h,i,j){j==undefined&&(j="");var k=c,l=d.replace(/:\/\//g,"~P"),m=f.toLowerCase(),n=g,o=j;if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)!=undefined)n=b.get(m),e.get(m)!=undefined&&(o=e.get(m));else{if(!(k.search(/\(\s*\)$/m)>-1))return k;n=""}}n=K(n),n=L(n,"*_");var p='<a target="_blank" href="'+n+'"';return o!=""&&(o=q(o),o=L(o,"*_"),p+=' title="'+o+'"'),p+=">"+l+"</a>",p}function p(a){return a=a.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,r),a=a.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,r),a}function q(a){return a.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function r(a,c,d,f,g,h,i,j){var k=c,l=d,m=f.toLowerCase(),n=g,o=j;o||(o="");if(n==""){m==""&&(m=l.toLowerCase().replace(/ ?\n/g," ")),n="#"+m;if(b.get(m)==undefined)return k;n=b.get(m),e.get(m)!=undefined&&(o=e.get(m))}l=L(q(l),"*_[]()"),n=L(n,"*_");var p='<img src="'+n+'" alt="'+l+'"';return o=q(o),o=L(o,"*_"),p+=' title="'+o+'"',p+=" />",p}function s(a){return a=a.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(a,b){return"<h1>"+l(b)+"</h1>\n\n"}),a=a.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(a,b){return"<h2>"+l(b)+"</h2>\n\n"}),a=a.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(a,b,c){var d=b.length;return"<h"+d+">"+l(c)+"</h"+d+">\n\n"}),a}function t(a){a+="~0";var b=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return g?a=a.replace(b,function(a,b,c){var d=b,e=c.search(/[*+-]/g)>-1?"ul":"ol",f=v(d,e);return f=f.replace(/\s+$/,""),f="<"+e+">"+f+"</"+e+">\n",f}):(b=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,a=a.replace(b,function(a,b,c,d){var e=b,f=c,g=d.search(/[*+-]/g)>-1?"ul":"ol",h=v(f,g);return h=e+"<"+g+">\n"+h+"</"+g+">\n",h})),a=a.replace(/~0/,""),a}function v(a,b){g++,a=a.replace(/\n{2,}$/,"\n"),a+="~0";var c=u[b],d=new RegExp("(^[ \\t]*)("+c+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+c+")[ \\t]+))","gm"),e=!1;return a=a.replace(d,function(a,b,c,d){var f=d,g=b,h=/\n\n$/.test(f),i=h||f.search(/\n{2,}/)>-1;return i||e?f=k(H(f),!0):(f=t(H(f)),f=f.replace(/\n$/,""),f=l(f)),e=h,"<li>"+f+"</li>\n"}),a=a.replace(/~0/g,""),g--,a}function w(a){return a+="~0",a=a.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(a,b,c){var d=b,e=c;return d=z(H(d)),d=I(d),d=d.replace(/^\n+/g,""),d=d.replace(/\n+$/g,""),d="<pre><code>"+d+"\n</code></pre>","\n\n"+d+"\n\n"+e}),a=a.replace(/~0/,""),a}function x(a){return a=a.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(f.push(a)-1)+"K\n\n"}function y(a){return a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(a,b,c,d,e){var f=d;return f=f.replace(/^([ \t]*)/g,""),f=f.replace(/[ \t]*$/g,""),f=z(f),f=f.replace(/:\/\//g,"~P"),b+"<code>"+f+"</code>"}),a}function z(a){return a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=L(a,"*_{}[]\\",!1),a}function A(a){return a=a.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),a=a.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4"),a}function B(a){return a=a.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(a,b){var c=b;return c=c.replace(/^[ \t]*>[ \t]?/gm,"~0"),c=c.replace(/~0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=k(c),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(a,b){var c=b;return c=c.replace(/^  /mg,"~0"),c=c.replace(/~0/g,""),c}),x("<blockquote>\n"+c+"\n</blockquote>")}),a}function C(a,b){a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");var c=a.split(/\n{2,}/g),d=[],e=/~K(\d+)K/,g=c.length;for(var h=0;h<g;h++){var i=c[h];e.test(i)?d.push(i):/\S/.test(i)&&(i=l(i),i=i.replace(/^([ \t]*)/g,"<p>"),i+="</p>",d.push(i))}if(!b){g=d.length;for(var h=0;h<g;h++){var j=!0;while(j)j=!1,d[h]=d[h].replace(/~K(\d+)K/g,function(a,b){return j=!0,f[b]})}}return d.join("\n\n")}function D(a){return a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?\$!])/gi,"&lt;"),a}function E(a){return a=a.replace(/\\(\\)/g,M),a=a.replace(/\\([`*_{}\[\]()>#+-.!])/g,M),a}function F(b){b=b.replace(/(^|\s)(https?|ftp)(:\/\/[-A-Z0-9+&@#\/%?=~_|\[\]\(\)!:,\.;]*[-A-Z0-9+&@#\/%=~_|\[\]])($|\W)/gi,"$1<$2$3>$4"),b=b.replace(/&nbsp>;/gi,">");var c=function(b,c){return'<a target="_blank" href="'+c+'">'+a.plainLinkText(c)+"</a>"};return b=b.replace(/<((https?|ftp):[^'">\s]+)>/gi,c),b}function G(a){return a=a.replace(/~E(\d+)E/g,function(a,b){var c=parseInt(b);return String.fromCharCode(c)}),a}function H(a){return a=a.replace(/^(\t|[ ]{1,4})/gm,"~0"),a=a.replace(/~0/g,""),a}function I(a){if(!/\t/.test(a))return a;var b=["    ","   ","  "," "],c=0,d;return a.replace(/[\n\t]/g,function(a,e){return a==="\n"?(c=e+1,a):(d=(e-c)%4,c=e+1,b[d])})}function K(a){if(!a)return"";var b=a.length;return a.replace(J,function(c,d){if(c=="~D")return"%24";if(c==":")if(d==b-1||/[0-9\/]/.test(a.charAt(d+1)))return":";return"%"+c.charCodeAt(0).toString(16)})}function L(a,b,c){var d="(["+b.replace(/([\[\]\\])/g,"\\$1")+"])";c&&(d="\\\\"+d);var e=new RegExp(d,"g");return a=a.replace(e,M),a}function M(a,b){var c=b.charCodeAt(0);return"~E"+c+"E"}var a=this.hooks=new c;a.addNoop("plainLinkText"),a.addNoop("preConversion"),a.addNoop("postConversion");var b,e,f,g;this.makeHtml=function(c){if(b)throw new Error("Recursive call to converter.makeHtml");return b=new d,e=new d,f=[],g=0,c=a.preConversion(c),c=c.replace(/~/g,"~T"),c=c.replace(/\$/g,"~D"),c=c.replace(/\r\n/g,"\n"),c=c.replace(/\r/g,"\n"),c="\n\n"+c+"\n\n",c=I(c),c=c.replace(/^[ \t]+$/mg,""),c=i(c),c=h(c),c=k(c),c=G(c),c=c.replace(/~D/g,"$$"),c=c.replace(/~T/g,"~"),c=a.postConversion(c),f=e=b=null,c};var u={ol:"\\d+[.]",ul:"[*+-]"},J=/(?:["'*()[\]:]|~D)/g}}(),function(){function c(a){return a.replace(/<[^>]*>?/gi,g)}function g(a){return a.match(d)||a.match(e)||a.match(f)?a:""}function h(a){if(a=="")return"";var b=/<\/?\w+[^>]*(\s|$|>)/g,c=a.toLowerCase().match(b),d=(c||[]).length;if(d==0)return a;var e,f,g="<p><img><br><li><hr>",h,i=[],j=[],k=!1;for(var l=0;l<d;l++){e=c[l].replace(/<\/?(\w+).*/,"$1");if(i[l]||g.search("<"+e+">")>-1)continue;f=c[l],h=-1;if(!/^<\//.test(f))for(var m=l+1;m<d;m++)if(!i[m]&&c[m]=="</"+e+">"){h=m;break}h==-1?k=j[l]=!0:i[h]=!0}if(!k)return a;var l=0;return a=a.replace(b,function(a){var b=j[l]?"":a;return l++,b}),a}var a,b;typeof exports=="object"&&typeof require=="function"?(a=exports,b=require("./Markdown.Converter").Converter):(a=window.Markdown,b=a.Converter),a.getSanitizingConverter=function(){var a=new b;return a.hooks.chain("postConversion",c),a.hooks.chain("postConversion",h),a};var d=/^(<\/?(b|blockquote|code|del|dd|dl|dt|em|h1|h2|h3|i|kbd|li|ol|p|pre|s|sup|sub|strong|strike|ul)>|<(br|hr)\s?\/?>)$/i,e=/^(<a\starget="_blank"\shref="((https?|ftp):\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\stitle="[^"<>]+")?\s?>|<\/a>)$/i,f=/^(<img\ssrc="(https?:\/\/|\/)[-A-Za-z0-9+&@#\/%?=~_|!:,.;\(\)]+"(\swidth="\d{1,3}")?(\sheight="\d{1,3}")?(\salt="[^"<>]*")?(\stitle="[^"<>]*")?\s?\/?>)$/i}();var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1)return;return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init(),BrowserDetect.browser=="Chrome"&&BrowserDetect.version>15||BrowserDetect.browser=="Firefox"&&BrowserDetect.version>9||BrowserDetect.browser=="Safari"&&BrowserDetect.version>5||(BrowserDetect.unsupportedBrowser=!0);if(BrowserDetect.OS=="iPhone/iPod"||BrowserDetect.OS=="Mac")BrowserDetect.isMac=!0;FDBK.Mockup=function(a,b){a=a||{},this.id=a.id||utils.guid("a"),this.name=a.name,this.isMaster=a.isMaster||!1,this.master=a.master||null,this.stageWidth=a.stageWidth,this.stageHeight=a.stageHeight,this.stencils=a.stencils||[],this.selection=[],this.stencilDict={},this.groupedStencils={},typeof FDBK.UndoManager!="undefined"&&(this.undo=new FDBK.UndoManager({undoChange:FDBK.action("updateUndoButton"),redoChange:FDBK.action("updateRedoButton"),max_undo:300})),this.hasLayout=!1,this.guidForStencil=function(){return utils.guid(this.id+"-")},this.localIdForStencil=function(a){var b=a.split("-");return b[b.length-1]},a.duplicateFrom&&function(a,b){var c=function(c){return c.replace(a,b)};((function(a){for(var b=0;b<a.length;b++){var d=a[b],e=d.id;d.id=c(d.id),d.type==="group"&&d.stencils&&arguments.callee.call(this,d.stencils)}})).call(this,this.stencils)}.call(this,a.duplicateFrom,this.id),this.cleanUpLinks=function(a){var b=this,c=function(d){for(var e=0;e<d.length;e++){var f=d[e];f.link&&f.link.ref===a&&(f.link=null,FDBK.pub("collab-link-stencil",f.id,null,b)),f.type==="group"&&f.stencils&&c(f.stencils)}};c(this.stencils)},function(a,b){for(var c=0;c<a.length;c++)this.stencilDict[a[c].id]=a[c],b&&(this.groupedStencils[a[c].id]=b),a[c].type=="group"&&a[c].stencils&&a[c].stencils.length>0&&arguments.callee.call(this,a[c].stencils,a[c].id)}.call(this,this.stencils),this.stencil=function(a){return this.stencilDict[a]},this.stencilPath=function(a){var b=[],c;while(c=this.stencil(a))b.push(c),a=this.groupedStencils[a];return b},this.substencils=function(a){var b=[];return function(a){if(a){b.push(a);if(a.type==="group"&&a.stencils)for(var c=0;c<a.stencils.length;c++)arguments.callee.call(this,a.stencils[c])}}(this.stencil(a)),b},this.stencilList=function(){return this.stencils||[]},this.indexOfStencil=function(a){for(var b=0;b<this.stencils.length;b++)if(this.stencils[b]&&this.stencils[b].id===a)return b;return-1},this.addStencil=function(a,b){a=a||{};var c=a.id||this.guidForStencil();a.id=c;if(b){var d=this.stencil(b);d.type!="group"&&console.log("Trying to add sub stencils to non group parents"),d.stencils=d.stencils?[a].concat(d.stencils):[a]}else this.stencils=[a].concat(this.stencils);return this.stencilDict[c]=a,b&&(this.groupedStencils[c]=b),c},this.copyStencil=function(a){return this.addStencil($.extend(!0,{},this.stencil(a)))},this.removeStencil=function(a){function c(a){var c=b.stencil(a);delete b.stencilDict[a],b.groupedStencils[a]&&delete b.groupedStencils[a];if(c&&c.type=="group"&&c.stencils&&c.stencils.length>0)for(var d=0;d<c.stencils.length;d++)arguments.callee(c.stencils[d].id)}var b=this;c(a);var d=this.indexOfStencil(a);d!==-1&&this.stencils.splice(d,1)},this.updateStencil=function(a,b){var c=this.stencil(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.changeStencilIndex=function(a,b){var c=this.indexOfStencil(a);c>=0&&this.stencils.splice(b,0,this.stencils.splice(c,1)[0])},this.stackStencil=function(a,b,c){var d=this.indexOfStencil(a),e=this.indexOfStencil(c),f=this.stencils[d],g=this.stencils[e];this.stencils.splice(d,1),e=this.indexOfStencil(c);var h=this.stencils.slice(0,e),i=this.stencils.slice(e+1,this.stencils.length);b=="before"?this.stencils=h.concat([f,g],i):this.stencils=h.concat([g,f],i)},this.stencilList=function(){return this.stencils},this.toString=function(){var a="#"+this.id+":";for(var b=0;b<this.stencils.length;b++){var c=this._stencilStore[this.stencils[b]];a+=this.stencils[b]+", "}return a},this.isEmpty=function(){return this.stencils.length===0};var c=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b};return this.propertiesToExport=function(){var a=["id","name","stageWidth","stageHeight","stencils","master","isMaster"];return c.call(this,a)},this.propertiesToDuplicate=function(){var a=["stageWidth","stageHeight","stencils","master","isMaster"];return c.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.filterStencils=function(a){var b=this.stencilDict;return Object.keys(b).map(function(a){return b[a]}).filter(a)},this},FDBK.Project=function(a,b){b&&($.extend(!0,a,a.jsonData),delete a.jsonData),a=a||{},this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.tempId=a.tempId||utils.guid("unsaved-"),this.alias=a.alias||null,this.name=a.name||FDBK.loc("_Untitled Project"),this.description=a.description||FDBK.loc("_No Description"),this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName||FDBK.USER_DATA.userName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy?a.privacy==="public_":!0,this.privacy=a.privacy,this.permission=a.permission||"unknown",this.font=a.font||FDBK.config("projectManagement.font.legacy"),this.readOnly=a.readOnly||!1,this.notificationsCommentsEnabled=a.notificationsCommentsEnabled||!1,this.lastUpdateDate=a.lastupdateDate||null,this.ownerIsPremium=a.ownerIsPremium||!1,this.isClean=function(){return JSON.stringify(this)===FDBK.CACHED_PROJECT},this.links=a.links||{},this.stageWidth=Math.abs(parseInt(a.stageWidth,10))||960,this.stageHeight=Math.abs(parseInt(a.stageHeight,10))||1200,this.mockups=a.mockups||[],this.privacy=a.privacy,this.fallbackImages=a.fallbackImages||[],this.mockups=this.mockups.map(function(a){return new FDBK.Mockup(a,b)}),this.updateAttributes=function(a){this.id=a.id||null,this.uniqueId=a.uniqueId||null,this.alias=a.alias||null,this.isArchived=a.isArchived||!1,this.ownerUserName=a.ownerUserName,this.isDeleted=a.isDeleted||!1,this.isPublic=a.privacy==="public_",this.permission=a.permission||"unknown",this.notificationsCommentsEnabled=a.notificationsCommentsEnabled||!1},this.mockupFromStencilId=function(a){var b=a.split("-");switch(b.length){case 1:return null;case 2:return this.mockup(b[0]);case 3:return this.mockup(b[0]+"-"+b[1])}return null},this.mockup=function(a){a+="";for(var b=0;b<this.mockups.length;b++)if(this.mockups[b].id===a)return this.mockups[b];return null},this.indexOfMockup=function(a){for(var b=0;b<this.mockups.length;b++)if(this.mockups[b].id===a)return b;return-1},this.mockupList=function(){return this.mockups},this.normalPages=function(){return this.mockupList().filter(function(a){return!a.isMaster})},this.masterPages=function(){return this.mockupList().filter(function(a){return a.isMaster})},this.pagesForMaster=function(a){return this.normalPages().filter(function(b){return b.master===a})},this.addMockup=function(a){a=a||{},a.stageWidth=a.stagewidth||this.stageWidth,a.stageHeight=a.stageHeight||this.stageHeight;var b=new FDBK.Mockup(a);return this.mockups.push(b),b.id},this.removeMockup=function(a){var b=this.indexOfMockup(a);b!==-1&&(this.cleanUpLinks(a),this.mockups.splice(b,1))},this.updateMockup=function(a,b){var c=this.mockup(a);if(c)for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d])},this.sortMockups=function(a){this.mockups.sort(function(b,c){return a.indexOf(b.id)-a.indexOf(c.id)})},this.cleanUpLinks=function(a){this.mockupList().forEach(function(b){b.cleanUpLinks(a)})},this.size=function(){return this.mockups.length},this.isNew=function(){return!this.uniqueId};var c=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=this[a[c]];return b};return this.propertiesToExport=function(){var a=["id","uniqueId","name","description","stageWidth","stageHeight","mockups","font"];return c.call(this,a)},this.toJSON=function(){return this.propertiesToExport()},this.toServerJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description,mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getMetadataJSON=function(){var a=this.toJSON(),b={name:a.name,uniqueId:a.uniqueId,description:a.description};return b},this.getContentJSON=function(){var a=this.toJSON(),b={mockups:a.mockups,stageWidth:a.stageWidth,stageHeight:a.stageHeight,font:a.font};return b},this.getAttributes=function(){return{id:this.id,uniqueId:this.uniqueId,alias:this.alias,isArchived:this.isArchived,ownerUserName:this.ownerUserName,isDeleted:this.isDeleted,privacy:this.privacy,permission:this.permission,notificationsCommentsEnabled:this.notificationsCommentsEnabled}},this.canViewProject=function(){return this.permission!="unknown"&&this.permission!="forbidden"},this.canEditProject=function(){return this.permission=="owner"||this.permission=="collab_edit"},this.canCommentProject=function(){return this.permission=="owner"||this.permission=="collab_edit"||this.permission=="collab_view"},this.canDeleteComments=function(){return this.permission=="owner"},this.canChangeCollaborators=function(){return this.permission=="owner"},this.isPremiumProject=function(){return FDBK.VIEWER_MODE?this.ownerIsPremium:this.permission=="collab_edit"||this.permission=="owner"&&FDBK.hasPremiumPlan()},this},function(a,b){function c(a,b,c){this._d=a,this._isUTC=!!b,this._a=a._a||null,a._a=null,this._lang=c||!1}function d(a){var b=this._data={},c=a.years||a.y||0,d=a.months||a.M||0,f=a.weeks||a.w||0,g=a.days||a.d||0,h=a.hours||a.h||0,i=a.minutes||a.m||0,j=a.seconds||a.s||0,k=a.milliseconds||a.ms||0;this._milliseconds=k+j*1e3+i*6e4+h*36e5,this._days=g+f*7,this._months=d+c*12,b.milliseconds=k%1e3,j+=e(k/1e3),b.seconds=j%60,i+=e(j/60),b.minutes=i%60,h+=e(i/60),b.hours=h%24,g+=e(h/24),g+=f*7,b.days=g%30,d+=e(g/30),b.months=d%12,c+=e(d/12),b.years=c,this._lang=!1}function e(a){return a<0?Math.ceil(a):Math.floor(a)}function f(a,b){var c=a+"";while(c.length<b)c="0"+c;return c}function g(a,b,c){var d=b._milliseconds,e=b._days,f=b._months,g;d&&a._d.setTime(+a+d*c),e&&a.date(a.date()+e*c),f&&(g=a.date(),a.date(1).month(a.month()+f*c).date(Math.min(g,a.daysInMonth())))}function h(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a,b){var c=Math.min(a.length,b.length),d=Math.abs(a.length-b.length),e=0,f;for(f=0;f<c;f++)~~a[f]!==~~b[f]&&e++;return e+d}function j(b,c){var d,e;for(d=1;d<7;d++)b[d]=b[d]==null?d===2?1:0:b[d];return b[7]=c,e=new a(0),c?(e.setUTCFullYear(b[0],b[1],b[2]),e.setUTCHours(b[3],b[4],b[5],b[6])):(e.setFullYear(b[0],b[1],b[2]),e.setHours(b[3],b[4],b[5],b[6])),e._a=b,e}function k(a,b){var c,d,e=[];!b&&H&&(b=require("./lang/"+a));for(c=0;c<I.length;c++)b[I[c]]=b[I[c]]||F.en[I[c]];for(c=0;c<12;c++)d=B([2e3,c]),e[c]=new RegExp("^"+(b.months[c]||b.months(d,""))+"|^"+(b.monthsShort[c]||b.monthsShort(d,"")).replace(".",""),"i");return b.monthsParse=b.monthsParse||e,F[a]=b,b}function l(a){var b=typeof a=="string"&&a||a&&a._lang||null;return b?F[b]||k(b):B}function m(a){return ba[a]?"'+("+ba[a]+")+'":a.replace(M,"").replace(/\\?'/g,"\\'")}function n(a){return l().longDateFormat[a]||a}function o(a){var b="var a,b;return '"+a.replace(K,m)+"';",c=Function;return new c("t","v","o","p","m",b)}function p(a){return _[a]||(_[a]=o(a)),_[a]}function q(a,b){function c(c,e){return d[c].call?d[c](a,b):d[c][e]}var d=l(a);while(L.test(b))b=b.replace(L,n);return _[b]||(_[b]=o(b)),_[b](a,c,d.ordinal,f,d.meridiem)}function r(a){switch(a){case"DDDD":return Q;case"YYYY":return R;case"S":case"SS":case"SSS":case"DDD":return P;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return S;case"Z":case"ZZ":return T;case"T":return U;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return O;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c,d){var e;switch(a){case"M":case"MM":c[1]=b==null?0:~~b-1;break;case"MMM":case"MMMM":for(e=0;e<12;e++)if(l().monthsParse[e].test(b)){c[1]=e;break}break;case"D":case"DD":case"DDD":case"DDDD":b!=null&&(c[2]=~~b);break;case"YY":b=~~b,c[0]=b+(b>70?1900:2e3);break;case"YYYY":c[0]=~~Math.abs(b);break;case"a":case"A":d.isPm=(b+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":c[3]=~~b;break;case"m":case"mm":c[4]=~~b;break;case"s":case"ss":c[5]=~~b;break;case"S":case"SS":case"SSS":c[6]=~~(("0."+b)*1e3);break;case"Z":case"ZZ":d.isUTC=!0,e=(b+"").match(Y),e&&e[1]&&(d.tzh=~~e[1]),e&&e[2]&&(d.tzm=~~e[2]),e&&e[0]==="+"&&(d.tzh=-d.tzh,d.tzm=-d.tzm)}}function t(a,b){var c=[0,0,1,0,0,0,0],d={tzh:0,tzm:0},e=b.match(K),f,g;for(f=0;f<e.length;f++)g=(r(e[f]).exec(a)||[])[0],a=a.replace(r(e[f]),""),s(e[f],g,c,d);return d.isPm&&c[3]<12&&(c[3]+=12),d.isPm===!1&&c[3]===12&&(c[3]=0),c[3]+=d.tzh,c[4]+=d.tzm,j(c,d.isUTC)}function u(a,b){var d,e=a.match(N)||[],f,g=99,h,j,k;for(h=0;h<b.length;h++)j=t(a,b[h]),f=q(new c(j),b[h]).match(N)||[],k=i(e,f),k<g&&(g=k,d=j);return d}function v(b){var c="YYYY-MM-DDT",d;if(V.exec(b)){for(d=0;d<4;d++)if(X[d][1].exec(b)){c+=X[d][0];break}return T.exec(b)?t(b,c+" Z"):t(b,c)}return new a(b)}function w(a,b,c,d,e){var f=e.relativeTime[a];return typeof f=="function"?f(b||1,!!c,a,d):f.replace(/%d/i,b||1)}function x(a,b,c){var d=D(Math.abs(a)/1e3),e=D(d/60),f=D(e/60),g=D(f/24),h=D(g/365),i=d<45&&["s",d]||e===1&&["m"]||e<45&&["mm",e]||f===1&&["h"]||f<22&&["hh",f]||g===1&&["d"]||g<=25&&["dd",g]||g<=45&&["M"]||g<345&&["MM",D(g/30)]||h===1&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,w.apply({},i)}function y(a,b){B.fn[a]=function(a){var c=this._isUTC?"UTC":"";return a!=null?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function z(a){B.duration.fn[a]=function(){return this._data[a]}}function A(a,b){B.duration.fn["as"+a]=function(){return+this/b}}var B,C="1.7.0",D=Math.round,E,F={},G="en",H=typeof module!="undefined"&&module.exports,I="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),J=/^\/?Date\((\-?\d+)/i,K=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?)/g,L=/(LT|LL?L?L?)/g,M=/(^\[)|(\\)|\]$/g,N=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,O=/\d\d?/,P=/\d{1,3}/,Q=/\d{3}/,R=/\d{1,4}/,S=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,T=/Z|[\+\-]\d\d:?\d\d/i,U=/T/i,V=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,W="YYYY-MM-DDTHH:mm:ssZ",X=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],Y=/([\+\-]|\d\d)/gi,Z="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),$={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},_={},ba={M:"(a=t.month()+1)",MMM:'v("monthsShort",t.month())',MMMM:'v("months",t.month())',D:"(a=t.date())",DDD:"(a=new Date(t.year(),t.month(),t.date()),b=new Date(t.year(),0,1),a=~~(((a-b)/864e5)+1.5))",d:"(a=t.day())",dd:'v("weekdaysMin",t.day())',ddd:'v("weekdaysShort",t.day())',dddd:'v("weekdays",t.day())',w:"(a=new Date(t.year(),t.month(),t.date()-t.day()+5),b=new Date(a.getFullYear(),0,4),a=~~((a-b)/864e5/7+1.5))",YY:"p(t.year()%100,2)",YYYY:"p(t.year(),4)",a:"m(t.hours(),t.minutes(),!0)",A:"m(t.hours(),t.minutes(),!1)",H:"t.hours()",h:"t.hours()%12||12",m:"t.minutes()",s:"t.seconds()",S:"~~(t.milliseconds()/100)",SS:"p(~~(t.milliseconds()/10),2)",SSS:"p(t.milliseconds(),3)",Z:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(a/60),2)+":"+p(~~a%60,2)',ZZ:'((a=-t.zone())<0?((a=-a),"-"):"+")+p(~~(10*a/6),4)'},bb="DDD w M D d".split(" "),bc="M D H h m s w".split(" ");while(bb.length)E=bb.pop(),ba[E+"o"]=ba[E]+"+o(a)";while(bc.length)E=bc.pop(),ba[E+E]="p("+ba[E]+",2)";ba.DDDD="p("+ba.DDD+",3)",B=function(d,e){if(d===null||d==="")return null;var f,g;return B.isMoment(d)?new c(new a(+d._d),d._isUTC,d._lang):(e?h(e)?f=u(d,e):f=t(d,e):(g=J.exec(d),f=d===b?new a:g?new a(+g[1]):d instanceof a?d:h(d)?j(d):typeof d=="string"?v(d):new a(d)),new c(f))},B.utc=function(a,b){return h(a)?new c(j(a,!0),!0):(typeof a=="string"&&!T.exec(a)&&(a+=" +0000",b&&(b+=" Z")),B(a,b).utc())},B.unix=function(a){return B(a*1e3)},B.duration=function(a,b){var c=B.isDuration(a),e=typeof a=="number",f=c?a._data:e?{}:a,g;return e&&(b?f[b]=a:f.milliseconds=a),g=new d(f),c&&(g._lang=a._lang),g},B.humanizeDuration=function(a,b,c){return B.duration(a,b===!0?null:b).humanize(b===!0?!0:c)},B.version=C,B.defaultFormat=W,B.lang=function(a,b){var c;if(!a)return G;(b||!F[a])&&k(a,b);if(F[a]){for(c=0;c<I.length;c++)B[I[c]]=F[a][I[c]];B.monthsParse=F[a].monthsParse,G=a}},B.langData=l,B.isMoment=function(a){return a instanceof c},B.isDuration=function(a){return a instanceof d},B.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(a){var b=a%10;return~~(a%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"}}),B.fn=c.prototype={clone:function(){return B(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d+""},toDate:function(){return this._d},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?!i(this._a,(this._a[7]?B.utc(this):this).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){return q(this,a?a:B.defaultFormat)},add:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,1),this},subtract:function(a,b){var c=b?B.duration(+b,a):B.duration(a);return g(this,c,-1),this},diff:function(a,b,c){var d=this._isUTC?B(a).utc():B(a).local(),e=(this.zone()-d.zone())*6e4,f=this._d-d._d-e,g=this.year()-d.year(),h=this.month()-d.month(),i=this.date()-d.date(),j;return b==="months"?j=g*12+h+i/30:b==="years"?j=g+(h+i/30)/12:j=b==="seconds"?f/1e3:b==="minutes"?f/6e4:b==="hours"?f/36e5:b==="days"?f/864e5:b==="weeks"?f/6048e5:f,c?j:D(j)},from:function(a,b){return B.duration(this.diff(a)).lang(this._lang).humanize(!b)},fromNow:function(a){return this.from(B(),a)},calendar:function(){var a=this.diff(B().sod(),"days",!0),b=this.lang().calendar,c=b.sameElse,d=a<-6?c:a<-1?b.lastWeek:a<0?b.lastDay:a<1?b.sameDay:a<2?b.nextDay:a<7?b.nextWeek:c;return this.format(typeof d=="function"?d.apply(this):d)},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<B([this.year()]).zone()||this.zone()<B([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return a==null?b:this.add({d:a-b})},startOf:function(a){switch(a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return B.utc([this.year(),this.month()+1,0]).date()},lang:function(a){return a===b?l(this):(this._lang=a,this)}};for(E=0;E<Z.length;E++)y(Z[E].toLowerCase(),Z[E]);y("year","FullYear"),B.duration.fn=d.prototype={weeks:function(){return e(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(a){var b=+this,c=this.lang().relativeTime,d=x(b,!a,this.lang());return a&&(d=(b<=0?c.past:c.future).replace(/%s/i,d)),d},lang:B.fn.lang};for(E in $)$.hasOwnProperty(E)&&(A(E,$[E]),z(E.toLowerCase()));A("Weeks",6048e5),H&&(module.exports=B),typeof ender=="undefined"&&(this.moment=B),typeof define=="function"&&define.amd&&define("moment",[],function(){return B})}.call(this,Date),function(){var a=function(b,c){if(!(this instanceof a))return new a(b,c);this.tokenizers=b.splice?b:[b],c&&(this.doBuild=c)};a.prototype={parse:function(a){this.src=a,this.ended=!1,this.tokens=[];do this.next();while(!this.ended);return this.tokens},build:function(a,b){a&&this.tokens.push(this.doBuild?this.doBuild(a,b,this.tkn):a)},next:function(){var a=this,b;a.findMin(),b=a.src.slice(0,a.min),a.build(b,!1),a.src=a.src.slice(a.min).replace(a.tkn,function(b){return a.build(b,!0),""}),a.src||(a.ended=!0)},findMin:function(){var a=this,b=0,c,d;a.min=-1,a.tkn="";while((c=a.tokenizers[b++])!==undefined)d=a.src[c.test?"search":"indexOf"](c),d!=-1&&(a.min==-1||d<a.min)&&(a.tkn=c,a.min=d);a.min==-1&&(a.min=a.src.length)}},window.jQuery?(jQuery.tokenizer=a,a.fn=a.prototype):window.Tokenizer=a}();var utils=window.utils={};utils.svgns="http://www.w3.org/2000/svg",utils.xlinkns="http://www.w3.org/1999/xlink",utils.xmlns="http://www.w3.org/XML/1998/namespace",utils.userAgent=navigator.userAgent,utils.isOpera=!!window.opera,utils.isWebkit=utils.userAgent.indexOf("AppleWebKit")>=0,utils.isGecko=utils.userAgent.indexOf("Gecko/")>=0,utils.isIE=utils.userAgent.indexOf("MSIE")>=0,utils._guidCount=0,utils.guid=function(a){var b=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},c=b()+b();return a?a+c:c},utils.getPercentage=function(a){return typeof a=="string"&&a.substr(-1)=="%"&&!isNaN(parseInt(a))?parseInt(a):!1},utils.nl2br=function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])},utils.uniqueName=function(a,b){a=a.replace(/\s\([0-9]+\)$/,"");var c=a,d=1;while(b.indexOf(c)!==-1)c=a+" ("+d++ +")";return c},utils.stencil=function(a){var b=a;return typeof b=="string"&&(b=$("#"+a).get(0)),b},utils.stencilId=function(a){return a instanceof jQuery?a.get(0).attr("id"):a!==undefined&&a.id!==undefined?a.id:null},utils.sameArrayContent=function(a,b){return a.length===b.length&&!a.filter(function(a){return b.indexOf(a)===-1}).length},utils.getAlphabeticIndex=function(a){var b=26,c=a%(b-1)>0?Math.floor(a/b):0,d=c>0?String.fromCharCode(64+c):"";return d+String.fromCharCode(a%b+65)},utils.sanitize=function(a){return((a||"")+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},utils.optimalPopoverPosition=function(a,b){var c=FDBK.library.$projectWrapper.height(),d=FDBK.library.$projectWrapper.width(),e=FDBK.library.$projectWrapper.scrollTop(),f=FDBK.library.$projectWrapper.scrollLeft(),g={left:$(a).offset().left-FDBK.library.$projectWrapper.offset().left,top:$(a).offset().top-FDBK.library.$projectWrapper.offset().top};targetOffset=$(a).offset();var h=$(a).outerWidth(),i=$(a).outerHeight(),j=$(b).width(),k=$(b).height(),l=$("body").height()-(targetOffset.top+i),m=targetOffset.top,n=targetOffset.left,o=$("body").width()-(targetOffset.left+h),p,q,r,s,t;return l>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top+i+5,r="bottom",s="",t=""):m>=k+30?(p=targetOffset.left+h/2-j/2,q=targetOffset.top-k-15,r="top",s="bottom",t="popoverTailDown"):o>=j+30?(p=targetOffset.left+h+15,q=targetOffset.top+i/2-k/2,r="right",s="right",t="popoverTailLeft"):n>=j+30?(p=targetOffset.left-j-15,q=targetOffset.top+i/2-k/2,r="left",s="left",t="popoverTailRight"):(p=targetOffset.left+(h-j)/2,q=targetOffset.top+(i-k)/2,s="",t="popoverTailNone"),p+j>$("body").width()&&(p-=p+j-$("body").width()+10,t="popoverTailNone"),q+k>$("body").height()&&(q-=q+k-$("body").height()+10,t="popoverTailNone"),{left:p,top:q,pos:r,tooltipWrapperClass:s,popoverTailClass:t}},utils.md5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=a&2147483648,f=b&2147483648,c=a&1073741824,d=b&1073741824,g=(a&1073741823)+(b&1073741823),c&d?g^2147483648^e^f:c|d?g&1073741824?g^3221225472^e^f:g^1073741824^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){var b,c=a.length,d=c+8,e=(d-d%64)/64,f=(e+1)*16,g=Array(f-1),h=0,i=0;while(i<c)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b="",c="",d,e;for(e=0;e<=3;e++)d=a>>>e*8&255,c="0"+d.toString(16),b+=c.substr(c.length-2,2);return b}function n(a){a=a.replace(/rn/g,"n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(d&63|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(d&63|128))}return b}var o=[],p,q,r,s,t,u,v,w,x,y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;a=n(a),o=l(a),u=1732584193,v=4023233417,w=2562383102,x=271733878;for(p=0;p<o.length;p+=16)q=u,r=v,s=w,t=x,u=h(u,v,w,x,o[p+0],y,3614090360),x=h(x,u,v,w,o[p+1],z,3905402710),w=h(w,x,u,v,o[p+2],A,606105819),v=h(v,w,x,u,o[p+3],B,3250441966),u=h(u,v,w,x,o[p+4],y,4118548399),x=h(x,u,v,w,o[p+5],z,1200080426),w=h(w,x,u,v,o[p+6],A,2821735955),v=h(v,w,x,u,o[p+7],B,4249261313),u=h(u,v,w,x,o[p+8],y,1770035416),x=h(x,u,v,w,o[p+9],z,2336552879),w=h(w,x,u,v,o[p+10],A,4294925233),v=h(v,w,x,u,o[p+11],B,2304563134),u=h(u,v,w,x,o[p+12],y,1804603682),x=h(x,u,v,w,o[p+13],z,4254626195),w=h(w,x,u,v,o[p+14],A,2792965006),v=h(v,w,x,u,o[p+15],B,1236535329),u=i(u,v,w,x,o[p+1],C,4129170786),x=i(x,u,v,w,o[p+6],D,3225465664),w=i(w,x,u,v,o[p+11],E,643717713),v=i(v,w,x,u,o[p+0],F,3921069994),u=i(u,v,w,x,o[p+5],C,3593408605),x=i(x,u,v,w,o[p+10],D,38016083),w=i(w,x,u,v,o[p+15],E,3634488961),v=i(v,w,x,u,o[p+4],F,3889429448),u=i(u,v,w,x,o[p+9],C,568446438),x=i(x,u,v,w,o[p+14],D,3275163606),w=i(w,x,u,v,o[p+3],E,4107603335),v=i(v,w,x,u,o[p+8],F,1163531501),u=i(u,v,w,x,o[p+13],C,2850285829),x=i(x,u,v,w,o[p+2],D,4243563512),w=i(w,x,u,v,o[p+7],E,1735328473),v=i(v,w,x,u,o[p+12],F,2368359562),u=j(u,v,w,x,o[p+5],G,4294588738),x=j(x,u,v,w,o[p+8],H,2272392833),w=j(w,x,u,v,o[p+11],I,1839030562),v=j(v,w,x,u,o[p+14],J,4259657740),u=j(u,v,w,x,o[p+1],G,2763975236),x=j(x,u,v,w,o[p+4],H,1272893353),w=j(w,x,u,v,o[p+7],I,4139469664),v=j(v,w,x,u,o[p+10],J,3200236656),u=j(u,v,w,x,o[p+13],G,681279174),x=j(x,u,v,w,o[p+0],H,3936430074),w=j(w,x,u,v,o[p+3],I,3572445317),v=j(v,w,x,u,o[p+6],J,76029189),u=j(u,v,w,x,o[p+9],G,3654602809),x=j(x,u,v,w,o[p+12],H,3873151461),w=j(w,x,u,v,o[p+15],I,530742520),v=j(v,w,x,u,o[p+2],J,3299628645),u=k(u,v,w,x,o[p+0],K,4096336452),x=k(x,u,v,w,o[p+7],L,1126891415),w=k(w,x,u,v,o[p+14],M,2878612391),v=k(v,w,x,u,o[p+5],N,4237533241),u=k(u,v,w,x,o[p+12],K,1700485571),x=k(x,u,v,w,o[p+3],L,2399980690),w=k(w,x,u,v,o[p+10],M,4293915773),v=k(v,w,x,u,o[p+1],N,2240044497),u=k(u,v,w,x,o[p+8],K,1873313359),x=k(x,u,v,w,o[p+15],L,4264355552),w=k(w,x,u,v,o[p+6],M,2734768916),v=k(v,w,x,u,o[p+13],N,1309151649),u=k(u,v,w,x,o[p+4],K,4149444226),x=k(x,u,v,w,o[p+11],L,3174756917),w=k(w,x,u,v,o[p+2],M,718787259),v=k(v,w,x,u,o[p+9],N,3951481745),u=c(u,q),v=c(v,r),w=c(w,s),x=c(x,t);var O=m(u)+m(v)+m(w)+m(x);return O.toLowerCase()},utils.gravatarImageURL=function(a,b){return b=b||60,"https://secure.gravatar.com/avatar/"+utils.md5(a)+"?d=mm&s="+b},utils.markdown=function(a){return this._markdownConverter||(this._markdownConverter=new Markdown.getSanitizingConverter,this._markdownConverter.hooks.chain("preConversion",function(a){return a=a.replace(/\n/g,"&nbsp;  \n"),a})),this._markdownConverter.makeHtml(a)},utils.setDocumentTitle=function(a){document.title=a+" · Moqups"},utils.insertText=function(a,b){if(a.selectionStart||a.selectionStart=="0"){var c=a.selectionStart,d=a.selectionEnd;a.value=a.value.substring(0,c)+b+a.value.substring(d,a.value.length),a.selectionStart=c+b.length,a.selectionEnd=c+b.length}else a.value+=b},utils.tab=function(a){utils.insertText(a,"\t")},utils.untab=function(a){utils.insertText(a,"\t")},utils.debounce=function(a,b,c){var d,e;return function(){var f=this,g=arguments,h=function(){d=null,c||(e=a.apply(f,g))},i=c&&!d;return clearTimeout(d),d=setTimeout(h,b),i&&(e=a.apply(f,g)),e}},FDBK.mixinModule("stencil-templates",{_stencilTemplates:{},_sidebarStencilTemplates:[],_SVGDefs:[],_SVGDefsProps:[],STENCIL_TEMPLATES_URL:"compiled/stencils-compiled.tmpl.",STENCIL_TEMPLATE_INDIVIDUAL_URL:"stencil-tmpl/{name}.tmpl.",STENCIL_ICON_SPRITE_URL:"stencils/compiled-stencil-icons.png",STENCIL_ICON_INDIVIDUAL_URL:"stencils/{name}.png",DEF_INDIVIDUAL_URL:"stencil-tmpl/{name}.def.",STENCIL_SIDEBAR_ITEM_TMPL:'<li class="stencil-item">   <a class="stencil-icon" data-id="{{= templateName}}">    <img src="{{= iconStyle}}" alt=""/><span>{{= title}}</span>   </a>  </li>',STENCIL_SIDEBAR_ITEM_SPRITE_TMPL:'<li class="stencil-item">   <a class="stencil-icon" data-id="{{= templateName}}">    <img class="stencil-icon-sprite" src="'+FDBK.CSS_BASE_URL+'images/pixel.gif" style="{{= iconStyle}}" />    <span>{{= title}}</span>   </a>  </li>',STENCIL_ICON_SPRITE_UNIT_SIZE_X:80,STENCIL_ICON_SPRITE_UNIT_SIZE_Y:50,_stencilsDefsReady:!1,_stencilTemplatesLoaded:!1,_stencilTemplatesToLoadCount:0,_stencilTemplatesLoadedCount:0,_SVGDefsLoaded:!1,_SVGDefsToLoadCount:0,_SVGDefsLoadedCount:0,initModule:function(){},parseCompiledStencilTemplates:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data);var b=0,c,d;while((b=a.indexOf("<<<",b))!==-1){c=b,b=a.indexOf(">>>",b);if(b===-1){console.info("stencil templates are corrupted.");break}var e=a.substring(c+3,b).split(/\n|\r\n/),f="tmplsvg-"+e[0].match(/\/([a-zA-Z0-9\-\_]+)\.tmpl\.svg/)[1],g=e.slice(1).join(" ");$.template(f,g)}},getStencilDOM:function(a,b){var c=this.stencilTemplate(a),d=c&&c.legacyInspectables?c.legacyInspectables:{},e=$.extend(!0,{},b,{tpl:typeof b.text!="undefined"?FDBK.tokenize(a,b.text,b):null,guid:utils.guid(),insp:$.extend({},d,b.inspectables),constants:{BASE_URL:FDBK.BASE_URL,IMAGE_BASE_URL:FDBK.ASSET_IMAGE_BASE_URL},stencil:b}),f=$.loc_tmpl(a,e).get(0);return f.templateName=a,b.locked&&(f.locked="true"),f},cloneStencilDOM:function(a){var b=$(a).clone()[0],c=FDBK.config("stencilTemplates.domProperties")||[];return c.forEach(function(c){b[c]=a[c]}),b},getStencilTemplateDefaultData:function(a){var b=this._stencilTemplates[a];return b?b.metadata||{}:{}},getPanelDOM:function(a,b){var c=this.stencilTemplate(b.name),d=c&&c.legacyInspectables?c.legacyInspectables:{};return $("#"+a).loc_tmpl({tpl:$.extend({},d,b.inspectables),stencil:b})},getAllStencilIconsDOM:function(){return FDBK.config("stencilTemplates.useSpriteStencilIcons")?$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_SPRITE_TMPL):$.template("stencil-sidebar-item-tmpl",FDBK.STENCIL_SIDEBAR_ITEM_TMPL),this._sidebarStencilTemplates.map(function(a){var b=FDBK.stencilTemplate(a);return $.loc_tmpl("stencil-sidebar-item-tmpl",b).outerHTML()}).join("")},addSVGDef:function(a){this._SVGDefsToLoadCount+=1,this._SVGDefsProps.push(a)},loadSVGDefs:function(){var a;for(var b=0;b<this._SVGDefsProps.length;b++){a=this._SVGDefsProps[b];var c=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.DEF_INDIVIDUAL_URL.replace("{name}",a.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(a){FDBK.config("stencilTemplates.useJSONPStencils")&&(a=a.data),FDBK._SVGDefs.push(a),c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()},error:function(){c._SVGDefsLoadedCount+=1,c.checkStencilsAndDefsLoaded()}})}},getSVGDefs:function(){return this._SVGDefs.join("")},addStencilTemplate:function(a){var b="tmplsvg-"+a.name;if(!a.excludeFromSidebar){if(FDBK.config("stencilTemplates.useSpriteStencilIcons")){var c=a.iconPosition||[0,0],d=-(c[1]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_X,e=-(c[0]-1)*FDBK.STENCIL_ICON_SPRITE_UNIT_SIZE_Y;a.iconStyle="background: url('"+FDBK.IMAGE_BASE_URL+FDBK.STENCIL_ICON_SPRITE_URL+"') "+d+"px "+e+"px"}else a.iconStyle=FDBK.IMAGE_BASE_URL+FDBK.STENCIL_ICON_INDIVIDUAL_URL.replace("{name}",a.name);this._sidebarStencilTemplates.push(b)}a.templateName=b,this._stencilTemplates[b]=a,FDBK.config("stencilTemplates.useCompiledStencils")||(this._stencilTemplatesToLoadCount+=1)},loadStencilTemplates:function(){if(!FDBK.config("stencilTemplates.useCompiledStencils")){var a=this,b;for(var c in this._stencilTemplates)b=this._stencilTemplates[c],$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATE_INDIVIDUAL_URL.replace("{name}",b.name)+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,jsonp:!1,jsonpCallback:"dataready",success:function(b){FDBK.config("stencilTemplates.useJSONPStencils")&&(b=b.data),$.template(c,b),a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount+=1,a.checkStencilsAndDefsLoaded()}})}else{this._stencilTemplatesToLoadCount=1;var a=this;$.ajax({url:FDBK.STENCIL_BASE_URL+FDBK.STENCIL_TEMPLATES_URL+this.getExtension(),dataType:FDBK.config("stencilTemplates.useJSONPStencils")?"jsonp":"text",async:!1,data:{},jsonp:!1,cache:!0,jsonpCallback:"dataready",success:function(b){a.parseCompiledStencilTemplates(b),a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()},error:function(){a._stencilTemplatesLoadedCount=1,a.checkStencilsAndDefsLoaded()}})}},stencilTemplate:function(a){return this._stencilTemplates[a]},getExtension:function(){return FDBK.config("stencilTemplates.useJSONPStencils")?"json":"svg"},checkStencilsAndDefsLoaded:function(){!this._stencilTemplatesLoaded&&this._stencilTemplatesToLoadCount>0&&this._stencilTemplatesToLoadCount==this._stencilTemplatesLoadedCount&&(this._stencilTemplatesLoaded=!0,FDBK.pub("stencils-loaded"),FDBK.loadSVGDefs()),!this._SVGDefsLoaded&&this._SVGDefsToLoadCount>0&&this._SVGDefsToLoadCount==this._SVGDefsLoadedCount&&(this._SVGDefsLoaded=!0,$("#svgObject").append(FDBK.getSVGDefs()),FDBK.pub("svg-defs-loaded")),!this._stencilsDefsReady&&this._stencilTemplatesLoadedCount&&this._SVGDefsLoaded&&(this._stencilsDefsReady=!0,FDBK.pub("stencils-and-defs-loaded"))},executeLayoutHelper:function(a,b){if(!a)return;var c=this.stencilTemplate(a).layoutHelper||this.F_HELPER_NULL;c(b)},F_HELPER_NULL:function(a){},F_TOKENIZER_MARKDOWN:function(a){return this._tokenizerConverter||(this._tokenizerConverter=new Markdown.getSanitizingConverter,this._tokenizerConverter.hooks.chain("preConversion",function(a){var b;while(b=/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm.exec(a))a=a.replace(b[0],b[0].replace(/\*/g,"\0"));return a=a.replace(/\n/g,"&nbsp;  \n"),a}),this._tokenizerConverter.hooks.chain("postConversion",function(a){return a.replace(/\0/g,"*")})),this._tokenizerConverter.makeHtml(a)},F_TOKENIZER_PARAGRAPH:function(a,b){return b.inspectables&&b.inspectables.blokk==="true"?a.replace(/[^\s\t\r\n]/g,"&#9600;").replace(/\s/g,"&#8194;"):this.F_TOKENIZER_MARKDOWN(a)},F_TOKENIZER_PERCENTAGE:function(a){var b=a.match(/(\d+)%?/);return b?Math.min(parseInt(b,10),100):a},F_TOKENIZER_RATINGS:function(a){var b=a.match(/(\d+)\/(\d+)/);if(!b)return"";for(var c=0,d=[],e=Math.min(parseInt(b[2],10),100);c<e;c++)d.push(" ");return b[2]=d,b},F_TOKENIZER_NEWLINE:function(a){var b=a.split(/\n|\r\n/);return b.map(utils.sanitize)},F_TOKENIZER_NULL:function(a){return utils.sanitize(a)},F_TOKENIZER_VERTICAL_MENU:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_HORIZONTAL_MENU:function(a){var b=a.replace(/\n|\r\n/g," ").split(/,\s*/igm),c=[];for(var d in b){var e=b[d].match(/^(\*|_)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(>)$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?>|)$/,"").split(/,([^,]+)$/);f.title=utils.sanitize(h[0]),c.push(f)}return c},F_TOKENIZER_TREE:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e={};e.title=b[d].replace(/^\s*/,""),e.indent=Math.max(0,b[d].length-e.title.length);var f=e.title.match(/^(f|F|v|>|\[\+\]|\[\-\]|\[x\]|\[\s\]|\-)?\s?(.*)?$/);e.icon=f[1],e.icon||e.indent--,e.title=utils.sanitize((f[2]||"").replace(/\s?,\s?(\s?>|)$/,"")),c.push(e)}return c},tokenize:function(a,b,c){var d=this._stencilTemplates[a];return(d&&d.tokenizer?d.tokenizer:this.F_TOKENIZER_NULL).call(this,b,c)}}),FDBK.addSVGDef({name:"webalys"}),FDBK.addStencilTemplate({name:"note",title:"Note",tags:"sticky note paper book",iconPosition:[6,6],metadata:{text:"When **you** do things **right**, people won't be sure you've done anything at all.\n\n_~~Futurama_",inspectables:{note_style:"yellow"}},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,layoutHelper:function(a){var b=$(a).find("path")[0],c=svg(a).explicitHeight(),d=svg(a).explicitWidth(),e=10,f=d/e,g="M0,0",h=0;for(var i=0;i<f;i++)h+e<=d&&(g+="l5,5 5,-5"),h+=e;g+="l0,-"+(c-e/2)+"-"+d+",0 0,"+(c-e/2),h+e>d&&(g+="l 0,5"),g+="z",b.setAttribute("d",g)},multiline:!0}),FDBK.addStencilTemplate({name:"rect",title:"Rectangle / Box",tags:"square rectangle container box",iconPosition:[5,2],metadata:{text:"",inspectables:{bg:"#ffffff",stroke:"#000000",stroke_width:"2",stroke_style:"solid",checked:"",border:"true"}},multiline:!0}),FDBK.addStencilTemplate({name:"hotspot",title:"Hotspot",tags:"link hotspot target",iconPosition:[6,5],excludeFromPrint:!0,excludeFromSidebar:!0,metadata:{inspectables:{type:"rect"}}}),FDBK.addStencilTemplate({name:"heading-one",title:"Heading",tags:"heading h1 big title",iconPosition:[1,12],metadata:{text:"Heading",inspectables:{color:"#000000",font_size:"26",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"label",title:"Label",tags:"label text input",iconPosition:[2,6],metadata:{text:"Label:",inspectables:{color:"#000000",font_size:"14",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"text",title:"Paragraph",tags:"label char paragraph string",iconPosition:[5,1],metadata:{text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla quam velit, vulputate eu pharetra nec, mattis ac neque. Duis vulputate commodo lectus, ac blandit elit tincidunt id. Sed rhoncus, tortor sed eleifend tristique, tortor mauris molestie elit, et lacinia ipsum quam nec dui. Quisque nec mauris sit amet elit iaculis pretium sit amet quis magna. Aenean velit odio, elementum in tempus ut, vehicula eu diam. Pellentesque rhoncus aliquam mattis. Ut vulputate eros sed felis sodales nec vulputate justo hendrerit. Vivamus varius pretium ligula, a aliquam odio euismod sit amet. Quisque laoreet sem sit amet orci ullamcorper at ultricies metus viverra. Pellentesque arcu mauris, malesuada quis ornare accumsan, blandit sed diam.",inspectables:{color:"#000000",font_size:"14",text_align:"left",line_height:"1.3",blokk:"false"}},legacyInspectables:{line_height:"1"},tokenizer:FDBK.F_TOKENIZER_PARAGRAPH,multiline:!0}),FDBK.addStencilTemplate({name:"link",title:"Link",tags:"link text hyper",iconPosition:[6,1],metadata:{text:"Hyperlink",inspectables:{color:"#1464f6",font_size:"14",text_align:"left",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"link-bar-menu",title:"Link Bar",tags:"horizontal",iconPosition:[6,2],metadata:{text:"Link 1, *Link2, Link 3",inspectables:{color:"#1464f6",font_size:"14",text_align:"center",_inspector:"tmplsvg-text-panel-alt"}},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"checkbox",tags:"form",title:"Checkbox",iconPosition:[1,3],metadata:{text:"Check me out",inspectables:{checked:"checked",disabled:"checked",font_size:"14"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"radio",title:"Radio buttons",tags:"form",iconPosition:[1,4],metadata:{text:"Pizza",inspectables:{checked:"checked",disabled:"checked",font_size:"14",_inspector:"tmplsvg-checkbox-panel"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"button",tags:"pill button control target action",title:"Button",iconPosition:[1,2],metadata:{text:"Button",inspectables:{radius:"4",color:"#000000",fill_color:"#E6E6E6",stroke_color:"#000000",icon:"",dropdown:"",size:"16"}},layoutHelper:function(a){var b=$(a).find("rect")[0];if(parseFloat(b.getAttribute("rx"))>4){var c=parseInt(svg(a).explicitHeight())/2;b.setAttribute("rx",c)}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"combo-box",title:"Combo box",tags:"form input combobox dropdown select options menu",iconPosition:[1,5],metadata:{text:"Options"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"input-text",title:"Text input",tags:"input text field",iconPosition:[2,4],metadata:{text:""},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"textarea",title:"Text area",tags:"input text field textarea area multiline",iconPosition:[2,5],metadata:{text:"Multi\n\nline\n\ntextarea"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"stepper",title:"Stepper input",tags:"form input number",iconPosition:[3,12],metadata:{text:"12px"}}),FDBK.addStencilTemplate({name:"annotation-circle",excludeFromSidebar:!0,metadata:{options:{fill:"none",stroke:"red",strokeWidth:5}}}),FDBK.addStencilTemplate({name:"annotation-line",excludeFromSidebar:!0,metadata:{options:{stroke:"red",strokeWidth:5,startMarker:"none",endMarker:"none"}}}),FDBK.addStencilTemplate({name:"annotation-rect",excludeFromSidebar:!0,metadata:{options:{fill:"none",stroke:"red",strokeWidth:5}}}),FDBK.addStencilTemplate({name:"slider",title:"Slider",tags:"form input percentage slider",iconPosition:[3,7],metadata:{text:"50%"},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"avatar",tags:"user picture",title:"Avatar",iconPosition:[1,1],metadata:{text:"",inspectables:{type:"dude",fill_color:"#606060",size:"128",border:"true"}}}),FDBK.addStencilTemplate({name:"icon",title:"Icon",tags:"symbol",iconPosition:[5,4],metadata:{text:"Icon",inspectables:{fill_color:"#000000",icon:"icon-emoticon-happy",size:"24"}}}),FDBK.addStencilTemplate({name:"grid",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Cell 1, cell 2, cell 3\nCell 4, cell 5, cell 6\nCell 7, cell 8, cell 9\n cell 10"},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});return c.map(function(a){a.length=d}),c},multiline:!0,excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"grid-2",title:"Grid",tags:"data table tabular",iconPosition:[4,2],metadata:{text:"Head 1, Head 2, Head 3\n Cell 1, Cell 2, Cell 3, []\nCell 4, Cell 5, Cell 6, [x]\nCell 7, Cell 8, Cell 9, ()\nCell 10, Cell 11, Cell 12, (o)",inspectables:{header:"true",zebra:"true",sortable:"true",border:"true",vertical_lines:"true",horizontal_lines:"true"}},tokenizer:function(a){var b,c;b=a.split(/\n|\r\n/);var d=0,c=b.map(function(a){var b=a.split(/,\s*/igm);return d=Math.max(d,b.length),b});for(var e in c)for(var f in c[e])c[e][f]!="(o)"&&c[e][f]!="()"&&c[e][f]!="[x]"&&c[e][f]!="[]"&&(c[e][f]=FDBK.F_TOKENIZER_MARKDOWN(c[e][f]));return[c,d]},multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-progress-bar",title:"Horizontal progress bar",tags:"percentage progress",iconPosition:[2,8],metadata:{text:"50%"},tokenizer:FDBK.F_TOKENIZER_PERCENTAGE}),FDBK.addStencilTemplate({name:"line",title:"Diagonal Line",tags:"ruler line horizontal diagonal connector arc orthogonal arrow",iconPosition:[6,5],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_type:"diagonal",line_mode:"major",line_marker_start:"true",line_marker_end:"true",resize_mode:"nwse"}}}),FDBK.addStencilTemplate({name:"horizontal-line",title:"Horizontal Line",tags:"ruler line horizontal",iconPosition:[3,9],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_marker_start:"false",line_marker_end:"false"}}}),FDBK.addStencilTemplate({name:"vertical-line",title:"Vertical Line",tags:"ruler line vertical",iconPosition:[3,10],metadata:{inspectables:{stroke:"#000000",stroke_width:"2",stroke_style:"solid",line_marker_start:"false",line_marker_end:"false"}}}),FDBK.addStencilTemplate({name:"iphone",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"5",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait"}},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"iphone-2",title:"iPhone",tags:"ios device mobile",iconPosition:[4,12],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"4",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait",_inspector:"tmplsvg-iphone-panel"}}}),FDBK.addStencilTemplate({name:"ipad",title:"iPad",tags:"ios device mobile tablet",iconPosition:[6,4],metadata:{text:"",inspectables:{bg_color:"#FFFFFF",status_size:"4",status_color:"#000000",top_color:"#D6D6D6",top_size:"15",bottom_size:"15",bottom_color:"#929292",orientation:"portrait"}}}),FDBK.addStencilTemplate({name:"ios-alert",title:"iOS Alert",tags:"alert confirm dialog",iconPosition:[5,10],metadata:{text:"Are you sure?\nSome helpful info here\nNo, Yes"},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];return c.push(b[0]),c.push(b[1]),b[2]&&c.push(b[2].split(/\s*\,\s*/)),c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-picker",title:"iOS Picker",tags:"picker",iconPosition:[5,8],metadata:{text:"April, 20, 2011\nMay, 21, 2012\nJune, 22, 2013"},tokenizer:function(a){var b;b=a.split(/\n|\r\n/);var c=0,d=[],e=[];for(var f=0;f<b.length;f++){var g=b[f].split(/,\s*/igm);d.push(g),c=Math.max(c,g.length)}for(var h=0;h<c;h++)for(var i=0;i<b.length;i++){e[h]||(e[h]=[]);var g=d[i][h];g==undefined&&(g=""),e[h].push(g)}return e},multiline:!0}),FDBK.addStencilTemplate({name:"ios-menu",title:"iOS Menu",tags:"menu settings",iconPosition:[5,6],metadata:{text:"+ Add\n- Delete\nv Check\nAnother check, (v)\nCurrent value, value\nSub menu, >\nReorder, =\n* Bullet\n_ Icon\n__ Big Icon, Summary description\nx Thumbnail\nX Big Thumbnail, Summary description\nToggle, ON",inspectables:{background:"true"}},tokenizer:function(a){var b=a.split(/\n|\r\n/),c=[];for(var d in b){var e=b[d].match(/^(\+|v|__|_|X|x|-|\*)?\s?(.*)?$/),f={};f.icon=e[1];var g=(e[2]||"").match(/^.*,\s?(OFF|ON|=|>|\(>\)|\(v\))$/);g&&(f.type=g[1]);var h=(e[2]||"").replace(/\s?,\s?(\s?(OFF)|(ON)|=|>|\(>\)|\(v\))$/,"").split(/,([^,]+)$/);f.title=h[0],f.subtitle=h[1],c.push(f)}return c},multiline:!0}),FDBK.addStencilTemplate({name:"ios-button",title:"iOS Button",tags:"mobile ios back",iconPosition:[3,5],metadata:{text:"Back",inspectables:{color:"#000000",fill_color:"#E6E6E6",stroke_color:"#000000",icon:"",orientation:"back"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"ios-segmented-control",title:"iOS Segments",tags:"tab menu segment horizontal",iconPosition:[5,7],metadata:{text:"Item 1, *Item 2, Item 3"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"ios-keyboard",title:"iOS Keyboard",tags:"input",iconPosition:[5,9],metadata:{text:"dasd",inspectables:{mode:"normal"}}}),FDBK.addStencilTemplate({name:"ios-switch",title:"iOS Switch",tags:"form on off",iconPosition:[2,1],metadata:{text:"",inspectables:{checked:"checked"}}}),FDBK.addStencilTemplate({name:"map",title:"Map",tags:"google maps location position",iconPosition:[3,2],metadata:{}}),FDBK.addStencilTemplate({name:"image-placeholder",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],excludeFromSidebar:!0,metadata:{}}),FDBK.addStencilTemplate({name:"image-placeholder-2",title:"Placeholder image",tags:"placeholder picture photo",iconPosition:[3,11],metadata:{}}),FDBK.addStencilTemplate({name:"image",title:"Image",tags:"picture photo",iconPosition:[0,0],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"group-stencil",title:"Group",tags:"",iconPosition:[0,0],metadata:{},excludeFromSidebar:!0}),FDBK.addStencilTemplate({name:"pie-chart",title:"Pie chart",tags:"charts data",iconPosition:[4,11],metadata:{}}),FDBK.addStencilTemplate({name:"bar-chart",title:"Bar chart",tags:"charts data",iconPosition:[4,10],metadata:{}}),FDBK.addStencilTemplate({name:"column-chart",title:"Column Chart",tags:"charts data",iconPosition:[4,9],metadata:{}}),FDBK.addStencilTemplate({name:"line-chart",title:"Line Chart",tags:"charts data",iconPosition:[4,8],metadata:{}}),FDBK.addStencilTemplate({name:"banner",title:"Banner",tags:"banner advertisement",iconPosition:[3,3],metadata:{text:"468*60",inspectables:{color:"#000000",fill_color:"#ffffff",stroke_color:"#000000"}},layoutHelper:function(a){$(a).find("div").html(utils.sanitize(svg(a).explicitWidth())+" &times; "+utils.sanitize(svg(a).explicitHeight()))}}),FDBK.addStencilTemplate({name:"search-input",title:"Search input",tags:"form search filter",iconPosition:[3,1],metadata:{text:"Search"}}),FDBK.addStencilTemplate({name:"stars",title:"Star ratings",tags:"ratings feedback vote",iconPosition:[1,10],metadata:{text:"3/5"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"hearts",title:"Heart ratings",tags:"ratings feedback",iconPosition:[1,9],metadata:{text:"3/5"},tokenizer:FDBK.F_TOKENIZER_RATINGS}),FDBK.addStencilTemplate({name:"tab-bar",title:"Tabs",tags:"navigation",iconPosition:[4,1],metadata:{text:"Home, *Products, About, Contact",inspectables:{mode:"up"}},tokenizer:function(a){return a.split(/,\s*/igm)}}),FDBK.addStencilTemplate({name:"throbber",title:"Throbber",tags:"spinner loading",iconPosition:[3,4],metadata:{}}),FDBK.addStencilTemplate({name:"thumbnails",title:"Thumbnails",tags:"grid placeholder image",iconPosition:[4,3],metadata:{text:"2*2"},tokenizer:function(a){var b=a.match(/\s*(\d+)\s*\*?\s*(\d+)?\s*/);if(!b)return"";var c,d,e,f;for(c=0,d=[],f=Math.min(parseInt(b[1]||1),100);c<f;c++)d.push(" ");for(c=0,e=[],f=Math.min(parseInt(b[2]||1),100);c<f;c++)e.push(" ");return[d,e]}}),FDBK.addStencilTemplate({name:"tooltip",title:"Tooltip",tags:"note annotation tooltip speech popover arrow",iconPosition:[3,6],metadata:{text:"I'm a tooltip! \n\nOr am I a *speech bubble?*",inspectables:{color:"#000000",bg:"#ffffff",stroke:"#000000",direction:"bottom-left"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.addStencilTemplate({name:"window",title:"Window",tags:"window chrome mac windows",iconPosition:[2,12],metadata:{text:"Untitled Window",inspectables:{type:"mac"}}}),FDBK.addStencilTemplate({name:"browser",title:"Browser",tags:"browser window popup firefox chrome windows mac",iconPosition:[2,11],metadata:{text:"Moqzilla \n http://moqups.com"},tokenizer:FDBK.F_TOKENIZER_NEWLINE,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-scrollbar",title:"Vertical scrollbar",tags:"scrollbar vertical",iconPosition:[1,6]}),FDBK.addStencilTemplate({name:"horizontal-scrollbar",title:"Horizontal scrollbar",tags:"scrollbar horizontal",iconPosition:[1,7]}),FDBK.addStencilTemplate({name:"context-menu",title:"Context menu",tags:"menu right click context vertical",iconPosition:[1,8],metadata:{text:"File\nOpen...\n*Open Recent,>\nExport as, >\n\nPrint\nPage Setup\n\nExit"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-menu",title:"Vertical List menu",tags:"menu right click context vertical list",iconPosition:[5,5],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"vertical-arrow-menu",title:"Vertical arrow menu",tags:"menu",iconPosition:[4,6],metadata:{text:"Apps\nGames\n* Movies,>\nBooks\nNewspapers"},tokenizer:FDBK.F_TOKENIZER_VERTICAL_MENU,multiline:!0}),FDBK.addStencilTemplate({name:"horizontal-menu",title:"Horizontal menu",tags:"menu right click context vertical list",iconPosition:[4,4],metadata:{text:"Apps, Games, * Movies, Books, Newspapers"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"horizontal-arrow-menu",title:"Horizontal Arrow Menu",tags:"menu right click context vertical list",iconPosition:[4,5],metadata:{text:"Apps, Games, * Movies, Books, Newspapers",inspectables:{hide_arrow:"false"}},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"steps",title:"Steps",tags:"steps",iconPosition:[2,7],metadata:{text:"*Sign up, Pricing plan, Payment, Complete!"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"bread-crumb-menu",title:"Breadcrumb menu",tags:"bread crumb menu",iconPosition:[4,7],metadata:{text:"Home, Level 1, Level 2, Level 3, *Last"},tokenizer:FDBK.F_TOKENIZER_HORIZONTAL_MENU}),FDBK.addStencilTemplate({name:"tree-menu",title:"Tree menu",tags:"tree",iconPosition:[6,3],metadata:{text:"F Pictures\n - Purple Lotus 1.jpg\n - Blue Orchid.png\n f Other Flowers\n\n[-] Tree\n [+] Branch\n [+] Another Branch\n A Leaf\n\nv Level 1 \n > Level 2\n v Level 3\n  > Level 3.1\n\n[ ] Check all the things!\n [x] Check me once\n [x] Check me twice"},tokenizer:FDBK.F_TOKENIZER_TREE,multiline:!0}),FDBK.addStencilTemplate({name:"ribbon",title:"Ribbon",tags:"header ribbon section",iconPosition:[1,11],metadata:{text:"Page Section",inspectables:{type:"both"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"calendar",title:"Calendar",tags:"date calendar picker",iconPosition:[2,2],metadata:{}}),FDBK.addStencilTemplate({name:"date-picker",title:"Date picker",tags:"input date picker",iconPosition:[2,3],metadata:{text:"4/22/2012"},tokenizer:FDBK.F_TOKENIZER_MARKDOWN}),FDBK.addStencilTemplate({name:"video-player",tags:"video player",title:"Video player",iconPosition:[2,9]}),FDBK.addStencilTemplate({name:"audio-player",tags:"audio player",title:"Audio player",iconPosition:[2,10]}),FDBK.addStencilTemplate({name:"basic-shapes",tags:"circle rectangle hexagon pentagon rombus parallelogram star",title:"Simple Shapes",iconPosition:[5,3],metadata:{text:"",inspectables:{color:"#000000",bg:"#E1E1E1",stroke:"#000000",stroke_width:"2",stroke_style:"solid",type:"star",border:"true"}},tokenizer:FDBK.F_TOKENIZER_MARKDOWN,multiline:!0}),FDBK.loadStencilTemplates();var svg=window.svg=function(a){return a==svg.element?svg:(typeof a=="string"&&(a=$(a)[0]),svg.init(a))};svg.TEXT_ALIGN_LEFT="left",svg.TEXT_ALIGN_RIGHT="right",svg.TEXT_ALIGN_MIDDLE="middle",svg.TEXT_ALIGN_JUSTIFY="justify",svg.RESIZE_VERTICAL="vertical",svg.RESIZE_HORIZONTAL="horizontal",svg.RESIZE_ASPECT="aspect",svg.RESIZE_ALL="all",svg.RESIZE_NWSE="nwse",svg.RESIZE_NESW="nesw",svg.RESIZE_NONE="none",svg.RESIZE_LINE="line",svg.init=function(a){return svg.element=a,svg.$element=$(a),svg.root=a.ownerSVGElement,svg},svg.width=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),svg.getBoundingRect().width;if(svg.isGroup())return svg.getBoundingRect().width;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().width;b!=1&&svg.transform(b,1)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().width)+svg.strokeWidth():0},svg.height=function(a){if(svg.isContainer())return a!=undefined&&(svg.element.setAttribute("height",a),svg.measuredHeight(a),svg.element.boundingRect=null),svg.getBoundingRect().height;if(svg.isGroup())return svg.getBoundingRect().height;if(a!=undefined){var b=(parseInt(a)-svg.strokeWidth())/svg.element.getBBox().height;b!=1&&svg.transform(1,b)}return svg.element.getBBox&&svg.isUIElement()?Math.round(svg.element.getBBox().height)+svg.strokeWidth():0},svg.explicitWidth=function(){var a=svg.element.getAttributeNode("explicit-width")||svg.element.getAttributeNode("width");if(a)return a.value},svg.explicitHeight=function(){var a=svg.element.getAttributeNode("explicit-height")||svg.element.getAttributeNode("height");if(a)return a.value},svg.totalWidth=function(a){if(a==undefined)return svg.element.getAttribute("total-width");svg.element.setAttribute("total-width",a)},svg.totalHeight=function(a){if(a==undefined)return svg.element.getAttribute("total-height");svg.element.setAttribute("total-height",a)},svg.measuredWidth=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-width")):(svg.element.setAttribute("measured-width",a),a)},svg.measuredHeight=function(a){return a==undefined?parseInt(svg.element.getAttribute("measured-height")):(svg.element.setAttribute("measured-height",a),a)},svg.strokeWidthCompensation=function(){return svg.strokeWidth()/2},svg.strokeWidth=function(){return parseInt(svg.element.getAttribute("stroke-width"))||0},svg.size=function(a,b){if(a==undefined&&b==undefined){if(svg.isContainer())return svg.getBoundingRect();return}var c,d;if(svg.isContainer()||svg.isRect()||svg.isImage())a!=undefined&&(a=Math.max(0,a-svg.strokeWidth()),svg.element.setAttribute("width",a),svg.measuredWidth(a),svg.element.boundingRect=null),b!=undefined&&(b=Math.max(0,b-svg.strokeWidth()),svg.element.setAttribute("height",b),svg.measuredHeight(b),svg.element.boundingRect=null);else if(svg.isGroup()){var e=svg.getRealBBox();a!=undefined?c=parseInt(a)/(e.width||1):c=1,b!=undefined?d=parseInt(b)/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}else{var e=svg.element.getBBox();a!=undefined?c=(parseInt(a)-svg.strokeWidth())/(e.width||1):c=1,b!=undefined?d=(parseInt(b)-svg.strokeWidth())/(e.height||1):d=1,(c!=1||d!=1)&&svg.transform(c,d)}},svg.position=function(a,b){if(a!=undefined&&b!=undefined){svg.transform(null,null,a,b);return}if(svg.isRect()||svg.isImage()||svg.isContainer()){var c=svg.element.x.baseVal.value-svg.strokeWidthCompensation(),d=svg.element.y.baseVal.value-svg.strokeWidthCompensation();return{x:c,y:d}}if(svg.isGroup()){var e=svg.root.createSVGPoint();return e.x=parseInt(svg.element.getAttribute("x"))||0,e.y=parseInt(svg.element.getAttribute("y"))||0,e}if(svg.isForeign())return{x:svg.element.x.baseVal.value||0,y:svg.element.y.baseVal.value||0};var f=svg.element.getBBox();return realX=f.x-svg.strokeWidthCompensation(),realY=f.y-svg.strokeWidthCompensation(),{x:realX,y:realY}},svg.transform=function(a,b,c,d){var e=svg.ROOT_EL||(svg.ROOT_EL=document.getElementById("svgObject"));switch(svg.element.nodeName){case"g":var f=svg.element.transform.baseVal,g,h,i,j,k,l;c!=undefined&&d!=undefined&&(l=svg.getRealBBox(),f.numberOfItems==0?(i=e.createSVGTransform(),i.setMatrix(e.createSVGMatrix()),f.appendItem(i)):i=f.getItem(0),g=svg.element.getScreenCTM(),g&&(j=svg.root.createSVGMatrix(),j.a=g.a,j.d=g.d,k=svg.root.createSVGMatrix(),k.e=l.x*j.a-c,k.f=l.y*j.d-d,j=j.inverse().multiply(k).inverse(),i.setMatrix(j)),svg.element.setAttribute("x",c),svg.element.setAttribute("y",d),svg.element.boundingRect=null);if(a!=undefined&&b!=undefined){var m;f.numberOfItems==0?m=svg.position(0,0):m=svg.position(),i=f.getItem(0),g=svg.element.getCTM(),l=svg.getRealBBox(),j=svg.root.createSVGMatrix(),j.e=l.x,j.f=l.y,g&&(j=g.multiply(j),h=svg.element.ownerSVGElement.getCTM(),k=svg.root.createSVGMatrix(),k.e=(g.e-j.e)/g.a*a+j.e-h.e,k.f=(g.f-j.f)/g.d*b+j.f-h.f,k.a=a,k.d=b,i.setMatrix(k)),svg.element.boundingRect=null}break;case"svg":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"ellipse":var n=parseInt(c),o=parseInt(d),p=parseFloat(svg.element.getAttribute("rx")),q=parseFloat(svg.element.getAttribute("ry"));isNaN(n)||svg.element.setAttribute("cx",n+p+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+q+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("rx",p)),isNaN(parseFloat(b))||(q=Math.abs(Math.max(0,svg.height()*b/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("ry",q));break;case"circle":var n=parseInt(c),o=parseInt(d),r=parseFloat(svg.element.getAttribute("r"));isNaN(n)||svg.element.setAttribute("cx",n+r+svg.strokeWidthCompensation()),isNaN(o)||svg.element.setAttribute("cy",o+r+svg.strokeWidthCompensation()),isNaN(parseFloat(a))||(p=Math.abs(Math.max(0,svg.width()*a/2)-svg.strokeWidthCompensation()),svg.element.setAttribute("r",r));break;case"rect":var n=parseInt(c)+svg.strokeWidthCompensation(),o=parseInt(d)+svg.strokeWidthCompensation();isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"text":var n=parseInt(c),o=parseInt(d);isNaN(n)||svg.element.setAttribute("x",n),isNaN(o)||svg.element.setAttribute("y",o);break;case"foreignObject":var n=parseInt(c),o=parseInt(d),s=svg.element.firstElementChild;isNaN(n)||(svg.element.setAttribute("x",n),s&&(s.style.width=svg.measuredWidth()+"px")),isNaN(o)||(svg.element.setAttribute("y",o),s&&(s.style.height=svg.measuredHeight()+"px"));break;case"path":var l=svg.element.getBBox(),t=svg.scaleGrid(l);if(t&&svg.isRelativePath()){var u=svg.convertPath();svg.pathData(u)}var v=svg.element.pathSegList,w=v.numberOfItems,x=[];a=Math.max(0,a),b=Math.max(0,b),x.right=a*l.width-l.width,x.bottom=b*l.height-l.height,c=c||0,d=d||0;var y=[];y.x=(c||0)+svg.strokeWidthCompensation()-l.x,y.y=(d||0)+svg.strokeWidthCompensation()-l.y;if(!isNaN(a)||!isNaN(b)||!isNaN(c)||!isNaN(d))while(w--){var z=v.getItem(w);a&&b&&(t?(z.x>t.right&&(z.x+=x.right,z.x1+=x.right,z.x2+=x.right),isNaN(t.right)&&(z.x*=a,z.x1*=a,z.x2*=a),z.y>t.bottom&&(z.y+=x.bottom,z.y1+=x.bottom,z.y2+=x.bottom),isNaN(t.bottom)&&(z.y*=b,z.y1*=b,z.y2*=b)):(z.x*=a,z.y*=b,z.x1*=a,z.y1*=b,z.x2*=a,z.y2*=b)),z.pathSegType%2||(c!=undefined&&(z.x+=y.x,z.x2+=y.x,z.x1+=y.x),d!=undefined&&(z.y+=y.y,z.y2+=y.y,z.y1+=y.y))}}e=null},svg.linePosition=function(a,b,c,d){if(svg.isLine()){a!=undefined&&b!=undefined&&(svg.$element[0].setAttribute("x1",a),svg.$element[0].setAttribute("y1",b)),c!=undefined&&d!=undefined&&(svg.$element[0].setAttribute("x2",c),svg.$element[0].setAttribute("y2",d));var e={x1:parseInt(svg.$element[0].getAttribute("x1")),y1:parseInt(svg.$element[0].getAttribute("y1")),x2:parseInt(svg.$element[0].getAttribute("x2")),y2:parseInt(svg.$element[0].getAttribute("y2"))};return e}},svg.gap=function(){return parseInt(svg.element.getAttribute("gap"))||0},svg.padding=function(){return parseInt(svg.element.getAttribute("padding"))||0},svg.isContainer=function(){return svg.element.nodeName=="svg"},svg.isRect=function(){return svg.element.nodeName=="rect"},svg.isImage=function(){return svg.element.nodeName=="image"},svg.isGroup=function(){return svg.element.nodeName=="g"},svg.isText=function(){return svg.element.nodeName=="text"},svg.isForeign=function(){return svg.element.nodeName=="foreignObject"},svg.isLine=function(){return svg.element.nodeName=="line"},svg.isStencil=function(){return svg.hasClass("stencil")||svg.hasClass("stencil-grouped")},svg.hasClass=function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(svg.element.nodeType===1&&(" "+svg.element.className.baseVal+" ").replace($.rclass," ").indexOf(b)>-1)return!0;return!1},svg.isDirty=function(a){return a!=undefined&&(a?svg.element.setAttribute("dirty","true"):svg.element.setAttribute("dirty","false")),svg.element.getAttribute("dirty")=="true"?!0:!1},svg.scaleGrid=function(a){a||(a=svg.element.getBBox());var b=[];b.right=parseInt(svg.element.getAttribute("scale-grid-right"))+a.x,b.bottom=parseInt(svg.element.getAttribute("scale-grid-bottom"))+a.y;if(b.right||b.bottom)return b},svg.minWidth=function(a){var b;if(!svg.element.getAttribute("min-width")){if(a!=undefined)b=a,svg.element.setAttribute("min-width",b);else if(!svg.isContainer()){var c=svg.explicitWidth();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild,e=d.style.width,f=svg.explicitWidth(),g=svg.explicitHeight();f==undefined&&(svg.element.setAttribute("width","100%"),g==undefined&&svg.element.setAttribute("height","100%")),d.style.width="1px",d.style.overflow="hidden",b=d.scrollWidth+(parseInt(d.style.paddingLeft)||0)+(parseInt(d.style.paddingRight)||0)+(parseInt(d.style.marginLeft)||0)+(parseInt(d.style.marginRight)||0),d.style.width=e,f==undefined&&(svg.element.setAttribute("width",b),g==undefined&&svg.element.removeAttribute("height"))}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.width()/2:svg.width();svg.element.setAttribute("min-width",b)}return b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-width",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-width"))||0},svg.minHeight=function(a){var b;if(!svg.element.getAttribute("min-height")){if(a!=undefined)b=a,svg.element.setAttribute("min-height",b);else if(!svg.isContainer()){var c=svg.explicitHeight();if(!utils.getPercentage(c)&&!isNaN(c))b=parseInt(c);else if(svg.isForeign()){var d=svg.element.firstElementChild;b=Math.round(parseInt(document.defaultView.getComputedStyle(d,null).getPropertyValue("line-height"))*1.3)||0,svg.explicitHeight()==undefined&&svg.element.setAttribute("height",b)}else b=/^icon-/.test(svg.element.getAttribute("id"))?svg.height()/2:svg.height()}return svg.element.setAttribute("min-height",b),b||0}a!=undefined&&(b=a,svg.element.setAttribute("min-height",b));if(a==undefined)return parseInt(svg.element.getAttribute("min-height"))||0},svg.convertPath=function(){var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],b=svg.element.pathSegList,c=b.numberOfItems,d=0,e=0,f="",g=null;for(var h=0;h<c;++h){var i=b.getItem(h),j=i.x||0,k=i.y||0,l=i.x1||0,m=i.y1||0,n=i.x2||0,o=i.y2||0,p=i.pathSegType,q=a[p].toUpperCase(),r=function(a,b,c){var d="",b=b?" "+b.join(" "):"",c=c?" "+c:"";$.each(a,function(b,c){a[b]=c}),f+=q+a.join(" ")+b+c};switch(p){case 1:f+="z";break;case 12:j-=d;case 13:j+=d,d=j,q="L",r([[j,e]]);break;case 14:k-=e;case 15:k+=e,e=k,q="L",r([[d,k]]);break;case 2:case 4:case 18:j-=d,k-=e;case 5:case 3:g&&b.getItem(h-1).pathSegType===1&&!toRel&&(d=g[0],e=g[1]);case 19:j+=d,k+=e,d=j,e=k,p===3&&(g=[d,e]),r([[j,k]]);break;case 6:j-=d,l-=d,n-=d,k-=e,m-=e,o-=e;case 7:j+=d,l+=d,n+=d,k+=e,m+=e,o+=e,d=j,e=k,r([[l,m],[n,o],[j,k]]);break;case 8:j-=d,l-=d,k-=e,m-=e;case 9:j+=d,l+=d,k+=e,m+=e,d=j,e=k,r([[l,m],[j,k]]);break;case 10:j-=d,k-=e;case 11:console.error("Error: Resizing paths with relative elliptical arcs is not implemented!"),j+=d,k+=e,d=j,e=k,r([[i.r1,i.r2]],[i.angle,i.largeArcFlag?1:0,i.sweepFlag?1:0],[j,k]);break;case 16:j-=d,n-=d,k-=e,o-=e;case 17:j+=d,n+=d,k+=e,o+=e,d=j,e=k,r([[n,o],[j,k]])}}return f},svg.pathData=function(a){return a&&svg.element.setAttribute("d",a),a||svg.element.getAttribute("d")},svg.isRelativePath=function(){var a=/[achlmqstv]/,b=svg.pathData().search(a);return b!=-1},svg.shouldWrap=function(){return svg.element.getAttribute("wrap")==="true"},svg.textData=function(a){return a&&svg.element.setAttribute("data-text",a),a||svg.element.getAttribute("data-text")},svg.textAlign=function(a){return a&&svg.element.setAttribute("data-text-align",a),a||svg.element.getAttribute("data-text-align")},svg.isEditable=function(){return svg.element.getAttribute("editable")==="true"},svg.resetSizeOnEdit=function(){return svg.element.getAttribute("reset-size")==="true"},svg.resetSizeOnInspect=function(){return svg.element.getAttribute("reset-size-inspect")==="true"},svg.isMultilineEditable=function(){return svg.element.getAttribute("multiline")==="true"},svg.resizeMode=function(){return svg.element.getAttribute("resize-mode")||svg.RESIZE_ALL},svg.isUIElement=function(){var a=/svg|text|foreignObject|path|circle|rect|ellipse|g|image/,b=svg.element.nodeName.search(a);return b!=-1},svg.data=function(a){console.info("deprecated: svg.data()")},svg.getRealBBox=function(){if(!svg.element.realBBox){var a=svg.$element.find("*").get(),b=svg.element.getBBox(),c,d,e,f,g,h;c=b.x,e=b.y,d=b.x+b.width,f=b.y+b.height,g=b.width,h=b.height;if(a.length)for(var i=0;i<a.length;i++){if(!a[i].getBBox||a[i].nodeName=="clipPath")break;var j=a[i].getBBox(),k=parseFloat(a[i].getAttribute("stroke-width"))||0,l=k/2;c=Math.min(c,j.x-l),e=Math.min(e,j.y-l),d=Math.max(d,j.x+j.width+l),f=Math.max(f,j.y+j.height+l),g=d-c,h=f-e}var m=svg.root.createSVGRect();m.x=c,m.y=e,m.width=g,m.height=h,svg.element.realBBox=m}return svg.element.realBBox},svg.getBoundingRect=function(){if(!svg.element.boundingRect){var a=svg.element.getCTM(),b=svg.element.ownerSVGElement.getCTM(),c=svg.getRealBBox(),d,e,f,g,h,i;h=a.a*c.width,i=a.d*c.height,d=(c.x+a.e/a.a)*a.a-b.e,f=(c.y+a.f/a.d)*a.d-b.f,e=d+h,g=e+i,svg.element.boundingRect={left:d,right:e,top:f,bottom:g,width:h,height:i}}return svg.element.boundingRect};var layout=window.layout=function(a){return typeof a=="string"&&(a=$(a)[0]),layout.init(a)};layout.LAYOUT_VERTICAL="vertical",layout.LAYOUT_HORIZONTAL="horizontal",layout.LAYOUT_NONE="none",layout.ALIGN_VERTICAL_TOP="top",layout.ALIGN_VERTICAL_MIDDLE="middle",layout.ALIGN_VERTICAL_BOTTOM="bottom",layout.ALIGN_HORIZONTAL_LEFT="left",layout.ALIGN_HORIZONTAL_RIGHT="right",layout.ALIGN_HORIZONTAL_CENTER="center",layout.init=function(a){return layout.element=a,layout},layout.measure=function(a){var b=a.getAttribute("layout"),c=svg(a).measuredWidth(),d=svg(a).measuredHeight(),e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=svg(a).padding(),p=o*2,q=0,r=0,s=0,t=0,u=$(a).children();u.length>1&&(m=svg(a).gap(),n=(u.length-1)*m);var v=n+p,w=n+p;isNaN(c)&&(c=svg(a).measuredWidth(a.getAttribute("width"))),isNaN(d)&&(d=svg(a).measuredHeight(a.getAttribute("height")));var x=[];for(var y=0;y<u.length;y++){var z=u[y],A=svg(z).explicitWidth(),B=svg(z).explicitHeight();if(!utils.getPercentage(A)){var C=parseInt(A);isNaN(C)?C=svg(z).width():C=parseInt(A),g+=C}else $.inArray(z,x)==-1&&x.push(z),e+=utils.getPercentage(A);if(!utils.getPercentage(B)){var D=parseInt(B);isNaN(D)?D=svg(z).height():D=parseInt(B),h+=D}else $.inArray(z,x)==-1&&x.push(z),f+=utils.getPercentage(B);svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0);var E=svg(z).minWidth(),F=svg(z).minHeight();C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).measuredWidth(C),svg(z).measuredHeight(D),!svg(z).isContainer()&&(!isNaN(parseInt(A))||!isNaN(parseInt(B)))&&svg(z).size(C,D),!isNaN(C)&&!utils.getPercentage(A)&&(v+=C),!isNaN(D)&&!utils.getPercentage(A)&&(w+=D),C=0,D=0}var G=x.length;b==layout.LAYOUT_HORIZONTAL?x.sort(function(a,b){return svg(b).minWidth()-svg(a).minWidth()}):b==layout.LAYOUT_VERTICAL&&x.sort(function(a,b){return svg(b).minHeight()-svg(a).minHeight()}),i=c-(g+n)-p,j=d-(h+n)-p,e<100&&(i*=e/100),f<100&&(j*=f/100),k=i,l=j;for(var y=0;y<x.length;y++){var z=x[y],H=utils.getPercentage(svg(z).explicitWidth()),I=utils.getPercentage(svg(z).explicitHeight()),E=svg(z).minWidth(),F=svg(z).minHeight(),C=0,D=0;if(b==layout.LAYOUT_HORIZONTAL)H&&(C=Math.round(H/e*k),C=Math.max(C,E),k-=C,e-=H,q+=C),I&&(j=d-p,D=j*I/100);else if(b==layout.LAYOUT_VERTICAL)I&&(D=Math.round(I/f*l),D=Math.max(D,F),l-=D,f-=I,r+=D),H&&(i=c-p,C=i*H/100);else{var J;H&&(C=c*H/100-p),I&&(D=d*I/100-p);if(H&&I&&svg(z).resizeMode()==svg.RESIZE_ASPECT)if(c>d){if(E>F){J=E/F;var K=C/J;K>d?(J=F/E,C=D/J,svg(z).measuredWidth(C)):(J=E/F,D=C/J,svg(z).measuredHeight(D))}E<F&&(J=F/E,C=D/J,svg(z).measuredWidth(C)),E==F&&(J=E/F,D=C/J,svg(z).measuredHeight(D))}else if(c<d){if(F>E){J=F/E;var L=D/J;L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C))}F<E&&(J=E/F,D=C/J,svg(z).measuredHeight(D)),E==F&&(J=F/E,C=D/J,svg(z).measuredWidth(C))}else c==d&&(J=F/E,L=D/J,L>c?(J=E/F,D=C/J,svg(z).measuredHeight(D)):(J=F/E,C=D/J,svg(z).measuredWidth(C)))}G>1&&G===y+1&&(s=q-i,t=r-j),b==layout.LAYOUT_HORIZONTAL&&H?C-=s:b==layout.LAYOUT_VERTICAL&&I&&(D-=t),C<E&&!svg(z).isContainer()&&(C=E),D<F&&!svg(z).isContainer()&&(D=F),svg(z).isContainer()&&C==svg(z).measuredWidth()&&D==svg(z).measuredHeight()?svg(z).isDirty(!1):svg(z).isDirty(!0),svg(z).isContainer()||svg(z).size(C,D),H&&(svg(z).measuredWidth(C),v+=C),I&&(svg(z).measuredHeight(D),w+=D),!!isNaN(C),!!isNaN(D)}svg(a).totalWidth(v),svg(a).totalHeight(w),x=null,u=null,z=null},layout.layout=function(a,b){var c=a;FDBK.executeLayoutHelper(a.templateName,a),b&&layout.measureMinSizes(c),layout.measure(c);var d=c.getAttribute("layout");switch(d){case layout.LAYOUT_HORIZONTAL:layout.horizontalLayout(c);break;case layout.LAYOUT_VERTICAL:layout.verticalLayout(c);break;default:layout.defaultLayout(c)}},layout.horizontalLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children(),i=svg(a).totalWidth(),j=svg(a).totalHeight();for(var k=0;k<h.length;k++){var l=h[k];if(!svg(l).isUIElement())continue;if(k==0)f=layout.verticalAlign(l,a,b),g=layout.horizontalAlign(l,a,c),svg(l).position(g,f);else{var m=h[k-1],n=svg(m).position().x,o=svg(m).measuredWidth(),p=n+o+d;f=layout.verticalAlign(l,a,b),svg(l).position(p,f)}svg(l).isContainer()&&svg(l).isDirty()&&layout.layout(l)}},layout.verticalLayout=function(a){var b=a.getAttribute("horizontal-align"),c=a.getAttribute("vertical-align"),d=svg(a).gap(),e=svg(a).padding(),f,g,h=$(a).children();for(var i=0;i<h.length;i++){var j=h[i];if(!svg(j).isUIElement())continue;if(i==0)f=layout.horizontalAlign(j,a,b),g=c?layout.verticalAlign(j,a,c):e,svg(j).position(f,g);else{var k=h[i-1],l=svg(k).position().y,m=svg(k).measuredHeight(),n=l+m+d;f=layout.horizontalAlign(j,a,b),svg(j).position(f,n)}svg(j).isContainer()&&svg(j).isDirty()&&layout.layout(j)}},layout.defaultLayout=function(a){var b=a.getAttribute("vertical-align"),c=a.getAttribute("horizontal-align"),d,e,f=$(a).children();for(var g=0;g<f.length;g++){var h=f[g];if(!svg(h).isUIElement())continue;d=layout.horizontalAlign(h,a,c),e=layout.verticalAlign(h,a,b),svg(h).position(d,e),svg(h).isContainer()&&svg(h).isDirty()&&layout.layout(h)}},layout.verticalAlign=function(a,b,c){var d=svg(b).measuredHeight(),e,f=svg(b).padding();switch(c){case layout.ALIGN_VERTICAL_MIDDLE:e=Math.floor((d-svg(a).measuredHeight())/2);break;case layout.ALIGN_VERTICAL_BOTTOM:e=d-svg(a).measuredHeight()-f;break;default:e=f}return e},layout.horizontalAlign=function(a,b,c){var d=svg(b).measuredWidth(),e=0,f=svg(b).padding();switch(c){case layout.ALIGN_HORIZONTAL_CENTER:var g=b.getAttribute("layout");g==layout.LAYOUT_HORIZONTAL?e=(d-svg(b).totalWidth())/2+f:e=Math.floor((d-svg(a).measuredWidth())/2);break;case layout.ALIGN_HORIZONTAL_RIGHT:e=d-svg(b).totalWidth()+f;break;default:e=f}return e},layout.measureMinSizes=function(a){var b=$(a).find("*").get().reverse();$(b).each(function(){if(svg(this).isText()&&!svg.shouldWrap()){var b=parseInt($(this).css("line-height"));this.setAttribute("dy",b)}this.nodeName!="foreignText";var c=$(this).parent()[0];if(!svg(c).isContainer())return;var d=$(c).children().length,e=svg(c).padding()*2,f,g=0,h=0,i=svg(c).minWidth(),j=svg(c).minHeight(),k=svg(c).explicitWidth(),l=svg(c).explicitHeight();d>1&&(g=svg(c).gap(),h=(d-1)*g),f=c.getAttribute("layout"),svg(c).minWidth()==0&&(i=e,f==layout.LAYOUT_HORIZONTAL&&(i+=h),svg(c).minWidth(i)),svg(c).minHeight()==0&&(j=e,f==layout.LAYOUT_VERTICAL&&(j+=h),svg(c).minHeight(j));switch(f){case layout.LAYOUT_HORIZONTAL:i=svg(c).minWidth()+svg(this).minWidth(),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight());break;case layout.LAYOUT_VERTICAL:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=svg(this).minHeight()+svg(c).minHeight();break;default:i=Math.max(svg(this).minWidth()+e,svg(c).minWidth()),j=Math.max(svg(this).minHeight()+e,svg(c).minHeight())}c!=a&&(!utils.getPercentage(k)&&!isNaN(parseInt(k))&&(i=parseInt(k)),!utils.getPercentage(l)&&!isNaN(parseInt(l))&&(j=parseInt(l))),svg(c).isContainer()&&(svg(c).minWidth(i),svg(c).minHeight(j),svg(c).isStencil()&&(!svg(c).explicitWidth()&&!svg(c).explicitHeight()&&(c.setAttribute("width",i),c.setAttribute("height",j)),parseInt(svg(c).explicitWidth())<i&&(c.setAttribute("width",i),c.setAttribute("measured-width",i)),parseInt(svg(c).explicitHeight())<j&&(c.setAttribute("height",j),c.setAttribute("measured-height",j))))}),b=null},layout.add=function(a,b,c){var d=$(a).appendTo(b)[0];return c||layout.layout(d,!0),d},FDBK.mixinModule("project-themes",{initModule:function(){if(FDBK.config("projectManagement.font.enabled")){var a=this;FDBK.sub("open-project",function(){a.applyProjectFont(FDBK.library.currentProject.font)}),FDBK.sub("loaded-user-settings",this.selectDefaultFont);if($("#project-fonts").length){for(var b=0,c="",d=FDBK.config("projectManagement.font.list");b<d.length;b++)c+='<label class="preview-font '+d[b].value+'" title="'+d[b].description+'" >      <input type="radio" name="font" value="'+d[b].value+'"/>'+d[b].name+"</label>";$("#project-fonts").append(c).find("[name=font]").on("change",function(){a.saveProjectFontPreference($(this).val())}).end(),this.selectDefaultFont()}}else $("#project-fonts").hide()},selectDefaultFont:function(){var a=FDBK.library.getUserSettings("defaultFont")||FDBK.config("projectManagement.font.default");$("#project-fonts").find('[value="'+a+'"]').attr("checked","checked")},applyProjectFont:function(a){var b=FDBK.config("projectManagement.font.list").map(function(a){return a.value}).join(" ");$("html").removeClass(b).addClass(a)},saveProjectFontPreference:function(a){FDBK.library.setUserSettings("defaultFont",a)}});var MODULE=function(a,b,c,d){return a.getMockupListItemView=function(a,c){var d='<li class="mockup-list-item" data-mockup="'+utils.sanitize(a.id)+'">'+'<span class="page-is-master"'+(a.isMaster?"":'style="display:none"')+">M</span>"+'<span class="sort-handle" title="Drag to change page order">&#8801;</span>'+'<span title="'+utils.sanitize(a.name)+'" class="mockup-name ellipsis">'+utils.sanitize(a.name)+"</span>"+"</li>";return c?b(d):d},a.getMockupSVG=function(a){return b.parseXML('<svg xmlns="http://www.w3.org/2000/svg" id="'+utils.sanitize(a)+'" class="mockup"></svg>').childNodes[0]},a.renderStencil=function(a,e,f){if(!a)return;var g,h,i,j,k=f?"stencil-grouped":"stencil";switch(a.type){case"group":h=b.parseXML('<svg xmlns="http://www.w3.org/2000/svg"></svg>').childNodes[0],j=a.stencils,g=null,k+=" group";break;case"stencil":h=FDBK.getStencilDOM(a.name,a),j=null}i=d.add([h],e,!0),i.id=a.id,a.type=="group"&&(i.modelReference=a),i.setAttribute("width",a.width),i.setAttribute("measured-width",a.width),i.setAttribute("height",a.height),i.setAttribute("measured-height",a.height),i.setAttribute("x",a.left),i.setAttribute("y",a.top);if(j)for(var l=j.length-1;l>=0;l--)arguments.callee.call(this,j[l],i,!0);i.className.baseVal=k,a.type!="group"&&d().layout(i,!0);if(a.type!="group"){var m=c(i).measuredWidth();m>a.width&&!FDBK.VIEWER_MODE&&(a.width=m,FDBK.pub("collab-move-resize-stencil",a.id))}k+=" stencil-dom-optimizer";var n=FDBK.stencilTemplate(a.name);return n&&n.excludeFromPrint&&(k+=" exclude-from-print"),i.className.baseVal=k,a.locked&&b(i).prop("locked","true"),h=null,i},a.renderMockup=function(c,d){var e=a.getMockupSVG(c.id);d.append(e),d.find(".mockup").attr("class","mockup"),b("#"+c.id).attr("class","mockup active-mockup"),a.currentMockup=a.currentProject.mockup(c.id),a.renderCurrentMockup()},a.renderFallbackPNGMockup=function(a,b,c){var d;b?d="<img id='"+utils.sanitize(a.id)+"' class='mockup mockup-fallback-png' src='"+b+"'/>":d="<p id='"+utils.sanitize(a.id)+"' class='mockup fallback-not-available'>"+utils.sanitize(a.name)+": "+FDBK.loc("_Fallback image not available")+"</p>",c.append(d)},a.renderCurrentMockup=function(d){var e=a.currentMockup,f=b("#"+e.id);if(d&&FDBK.config("projectManagement.duplicateMockupMethod")==="dom-based"){var g,h=b("#"+d).clone().attr("id",utils.sanitize(e.id)).attr("class","mockup active-mockup").find(".stencil, .stencil-grouped").each(function(b,c){c.id=c.id.replace(d,e.id),g=a.currentMockup.stencil(c.id),g&&(g.locked&&(c.locked="true"),c.templateName=g.name)}).end();f.replaceWith(h)}else{var i=e.stencilList();f.attr("class","mockup active-mockup").append("<style id='reflow-optimization-style'>.stencil-dom-optimizer {display:none !important;}</style>");for(var j=i.length-1;j>=0;j--)var k=a.renderStencil(i[j],f);var l=document.getElementById("reflow-optimization-style");l.parentNode.removeChild(l);var m=b(f).find(".group").get().reverse();b(m).each(function(){var a=this,d=b(a).find(".stencil-grouped").get(),e=0;b(d).each(function(){e=Math.max(e,c(this).position().x+c(this).measuredWidth())}),a.setAttribute("width",e),a.setAttribute("measured-width",e);var f=e>a.modelReference.width;f&&!FDBK.VIEWER_MODE&&(a.modelReference.width=e,FDBK.pub("collab-move-resize-stencil",a.modelReference.id))})}},a}(MODULE||{},jQuery,svg,layout);FDBK.mixinModule("ui-components",{initModule:function(){BrowserDetect.browser=="Firefox"&&$("html").addClass("autoHideScroll"),FDBK.$tooltip=$("<div id='button-tooltip'></div>").appendTo("body"),$(window).resize(function(){var a=$(".show-dropdown > .button")[0];a&&FDBK.openDropdown(a)}),$(document).on("mousedown",".button",function(){if($(this).hasClass("disabled"))return;$(this).parent().hasClass("show-dropdown")?FDBK.closeDropdowns():$(this).parent().hasClass("dropdown-wrapper")?FDBK.openDropdown(this):($(this).addClass("active"),$(this).siblings(".dropdown").length||(FDBK.$activeButton=$(this)))}).on("mouseup",function(a){$(a.target).closest(".action").length&&!$(a.target).closest(".disabled").length?(FDBK.pub("action-clicked",{$action:$(a.target).closest(".action"),$dropdown:$(".show-dropdown")}),FDBK.closeDropdowns()):!$(a.target).closest(".dropdown-wrapper").length&&!$(a.target).closest(".dropdown").length&&FDBK.closeDropdowns(),$(a.target).closest(".button")&&!$(a.target).closest(".button").siblings(".dropdown").length&&FDBK.$activeButton&&(FDBK.$activeButton.removeClass("active"),FDBK.$activeButton=null)}).on("hover",".button",function(){if($(this).hasClass("disabled"))return;if($(this).parent().hasClass("detached"))return;$(".show-dropdown").length&&$(this).parent().hasClass("dropdown-wrapper")&&document.activeElement.nodeName!=="INPUT"&&FDBK.openDropdown(this)}).on("click",".toggle-buttons .button",function(){$(this).siblings().removeClass("active").end().addClass("active")}).on("mouseenter",".button, .custom-title",function(){FDBK.showTooltip($(this))}).on("mouseenter",".menu-item",function(){$(this).parents(".dropdown").find(".menu-item").removeClass("selected"),$(this).addClass("selected")}).on("mouseleave",".button, .custom-title",function(){FDBK.hideTooltip()}).on("click","a",function(a){$(this).attr("href")==="#"&&a.preventDefault()})},showTooltip:function(a){var b=a.attr("title");if(!b||a.parent().hasClass("show-dropdown"))return;FDBK.activeTooltip=a.removeAttr("title").data("title",b),FDBK.$tooltip.html(utils.sanitize(b)+"<span></span>").css({top:a.offset().top+a.outerHeight()+6,left:a.offset().left+Math.ceil(a.outerWidth()/2)-Math.ceil(FDBK.$tooltip.outerWidth()/2)}).show()},hideTooltip:function(){FDBK.activeTooltip&&(FDBK.activeTooltip.attr("title",FDBK.activeTooltip.data("title")),FDBK.activeTooltip=null,FDBK.$tooltip.hide())},openDropdown:function(a){FDBK.closeDropdowns();var b=$(a).addClass("active").parent();b.addClass("show-dropdown");if(b.hasClass("detached")){var c=b.find(".dropdown").first().clone();c.css({top:b.offset().top+b.outerHeight()+2,left:b.offset().left}),c.appendTo("body")}FDBK.hideTooltip(),FDBK.pub("dropdown-shown",$(a).parent())},closeDropdowns:function(){var a=$(".show-dropdown");a.removeClass("show-dropdown").find(".menu-item").removeClass("selected").end().find(".button").each(function(a,b){$(b).closest(".dropdown-content").length===0&&$(b).removeClass("active")}),FDBK.pub("dropdown-close"),$("body > .dropdown").remove(),FDBK.pub("dropdown-close",a)},openModal:function(a,b){if(BrowserDetect.unsupportedBrowser)return;if(!a)return;FDBK.closeModal(),$("#overlay").show().find(a).addClass("active"),FDBK.buildHash(b),FDBK.pub("modal-opened",a)},closeModal:function(){var a=$("#overlay").find(".modal.active").first().prop("id");if(!a)return;a="#"+a,$("#overlay").hide().find(a).removeClass("active"),FDBK.cleanAllErrors(a),FDBK.buildHash(),FDBK.pub("modal-closed",a)},openConfirmDialog:function(a){var b=$('<h2 class="heading">'+(a.showCloseButton?'<a href="#" class="close-modal">Close</a>':"")+"<strong>"+(a.heading||"Confirm action")+'</strong></h2><div class="server-errors"></div>'),c=$('<div class="modal-content"><p style="padding-bottom:20px;">'+a.message+"</p>"+"</div>"),d=$('<div class="clearfix"></div>');a.buttons&&a.buttons.length&&$.each(a.buttons,function(a,b){var c=$('<a href="#" class="button simple '+b.classes+'">'+b.text+"</a>");c.on("click",function(){typeof b.onBeforeClick=="function"&&b.onBeforeClick(),FDBK.closeModal(),typeof b.onClick=="function"&&b.onClick()}),d.append(c)}),c.append(d);var e=$("#confirm-dialog");e.empty().append(b,c);var f=a.width||"400px";e.css("width",f),FDBK.openModal("#confirm-dialog")},buildHash:function(a){if(a&&"#!/"+a!=window.location.hash)window.location.hash="#!/"+a;else if(FDBK.library&&FDBK.library.currentProject&&FDBK.library.currentProject.uniqueId){var b=FDBK.library.currentProject;window.location.hash="#!/edit/"+(b.ownerUserName?b.ownerUserName+"/":"")+b.uniqueId}else window.location.hash&&(window.location.hash="#!/")},cleanAllErrors:function(a){$(".reset-input").val(""),$(a).find("p.error").remove().end().find(".error").removeClass("error"),FDBK.showServerError({selector:a})},cleanServerError:function(){var a=$("#overlay").find(".modal.active").first();a.length&&a.find(".server-errors").empty()},showServerError:function(a){var b=$("#overlay").find(".modal.active").first();a&&a.selector&&(b=$(a.selector)),b.find(".server-errors").empty(),a&&a.message&&b.find(".server-errors").append('<div class="message '+(a.style?a.style:"")+'">'+a.message+"</div>")}}),FDBK.mixinModule("project-viewer",{needsPNGFallback:function(){return BrowserDetect.unsupportedBrowser},VIEWER_MODE:!0,PROMO_STENCIL:{type:"group",stencils:[{text:"**Online wireframes and prototypes powered by Moqups. Visit us at https://moqups.com**",inspectables:{color:"#7a7a7a",font_size:12,text_align:"left",_inspector:"tmplsvg-text-panel-alt"},type:"stencil",name:"tmplsvg-label",version:"1.0",left:48,top:12,width:436,height:16,id:"aebdb327f-5"},{path:"https://moqups.com/favicon.png",width:40,height:40,type:"stencil",name:"tmplsvg-image",version:"1.0",left:0,top:0,id:"aebdb327f-4"}],id:"aebdb327f-6",left:15,top:12,width:484,height:40},initModule:function(){function b(){var b=$(".mockup-list-item.selected").prev();if(b.length){var c=FDBK.library.currentProject.mockup(b.data("mockup"));a.switchToMockup(c,!0);var d=FDBK.library.currentProject.indexOfMockup(c.id);FDBK.itemIsVisible($("#project-mockup-list"),d)||FDBK.scrollToSelectedItem($("#project-mockup-list"),d)}}function c(){var b=$(".mockup-list-item.selected").next();if(b.length){var c=FDBK.library.currentProject.mockup(b.data("mockup"));a.switchToMockup(c,!0);var d=FDBK.library.currentProject.indexOfMockup(c.id);FDBK.itemIsVisible($("#project-mockup-list"),d)||FDBK.scrollToSelectedItem($("#project-mockup-list"),d)}}var a=this;this.$projectViewerMockupList=$("#project-mockup-list"),this.$projectViewerStage=$("#htmlStage"),this.$projectViewerSvgObject=$("#svgObject"),this.$linkNote=$("#link-note"),FDBK.sub("dom-ready",function(){function a(){FDBK.PROJECT_DATA&&FDBK.viewProject(FDBK.PROJECT_DATA,!0)}FDBK._stencilsDefsReady?a():FDBK.sub("stencils-and-defs-loaded",function(){a()});try{!$.cookie("hasAccount")&&!FDBK.inPreviewMode()&&($.cookie("compactPromo")?$("#promo-button").show():$("#promo").slideDown())}catch(b){console.log("Error on promo slide : ",b)}}),$(document).on("click","#close-promo",function(){$.cookie("compactPromo","true",{expires:7,path:"/"}),$("#promo").hide(),FDBK.pub("viewer-promo-closed")}).on("click",".promo-button",function(){FDBK.pub("viewer-promo-clicked")}),$(document).bind("swipeleft",b),$(document).bind("swiperight",c),$(document).on("keydown",null,"left pageup",function(){return b(),!1}).on("keydown",null,"right pagedown",function(){return c(),!1}).on("keydown",null,"up",function(){if($("#project-mockup-list").is(":visible"))return b(),!1}).on("keydown",null,"down",function(){if($("#project-mockup-list").is(":visible"))return c(),!1}).on("keydown",null,"return",function(){FDBK.closeDropdowns()}),FDBK.sub("dropdown-shown",function(a){if(a.attr("id")==="project-structure-dropdown"){var b=FDBK.library.currentProject.indexOfMockup($(".mockup-list-item.selected").data("mockup"));FDBK.itemIsVisible($("#project-mockup-list"),b)||FDBK.scrollToSelectedItem($("#project-mockup-list"),b)}}),FDBK.sub("mockup-changed",this.updateViewerUI,this),$(document).bind("keydown","return",function(){try{closeDropdowns()}catch(a){}}),$("#prev-page").click(function(){$(this).hasClass("disabled")||b()}),$("#next-page").click(function(){$(this).hasClass("disabled")||c()}),$(document).on("keydown",function(b){b.keyCode===16&&(a._projectViewerLinksShown||(a._projectViewerLinksShown=!0,$(".link-ghost").addClass("hover")))}).on("keyup",function(){a._projectViewerLinksShown&&(a._projectViewerLinksShown=!1,$(".link-ghost").removeClass("hover"))}),this.$projectViewerStage.on("click",".link-ghost[rel=mockup]",function(){var b=FDBK.library.currentProject.mockup($(this).attr("href").substring(1));return a.switchToMockup(b,!0),$("#page").scrollTop(0),!1}),this.$projectViewerMockupList.on("click",".mockup-list-item",function(){var b=FDBK.library.currentProject.mockup($(this).data("mockup"));a.switchToMockup(b,!0)}),window.onpopstate=function(b){if(b&&b.state){var c=FDBK.library.currentProject.mockup(b.state.mockupId);a.switchToMockup(c,!1)}}},clearProjectViewer:function(){this.$projectViewerMockupList.empty(),this.$projectViewerSvgObject.find(".mockup").remove(),$(".link-ghost").remove()},centerTheProject:function(){this.$projectViewerStage.css({margin:"0 auto"}).css({"margin-left":parseInt(this.$projectViewerStage.offset().left,10)})},highlightStencils:function(a){},viewProject:function(a,b){FDBK.sub("user-login-success",function(){window.location.hash="",window.location.reload()}),a.ownerIsPremium||($("#comments-button").hide(),$("#notif-button").hide());var c=this;if(FDBK.config("projectManagement.useContentStreaming")&&b){var d=new FDBK.Project(a,b);FDBK.library.currentProject=d;if(!d.isPublic&&!FDBK.library.canViewProject())return;var e=a?a.uniqueId?a.uniqueId:a:null;if(!e)return;FDBK.API.xhr(FDBK.API.CALL_GET_PROJECT_CONTENT_STREAM_VIEW,{BASE_URL:FDBK.WEB_SOCKET_URL,urlParams:[e],success:function(d){if(d.success){var e=$.extend({},a,d.object.snapshot);c.renderProject(e,b)}},error:function(){}})}else this.renderProject(a,b)},renderProject:function(a,b){function e(a){var b=-1;for(var c=0;c<d.fallbackImages.length;c++){var e=d.fallbackImages[c].split("/"),f=e[e.length-1],g=parseInt(f.split("_")[0],10)-1;g==a&&(b=c)}return b}var c=this;this._renderedMockups.length=0,this.stagePadding=20,$(window).resize(function(){c.centerTheProject()}),this.$mockupContainer=this.needsPNGFallback()?this.$projectViewerStage:this.$projectViewerSvgObject,this.needsPNGFallback()&&this.$projectViewerSvgObject.remove();var d=new FDBK.Project(a,b);FDBK.library.currentProject=d,FDBK.pub("open-project"),utils.setDocumentTitle(d.name),!FDBK.config("viewer.fallback.enabled")&&this.needsPNGFallback()?$("#preloader").append('<h2>We\'re sorry, but your browser is not supported yet.</h2><p>Moqups works great with the latest version of <a href="https://www.google.com/chrome">Chrome</a>, <a href="http://www.mozilla.org/en-US/firefox/new/">Firefox</a> or <a href="http://www.apple.com/safari/download/">Safari</a>.</p>'):$("#preloader").hide(),FDBK.config("viewer.prefetchImages")&&this.prefetchImages(d),this.needsPNGFallback()||(this.$projectViewerSvgObject.append(FDBK.getSVGDefs()),this.$projectViewerSvgObject.add(this.$projectViewerStage)),this.$projectViewerStage.css({padding:this.stagePadding,margin:"0 auto"}).css({"margin-left":parseInt(c.$projectViewerStage.offset().left,10)});if((!this.needsPNGFallback()||!FDBK.config("viewer.fallback.enabled"))&&FDBK.config("viewer.render.method")==="all-the-things"){var f=d.masterPages();for(var g=0;g<f.length;g++){var h=f[g];this.library.renderMockup(h,this.$mockupContainer)}}var i=d.normalPages();for(var g=0;g<i.length;g++){var j=i[g];this.addMockupToMockupList(j),this.needsPNGFallback()?FDBK.config("viewer.fallback.enabled")&&this.library.renderFallbackPNGMockup(j,d.fallbackImages[e(g)],this.$mockupContainer):FDBK.config("viewer.render.method")==="all-the-things"&&this.library.renderMockup(j,this.$mockupContainer)}i.length>1&&$("#next-page").removeClass("disabled"),$("#mockup-counter").text("("+i.length+")");if(i.length){var k=function(a){var b=FDBK.R_VIEWER_PAGE_PATTERN.exec(a.pathname),c=b?b[1]:a.hash.substring(1);if(c){var e=d.indexOfMockup(c);if(e!==-1)return i[e]}return null}(window.location)||i[0];this.switchToMockup(k,!1),FDBK.config("viewer.history.method")==="pushState"&&window.history&&window.history.replaceState&&window.history.replaceState({mockupId:k.id},k.name)}FDBK.inPreviewMode()||FDBK.library.currentProject.canEditProject()&&$("#project-edit-button").click(function(){var a=FDBK.library.currentProject;window.location=FDBK.BASE_URL+"#!/edit/"+(a.ownerUserName?a.ownerUserName+"/":"")+a.uniqueId}).show()},printProject:function(a,b,c,d){var e=FDBK.library.currentProject=new FDBK.Project(a);FDBK.pub("open-project"),d&&d==="true"&&FDBK.addPromoStencilToProject(e);var f=e.normalPages(),g=$('<div class="htmlStage"></div>'),h=this.getPageRenderSize(f,b,c);$("#page").width(h.width+"px").height(h.height+"px");for(var i=b?parseInt(b)-1:0,j=c?parseInt(c):f.length;i<j;i++){var k=$("#tmpl-svgobject").loc_tmpl();k.append(FDBK.getSVGDefs()),k.width(h.width+"px").height(h.height+"px"),$("#page").append(g),g.append(k),k.append(FDBK.library.getMockupSVG(f[i].id));var l=$("#"+f[i].id);if(f[i].master){var m=FDBK.library.currentProject.mockup(f[i].master),n=m.stencilList(),o;for(o=n.length-1;o>=0;o--)FDBK.library.renderStencil(n[o],l)}var p=f[i].stencilList(),o;for(o=p.length-1;o>=0;o--)FDBK.library.renderStencil(p[o],l)}},prefetchImages:function(a){if(!a||!a.mockupList())return;var b=a.mockupList(),c=function(a){return a.name==="tmplsvg-image"&&a.path};for(var d=0;d<b.length;d++){var e=b[d].filterStencils(c);for(var f=0;f<e.length;f++)(new Image).src=FDBK.ASSET_IMAGE_BASE_URL+e[f].path}},addPromoStencilToProject:function(a){if(FDBK.config("export.includePromo")){var b=a.mockupList(),c;for(c=0;c<b.length;c++){var d=b[c],e=d.stencilList(),f;if(d.isMaster)continue;d.master&&a.mockup(d.master)&&(e=e.concat(a.mockup(d.master).stencilList()));var g,h,i=null;for(f=e.length-1;f>=0;f--)g=e[f].top+e[f].height,h=e[f].left,(i||0)<g&&(i=g);d.stageHeight-i<FDBK.PROMO_STENCIL.height+30&&(d.stageHeight=i+FDBK.PROMO_STENCIL.height+30);var j=d.stageHeight-FDBK.PROMO_STENCIL.height-10,k=10,l=$.extend(!0,{},FDBK.PROMO_STENCIL,{top:j,left:k});d.addStencil(l)}}},getPageRenderSize:function(a,b,c){var d=0,e=0;for(var f=b?parseInt(b)-1:0,g=c?parseInt(c):a.length;f<g;f++)a[f].stageWidth>d&&(d=a[f].stageWidth),a[f].stageHeight>e&&(e=a[f].stageHeight);return{width:d,height:e}},printHeaderForMockup:function(a){$.template["fdbk-print-header"]||$.template("fdbk-print-header",$("#tmpl-print-header"));var b=FDBK.BASE_URL+"/project/"+a.id,c=qrcode(4,"M");return c.addData(b),c.make(),$.loc_tmpl("fdbk-print-header",{qr:c.createImgTag(),project:a.name,url:b})},addMockupToMockupList:function(a){this.$projectViewerMockupList.append('<li class="mockup-list-item" data-mockup="'+utils.sanitize(a.id)+'" title="'+utils.sanitize(a.name)+'">'+'<span class="mockup-name ellipsis">'+utils.sanitize(a.name)+"</span>"+"</li>")},renderMockupLinks:function(a){var b=function(a,c,d){var e=!1;for(var f=a.length-1;f>=0;f--){var g=a[f],h=g&&g.link&&g.link.type==="mockup"&&FDBK.library.currentProject.mockup(g.link.ref)&&!FDBK.library.currentProject.mockup(g.link.ref).isMaster;h&&(d.$projectViewerStage.append($.loc_tmpl('<a class="link-ghost {{= klass }}" title="{{= title }}" rel="{{= rel }}" href="{{= href }}" target="_blank" style="width:{{= css.width }}px;height:{{= css.height }}px;top:{{= css.top }}px;left:{{= css.left }}px;"><span></span></a>',{href:g.link.type==="url"?g.link.ref:"#"+g.link.ref,klass:"link-ghost-"+utils.sanitize(g.link.type)+(g.name==="tmplsvg-hotspot"&&g.inspectables?" "+g.inspectables.type:""),rel:g.link.type,title:g.link.type==="mockup"&&FDBK.library.currentProject.mockup(g.link.ref)?"→ "+FDBK.library.currentProject.mockup(g.link.ref).name:"",css:{width:g.width,height:g.height,top:c.top+g.top,left:c.left+g.left}})),e=!0),g.type==="group"&&g.stencils&&b(g.stencils,{left:c.left+g.left,top:c.top+g.top},d)&&(e=!0)}return e};b(a.stencils,{left:this.stagePadding,top:this.stagePadding},this)&&!this.$linkNote.is(":visible")&&this.$linkNote.delay(500).fadeIn("fast").delay(5e3).fadeOut("fast")},_renderedMockups:[],switchToMockup:function(a,b){this.$projectViewerSvgObject.css({width:a.stageWidth+"px",height:a.stageHeight+"px"}),this.$projectViewerStage.css({width:a.stageWidth+"px",height:a.stageHeight+"px",margin:"0 auto"}).css({"margin-left":parseInt(this.$projectViewerStage.offset().left,10)});var c=this.$projectViewerMockupList.find(".mockup-list-item[data-mockup="+a.id+"]");c.addClass("selected").siblings(".mockup-list-item").removeClass("selected"),FDBK.config("viewer.render.method")==="on-demand"&&this._renderedMockups.indexOf(a.id)===-1&&(a.master&&(this.library.renderMockup(this.library.currentProject.mockup(a.master),this.$mockupContainer),this._renderedMockups.push(a.master)),this.library.renderMockup(a,this.$mockupContainer),this._renderedMockups.push(a.id));var d=FDBK.library.currentProject.normalPages();this.$mockupContainer.find(".mockup").attr("class","mockup"),$("#"+a.id).attr("class","mockup active-mockup"),$(".link-ghost").remove(),a.master&&($("#"+a.master).attr("class","mockup active-master-mockup"),this.renderMockupLinks(this.library.currentProject.mockup(a.master))),this.renderMockupLinks(a);if(b){switch(FDBK.config("viewer.history.method")){case"pushState":if(window.history&&window.history.pushState){var e=window.location.pathname,f;/\/$/.test(e)||(e+="/"),FDBK.R_VIEWER_PAGE_PATTERN.test(e)?f=window.location.pathname.replace(FDBK.R_VIEWER_PAGE_PATTERN,function(b,c){return b.replace(c,a.id)}):f=e+"p:"+a.id,window.history.pushState({mockupId:a.id},a.name,f);break}break;case"hash":window.location.hash="#"+a.id;break;case"none":}$.each($("#"+a.id).find("path"),function(a,b){var c=b.getAttribute("fill"),d=b.getAttribute("marker-start"),e=b.getAttribute("marker-end");c&&(b.removeAttribute("fill"),b.setAttribute("fill",c)),d&&(b.removeAttribute("marker-start"),b.setAttribute("marker-start",d)),e&&(b.removeAttribute("marker-end"),b.setAttribute("marker-end",e))})}FDBK.library.currentMockup=a,FDBK.pub("mockup-changed",a)},updateViewerUI:function(a){var b=FDBK.library.currentProject.normalPages(),c=b.indexOf(a);utils.setDocumentTitle(FDBK.library.currentProject.name+" / "+a.name),$("#project-name").html("<em>"+utils.sanitize(FDBK.library.currentProject.name)+" /</em> "+utils.sanitize(a.name)),$("#page-count").html(utils.sanitize(""+(c+1)+" / "+b.length)),$("#prev-page").toggleClass("disabled",c===0),$("#next-page").toggleClass("disabled",c==b.length-1)}});var MODULE=function(a,b){function d(a){return/^[a-z0-9._-]+$/i.test(a)}var c=!1;return a.setLoggedState=function(d){d?(c=!0,b.cookie("hasAccount","true",{expires:365,path:"/"}),FDBK.pub("user-logged-in")):(c=!1,FDBK.pub("user-logged-out")),a.setAccountMenu(),a.checkHash()},a.isUserLoggedIn=function(){return c},a.setAccountMenu=function(){var c=b("#account-menu");if(a.isUserLoggedIn()){var d=b.trim(FDBK.USER_DATA.fullName)?FDBK.USER_DATA.fullName:FDBK.USER_DATA.userName;c.html(b("#tmpl-logged").loc_tmpl({name:d,gravatar:utils.gravatarImageURL(FDBK.USER_DATA.email),isPremium:FDBK.hasPremiumPlan()}))}else c.html(b("#tmpl-nosession").loc_tmpl())},FDBK.sub("update-profile-dependencies plan-updated",function(){a.setAccountMenu()}),b(document).on("click",".open-login",function(){a.showLoginDialog()}),b(document).on("click",".open-register",function(){a.showRegisterDialog()}),b(document).on("click",".open-dialog",function(){!b(this).hasClass("disabled")&&b(this).data("dialog")=="reset"&&a.showResetDialog()}),b(document).on("submit","#login-form",function(){if(a.inProgressRequest)return!1;var c={j_username:b("[name=j_username]").val(),j_password:b("[name=j_password]").val(),ajax:"true"};b("#remember").is(":checked")&&(c.rememberme="true"),FDBK.API.xhr(FDBK.API.CALL_LOGIN,{contentType:"application/x-www-form-urlencoded",data:c,success:function(c){if(c.success){FDBK.pub("user-login-success"),b("#login-dialog").is(":visible")&&FDBK.closeModal();try{a.getUserData()}catch(d){}}else FDBK.showServerError({message:FDBK.loc("_Invalid username or password"),style:"error"}),b(".reset-input").val("")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),a.canViewProject=function(){var b=a.currentProject.canViewProject();return b||a.checkForActivationToken(),b},a.validateActivationToken=function(c,d){FDBK.API.xhr(FDBK.API.CALL_GET_TOKEN_INFO,{data:{token:c},success:function(e){e.success&&e.object.email?(a.showActivateDialog(),b("#tokenInput").val(c),b("#activateEmail").val(e.object.email),FDBK.showServerError({message:"Please choose your username and password"})):a.showLoginDialog(),b("#preloader").hide(),d&&d()},error:function(){a.showLoginDialog(),b("#preloader").hide(),d&&d()},traditional:!0})},a.checkForActivationToken=function(){var c=window.location.hash;if(c.indexOf("activate?at=")!=-1){var d=c.split("="),e=d[1];a.validateActivationToken(e)}else a.showLoginDialog(),FDBK.library.currentProject.permission=="forbidden"&&FDBK.showServerError({message:FDBK.loc("_You don't have access to this project")}),b("#toolbar-options").hide(),FDBK.centerTheProject(),b("#preloader").hide()},b(document).on("submit","#register-form",function(){if(a.inProgressRequest)return!1;var c={email:b.trim(b("#signupEmail").val()),userName:b.trim(b("#signupUsername").val()),password:b("#signupPassword").val()};return c.userName&&!d(c.userName)?(b("#signupUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_SIGN_UP,{data:JSON.stringify(c),success:function(d){if(d.success)FDBK.pub("account-created"),b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.pub("signup-error",e),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b(document).on("submit","#activate-form",function(){if(a.inProgressRequest)return!1;var c={token:b.trim(b("#tokenInput").val()),userName:b.trim(b("#activateUsername").val()),password:b("#activatePassword").val()};return c.userName&&!d(c.userName)?(b("#activateUsername").blur(),!1):(FDBK.API.xhr(FDBK.API.CALL_ACTIVATE_USER,{contentType:"application/x-www-form-urlencoded",data:c,success:function(d){if(d.success)FDBK.pub("account-created"),b("[name=j_username]").val(c.userName),b("[name=j_password]").val(c.password),a.inProgressRequest=!1,b("#login-form").submit();else{var e;d.object.emailError?e=d.object.emailError:d.object.usernameError?e=d.object.usernameError:d.object.passwordError?e=d.object.passwordError:d.object.CodeError?e=d.object.CodeError:d.object.inviteCodeError&&(e=d.object.inviteCodeError),FDBK.showServerError({message:FDBK.loc(e),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}),!1)}),b("#signupEmail").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&FDBK.API.xhr(FDBK.API.CALL_CHECK_EMAIL,{data:{email:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b("#signupUsername, #activateUsername").blur(function(){var a=b(this),c=b.trim(a.val());a.removeClass("error").parent().find("p").remove(),c&&d(c)?FDBK.API.xhr(FDBK.API.CALL_CHECK_USER,{data:{name:c},dataType:"html",success:function(c){b.parseJSON(c).available||a.addClass("error").after('<p class="error">'+FDBK.loc(b.parseJSON(c).message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c&&!d(c)&&a.addClass("error").after('<p class="error">'+FDBK.loc("usernameNotValid")+"</p>")}),b("#signupPassword, #activatePassword").blur(function(){var a=b(this),c=a.val();a.parent().find("p").remove(),c&&c.length<5?a.addClass("error").after('<p class="error">'+FDBK.loc("passwordLength")+"</p>"):a.removeClass("error")}),a.askForSession=function(){b.cookie("hasAccount")||a.currentProject&&a.currentProject.uniqueId?(a.showLoginDialog(),FDBK.showServerError({message:FDBK.loc("_You need to sign in to perform this action.")})):(a.showRegisterDialog(),FDBK.showServerError({message:FDBK.loc("_You need an account to perform this action.")})),FDBK.pub("action-requires-account")},a.showLoginDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#login-dialog","sign-in"),b("[name=j_username]").focus()):FDBK.showCookiesAlert()},a.showRegisterDialog=function(){FDBK.hasCookies()?(FDBK.openModal("#register-dialog","register"),FDBK.pub("opened-signup-dialog")):FDBK.showCookiesAlert()},a.showActivateDialog=function(){FDBK.hasCookies()?FDBK.openModal("#activate-dialog","activate"):FDBK.showCookiesAlert()},a.showResetDialog=function(){FDBK.openModal("#reset-dialog","reset")},b(document).on("submit","#reset-form",function(){if(a.inProgressRequest)return!1;var c=b("#recover-email"),d=b.trim(c.val());return c.removeClass("error").parent().find("p").remove(),d?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RECOVER_PASSWORD,{data:{email:d},success:function(a){a.success?FDBK.openModal("#reset-success-dialog"):c.addClass("error").after('<p class="error">'+FDBK.loc(a.message)+"</p>")},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):c.addClass("error").after('<p class="error">'+FDBK.loc("emailBlank")+"</p>"),!1}),b(document).on("submit","#password-form",function(){if(a.inProgressRequest)return!1;var c=b("#newPassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==b("#reNewPassword").val()?a.inProgressRequest||FDBK.API.xhr(FDBK.API.CALL_RESET_PASSWORD,{data:JSON.stringify({token:FDBK.resetToken,newPwd:c}),success:function(a){a.success?FDBK.openConfirmDialog({heading:FDBK.loc("_Password changed"),message:FDBK.loc("_Password successfully changed"),buttons:[{text:FDBK.loc("_Sign in"),classes:"right open-login primary-action"},{text:FDBK.loc("_Close"),classes:"close-modal"}]}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),b(document).on("submit","#profile-form",function(){FDBK.USER_DATA.fullName=b.trim(b(this).find("[name=fullName]").val()),FDBK.USER_DATA.email=b.trim(b(this).find("[name=email]").val()),FDBK.USER_DATA.company=b.trim(b(this).find("[name=company]").val()),FDBK.USER_DATA.location=b.trim(b(this).find("[name=location]").val()),FDBK.USER_DATA.url=b.trim(b(this).find("[name=url]").val()),FDBK.API.xhr(FDBK.API.CALL_UPDATE_CURRENT_USER,{data:JSON.stringify({email:FDBK.USER_DATA.email,fullName:FDBK.USER_DATA.fullName,company:FDBK.USER_DATA.company,location:FDBK.USER_DATA.location,url:FDBK.USER_DATA.url}),success:function(a){if(a.success)FDBK.closeModal(),FDBK.pub("update-profile-dependencies");else{var b;a.object.emailError?b=a.object.emailError:a.object.usernameError&&(b=a.object.usernameError),FDBK.showServerError({message:FDBK.loc(b),style:"error"})}},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}})}),b(document).on("submit","#change-form",function(){if(a.inProgressRequest)return!1;var c=b("#changePassword").val(),d=b("#oldPassword").val(),e=b("#changeRePassword").val();return c&&c.length<5?FDBK.showServerError({message:FDBK.loc("passwordLength"),style:"error"}):c?c==e?FDBK.API.xhr(FDBK.API.CALL_CHANGE_PASSWORD,{data:JSON.stringify({name:FDBK.USER_DATA.userName,oldPwd:d,newPwd:c}),success:function(a){a.success?FDBK.openConfirmDialog({heading:FDBK.loc("_Password changed"),message:FDBK.loc("_Password successfully changed"),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal primary-action"}]}):FDBK.showServerError({message:FDBK.loc(a.message),style:"error"})},error:function(){FDBK.showServerError({message:FDBK.loc("_Oops. Something went wrong. Please try again."),style:"error"})}}):FDBK.showServerError({message:FDBK.loc("_Passwords do not match."),style:"error"}):FDBK.showServerError({message:FDBK.loc("_Password cannot be empty."),style:"error"}),!1}),a}(MODULE||{},jQuery);FDBK.mixinModule("project-comments",{comments:[],commentsSelection:"all",COMMENTS_SELECTION_ALL:"all",COMMENTS_SELECTION_CURRENT:"current",$sidebarComments:null,$commentsWrapper:null,$commentsButton:null,replyToCommentId:!1,initModule:function(){function g(a){var c=null,d=FDBK.library.currentMockup.id,e=$("#new-comment"),g=e.val();if(b.replyToCommentId){c=b.replyToCommentId;var h=b.getComment(c);h&&h.pageId&&(d=h.pageId)}if($.trim(g)){var i={};FDBK.library.currentMockup.selection.length&&(i.stencilIds=FDBK.library.currentMockup.selection.map(function(a){return a.id})),b.postComment({uniqueId:"comment-"+utils.guid(),projectUniqueId:FDBK.library.currentProject.uniqueId,parentUniqueId:c,pageId:d,text:g,attributes:JSON.stringify(i),author:FDBK.USER_DATA}),e.val("").blur(),c&&$(".cancel-comment").click()}f()}this.$sidebarComments=$("#comments"),this.$commentsWrapper=$(".comments-wrapper"),this.$commentsButton=$("#comments-button"),this.$metaGhostWrapper=$("#meta-ghost-wrapper");var a=BrowserDetect.isMac?"&#8984;&#8617;":"Ctrl+Enter";$(".submit-comment-shortcut").html(a);var b=this;FDBK.sub("open-project",function(){this.$commentsButton.find(".comment-count").text(""),FDBK.VIEWER_MODE&&FDBK.library.currentProject.ownerIsPremium&&!FDBK.USER_DATA.userName&&(this.$commentsButton.hide(),$("#notification-settings").hide(),FDBK.API.xhr(FDBK.API.CALL_GET_CURRENT_USER,{success:function(a){a.success&&(FDBK.USER_DATA=$.extend(FDBK.USER_DATA,a.object.user)),b.$commentsButton.show(),FDBK.library.currentProject.canCommentProject()&&$("#notification-settings").show(),FDBK.pub("viewer-user-logged-in")},error:function(){b.$commentsButton.show()}}))}),FDBK.sub("user-logged-in open-project",function(){FDBK.library.isUserLoggedIn()&&FDBK.library.currentProject&&this.$commentsButton.removeClass("disabled")}),FDBK.sub("user-logged-out close-project",function(){this.$commentsButton.addClass("disabled").removeClass("pressed"),this.comments.length=0,this.$sidebarComments.empty(),$("body").removeClass("has-right-sidebar")}),FDBK.sub("viewer-user-logged-in mockup-changed",function(){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.showComments()}),FDBK.sub("open-project refresh-comments",function(a){FDBK.library.currentProject&&(FDBK.hasPremiumPlan()||FDBK.library.currentProject.isPremiumProject())&&FDBK.library.currentProject.canCommentProject()&&b.fetchComments()}),FDBK.config("comments.stencilLinks.enabled")&&$(document).on("click",".comment-link",function(){FDBK.goToStencils($(this).data("stencil-ids").split(" "))}),b.$commentsButton.on("click",function(){if($(this).hasClass("disabled"))return;if(FDBK.VIEWER_MODE&&!FDBK.USER_DATA.userName){FDBK.library.askForSession();return}if(FDBK.VIEWER_MODE&&!FDBK.library.currentProject.canCommentProject()){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_You're not authorized to comment on this project"),buttons:[{text:FDBK.loc("_OK"),classes:"close-modal"}]});return}if(!FDBK.VIEWER_MODE&&!FDBK.hasPremiumPlan()&&!FDBK.library.currentProject.isPremiumProject()){FDBK.showCommentsAlert();return}$(this).toggleClass("pressed"),$("body").toggleClass("has-right-sidebar"),FDBK.centerTheProject&&setTimeout(function(){FDBK.centerTheProject()},300)}),$("#comments").on("click","a",function(a){var c=$(this).data("type"),d=$(a.target).closest(".comment"),e=d.data("id");c==="delete"?d.length>0&&(a.shiftKey?b.deleteComment(e):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_Are you sure you want to delete this comment ?"),buttons:[{text:FDBK.loc("_Delete"),classes:"primary-action",onClick:function(){b.deleteComment(e)}},{text:FDBK.loc("_Cancel"),classes:"close-modal"}]})):c==="reply"?(b.replyToCommentId=e,$("#add-comment").find(".new").hide().end().find(".reply").show(),$(this).parents(".comment").siblings().addClass("disabled"),$("#new-comment").prop("placeholder","Reply to comment...").focus()):c==="unlink"&&b.unlinkComment(e)});var c=$("#comments-sidebar"),d=$("#add-comment"),e=function(){c.removeClass("hide-new-comment")},f=function(){c.addClass("hide-new-comment")};FDBK.config("comments.stencilLinks.enabled")&&FDBK.sub("selection-changed",function(a){a.length?d.addClass("link-to-stencil"):d.removeClass("link-to-stencil")}),$("#new-comment").on({focus:e}),$(document).on("click",".cancel-comment",function(){b.replyToCommentId=!1,$("#add-comment").find(".reply").hide().end().find(".new").show(),$(".comment").removeClass("disabled"),$("#new-comment").prop("placeholder","New comment..."),f()}),$(document).on("click",".send-comment",g),$("#new-comment").on("keydown",null,"meta+return ctrl+return",g),jQuery.fn.highlight=function(a,b){$(this).each(function(){var c=$(this);c.before("<div/>"),c.prev().width(c.width()).height(c.height()).css({position:"absolute","background-color":a,opacity:".7"}).fadeOut(b)})},FDBK.sub("open-project",function(){$("[name=comments-notification]").prop("checked",FDBK.library.currentProject.notificationsCommentsEnabled)}),$(document).on("change","[name=comments-notification]",function(){var a=$(this).is(":checked");FDBK.library.currentProject.notificationsCommentsEnabled=a,FDBK.API.xhr(FDBK.API.CALL_SET_NOTIFICATION,{data:{enabled:a,type:"comments",projectUniqueId:FDBK.library.currentProject.uniqueId},contentType:"application/x-www-form-urlencoded"})}),FDBK.config("comments.allVsCurrent.enabled")?($("#comments-selector").on("click","a",function(){var a=$(this).data("value");switch(a){case"all":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_ALL;break;case"current":FDBK.commentsSelection=FDBK.COMMENTS_SELECTION_CURRENT}$(this).addClass("selected").siblings("a").removeClass("selected"),b.showComments()}),$("#comments-selector a[data-value="+FDBK.commentsSelection+"]").addClass("selected")):$("#comments-selector").hide()},goToStencils:function(a){if(!a.length)return;var b=FDBK.library,c=b.currentProject.mockupFromStencilId(a[0]);if(!c){console.info("This stencil is not available; mockup not found.");return}c.id!==b.currentMockup.id&&(FDBK.VIEWER_MODE?FDBK.switchToMockup(c,!0):b.changeActiveMockup(c.id));var d=a.filter(function(a){return b.currentMockup.stencil(a)!==null&&document.getElementById(a)});if(d.length){FDBK.VIEWER_MODE?FDBK.highlightStencils(d):(b.currentMockup.selection=d.map(function(a){return document.getElementById(a)}),b.showSelection(),b.focusStage());var e=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).top})),f=Math.min.apply(this,d.map(function(a){return b.currentMockup.stencil(a).left})),g=FDBK.VIEWER_MODE?document.getElementById("page"):document.getElementById("project-wrapper");g.scrollLeft=f,g.scrollTop=e}else FDBK.VIEWER_MODE||(b.currentMockup.selection.length=0,b.showSelection(),b.focusStage())},showCommentGhosts:function(a){for(var b=0;b<a.length;b++){var c=a[b].id,d=FDBK.library.currentMockup.stencil(c);d&&this.$metaGhostWrapper.find("[data-stencil="+c+"]").css({top:d.top,left:d.left})}this.$metaGhostWrapper.removeClass("hidden")},hideCommentGhosts:function(a){this.$metaGhostWrapper.addClass("hidden")},getCommentsForPage:function(a){return this.comments.filter(function(b){return!a||b.pageId===a})},getComment:function(a){var b=this.getCommentsForPage();for(var c=0;c<b.length;c++){var d=b[c];if(d.uniqueId==a)return d}return null},sortComments:function(){var a=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?-1:a.createDate<b.createDate?1:0:1:-1},b=function(a,b){return a.createDate?b.createDate?a.createDate>b.createDate?1:a.createDate<b.createDate?-1:0:-1:1};this.comments=this.comments.filter(function(a){return!a.parentUniqueId}).sort(a).concat(this.comments.filter(function(a){return a.parentUniqueId}).sort(b))},getCommentSummary:function(a){var b="",c=this.getComment(a);return c.text.length<=30?b=c.text:b=c.text.substring(0,30)+"...",b},scrollSidebarToComment:function(a){var b=this.getComment(a),c=a;b.parentUniqueId&&(c=b.parentUniqueId);var d=this.$sidebarComments.find("[data-id="+c+"]");this.$commentsWrapper.scrollTop(this.$commentsWrapper.scrollTop()+d.position().top),this.$sidebarComments.find("[data-id="+a+"]").highlight("#c2e2fd",600)},showComments:function(a){var b=FDBK.commentsSelection===FDBK.COMMENTS_SELECTION_ALL?null:FDBK.library.currentMockup.id,c=this.getCommentsForPage(b);a&&a.highlight&&(this._commentHighlightTimer||(this._commentHighlightTimer=AppSeeds.Scheduler.create(function(){FDBK.$commentsButton.removeClass("button-highlighted")}).delay(1e3)),this.$commentsButton.addClass("button-highlighted"),this._commentHighlightTimer.reset());var d=FDBK.library.currentProject.canDeleteComments(),e=$("#tmpl-comment");this.$sidebarComments.empty(),this.$commentsButton.find(".comment-count").text(this.comments.length);if(c.length)for(var f=0;f<c.length;f++){var g=c[f];g=$.extend(!0,g,{canDeleteComment:d,commentMarkdownHtml:utils.markdown(g.text),timestamp:moment(Math.min(g.createDate,FDBK.SERVER_TIME)).from(Math.max(FDBK.SERVER_TIME,g.createDate))+"",author:{avatar:utils.gravatarImageURL(g.author.email)}}),!FDBK.config("comments.stencilLinks.enabled")&&g.attributes&&g.attributes.stencilIds&&delete g.attributes.stencilIds;var h=g.parentUniqueId?this.$sidebarComments.find("[data-id="+g.parentUniqueId+"]"):this.$sidebarComments;h.append(e.loc_tmpl(g))}else this.$sidebarComments.append('<p class="no-comments">'+FDBK.loc("_No comments for this page.")+"</p>")},ALL_PAGES:"ALL_PAGES_EVER",fetchComments:function(){var a=this;FDBK.API.xhr(FDBK.API.CALL_GET_COMMENTS,{data:{projectUniqueId:FDBK.library.currentProject.uniqueId},success:function(b){b.success?(a.comments=(b.object||[]).map(a.prepareComments),a.sortComments(),a.showComments({highlight:!0})):a.showErrorOnFetchComments()},error:function(){a.showErrorOnFetchComments()}})},showErrorOnFetchComments:function(){},prepareComments:function(a){if(typeof a.attributes=="string")try{a.attributes=JSON.parse(a.attributes)}catch(b){console.warn("could not parse comment attributes")}return a},addComment:function(a,b){this.prepareComments(b),this.comments.push(b),this.sortComments(),this.showComments(),this.scrollSidebarToComment(b.uniqueId),FDBK.pub("comment-posted",a,b)},postComment:function(a){function g(a,c){var d=b.comments;for(var e=0;e<d.length;e++)d[e].uniqueId===a&&(d[e].uniqueId=c.uniqueId,d[e].createDate=c.createDate);b.showComments()}var b=this,c=FDBK.library.currentMockup.id,d=["projectUniqueId","parentUniqueId","pageId","text","attributes"],e={};for(var f=0;f<d.length;f++)e[d[f]]=a[d[f]];FDBK.API.xhr(FDBK.API.CALL_ADD_COMMENT,{data:JSON.stringify(e),success:function(b){b.success?g(a.uniqueId,b.object):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error posting your comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}}),b.addComment(c,a)},unlinkComment:function(a){},deleteComment:function(a){var b=this,c=FDBK.library.currentMockup.id;this.comments=this.comments.filter(function(b){return b.uniqueId!=a&&b.parentUniqueId!=a}),this.showComments(),FDBK.API.xhr(FDBK.API.CALL_DELETE_COMMENTS,{data:{uniqueId:a},success:function(a){a.success?FDBK.pub("comment-posted",c):FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})},error:function(){FDBK.openConfirmDialog({heading:FDBK.loc("_Warning"),message:FDBK.loc("_There was an error while deleting the comment. Please try again."),buttons:[{text:FDBK.loc("_Close"),classes:"close-modal"}]})}})}})